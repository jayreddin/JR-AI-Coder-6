function b1(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in n)){const o=Object.getOwnPropertyDescriptor(r,i);o&&Object.defineProperty(n,i,o.get?o:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}function Gl(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Bp={exports:{}},al={};var jE;function oN(){if(jE)return al;jE=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(r,i,o){var l=null;if(o!==void 0&&(l=""+o),i.key!==void 0&&(l=""+i.key),"key"in i){o={};for(var f in i)f!=="key"&&(o[f]=i[f])}else o=i;return i=o.ref,{$$typeof:n,type:r,key:l,ref:i!==void 0?i:null,props:o}}return al.Fragment=e,al.jsx=t,al.jsxs=t,al}var HE;function cN(){return HE||(HE=1,Bp.exports=oN()),Bp.exports}var bH=cN(),Pp={exports:{}},ol={},$p={exports:{}},Kp={};var qE;function lN(){return qE||(qE=1,(function(n){function e(P,ne){var me=P.length;P.push(ne);e:for(;0<me;){var Be=me-1>>>1,Pe=P[Be];if(0<i(Pe,ne))P[Be]=ne,P[me]=Pe,me=Be;else break e}}function t(P){return P.length===0?null:P[0]}function r(P){if(P.length===0)return null;var ne=P[0],me=P.pop();if(me!==ne){P[0]=me;e:for(var Be=0,Pe=P.length,T=Pe>>>1;Be<T;){var V=2*(Be+1)-1,Q=P[V],ae=V+1,le=P[ae];if(0>i(Q,me))ae<Pe&&0>i(le,Q)?(P[Be]=le,P[ae]=me,Be=ae):(P[Be]=Q,P[V]=me,Be=V);else if(ae<Pe&&0>i(le,me))P[Be]=le,P[ae]=me,Be=ae;else break e}}return ne}function i(P,ne){var me=P.sortIndex-ne.sortIndex;return me!==0?me:P.id-ne.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var o=performance;n.unstable_now=function(){return o.now()}}else{var l=Date,f=l.now();n.unstable_now=function(){return l.now()-f}}var h=[],m=[],y=1,g=null,b=3,E=!1,_=!1,S=!1,k=!1,M=typeof setTimeout=="function"?setTimeout:null,x=typeof clearTimeout=="function"?clearTimeout:null,$=typeof setImmediate<"u"?setImmediate:null;function L(P){for(var ne=t(m);ne!==null;){if(ne.callback===null)r(m);else if(ne.startTime<=P)r(m),ne.sortIndex=ne.expirationTime,e(h,ne);else break;ne=t(m)}}function j(P){if(S=!1,L(P),!_)if(t(h)!==null)_=!0,W||(W=!0,Ee());else{var ne=t(m);ne!==null&&Ne(j,ne.startTime-P)}}var W=!1,G=-1,H=5,ie=-1;function de(){return k?!0:!(n.unstable_now()-ie<H)}function be(){if(k=!1,W){var P=n.unstable_now();ie=P;var ne=!0;try{e:{_=!1,S&&(S=!1,x(G),G=-1),E=!0;var me=b;try{t:{for(L(P),g=t(h);g!==null&&!(g.expirationTime>P&&de());){var Be=g.callback;if(typeof Be=="function"){g.callback=null,b=g.priorityLevel;var Pe=Be(g.expirationTime<=P);if(P=n.unstable_now(),typeof Pe=="function"){g.callback=Pe,L(P),ne=!0;break t}g===t(h)&&r(h),L(P)}else r(h);g=t(h)}if(g!==null)ne=!0;else{var T=t(m);T!==null&&Ne(j,T.startTime-P),ne=!1}}break e}finally{g=null,b=me,E=!1}ne=void 0}}finally{ne?Ee():W=!1}}}var Ee;if(typeof $=="function")Ee=function(){$(be)};else if(typeof MessageChannel<"u"){var Pt=new MessageChannel,$t=Pt.port2;Pt.port1.onmessage=be,Ee=function(){$t.postMessage(null)}}else Ee=function(){M(be,0)};function Ne(P,ne){G=M(function(){P(n.unstable_now())},ne)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(P){P.callback=null},n.unstable_forceFrameRate=function(P){0>P||125<P?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):H=0<P?Math.floor(1e3/P):5},n.unstable_getCurrentPriorityLevel=function(){return b},n.unstable_next=function(P){switch(b){case 1:case 2:case 3:var ne=3;break;default:ne=b}var me=b;b=ne;try{return P()}finally{b=me}},n.unstable_requestPaint=function(){k=!0},n.unstable_runWithPriority=function(P,ne){switch(P){case 1:case 2:case 3:case 4:case 5:break;default:P=3}var me=b;b=P;try{return ne()}finally{b=me}},n.unstable_scheduleCallback=function(P,ne,me){var Be=n.unstable_now();switch(typeof me=="object"&&me!==null?(me=me.delay,me=typeof me=="number"&&0<me?Be+me:Be):me=Be,P){case 1:var Pe=-1;break;case 2:Pe=250;break;case 5:Pe=1073741823;break;case 4:Pe=1e4;break;default:Pe=5e3}return Pe=me+Pe,P={id:y++,callback:ne,priorityLevel:P,startTime:me,expirationTime:Pe,sortIndex:-1},me>Be?(P.sortIndex=me,e(m,P),t(h)===null&&P===t(m)&&(S?(x(G),G=-1):S=!0,Ne(j,me-Be))):(P.sortIndex=Pe,e(h,P),_||E||(_=!0,W||(W=!0,Ee()))),P},n.unstable_shouldYield=de,n.unstable_wrapCallback=function(P){var ne=b;return function(){var me=b;b=ne;try{return P.apply(this,arguments)}finally{b=me}}}})(Kp)),Kp}var FE;function uN(){return FE||(FE=1,$p.exports=lN()),$p.exports}var jp={exports:{}},ve={};var VE;function fN(){if(VE)return ve;VE=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),l=Symbol.for("react.context"),f=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),m=Symbol.for("react.memo"),y=Symbol.for("react.lazy"),g=Symbol.for("react.activity"),b=Symbol.iterator;function E(T){return T===null||typeof T!="object"?null:(T=b&&T[b]||T["@@iterator"],typeof T=="function"?T:null)}var _={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},S=Object.assign,k={};function M(T,V,Q){this.props=T,this.context=V,this.refs=k,this.updater=Q||_}M.prototype.isReactComponent={},M.prototype.setState=function(T,V){if(typeof T!="object"&&typeof T!="function"&&T!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,T,V,"setState")},M.prototype.forceUpdate=function(T){this.updater.enqueueForceUpdate(this,T,"forceUpdate")};function x(){}x.prototype=M.prototype;function $(T,V,Q){this.props=T,this.context=V,this.refs=k,this.updater=Q||_}var L=$.prototype=new x;L.constructor=$,S(L,M.prototype),L.isPureReactComponent=!0;var j=Array.isArray;function W(){}var G={H:null,A:null,T:null,S:null},H=Object.prototype.hasOwnProperty;function ie(T,V,Q){var ae=Q.ref;return{$$typeof:n,type:T,key:V,ref:ae!==void 0?ae:null,props:Q}}function de(T,V){return ie(T.type,V,T.props)}function be(T){return typeof T=="object"&&T!==null&&T.$$typeof===n}function Ee(T){var V={"=":"=0",":":"=2"};return"$"+T.replace(/[=:]/g,function(Q){return V[Q]})}var Pt=/\/+/g;function $t(T,V){return typeof T=="object"&&T!==null&&T.key!=null?Ee(""+T.key):V.toString(36)}function Ne(T){switch(T.status){case"fulfilled":return T.value;case"rejected":throw T.reason;default:switch(typeof T.status=="string"?T.then(W,W):(T.status="pending",T.then(function(V){T.status==="pending"&&(T.status="fulfilled",T.value=V)},function(V){T.status==="pending"&&(T.status="rejected",T.reason=V)})),T.status){case"fulfilled":return T.value;case"rejected":throw T.reason}}throw T}function P(T,V,Q,ae,le){var _e=typeof T;(_e==="undefined"||_e==="boolean")&&(T=null);var Le=!1;if(T===null)Le=!0;else switch(_e){case"bigint":case"string":case"number":Le=!0;break;case"object":switch(T.$$typeof){case n:case e:Le=!0;break;case y:return Le=T._init,P(Le(T._payload),V,Q,ae,le)}}if(Le)return le=le(T),Le=ae===""?"."+$t(T,0):ae,j(le)?(Q="",Le!=null&&(Q=Le.replace(Pt,"$&/")+"/"),P(le,V,Q,"",function(qr){return qr})):le!=null&&(be(le)&&(le=de(le,Q+(le.key==null||T&&T.key===le.key?"":(""+le.key).replace(Pt,"$&/")+"/")+Le)),V.push(le)),1;Le=0;var bt=ae===""?".":ae+":";if(j(T))for(var ct=0;ct<T.length;ct++)ae=T[ct],_e=bt+$t(ae,ct),Le+=P(ae,V,Q,_e,le);else if(ct=E(T),typeof ct=="function")for(T=ct.call(T),ct=0;!(ae=T.next()).done;)ae=ae.value,_e=bt+$t(ae,ct++),Le+=P(ae,V,Q,_e,le);else if(_e==="object"){if(typeof T.then=="function")return P(Ne(T),V,Q,ae,le);throw V=String(T),Error("Objects are not valid as a React child (found: "+(V==="[object Object]"?"object with keys {"+Object.keys(T).join(", ")+"}":V)+"). If you meant to render a collection of children, use an array instead.")}return Le}function ne(T,V,Q){if(T==null)return T;var ae=[],le=0;return P(T,ae,"","",function(_e){return V.call(Q,_e,le++)}),ae}function me(T){if(T._status===-1){var V=T._result;V=V(),V.then(function(Q){(T._status===0||T._status===-1)&&(T._status=1,T._result=Q)},function(Q){(T._status===0||T._status===-1)&&(T._status=2,T._result=Q)}),T._status===-1&&(T._status=0,T._result=V)}if(T._status===1)return T._result.default;throw T._result}var Be=typeof reportError=="function"?reportError:function(T){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var V=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof T=="object"&&T!==null&&typeof T.message=="string"?String(T.message):String(T),error:T});if(!window.dispatchEvent(V))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",T);return}console.error(T)},Pe={map:ne,forEach:function(T,V,Q){ne(T,function(){V.apply(this,arguments)},Q)},count:function(T){var V=0;return ne(T,function(){V++}),V},toArray:function(T){return ne(T,function(V){return V})||[]},only:function(T){if(!be(T))throw Error("React.Children.only expected to receive a single React element child.");return T}};return ve.Activity=g,ve.Children=Pe,ve.Component=M,ve.Fragment=t,ve.Profiler=i,ve.PureComponent=$,ve.StrictMode=r,ve.Suspense=h,ve.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=G,ve.__COMPILER_RUNTIME={__proto__:null,c:function(T){return G.H.useMemoCache(T)}},ve.cache=function(T){return function(){return T.apply(null,arguments)}},ve.cacheSignal=function(){return null},ve.cloneElement=function(T,V,Q){if(T==null)throw Error("The argument must be a React element, but you passed "+T+".");var ae=S({},T.props),le=T.key;if(V!=null)for(_e in V.key!==void 0&&(le=""+V.key),V)!H.call(V,_e)||_e==="key"||_e==="__self"||_e==="__source"||_e==="ref"&&V.ref===void 0||(ae[_e]=V[_e]);var _e=arguments.length-2;if(_e===1)ae.children=Q;else if(1<_e){for(var Le=Array(_e),bt=0;bt<_e;bt++)Le[bt]=arguments[bt+2];ae.children=Le}return ie(T.type,le,ae)},ve.createContext=function(T){return T={$$typeof:l,_currentValue:T,_currentValue2:T,_threadCount:0,Provider:null,Consumer:null},T.Provider=T,T.Consumer={$$typeof:o,_context:T},T},ve.createElement=function(T,V,Q){var ae,le={},_e=null;if(V!=null)for(ae in V.key!==void 0&&(_e=""+V.key),V)H.call(V,ae)&&ae!=="key"&&ae!=="__self"&&ae!=="__source"&&(le[ae]=V[ae]);var Le=arguments.length-2;if(Le===1)le.children=Q;else if(1<Le){for(var bt=Array(Le),ct=0;ct<Le;ct++)bt[ct]=arguments[ct+2];le.children=bt}if(T&&T.defaultProps)for(ae in Le=T.defaultProps,Le)le[ae]===void 0&&(le[ae]=Le[ae]);return ie(T,_e,le)},ve.createRef=function(){return{current:null}},ve.forwardRef=function(T){return{$$typeof:f,render:T}},ve.isValidElement=be,ve.lazy=function(T){return{$$typeof:y,_payload:{_status:-1,_result:T},_init:me}},ve.memo=function(T,V){return{$$typeof:m,type:T,compare:V===void 0?null:V}},ve.startTransition=function(T){var V=G.T,Q={};G.T=Q;try{var ae=T(),le=G.S;le!==null&&le(Q,ae),typeof ae=="object"&&ae!==null&&typeof ae.then=="function"&&ae.then(W,Be)}catch(_e){Be(_e)}finally{V!==null&&Q.types!==null&&(V.types=Q.types),G.T=V}},ve.unstable_useCacheRefresh=function(){return G.H.useCacheRefresh()},ve.use=function(T){return G.H.use(T)},ve.useActionState=function(T,V,Q){return G.H.useActionState(T,V,Q)},ve.useCallback=function(T,V){return G.H.useCallback(T,V)},ve.useContext=function(T){return G.H.useContext(T)},ve.useDebugValue=function(){},ve.useDeferredValue=function(T,V){return G.H.useDeferredValue(T,V)},ve.useEffect=function(T,V){return G.H.useEffect(T,V)},ve.useEffectEvent=function(T){return G.H.useEffectEvent(T)},ve.useId=function(){return G.H.useId()},ve.useImperativeHandle=function(T,V,Q){return G.H.useImperativeHandle(T,V,Q)},ve.useInsertionEffect=function(T,V){return G.H.useInsertionEffect(T,V)},ve.useLayoutEffect=function(T,V){return G.H.useLayoutEffect(T,V)},ve.useMemo=function(T,V){return G.H.useMemo(T,V)},ve.useOptimistic=function(T,V){return G.H.useOptimistic(T,V)},ve.useReducer=function(T,V,Q){return G.H.useReducer(T,V,Q)},ve.useRef=function(T){return G.H.useRef(T)},ve.useState=function(T){return G.H.useState(T)},ve.useSyncExternalStore=function(T,V,Q){return G.H.useSyncExternalStore(T,V,Q)},ve.useTransition=function(){return G.H.useTransition()},ve.version="19.2.4",ve}var GE;function Pg(){return GE||(GE=1,jp.exports=fN()),jp.exports}var Hp={exports:{}},cn={};var ZE;function hN(){if(ZE)return cn;ZE=1;var n=Pg();function e(h){var m="https://react.dev/errors/"+h;if(1<arguments.length){m+="?args[]="+encodeURIComponent(arguments[1]);for(var y=2;y<arguments.length;y++)m+="&args[]="+encodeURIComponent(arguments[y])}return"Minified React error #"+h+"; visit "+m+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var r={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},i=Symbol.for("react.portal");function o(h,m,y){var g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:g==null?null:""+g,children:h,containerInfo:m,implementation:y}}var l=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function f(h,m){if(h==="font")return"";if(typeof m=="string")return m==="use-credentials"?m:""}return cn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,cn.createPortal=function(h,m){var y=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!m||m.nodeType!==1&&m.nodeType!==9&&m.nodeType!==11)throw Error(e(299));return o(h,m,null,y)},cn.flushSync=function(h){var m=l.T,y=r.p;try{if(l.T=null,r.p=2,h)return h()}finally{l.T=m,r.p=y,r.d.f()}},cn.preconnect=function(h,m){typeof h=="string"&&(m?(m=m.crossOrigin,m=typeof m=="string"?m==="use-credentials"?m:"":void 0):m=null,r.d.C(h,m))},cn.prefetchDNS=function(h){typeof h=="string"&&r.d.D(h)},cn.preinit=function(h,m){if(typeof h=="string"&&m&&typeof m.as=="string"){var y=m.as,g=f(y,m.crossOrigin),b=typeof m.integrity=="string"?m.integrity:void 0,E=typeof m.fetchPriority=="string"?m.fetchPriority:void 0;y==="style"?r.d.S(h,typeof m.precedence=="string"?m.precedence:void 0,{crossOrigin:g,integrity:b,fetchPriority:E}):y==="script"&&r.d.X(h,{crossOrigin:g,integrity:b,fetchPriority:E,nonce:typeof m.nonce=="string"?m.nonce:void 0})}},cn.preinitModule=function(h,m){if(typeof h=="string")if(typeof m=="object"&&m!==null){if(m.as==null||m.as==="script"){var y=f(m.as,m.crossOrigin);r.d.M(h,{crossOrigin:y,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0})}}else m==null&&r.d.M(h)},cn.preload=function(h,m){if(typeof h=="string"&&typeof m=="object"&&m!==null&&typeof m.as=="string"){var y=m.as,g=f(y,m.crossOrigin);r.d.L(h,y,{crossOrigin:g,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0,type:typeof m.type=="string"?m.type:void 0,fetchPriority:typeof m.fetchPriority=="string"?m.fetchPriority:void 0,referrerPolicy:typeof m.referrerPolicy=="string"?m.referrerPolicy:void 0,imageSrcSet:typeof m.imageSrcSet=="string"?m.imageSrcSet:void 0,imageSizes:typeof m.imageSizes=="string"?m.imageSizes:void 0,media:typeof m.media=="string"?m.media:void 0})}},cn.preloadModule=function(h,m){if(typeof h=="string")if(m){var y=f(m.as,m.crossOrigin);r.d.m(h,{as:typeof m.as=="string"&&m.as!=="script"?m.as:void 0,crossOrigin:y,integrity:typeof m.integrity=="string"?m.integrity:void 0})}else r.d.m(h)},cn.requestFormReset=function(h){r.d.r(h)},cn.unstable_batchedUpdates=function(h,m){return h(m)},cn.useFormState=function(h,m,y){return l.H.useFormState(h,m,y)},cn.useFormStatus=function(){return l.H.useHostTransitionStatus()},cn.version="19.2.4",cn}var JE;function dN(){if(JE)return Hp.exports;JE=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),Hp.exports=hN(),Hp.exports}var WE;function mN(){if(WE)return ol;WE=1;var n=uN(),e=Pg(),t=dN();function r(s){var a="https://react.dev/errors/"+s;if(1<arguments.length){a+="?args[]="+encodeURIComponent(arguments[1]);for(var c=2;c<arguments.length;c++)a+="&args[]="+encodeURIComponent(arguments[c])}return"Minified React error #"+s+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function o(s){var a=s,c=s;if(s.alternate)for(;a.return;)a=a.return;else{s=a;do a=s,(a.flags&4098)!==0&&(c=a.return),s=a.return;while(s)}return a.tag===3?c:null}function l(s){if(s.tag===13){var a=s.memoizedState;if(a===null&&(s=s.alternate,s!==null&&(a=s.memoizedState)),a!==null)return a.dehydrated}return null}function f(s){if(s.tag===31){var a=s.memoizedState;if(a===null&&(s=s.alternate,s!==null&&(a=s.memoizedState)),a!==null)return a.dehydrated}return null}function h(s){if(o(s)!==s)throw Error(r(188))}function m(s){var a=s.alternate;if(!a){if(a=o(s),a===null)throw Error(r(188));return a!==s?null:s}for(var c=s,u=a;;){var d=c.return;if(d===null)break;var p=d.alternate;if(p===null){if(u=d.return,u!==null){c=u;continue}break}if(d.child===p.child){for(p=d.child;p;){if(p===c)return h(d),s;if(p===u)return h(d),a;p=p.sibling}throw Error(r(188))}if(c.return!==u.return)c=d,u=p;else{for(var w=!1,v=d.child;v;){if(v===c){w=!0,c=d,u=p;break}if(v===u){w=!0,u=d,c=p;break}v=v.sibling}if(!w){for(v=p.child;v;){if(v===c){w=!0,c=p,u=d;break}if(v===u){w=!0,u=p,c=d;break}v=v.sibling}if(!w)throw Error(r(189))}}if(c.alternate!==u)throw Error(r(190))}if(c.tag!==3)throw Error(r(188));return c.stateNode.current===c?s:a}function y(s){var a=s.tag;if(a===5||a===26||a===27||a===6)return s;for(s=s.child;s!==null;){if(a=y(s),a!==null)return a;s=s.sibling}return null}var g=Object.assign,b=Symbol.for("react.element"),E=Symbol.for("react.transitional.element"),_=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),k=Symbol.for("react.strict_mode"),M=Symbol.for("react.profiler"),x=Symbol.for("react.consumer"),$=Symbol.for("react.context"),L=Symbol.for("react.forward_ref"),j=Symbol.for("react.suspense"),W=Symbol.for("react.suspense_list"),G=Symbol.for("react.memo"),H=Symbol.for("react.lazy"),ie=Symbol.for("react.activity"),de=Symbol.for("react.memo_cache_sentinel"),be=Symbol.iterator;function Ee(s){return s===null||typeof s!="object"?null:(s=be&&s[be]||s["@@iterator"],typeof s=="function"?s:null)}var Pt=Symbol.for("react.client.reference");function $t(s){if(s==null)return null;if(typeof s=="function")return s.$$typeof===Pt?null:s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case S:return"Fragment";case M:return"Profiler";case k:return"StrictMode";case j:return"Suspense";case W:return"SuspenseList";case ie:return"Activity"}if(typeof s=="object")switch(s.$$typeof){case _:return"Portal";case $:return s.displayName||"Context";case x:return(s._context.displayName||"Context")+".Consumer";case L:var a=s.render;return s=s.displayName,s||(s=a.displayName||a.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case G:return a=s.displayName||null,a!==null?a:$t(s.type)||"Memo";case H:a=s._payload,s=s._init;try{return $t(s(a))}catch{}}return null}var Ne=Array.isArray,P=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ne=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,me={pending:!1,data:null,method:null,action:null},Be=[],Pe=-1;function T(s){return{current:s}}function V(s){0>Pe||(s.current=Be[Pe],Be[Pe]=null,Pe--)}function Q(s,a){Pe++,Be[Pe]=s.current,s.current=a}var ae=T(null),le=T(null),_e=T(null),Le=T(null);function bt(s,a){switch(Q(_e,a),Q(le,s),Q(ae,null),a.nodeType){case 9:case 11:s=(s=a.documentElement)&&(s=s.namespaceURI)?fE(s):0;break;default:if(s=a.tagName,a=a.namespaceURI)a=fE(a),s=hE(a,s);else switch(s){case"svg":s=1;break;case"math":s=2;break;default:s=0}}V(ae),Q(ae,s)}function ct(){V(ae),V(le),V(_e)}function qr(s){s.memoizedState!==null&&Q(Le,s);var a=ae.current,c=hE(a,s.type);a!==c&&(Q(le,s),Q(ae,c))}function Ei(s){le.current===s&&(V(ae),V(le)),Le.current===s&&(V(Le),nl._currentValue=me)}var va,Fr;function Fn(s){if(va===void 0)try{throw Error()}catch(c){var a=c.stack.trim().match(/\n( *(at )?)/);va=a&&a[1]||"",Fr=-1<c.stack.indexOf(`
    at`)?" (<anonymous>)":-1<c.stack.indexOf("@")?"@unknown:0:0":""}return`
`+va+s+Fr}var hr=!1;function _i(s,a){if(!s||hr)return"";hr=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var u={DetermineComponentFrameRoot:function(){try{if(a){var J=function(){throw Error()};if(Object.defineProperty(J.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(J,[])}catch(K){var B=K}Reflect.construct(s,[],J)}else{try{J.call()}catch(K){B=K}s.call(J.prototype)}}else{try{throw Error()}catch(K){B=K}(J=s())&&typeof J.catch=="function"&&J.catch(function(){})}}catch(K){if(K&&B&&typeof K.stack=="string")return[K.stack,B.stack]}return[null,null]}};u.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var d=Object.getOwnPropertyDescriptor(u.DetermineComponentFrameRoot,"name");d&&d.configurable&&Object.defineProperty(u.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var p=u.DetermineComponentFrameRoot(),w=p[0],v=p[1];if(w&&v){var O=w.split(`
`),z=v.split(`
`);for(d=u=0;u<O.length&&!O[u].includes("DetermineComponentFrameRoot");)u++;for(;d<z.length&&!z[d].includes("DetermineComponentFrameRoot");)d++;if(u===O.length||d===z.length)for(u=O.length-1,d=z.length-1;1<=u&&0<=d&&O[u]!==z[d];)d--;for(;1<=u&&0<=d;u--,d--)if(O[u]!==z[d]){if(u!==1||d!==1)do if(u--,d--,0>d||O[u]!==z[d]){var q=`
`+O[u].replace(" at new "," at ");return s.displayName&&q.includes("<anonymous>")&&(q=q.replace("<anonymous>",s.displayName)),q}while(1<=u&&0<=d);break}}}finally{hr=!1,Error.prepareStackTrace=c}return(c=s?s.displayName||s.name:"")?Fn(c):""}function ac(s,a){switch(s.tag){case 26:case 27:case 5:return Fn(s.type);case 16:return Fn("Lazy");case 13:return s.child!==a&&a!==null?Fn("Suspense Fallback"):Fn("Suspense");case 19:return Fn("SuspenseList");case 0:case 15:return _i(s.type,!1);case 11:return _i(s.type.render,!1);case 1:return _i(s.type,!0);case 31:return Fn("Activity");default:return""}}function Vr(s){try{var a="",c=null;do a+=ac(s,c),c=s,s=s.return;while(s);return a}catch(u){return`
Error generating stack: `+u.message+`
`+u.stack}}var _s=Object.prototype.hasOwnProperty,As=n.unstable_scheduleCallback,Sa=n.unstable_cancelCallback,cu=n.unstable_shouldYield,Md=n.unstable_requestPaint,Jt=n.unstable_now,Ai=n.unstable_getCurrentPriorityLevel,Gr=n.unstable_ImmediatePriority,Rn=n.unstable_UserBlockingPriority,ks=n.unstable_NormalPriority,lu=n.unstable_LowPriority,oc=n.unstable_IdlePriority,cc=n.log,uu=n.unstable_setDisableYieldValue,Cr=null,Ht=null;function qt(s){if(typeof cc=="function"&&uu(s),Ht&&typeof Ht.setStrictMode=="function")try{Ht.setStrictMode(Cr,s)}catch{}}var Nt=Math.clz32?Math.clz32:Nd,lc=Math.log,uc=Math.LN2;function Nd(s){return s>>>=0,s===0?32:31-(lc(s)/uc|0)|0}var Zr=256,Jr=262144,Ea=4194304;function Dn(s){var a=s&42;if(a!==0)return a;switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return s&261888;case 262144:case 524288:case 1048576:case 2097152:return s&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return s&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return s}}function _a(s,a,c){var u=s.pendingLanes;if(u===0)return 0;var d=0,p=s.suspendedLanes,w=s.pingedLanes;s=s.warmLanes;var v=u&134217727;return v!==0?(u=v&~p,u!==0?d=Dn(u):(w&=v,w!==0?d=Dn(w):c||(c=v&~s,c!==0&&(d=Dn(c))))):(v=u&~p,v!==0?d=Dn(v):w!==0?d=Dn(w):c||(c=u&~s,c!==0&&(d=Dn(c)))),d===0?0:a!==0&&a!==d&&(a&p)===0&&(p=d&-d,c=a&-a,p>=c||p===32&&(c&4194048)!==0)?a:d}function ki(s,a){return(s.pendingLanes&~(s.suspendedLanes&~s.pingedLanes)&a)===0}function kt(s,a){switch(s){case 1:case 2:case 4:case 8:case 64:return a+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Wr(){var s=Ea;return Ea<<=1,(Ea&62914560)===0&&(Ea=4194304),s}function fc(s){for(var a=[],c=0;31>c;c++)a.push(s);return a}function Ts(s,a){s.pendingLanes|=a,a!==268435456&&(s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0)}function hc(s,a,c,u,d,p){var w=s.pendingLanes;s.pendingLanes=c,s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0,s.expiredLanes&=c,s.entangledLanes&=c,s.errorRecoveryDisabledLanes&=c,s.shellSuspendCounter=0;var v=s.entanglements,O=s.expirationTimes,z=s.hiddenUpdates;for(c=w&~c;0<c;){var q=31-Nt(c),J=1<<q;v[q]=0,O[q]=-1;var B=z[q];if(B!==null)for(z[q]=null,q=0;q<B.length;q++){var K=B[q];K!==null&&(K.lane&=-536870913)}c&=~J}u!==0&&dc(s,u,0),p!==0&&d===0&&s.tag!==0&&(s.suspendedLanes|=p&~(w&~a))}function dc(s,a,c){s.pendingLanes|=a,s.suspendedLanes&=~a;var u=31-Nt(a);s.entangledLanes|=a,s.entanglements[u]=s.entanglements[u]|1073741824|c&261930}function mc(s,a){var c=s.entangledLanes|=a;for(s=s.entanglements;c;){var u=31-Nt(c),d=1<<u;d&a|s[u]&a&&(s[u]|=a),c&=~d}}function fu(s,a){var c=a&-a;return c=(c&42)!==0?1:wn(c),(c&(s.suspendedLanes|a))!==0?0:c}function wn(s){switch(s){case 2:s=1;break;case 8:s=4;break;case 32:s=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:s=128;break;case 268435456:s=134217728;break;default:s=0}return s}function dr(s){return s&=-s,2<s?8<s?(s&134217727)!==0?32:268435456:8:2}function pc(){var s=ne.p;return s!==0?s:(s=window.event,s===void 0?32:UE(s.type))}function yc(s,a){var c=ne.p;try{return ne.p=s,a()}finally{ne.p=c}}var Vn=Math.random().toString(36).slice(2),Rt="__reactFiber$"+Vn,lt="__reactProps$"+Vn,Yr="__reactContainer$"+Vn,Aa="__reactEvents$"+Vn,hu="__reactListeners$"+Vn,du="__reactHandles$"+Vn,mu="__reactResources$"+Vn,ue="__reactMarker$"+Vn;function C(s){delete s[Rt],delete s[lt],delete s[Aa],delete s[hu],delete s[du]}function Y(s){var a=s[Rt];if(a)return a;for(var c=s.parentNode;c;){if(a=c[Yr]||c[Rt]){if(c=a.alternate,a.child!==null||c!==null&&c.child!==null)for(s=bE(s);s!==null;){if(c=s[Rt])return c;s=bE(s)}return a}s=c,c=s.parentNode}return null}function oe(s){if(s=s[Rt]||s[Yr]){var a=s.tag;if(a===5||a===6||a===13||a===31||a===26||a===27||a===3)return s}return null}function qe(s){var a=s.tag;if(a===5||a===26||a===27||a===6)return s.stateNode;throw Error(r(33))}function pt(s){var a=s[mu];return a||(a=s[mu]={hoistableStyles:new Map,hoistableScripts:new Map}),a}function Ce(s){s[ue]=!0}var Wt=new Set,Gn={};function bn(s,a){Mr(s,a),Mr(s+"Capture",a)}function Mr(s,a){for(Gn[s]=a,s=0;s<a.length;s++)Wt.add(a[s])}var Kt=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),gc={},wc={};function XO(s){return _s.call(wc,s)?!0:_s.call(gc,s)?!1:Kt.test(s)?wc[s]=!0:(gc[s]=!0,!1)}function pu(s,a,c){if(XO(a))if(c===null)s.removeAttribute(a);else{switch(typeof c){case"undefined":case"function":case"symbol":s.removeAttribute(a);return;case"boolean":var u=a.toLowerCase().slice(0,5);if(u!=="data-"&&u!=="aria-"){s.removeAttribute(a);return}}s.setAttribute(a,""+c)}}function yu(s,a,c){if(c===null)s.removeAttribute(a);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(a);return}s.setAttribute(a,""+c)}}function Qr(s,a,c,u){if(u===null)s.removeAttribute(c);else{switch(typeof u){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(c);return}s.setAttributeNS(a,c,""+u)}}function Zn(s){switch(typeof s){case"bigint":case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function rb(s){var a=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function eC(s,a,c){var u=Object.getOwnPropertyDescriptor(s.constructor.prototype,a);if(!s.hasOwnProperty(a)&&typeof u<"u"&&typeof u.get=="function"&&typeof u.set=="function"){var d=u.get,p=u.set;return Object.defineProperty(s,a,{configurable:!0,get:function(){return d.call(this)},set:function(w){c=""+w,p.call(this,w)}}),Object.defineProperty(s,a,{enumerable:u.enumerable}),{getValue:function(){return c},setValue:function(w){c=""+w},stopTracking:function(){s._valueTracker=null,delete s[a]}}}}function Rd(s){if(!s._valueTracker){var a=rb(s)?"checked":"value";s._valueTracker=eC(s,a,""+s[a])}}function sb(s){if(!s)return!1;var a=s._valueTracker;if(!a)return!0;var c=a.getValue(),u="";return s&&(u=rb(s)?s.checked?"true":"false":s.value),s=u,s!==c?(a.setValue(s),!0):!1}function gu(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}var tC=/[\n"\\]/g;function Jn(s){return s.replace(tC,function(a){return"\\"+a.charCodeAt(0).toString(16)+" "})}function Dd(s,a,c,u,d,p,w,v){s.name="",w!=null&&typeof w!="function"&&typeof w!="symbol"&&typeof w!="boolean"?s.type=w:s.removeAttribute("type"),a!=null?w==="number"?(a===0&&s.value===""||s.value!=a)&&(s.value=""+Zn(a)):s.value!==""+Zn(a)&&(s.value=""+Zn(a)):w!=="submit"&&w!=="reset"||s.removeAttribute("value"),a!=null?xd(s,w,Zn(a)):c!=null?xd(s,w,Zn(c)):u!=null&&s.removeAttribute("value"),d==null&&p!=null&&(s.defaultChecked=!!p),d!=null&&(s.checked=d&&typeof d!="function"&&typeof d!="symbol"),v!=null&&typeof v!="function"&&typeof v!="symbol"&&typeof v!="boolean"?s.name=""+Zn(v):s.removeAttribute("name")}function ib(s,a,c,u,d,p,w,v){if(p!=null&&typeof p!="function"&&typeof p!="symbol"&&typeof p!="boolean"&&(s.type=p),a!=null||c!=null){if(!(p!=="submit"&&p!=="reset"||a!=null)){Rd(s);return}c=c!=null?""+Zn(c):"",a=a!=null?""+Zn(a):c,v||a===s.value||(s.value=a),s.defaultValue=a}u=u??d,u=typeof u!="function"&&typeof u!="symbol"&&!!u,s.checked=v?s.checked:!!u,s.defaultChecked=!!u,w!=null&&typeof w!="function"&&typeof w!="symbol"&&typeof w!="boolean"&&(s.name=w),Rd(s)}function xd(s,a,c){a==="number"&&gu(s.ownerDocument)===s||s.defaultValue===""+c||(s.defaultValue=""+c)}function ka(s,a,c,u){if(s=s.options,a){a={};for(var d=0;d<c.length;d++)a["$"+c[d]]=!0;for(c=0;c<s.length;c++)d=a.hasOwnProperty("$"+s[c].value),s[c].selected!==d&&(s[c].selected=d),d&&u&&(s[c].defaultSelected=!0)}else{for(c=""+Zn(c),a=null,d=0;d<s.length;d++){if(s[d].value===c){s[d].selected=!0,u&&(s[d].defaultSelected=!0);return}a!==null||s[d].disabled||(a=s[d])}a!==null&&(a.selected=!0)}}function ab(s,a,c){if(a!=null&&(a=""+Zn(a),a!==s.value&&(s.value=a),c==null)){s.defaultValue!==a&&(s.defaultValue=a);return}s.defaultValue=c!=null?""+Zn(c):""}function ob(s,a,c,u){if(a==null){if(u!=null){if(c!=null)throw Error(r(92));if(Ne(u)){if(1<u.length)throw Error(r(93));u=u[0]}c=u}c==null&&(c=""),a=c}c=Zn(a),s.defaultValue=c,u=s.textContent,u===c&&u!==""&&u!==null&&(s.value=u),Rd(s)}function Ta(s,a){if(a){var c=s.firstChild;if(c&&c===s.lastChild&&c.nodeType===3){c.nodeValue=a;return}}s.textContent=a}var nC=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function cb(s,a,c){var u=a.indexOf("--")===0;c==null||typeof c=="boolean"||c===""?u?s.setProperty(a,""):a==="float"?s.cssFloat="":s[a]="":u?s.setProperty(a,c):typeof c!="number"||c===0||nC.has(a)?a==="float"?s.cssFloat=c:s[a]=(""+c).trim():s[a]=c+"px"}function lb(s,a,c){if(a!=null&&typeof a!="object")throw Error(r(62));if(s=s.style,c!=null){for(var u in c)!c.hasOwnProperty(u)||a!=null&&a.hasOwnProperty(u)||(u.indexOf("--")===0?s.setProperty(u,""):u==="float"?s.cssFloat="":s[u]="");for(var d in a)u=a[d],a.hasOwnProperty(d)&&c[d]!==u&&cb(s,d,u)}else for(var p in a)a.hasOwnProperty(p)&&cb(s,p,a[p])}function Id(s){if(s.indexOf("-")===-1)return!1;switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var rC=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),sC=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function wu(s){return sC.test(""+s)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":s}function Xr(){}var Ud=null;function zd(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var Oa=null,Ca=null;function ub(s){var a=oe(s);if(a&&(s=a.stateNode)){var c=s[lt]||null;e:switch(s=a.stateNode,a.type){case"input":if(Dd(s,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name),a=c.name,c.type==="radio"&&a!=null){for(c=s;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll('input[name="'+Jn(""+a)+'"][type="radio"]'),a=0;a<c.length;a++){var u=c[a];if(u!==s&&u.form===s.form){var d=u[lt]||null;if(!d)throw Error(r(90));Dd(u,d.value,d.defaultValue,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name)}}for(a=0;a<c.length;a++)u=c[a],u.form===s.form&&sb(u)}break e;case"textarea":ab(s,c.value,c.defaultValue);break e;case"select":a=c.value,a!=null&&ka(s,!!c.multiple,a,!1)}}}var Ld=!1;function fb(s,a,c){if(Ld)return s(a,c);Ld=!0;try{var u=s(a);return u}finally{if(Ld=!1,(Oa!==null||Ca!==null)&&(af(),Oa&&(a=Oa,s=Ca,Ca=Oa=null,ub(a),s)))for(a=0;a<s.length;a++)ub(s[a])}}function bc(s,a){var c=s.stateNode;if(c===null)return null;var u=c[lt]||null;if(u===null)return null;c=u[a];e:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(u=!u.disabled)||(s=s.type,u=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!u;break e;default:s=!1}if(s)return null;if(c&&typeof c!="function")throw Error(r(231,a,typeof c));return c}var es=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Bd=!1;if(es)try{var vc={};Object.defineProperty(vc,"passive",{get:function(){Bd=!0}}),window.addEventListener("test",vc,vc),window.removeEventListener("test",vc,vc)}catch{Bd=!1}var Os=null,Pd=null,bu=null;function hb(){if(bu)return bu;var s,a=Pd,c=a.length,u,d="value"in Os?Os.value:Os.textContent,p=d.length;for(s=0;s<c&&a[s]===d[s];s++);var w=c-s;for(u=1;u<=w&&a[c-u]===d[p-u];u++);return bu=d.slice(s,1<u?1-u:void 0)}function vu(s){var a=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&a===13&&(s=13)):s=a,s===10&&(s=13),32<=s||s===13?s:0}function Su(){return!0}function db(){return!1}function vn(s){function a(c,u,d,p,w){this._reactName=c,this._targetInst=d,this.type=u,this.nativeEvent=p,this.target=w,this.currentTarget=null;for(var v in s)s.hasOwnProperty(v)&&(c=s[v],this[v]=c?c(p):p[v]);return this.isDefaultPrevented=(p.defaultPrevented!=null?p.defaultPrevented:p.returnValue===!1)?Su:db,this.isPropagationStopped=db,this}return g(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=Su)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=Su)},persist:function(){},isPersistent:Su}),a}var Ti={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Eu=vn(Ti),Sc=g({},Ti,{view:0,detail:0}),iC=vn(Sc),$d,Kd,Ec,_u=g({},Sc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Hd,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==Ec&&(Ec&&s.type==="mousemove"?($d=s.screenX-Ec.screenX,Kd=s.screenY-Ec.screenY):Kd=$d=0,Ec=s),$d)},movementY:function(s){return"movementY"in s?s.movementY:Kd}}),mb=vn(_u),aC=g({},_u,{dataTransfer:0}),oC=vn(aC),cC=g({},Sc,{relatedTarget:0}),jd=vn(cC),lC=g({},Ti,{animationName:0,elapsedTime:0,pseudoElement:0}),uC=vn(lC),fC=g({},Ti,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),hC=vn(fC),dC=g({},Ti,{data:0}),pb=vn(dC),mC={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},pC={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},yC={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function gC(s){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(s):(s=yC[s])?!!a[s]:!1}function Hd(){return gC}var wC=g({},Sc,{key:function(s){if(s.key){var a=mC[s.key]||s.key;if(a!=="Unidentified")return a}return s.type==="keypress"?(s=vu(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?pC[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Hd,charCode:function(s){return s.type==="keypress"?vu(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?vu(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),bC=vn(wC),vC=g({},_u,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),yb=vn(vC),SC=g({},Sc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Hd}),EC=vn(SC),_C=g({},Ti,{propertyName:0,elapsedTime:0,pseudoElement:0}),AC=vn(_C),kC=g({},_u,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),TC=vn(kC),OC=g({},Ti,{newState:0,oldState:0}),CC=vn(OC),MC=[9,13,27,32],qd=es&&"CompositionEvent"in window,_c=null;es&&"documentMode"in document&&(_c=document.documentMode);var NC=es&&"TextEvent"in window&&!_c,gb=es&&(!qd||_c&&8<_c&&11>=_c),wb=" ",bb=!1;function vb(s,a){switch(s){case"keyup":return MC.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Sb(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var Ma=!1;function RC(s,a){switch(s){case"compositionend":return Sb(a);case"keypress":return a.which!==32?null:(bb=!0,wb);case"textInput":return s=a.data,s===wb&&bb?null:s;default:return null}}function DC(s,a){if(Ma)return s==="compositionend"||!qd&&vb(s,a)?(s=hb(),bu=Pd=Os=null,Ma=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return gb&&a.locale!=="ko"?null:a.data;default:return null}}var xC={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Eb(s){var a=s&&s.nodeName&&s.nodeName.toLowerCase();return a==="input"?!!xC[s.type]:a==="textarea"}function _b(s,a,c,u){Oa?Ca?Ca.push(u):Ca=[u]:Oa=u,a=df(a,"onChange"),0<a.length&&(c=new Eu("onChange","change",null,c,u),s.push({event:c,listeners:a}))}var Ac=null,kc=null;function IC(s){iE(s,0)}function Au(s){var a=qe(s);if(sb(a))return s}function Ab(s,a){if(s==="change")return a}var kb=!1;if(es){var Fd;if(es){var Vd="oninput"in document;if(!Vd){var Tb=document.createElement("div");Tb.setAttribute("oninput","return;"),Vd=typeof Tb.oninput=="function"}Fd=Vd}else Fd=!1;kb=Fd&&(!document.documentMode||9<document.documentMode)}function Ob(){Ac&&(Ac.detachEvent("onpropertychange",Cb),kc=Ac=null)}function Cb(s){if(s.propertyName==="value"&&Au(kc)){var a=[];_b(a,kc,s,zd(s)),fb(IC,a)}}function UC(s,a,c){s==="focusin"?(Ob(),Ac=a,kc=c,Ac.attachEvent("onpropertychange",Cb)):s==="focusout"&&Ob()}function zC(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return Au(kc)}function LC(s,a){if(s==="click")return Au(a)}function BC(s,a){if(s==="input"||s==="change")return Au(a)}function PC(s,a){return s===a&&(s!==0||1/s===1/a)||s!==s&&a!==a}var xn=typeof Object.is=="function"?Object.is:PC;function Tc(s,a){if(xn(s,a))return!0;if(typeof s!="object"||s===null||typeof a!="object"||a===null)return!1;var c=Object.keys(s),u=Object.keys(a);if(c.length!==u.length)return!1;for(u=0;u<c.length;u++){var d=c[u];if(!_s.call(a,d)||!xn(s[d],a[d]))return!1}return!0}function Mb(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function Nb(s,a){var c=Mb(s);s=0;for(var u;c;){if(c.nodeType===3){if(u=s+c.textContent.length,s<=a&&u>=a)return{node:c,offset:a-s};s=u}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=Mb(c)}}function Rb(s,a){return s&&a?s===a?!0:s&&s.nodeType===3?!1:a&&a.nodeType===3?Rb(s,a.parentNode):"contains"in s?s.contains(a):s.compareDocumentPosition?!!(s.compareDocumentPosition(a)&16):!1:!1}function Db(s){s=s!=null&&s.ownerDocument!=null&&s.ownerDocument.defaultView!=null?s.ownerDocument.defaultView:window;for(var a=gu(s.document);a instanceof s.HTMLIFrameElement;){try{var c=typeof a.contentWindow.location.href=="string"}catch{c=!1}if(c)s=a.contentWindow;else break;a=gu(s.document)}return a}function Gd(s){var a=s&&s.nodeName&&s.nodeName.toLowerCase();return a&&(a==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||a==="textarea"||s.contentEditable==="true")}var $C=es&&"documentMode"in document&&11>=document.documentMode,Na=null,Zd=null,Oc=null,Jd=!1;function xb(s,a,c){var u=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;Jd||Na==null||Na!==gu(u)||(u=Na,"selectionStart"in u&&Gd(u)?u={start:u.selectionStart,end:u.selectionEnd}:(u=(u.ownerDocument&&u.ownerDocument.defaultView||window).getSelection(),u={anchorNode:u.anchorNode,anchorOffset:u.anchorOffset,focusNode:u.focusNode,focusOffset:u.focusOffset}),Oc&&Tc(Oc,u)||(Oc=u,u=df(Zd,"onSelect"),0<u.length&&(a=new Eu("onSelect","select",null,a,c),s.push({event:a,listeners:u}),a.target=Na)))}function Oi(s,a){var c={};return c[s.toLowerCase()]=a.toLowerCase(),c["Webkit"+s]="webkit"+a,c["Moz"+s]="moz"+a,c}var Ra={animationend:Oi("Animation","AnimationEnd"),animationiteration:Oi("Animation","AnimationIteration"),animationstart:Oi("Animation","AnimationStart"),transitionrun:Oi("Transition","TransitionRun"),transitionstart:Oi("Transition","TransitionStart"),transitioncancel:Oi("Transition","TransitionCancel"),transitionend:Oi("Transition","TransitionEnd")},Wd={},Ib={};es&&(Ib=document.createElement("div").style,"AnimationEvent"in window||(delete Ra.animationend.animation,delete Ra.animationiteration.animation,delete Ra.animationstart.animation),"TransitionEvent"in window||delete Ra.transitionend.transition);function Ci(s){if(Wd[s])return Wd[s];if(!Ra[s])return s;var a=Ra[s],c;for(c in a)if(a.hasOwnProperty(c)&&c in Ib)return Wd[s]=a[c];return s}var Ub=Ci("animationend"),zb=Ci("animationiteration"),Lb=Ci("animationstart"),KC=Ci("transitionrun"),jC=Ci("transitionstart"),HC=Ci("transitioncancel"),Bb=Ci("transitionend"),Pb=new Map,Yd="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Yd.push("scrollEnd");function mr(s,a){Pb.set(s,a),bn(a,[s])}var ku=typeof reportError=="function"?reportError:function(s){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var a=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof s=="object"&&s!==null&&typeof s.message=="string"?String(s.message):String(s),error:s});if(!window.dispatchEvent(a))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",s);return}console.error(s)},Wn=[],Da=0,Qd=0;function Tu(){for(var s=Da,a=Qd=Da=0;a<s;){var c=Wn[a];Wn[a++]=null;var u=Wn[a];Wn[a++]=null;var d=Wn[a];Wn[a++]=null;var p=Wn[a];if(Wn[a++]=null,u!==null&&d!==null){var w=u.pending;w===null?d.next=d:(d.next=w.next,w.next=d),u.pending=d}p!==0&&$b(c,d,p)}}function Ou(s,a,c,u){Wn[Da++]=s,Wn[Da++]=a,Wn[Da++]=c,Wn[Da++]=u,Qd|=u,s.lanes|=u,s=s.alternate,s!==null&&(s.lanes|=u)}function Xd(s,a,c,u){return Ou(s,a,c,u),Cu(s)}function Mi(s,a){return Ou(s,null,null,a),Cu(s)}function $b(s,a,c){s.lanes|=c;var u=s.alternate;u!==null&&(u.lanes|=c);for(var d=!1,p=s.return;p!==null;)p.childLanes|=c,u=p.alternate,u!==null&&(u.childLanes|=c),p.tag===22&&(s=p.stateNode,s===null||s._visibility&1||(d=!0)),s=p,p=p.return;return s.tag===3?(p=s.stateNode,d&&a!==null&&(d=31-Nt(c),s=p.hiddenUpdates,u=s[d],u===null?s[d]=[a]:u.push(a),a.lane=c|536870912),p):null}function Cu(s){if(50<Jc)throw Jc=0,cp=null,Error(r(185));for(var a=s.return;a!==null;)s=a,a=s.return;return s.tag===3?s.stateNode:null}var xa={};function qC(s,a,c,u){this.tag=s,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=u,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function In(s,a,c,u){return new qC(s,a,c,u)}function em(s){return s=s.prototype,!(!s||!s.isReactComponent)}function ts(s,a){var c=s.alternate;return c===null?(c=In(s.tag,a,s.key,s.mode),c.elementType=s.elementType,c.type=s.type,c.stateNode=s.stateNode,c.alternate=s,s.alternate=c):(c.pendingProps=a,c.type=s.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=s.flags&65011712,c.childLanes=s.childLanes,c.lanes=s.lanes,c.child=s.child,c.memoizedProps=s.memoizedProps,c.memoizedState=s.memoizedState,c.updateQueue=s.updateQueue,a=s.dependencies,c.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},c.sibling=s.sibling,c.index=s.index,c.ref=s.ref,c.refCleanup=s.refCleanup,c}function Kb(s,a){s.flags&=65011714;var c=s.alternate;return c===null?(s.childLanes=0,s.lanes=a,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=c.childLanes,s.lanes=c.lanes,s.child=c.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=c.memoizedProps,s.memoizedState=c.memoizedState,s.updateQueue=c.updateQueue,s.type=c.type,a=c.dependencies,s.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),s}function Mu(s,a,c,u,d,p){var w=0;if(u=s,typeof s=="function")em(s)&&(w=1);else if(typeof s=="string")w=JM(s,c,ae.current)?26:s==="html"||s==="head"||s==="body"?27:5;else e:switch(s){case ie:return s=In(31,c,a,d),s.elementType=ie,s.lanes=p,s;case S:return Ni(c.children,d,p,a);case k:w=8,d|=24;break;case M:return s=In(12,c,a,d|2),s.elementType=M,s.lanes=p,s;case j:return s=In(13,c,a,d),s.elementType=j,s.lanes=p,s;case W:return s=In(19,c,a,d),s.elementType=W,s.lanes=p,s;default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case $:w=10;break e;case x:w=9;break e;case L:w=11;break e;case G:w=14;break e;case H:w=16,u=null;break e}w=29,c=Error(r(130,s===null?"null":typeof s,"")),u=null}return a=In(w,c,a,d),a.elementType=s,a.type=u,a.lanes=p,a}function Ni(s,a,c,u){return s=In(7,s,u,a),s.lanes=c,s}function tm(s,a,c){return s=In(6,s,null,a),s.lanes=c,s}function jb(s){var a=In(18,null,null,0);return a.stateNode=s,a}function nm(s,a,c){return a=In(4,s.children!==null?s.children:[],s.key,a),a.lanes=c,a.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},a}var Hb=new WeakMap;function Yn(s,a){if(typeof s=="object"&&s!==null){var c=Hb.get(s);return c!==void 0?c:(a={value:s,source:a,stack:Vr(a)},Hb.set(s,a),a)}return{value:s,source:a,stack:Vr(a)}}var Ia=[],Ua=0,Nu=null,Cc=0,Qn=[],Xn=0,Cs=null,Nr=1,Rr="";function ns(s,a){Ia[Ua++]=Cc,Ia[Ua++]=Nu,Nu=s,Cc=a}function qb(s,a,c){Qn[Xn++]=Nr,Qn[Xn++]=Rr,Qn[Xn++]=Cs,Cs=s;var u=Nr;s=Rr;var d=32-Nt(u)-1;u&=~(1<<d),c+=1;var p=32-Nt(a)+d;if(30<p){var w=d-d%5;p=(u&(1<<w)-1).toString(32),u>>=w,d-=w,Nr=1<<32-Nt(a)+d|c<<d|u,Rr=p+s}else Nr=1<<p|c<<d|u,Rr=s}function rm(s){s.return!==null&&(ns(s,1),qb(s,1,0))}function sm(s){for(;s===Nu;)Nu=Ia[--Ua],Ia[Ua]=null,Cc=Ia[--Ua],Ia[Ua]=null;for(;s===Cs;)Cs=Qn[--Xn],Qn[Xn]=null,Rr=Qn[--Xn],Qn[Xn]=null,Nr=Qn[--Xn],Qn[Xn]=null}function Fb(s,a){Qn[Xn++]=Nr,Qn[Xn++]=Rr,Qn[Xn++]=Cs,Nr=a.id,Rr=a.overflow,Cs=s}var Yt=null,nt=null,ze=!1,Ms=null,er=!1,im=Error(r(519));function Ns(s){var a=Error(r(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Mc(Yn(a,s)),im}function Vb(s){var a=s.stateNode,c=s.type,u=s.memoizedProps;switch(a[Rt]=s,a[lt]=u,c){case"dialog":xe("cancel",a),xe("close",a);break;case"iframe":case"object":case"embed":xe("load",a);break;case"video":case"audio":for(c=0;c<Yc.length;c++)xe(Yc[c],a);break;case"source":xe("error",a);break;case"img":case"image":case"link":xe("error",a),xe("load",a);break;case"details":xe("toggle",a);break;case"input":xe("invalid",a),ib(a,u.value,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name,!0);break;case"select":xe("invalid",a);break;case"textarea":xe("invalid",a),ob(a,u.value,u.defaultValue,u.children)}c=u.children,typeof c!="string"&&typeof c!="number"&&typeof c!="bigint"||a.textContent===""+c||u.suppressHydrationWarning===!0||lE(a.textContent,c)?(u.popover!=null&&(xe("beforetoggle",a),xe("toggle",a)),u.onScroll!=null&&xe("scroll",a),u.onScrollEnd!=null&&xe("scrollend",a),u.onClick!=null&&(a.onclick=Xr),a=!0):a=!1,a||Ns(s,!0)}function Gb(s){for(Yt=s.return;Yt;)switch(Yt.tag){case 5:case 31:case 13:er=!1;return;case 27:case 3:er=!0;return;default:Yt=Yt.return}}function za(s){if(s!==Yt)return!1;if(!ze)return Gb(s),ze=!0,!1;var a=s.tag,c;if((c=a!==3&&a!==27)&&((c=a===5)&&(c=s.type,c=!(c!=="form"&&c!=="button")||_p(s.type,s.memoizedProps)),c=!c),c&&nt&&Ns(s),Gb(s),a===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(r(317));nt=wE(s)}else if(a===31){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(r(317));nt=wE(s)}else a===27?(a=nt,qs(s.type)?(s=Cp,Cp=null,nt=s):nt=a):nt=Yt?nr(s.stateNode.nextSibling):null;return!0}function Ri(){nt=Yt=null,ze=!1}function am(){var s=Ms;return s!==null&&(An===null?An=s:An.push.apply(An,s),Ms=null),s}function Mc(s){Ms===null?Ms=[s]:Ms.push(s)}var om=T(null),Di=null,rs=null;function Rs(s,a,c){Q(om,a._currentValue),a._currentValue=c}function ss(s){s._currentValue=om.current,V(om)}function cm(s,a,c){for(;s!==null;){var u=s.alternate;if((s.childLanes&a)!==a?(s.childLanes|=a,u!==null&&(u.childLanes|=a)):u!==null&&(u.childLanes&a)!==a&&(u.childLanes|=a),s===c)break;s=s.return}}function lm(s,a,c,u){var d=s.child;for(d!==null&&(d.return=s);d!==null;){var p=d.dependencies;if(p!==null){var w=d.child;p=p.firstContext;e:for(;p!==null;){var v=p;p=d;for(var O=0;O<a.length;O++)if(v.context===a[O]){p.lanes|=c,v=p.alternate,v!==null&&(v.lanes|=c),cm(p.return,c,s),u||(w=null);break e}p=v.next}}else if(d.tag===18){if(w=d.return,w===null)throw Error(r(341));w.lanes|=c,p=w.alternate,p!==null&&(p.lanes|=c),cm(w,c,s),w=null}else w=d.child;if(w!==null)w.return=d;else for(w=d;w!==null;){if(w===s){w=null;break}if(d=w.sibling,d!==null){d.return=w.return,w=d;break}w=w.return}d=w}}function La(s,a,c,u){s=null;for(var d=a,p=!1;d!==null;){if(!p){if((d.flags&524288)!==0)p=!0;else if((d.flags&262144)!==0)break}if(d.tag===10){var w=d.alternate;if(w===null)throw Error(r(387));if(w=w.memoizedProps,w!==null){var v=d.type;xn(d.pendingProps.value,w.value)||(s!==null?s.push(v):s=[v])}}else if(d===Le.current){if(w=d.alternate,w===null)throw Error(r(387));w.memoizedState.memoizedState!==d.memoizedState.memoizedState&&(s!==null?s.push(nl):s=[nl])}d=d.return}s!==null&&lm(a,s,c,u),a.flags|=262144}function Ru(s){for(s=s.firstContext;s!==null;){if(!xn(s.context._currentValue,s.memoizedValue))return!0;s=s.next}return!1}function xi(s){Di=s,rs=null,s=s.dependencies,s!==null&&(s.firstContext=null)}function Qt(s){return Zb(Di,s)}function Du(s,a){return Di===null&&xi(s),Zb(s,a)}function Zb(s,a){var c=a._currentValue;if(a={context:a,memoizedValue:c,next:null},rs===null){if(s===null)throw Error(r(308));rs=a,s.dependencies={lanes:0,firstContext:a},s.flags|=524288}else rs=rs.next=a;return c}var FC=typeof AbortController<"u"?AbortController:function(){var s=[],a=this.signal={aborted:!1,addEventListener:function(c,u){s.push(u)}};this.abort=function(){a.aborted=!0,s.forEach(function(c){return c()})}},VC=n.unstable_scheduleCallback,GC=n.unstable_NormalPriority,Dt={$$typeof:$,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function um(){return{controller:new FC,data:new Map,refCount:0}}function Nc(s){s.refCount--,s.refCount===0&&VC(GC,function(){s.controller.abort()})}var Rc=null,fm=0,Ba=0,Pa=null;function ZC(s,a){if(Rc===null){var c=Rc=[];fm=0,Ba=mp(),Pa={status:"pending",value:void 0,then:function(u){c.push(u)}}}return fm++,a.then(Jb,Jb),a}function Jb(){if(--fm===0&&Rc!==null){Pa!==null&&(Pa.status="fulfilled");var s=Rc;Rc=null,Ba=0,Pa=null;for(var a=0;a<s.length;a++)(0,s[a])()}}function JC(s,a){var c=[],u={status:"pending",value:null,reason:null,then:function(d){c.push(d)}};return s.then(function(){u.status="fulfilled",u.value=a;for(var d=0;d<c.length;d++)(0,c[d])(a)},function(d){for(u.status="rejected",u.reason=d,d=0;d<c.length;d++)(0,c[d])(void 0)}),u}var Wb=P.S;P.S=function(s,a){xS=Jt(),typeof a=="object"&&a!==null&&typeof a.then=="function"&&ZC(s,a),Wb!==null&&Wb(s,a)};var Ii=T(null);function hm(){var s=Ii.current;return s!==null?s:et.pooledCache}function xu(s,a){a===null?Q(Ii,Ii.current):Q(Ii,a.pool)}function Yb(){var s=hm();return s===null?null:{parent:Dt._currentValue,pool:s}}var $a=Error(r(460)),dm=Error(r(474)),Iu=Error(r(542)),Uu={then:function(){}};function Qb(s){return s=s.status,s==="fulfilled"||s==="rejected"}function Xb(s,a,c){switch(c=s[c],c===void 0?s.push(a):c!==a&&(a.then(Xr,Xr),a=c),a.status){case"fulfilled":return a.value;case"rejected":throw s=a.reason,tv(s),s;default:if(typeof a.status=="string")a.then(Xr,Xr);else{if(s=et,s!==null&&100<s.shellSuspendCounter)throw Error(r(482));s=a,s.status="pending",s.then(function(u){if(a.status==="pending"){var d=a;d.status="fulfilled",d.value=u}},function(u){if(a.status==="pending"){var d=a;d.status="rejected",d.reason=u}})}switch(a.status){case"fulfilled":return a.value;case"rejected":throw s=a.reason,tv(s),s}throw zi=a,$a}}function Ui(s){try{var a=s._init;return a(s._payload)}catch(c){throw c!==null&&typeof c=="object"&&typeof c.then=="function"?(zi=c,$a):c}}var zi=null;function ev(){if(zi===null)throw Error(r(459));var s=zi;return zi=null,s}function tv(s){if(s===$a||s===Iu)throw Error(r(483))}var Ka=null,Dc=0;function zu(s){var a=Dc;return Dc+=1,Ka===null&&(Ka=[]),Xb(Ka,s,a)}function xc(s,a){a=a.props.ref,s.ref=a!==void 0?a:null}function Lu(s,a){throw a.$$typeof===b?Error(r(525)):(s=Object.prototype.toString.call(a),Error(r(31,s==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":s)))}function nv(s){function a(D,N){if(s){var U=D.deletions;U===null?(D.deletions=[N],D.flags|=16):U.push(N)}}function c(D,N){if(!s)return null;for(;N!==null;)a(D,N),N=N.sibling;return null}function u(D){for(var N=new Map;D!==null;)D.key!==null?N.set(D.key,D):N.set(D.index,D),D=D.sibling;return N}function d(D,N){return D=ts(D,N),D.index=0,D.sibling=null,D}function p(D,N,U){return D.index=U,s?(U=D.alternate,U!==null?(U=U.index,U<N?(D.flags|=67108866,N):U):(D.flags|=67108866,N)):(D.flags|=1048576,N)}function w(D){return s&&D.alternate===null&&(D.flags|=67108866),D}function v(D,N,U,Z){return N===null||N.tag!==6?(N=tm(U,D.mode,Z),N.return=D,N):(N=d(N,U),N.return=D,N)}function O(D,N,U,Z){var pe=U.type;return pe===S?q(D,N,U.props.children,Z,U.key):N!==null&&(N.elementType===pe||typeof pe=="object"&&pe!==null&&pe.$$typeof===H&&Ui(pe)===N.type)?(N=d(N,U.props),xc(N,U),N.return=D,N):(N=Mu(U.type,U.key,U.props,null,D.mode,Z),xc(N,U),N.return=D,N)}function z(D,N,U,Z){return N===null||N.tag!==4||N.stateNode.containerInfo!==U.containerInfo||N.stateNode.implementation!==U.implementation?(N=nm(U,D.mode,Z),N.return=D,N):(N=d(N,U.children||[]),N.return=D,N)}function q(D,N,U,Z,pe){return N===null||N.tag!==7?(N=Ni(U,D.mode,Z,pe),N.return=D,N):(N=d(N,U),N.return=D,N)}function J(D,N,U){if(typeof N=="string"&&N!==""||typeof N=="number"||typeof N=="bigint")return N=tm(""+N,D.mode,U),N.return=D,N;if(typeof N=="object"&&N!==null){switch(N.$$typeof){case E:return U=Mu(N.type,N.key,N.props,null,D.mode,U),xc(U,N),U.return=D,U;case _:return N=nm(N,D.mode,U),N.return=D,N;case H:return N=Ui(N),J(D,N,U)}if(Ne(N)||Ee(N))return N=Ni(N,D.mode,U,null),N.return=D,N;if(typeof N.then=="function")return J(D,zu(N),U);if(N.$$typeof===$)return J(D,Du(D,N),U);Lu(D,N)}return null}function B(D,N,U,Z){var pe=N!==null?N.key:null;if(typeof U=="string"&&U!==""||typeof U=="number"||typeof U=="bigint")return pe!==null?null:v(D,N,""+U,Z);if(typeof U=="object"&&U!==null){switch(U.$$typeof){case E:return U.key===pe?O(D,N,U,Z):null;case _:return U.key===pe?z(D,N,U,Z):null;case H:return U=Ui(U),B(D,N,U,Z)}if(Ne(U)||Ee(U))return pe!==null?null:q(D,N,U,Z,null);if(typeof U.then=="function")return B(D,N,zu(U),Z);if(U.$$typeof===$)return B(D,N,Du(D,U),Z);Lu(D,U)}return null}function K(D,N,U,Z,pe){if(typeof Z=="string"&&Z!==""||typeof Z=="number"||typeof Z=="bigint")return D=D.get(U)||null,v(N,D,""+Z,pe);if(typeof Z=="object"&&Z!==null){switch(Z.$$typeof){case E:return D=D.get(Z.key===null?U:Z.key)||null,O(N,D,Z,pe);case _:return D=D.get(Z.key===null?U:Z.key)||null,z(N,D,Z,pe);case H:return Z=Ui(Z),K(D,N,U,Z,pe)}if(Ne(Z)||Ee(Z))return D=D.get(U)||null,q(N,D,Z,pe,null);if(typeof Z.then=="function")return K(D,N,U,zu(Z),pe);if(Z.$$typeof===$)return K(D,N,U,Du(N,Z),pe);Lu(N,Z)}return null}function ce(D,N,U,Z){for(var pe=null,$e=null,fe=N,Oe=N=0,Ue=null;fe!==null&&Oe<U.length;Oe++){fe.index>Oe?(Ue=fe,fe=null):Ue=fe.sibling;var Ke=B(D,fe,U[Oe],Z);if(Ke===null){fe===null&&(fe=Ue);break}s&&fe&&Ke.alternate===null&&a(D,fe),N=p(Ke,N,Oe),$e===null?pe=Ke:$e.sibling=Ke,$e=Ke,fe=Ue}if(Oe===U.length)return c(D,fe),ze&&ns(D,Oe),pe;if(fe===null){for(;Oe<U.length;Oe++)fe=J(D,U[Oe],Z),fe!==null&&(N=p(fe,N,Oe),$e===null?pe=fe:$e.sibling=fe,$e=fe);return ze&&ns(D,Oe),pe}for(fe=u(fe);Oe<U.length;Oe++)Ue=K(fe,D,Oe,U[Oe],Z),Ue!==null&&(s&&Ue.alternate!==null&&fe.delete(Ue.key===null?Oe:Ue.key),N=p(Ue,N,Oe),$e===null?pe=Ue:$e.sibling=Ue,$e=Ue);return s&&fe.forEach(function(Js){return a(D,Js)}),ze&&ns(D,Oe),pe}function we(D,N,U,Z){if(U==null)throw Error(r(151));for(var pe=null,$e=null,fe=N,Oe=N=0,Ue=null,Ke=U.next();fe!==null&&!Ke.done;Oe++,Ke=U.next()){fe.index>Oe?(Ue=fe,fe=null):Ue=fe.sibling;var Js=B(D,fe,Ke.value,Z);if(Js===null){fe===null&&(fe=Ue);break}s&&fe&&Js.alternate===null&&a(D,fe),N=p(Js,N,Oe),$e===null?pe=Js:$e.sibling=Js,$e=Js,fe=Ue}if(Ke.done)return c(D,fe),ze&&ns(D,Oe),pe;if(fe===null){for(;!Ke.done;Oe++,Ke=U.next())Ke=J(D,Ke.value,Z),Ke!==null&&(N=p(Ke,N,Oe),$e===null?pe=Ke:$e.sibling=Ke,$e=Ke);return ze&&ns(D,Oe),pe}for(fe=u(fe);!Ke.done;Oe++,Ke=U.next())Ke=K(fe,D,Oe,Ke.value,Z),Ke!==null&&(s&&Ke.alternate!==null&&fe.delete(Ke.key===null?Oe:Ke.key),N=p(Ke,N,Oe),$e===null?pe=Ke:$e.sibling=Ke,$e=Ke);return s&&fe.forEach(function(aN){return a(D,aN)}),ze&&ns(D,Oe),pe}function Ye(D,N,U,Z){if(typeof U=="object"&&U!==null&&U.type===S&&U.key===null&&(U=U.props.children),typeof U=="object"&&U!==null){switch(U.$$typeof){case E:e:{for(var pe=U.key;N!==null;){if(N.key===pe){if(pe=U.type,pe===S){if(N.tag===7){c(D,N.sibling),Z=d(N,U.props.children),Z.return=D,D=Z;break e}}else if(N.elementType===pe||typeof pe=="object"&&pe!==null&&pe.$$typeof===H&&Ui(pe)===N.type){c(D,N.sibling),Z=d(N,U.props),xc(Z,U),Z.return=D,D=Z;break e}c(D,N);break}else a(D,N);N=N.sibling}U.type===S?(Z=Ni(U.props.children,D.mode,Z,U.key),Z.return=D,D=Z):(Z=Mu(U.type,U.key,U.props,null,D.mode,Z),xc(Z,U),Z.return=D,D=Z)}return w(D);case _:e:{for(pe=U.key;N!==null;){if(N.key===pe)if(N.tag===4&&N.stateNode.containerInfo===U.containerInfo&&N.stateNode.implementation===U.implementation){c(D,N.sibling),Z=d(N,U.children||[]),Z.return=D,D=Z;break e}else{c(D,N);break}else a(D,N);N=N.sibling}Z=nm(U,D.mode,Z),Z.return=D,D=Z}return w(D);case H:return U=Ui(U),Ye(D,N,U,Z)}if(Ne(U))return ce(D,N,U,Z);if(Ee(U)){if(pe=Ee(U),typeof pe!="function")throw Error(r(150));return U=pe.call(U),we(D,N,U,Z)}if(typeof U.then=="function")return Ye(D,N,zu(U),Z);if(U.$$typeof===$)return Ye(D,N,Du(D,U),Z);Lu(D,U)}return typeof U=="string"&&U!==""||typeof U=="number"||typeof U=="bigint"?(U=""+U,N!==null&&N.tag===6?(c(D,N.sibling),Z=d(N,U),Z.return=D,D=Z):(c(D,N),Z=tm(U,D.mode,Z),Z.return=D,D=Z),w(D)):c(D,N)}return function(D,N,U,Z){try{Dc=0;var pe=Ye(D,N,U,Z);return Ka=null,pe}catch(fe){if(fe===$a||fe===Iu)throw fe;var $e=In(29,fe,null,D.mode);return $e.lanes=Z,$e.return=D,$e}}}var Li=nv(!0),rv=nv(!1),Ds=!1;function mm(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function pm(s,a){s=s.updateQueue,a.updateQueue===s&&(a.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,callbacks:null})}function xs(s){return{lane:s,tag:0,payload:null,callback:null,next:null}}function Is(s,a,c){var u=s.updateQueue;if(u===null)return null;if(u=u.shared,(He&2)!==0){var d=u.pending;return d===null?a.next=a:(a.next=d.next,d.next=a),u.pending=a,a=Cu(s),$b(s,null,c),a}return Ou(s,u,a,c),Cu(s)}function Ic(s,a,c){if(a=a.updateQueue,a!==null&&(a=a.shared,(c&4194048)!==0)){var u=a.lanes;u&=s.pendingLanes,c|=u,a.lanes=c,mc(s,c)}}function ym(s,a){var c=s.updateQueue,u=s.alternate;if(u!==null&&(u=u.updateQueue,c===u)){var d=null,p=null;if(c=c.firstBaseUpdate,c!==null){do{var w={lane:c.lane,tag:c.tag,payload:c.payload,callback:null,next:null};p===null?d=p=w:p=p.next=w,c=c.next}while(c!==null);p===null?d=p=a:p=p.next=a}else d=p=a;c={baseState:u.baseState,firstBaseUpdate:d,lastBaseUpdate:p,shared:u.shared,callbacks:u.callbacks},s.updateQueue=c;return}s=c.lastBaseUpdate,s===null?c.firstBaseUpdate=a:s.next=a,c.lastBaseUpdate=a}var gm=!1;function Uc(){if(gm){var s=Pa;if(s!==null)throw s}}function zc(s,a,c,u){gm=!1;var d=s.updateQueue;Ds=!1;var p=d.firstBaseUpdate,w=d.lastBaseUpdate,v=d.shared.pending;if(v!==null){d.shared.pending=null;var O=v,z=O.next;O.next=null,w===null?p=z:w.next=z,w=O;var q=s.alternate;q!==null&&(q=q.updateQueue,v=q.lastBaseUpdate,v!==w&&(v===null?q.firstBaseUpdate=z:v.next=z,q.lastBaseUpdate=O))}if(p!==null){var J=d.baseState;w=0,q=z=O=null,v=p;do{var B=v.lane&-536870913,K=B!==v.lane;if(K?(Ie&B)===B:(u&B)===B){B!==0&&B===Ba&&(gm=!0),q!==null&&(q=q.next={lane:0,tag:v.tag,payload:v.payload,callback:null,next:null});e:{var ce=s,we=v;B=a;var Ye=c;switch(we.tag){case 1:if(ce=we.payload,typeof ce=="function"){J=ce.call(Ye,J,B);break e}J=ce;break e;case 3:ce.flags=ce.flags&-65537|128;case 0:if(ce=we.payload,B=typeof ce=="function"?ce.call(Ye,J,B):ce,B==null)break e;J=g({},J,B);break e;case 2:Ds=!0}}B=v.callback,B!==null&&(s.flags|=64,K&&(s.flags|=8192),K=d.callbacks,K===null?d.callbacks=[B]:K.push(B))}else K={lane:B,tag:v.tag,payload:v.payload,callback:v.callback,next:null},q===null?(z=q=K,O=J):q=q.next=K,w|=B;if(v=v.next,v===null){if(v=d.shared.pending,v===null)break;K=v,v=K.next,K.next=null,d.lastBaseUpdate=K,d.shared.pending=null}}while(!0);q===null&&(O=J),d.baseState=O,d.firstBaseUpdate=z,d.lastBaseUpdate=q,p===null&&(d.shared.lanes=0),Ps|=w,s.lanes=w,s.memoizedState=J}}function sv(s,a){if(typeof s!="function")throw Error(r(191,s));s.call(a)}function iv(s,a){var c=s.callbacks;if(c!==null)for(s.callbacks=null,s=0;s<c.length;s++)sv(c[s],a)}var ja=T(null),Bu=T(0);function av(s,a){s=ds,Q(Bu,s),Q(ja,a),ds=s|a.baseLanes}function wm(){Q(Bu,ds),Q(ja,ja.current)}function bm(){ds=Bu.current,V(ja),V(Bu)}var Un=T(null),tr=null;function Us(s){var a=s.alternate;Q(Tt,Tt.current&1),Q(Un,s),tr===null&&(a===null||ja.current!==null||a.memoizedState!==null)&&(tr=s)}function vm(s){Q(Tt,Tt.current),Q(Un,s),tr===null&&(tr=s)}function ov(s){s.tag===22?(Q(Tt,Tt.current),Q(Un,s),tr===null&&(tr=s)):zs()}function zs(){Q(Tt,Tt.current),Q(Un,Un.current)}function zn(s){V(Un),tr===s&&(tr=null),V(Tt)}var Tt=T(0);function Pu(s){for(var a=s;a!==null;){if(a.tag===13){var c=a.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||Tp(c)||Op(c)))return a}else if(a.tag===19&&(a.memoizedProps.revealOrder==="forwards"||a.memoizedProps.revealOrder==="backwards"||a.memoizedProps.revealOrder==="unstable_legacy-backwards"||a.memoizedProps.revealOrder==="together")){if((a.flags&128)!==0)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===s)break;for(;a.sibling===null;){if(a.return===null||a.return===s)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}var is=0,Ae=null,Je=null,xt=null,$u=!1,Ha=!1,Bi=!1,Ku=0,Lc=0,qa=null,WC=0;function vt(){throw Error(r(321))}function Sm(s,a){if(a===null)return!1;for(var c=0;c<a.length&&c<s.length;c++)if(!xn(s[c],a[c]))return!1;return!0}function Em(s,a,c,u,d,p){return is=p,Ae=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,P.H=s===null||s.memoizedState===null?qv:Lm,Bi=!1,p=c(u,d),Bi=!1,Ha&&(p=lv(a,c,u,d)),cv(s),p}function cv(s){P.H=$c;var a=Je!==null&&Je.next!==null;if(is=0,xt=Je=Ae=null,$u=!1,Lc=0,qa=null,a)throw Error(r(300));s===null||It||(s=s.dependencies,s!==null&&Ru(s)&&(It=!0))}function lv(s,a,c,u){Ae=s;var d=0;do{if(Ha&&(qa=null),Lc=0,Ha=!1,25<=d)throw Error(r(301));if(d+=1,xt=Je=null,s.updateQueue!=null){var p=s.updateQueue;p.lastEffect=null,p.events=null,p.stores=null,p.memoCache!=null&&(p.memoCache.index=0)}P.H=Fv,p=a(c,u)}while(Ha);return p}function YC(){var s=P.H,a=s.useState()[0];return a=typeof a.then=="function"?Bc(a):a,s=s.useState()[0],(Je!==null?Je.memoizedState:null)!==s&&(Ae.flags|=1024),a}function _m(){var s=Ku!==0;return Ku=0,s}function Am(s,a,c){a.updateQueue=s.updateQueue,a.flags&=-2053,s.lanes&=~c}function km(s){if($u){for(s=s.memoizedState;s!==null;){var a=s.queue;a!==null&&(a.pending=null),s=s.next}$u=!1}is=0,xt=Je=Ae=null,Ha=!1,Lc=Ku=0,qa=null}function fn(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return xt===null?Ae.memoizedState=xt=s:xt=xt.next=s,xt}function Ot(){if(Je===null){var s=Ae.alternate;s=s!==null?s.memoizedState:null}else s=Je.next;var a=xt===null?Ae.memoizedState:xt.next;if(a!==null)xt=a,Je=s;else{if(s===null)throw Ae.alternate===null?Error(r(467)):Error(r(310));Je=s,s={memoizedState:Je.memoizedState,baseState:Je.baseState,baseQueue:Je.baseQueue,queue:Je.queue,next:null},xt===null?Ae.memoizedState=xt=s:xt=xt.next=s}return xt}function ju(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Bc(s){var a=Lc;return Lc+=1,qa===null&&(qa=[]),s=Xb(qa,s,a),a=Ae,(xt===null?a.memoizedState:xt.next)===null&&(a=a.alternate,P.H=a===null||a.memoizedState===null?qv:Lm),s}function Hu(s){if(s!==null&&typeof s=="object"){if(typeof s.then=="function")return Bc(s);if(s.$$typeof===$)return Qt(s)}throw Error(r(438,String(s)))}function Tm(s){var a=null,c=Ae.updateQueue;if(c!==null&&(a=c.memoCache),a==null){var u=Ae.alternate;u!==null&&(u=u.updateQueue,u!==null&&(u=u.memoCache,u!=null&&(a={data:u.data.map(function(d){return d.slice()}),index:0})))}if(a==null&&(a={data:[],index:0}),c===null&&(c=ju(),Ae.updateQueue=c),c.memoCache=a,c=a.data[a.index],c===void 0)for(c=a.data[a.index]=Array(s),u=0;u<s;u++)c[u]=de;return a.index++,c}function as(s,a){return typeof a=="function"?a(s):a}function qu(s){var a=Ot();return Om(a,Je,s)}function Om(s,a,c){var u=s.queue;if(u===null)throw Error(r(311));u.lastRenderedReducer=c;var d=s.baseQueue,p=u.pending;if(p!==null){if(d!==null){var w=d.next;d.next=p.next,p.next=w}a.baseQueue=d=p,u.pending=null}if(p=s.baseState,d===null)s.memoizedState=p;else{a=d.next;var v=w=null,O=null,z=a,q=!1;do{var J=z.lane&-536870913;if(J!==z.lane?(Ie&J)===J:(is&J)===J){var B=z.revertLane;if(B===0)O!==null&&(O=O.next={lane:0,revertLane:0,gesture:null,action:z.action,hasEagerState:z.hasEagerState,eagerState:z.eagerState,next:null}),J===Ba&&(q=!0);else if((is&B)===B){z=z.next,B===Ba&&(q=!0);continue}else J={lane:0,revertLane:z.revertLane,gesture:null,action:z.action,hasEagerState:z.hasEagerState,eagerState:z.eagerState,next:null},O===null?(v=O=J,w=p):O=O.next=J,Ae.lanes|=B,Ps|=B;J=z.action,Bi&&c(p,J),p=z.hasEagerState?z.eagerState:c(p,J)}else B={lane:J,revertLane:z.revertLane,gesture:z.gesture,action:z.action,hasEagerState:z.hasEagerState,eagerState:z.eagerState,next:null},O===null?(v=O=B,w=p):O=O.next=B,Ae.lanes|=J,Ps|=J;z=z.next}while(z!==null&&z!==a);if(O===null?w=p:O.next=v,!xn(p,s.memoizedState)&&(It=!0,q&&(c=Pa,c!==null)))throw c;s.memoizedState=p,s.baseState=w,s.baseQueue=O,u.lastRenderedState=p}return d===null&&(u.lanes=0),[s.memoizedState,u.dispatch]}function Cm(s){var a=Ot(),c=a.queue;if(c===null)throw Error(r(311));c.lastRenderedReducer=s;var u=c.dispatch,d=c.pending,p=a.memoizedState;if(d!==null){c.pending=null;var w=d=d.next;do p=s(p,w.action),w=w.next;while(w!==d);xn(p,a.memoizedState)||(It=!0),a.memoizedState=p,a.baseQueue===null&&(a.baseState=p),c.lastRenderedState=p}return[p,u]}function uv(s,a,c){var u=Ae,d=Ot(),p=ze;if(p){if(c===void 0)throw Error(r(407));c=c()}else c=a();var w=!xn((Je||d).memoizedState,c);if(w&&(d.memoizedState=c,It=!0),d=d.queue,Rm(dv.bind(null,u,d,s),[s]),d.getSnapshot!==a||w||xt!==null&&xt.memoizedState.tag&1){if(u.flags|=2048,Fa(9,{destroy:void 0},hv.bind(null,u,d,c,a),null),et===null)throw Error(r(349));p||(is&127)!==0||fv(u,a,c)}return c}function fv(s,a,c){s.flags|=16384,s={getSnapshot:a,value:c},a=Ae.updateQueue,a===null?(a=ju(),Ae.updateQueue=a,a.stores=[s]):(c=a.stores,c===null?a.stores=[s]:c.push(s))}function hv(s,a,c,u){a.value=c,a.getSnapshot=u,mv(a)&&pv(s)}function dv(s,a,c){return c(function(){mv(a)&&pv(s)})}function mv(s){var a=s.getSnapshot;s=s.value;try{var c=a();return!xn(s,c)}catch{return!0}}function pv(s){var a=Mi(s,2);a!==null&&kn(a,s,2)}function Mm(s){var a=fn();if(typeof s=="function"){var c=s;if(s=c(),Bi){qt(!0);try{c()}finally{qt(!1)}}}return a.memoizedState=a.baseState=s,a.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:as,lastRenderedState:s},a}function yv(s,a,c,u){return s.baseState=c,Om(s,Je,typeof u=="function"?u:as)}function QC(s,a,c,u,d){if(Gu(s))throw Error(r(485));if(s=a.action,s!==null){var p={payload:d,action:s,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(w){p.listeners.push(w)}};P.T!==null?c(!0):p.isTransition=!1,u(p),c=a.pending,c===null?(p.next=a.pending=p,gv(a,p)):(p.next=c.next,a.pending=c.next=p)}}function gv(s,a){var c=a.action,u=a.payload,d=s.state;if(a.isTransition){var p=P.T,w={};P.T=w;try{var v=c(d,u),O=P.S;O!==null&&O(w,v),wv(s,a,v)}catch(z){Nm(s,a,z)}finally{p!==null&&w.types!==null&&(p.types=w.types),P.T=p}}else try{p=c(d,u),wv(s,a,p)}catch(z){Nm(s,a,z)}}function wv(s,a,c){c!==null&&typeof c=="object"&&typeof c.then=="function"?c.then(function(u){bv(s,a,u)},function(u){return Nm(s,a,u)}):bv(s,a,c)}function bv(s,a,c){a.status="fulfilled",a.value=c,vv(a),s.state=c,a=s.pending,a!==null&&(c=a.next,c===a?s.pending=null:(c=c.next,a.next=c,gv(s,c)))}function Nm(s,a,c){var u=s.pending;if(s.pending=null,u!==null){u=u.next;do a.status="rejected",a.reason=c,vv(a),a=a.next;while(a!==u)}s.action=null}function vv(s){s=s.listeners;for(var a=0;a<s.length;a++)(0,s[a])()}function Sv(s,a){return a}function Ev(s,a){if(ze){var c=et.formState;if(c!==null){e:{var u=Ae;if(ze){if(nt){t:{for(var d=nt,p=er;d.nodeType!==8;){if(!p){d=null;break t}if(d=nr(d.nextSibling),d===null){d=null;break t}}p=d.data,d=p==="F!"||p==="F"?d:null}if(d){nt=nr(d.nextSibling),u=d.data==="F!";break e}}Ns(u)}u=!1}u&&(a=c[0])}}return c=fn(),c.memoizedState=c.baseState=a,u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Sv,lastRenderedState:a},c.queue=u,c=Kv.bind(null,Ae,u),u.dispatch=c,u=Mm(!1),p=zm.bind(null,Ae,!1,u.queue),u=fn(),d={state:a,dispatch:null,action:s,pending:null},u.queue=d,c=QC.bind(null,Ae,d,p,c),d.dispatch=c,u.memoizedState=s,[a,c,!1]}function _v(s){var a=Ot();return Av(a,Je,s)}function Av(s,a,c){if(a=Om(s,a,Sv)[0],s=qu(as)[0],typeof a=="object"&&a!==null&&typeof a.then=="function")try{var u=Bc(a)}catch(w){throw w===$a?Iu:w}else u=a;a=Ot();var d=a.queue,p=d.dispatch;return c!==a.memoizedState&&(Ae.flags|=2048,Fa(9,{destroy:void 0},XC.bind(null,d,c),null)),[u,p,s]}function XC(s,a){s.action=a}function kv(s){var a=Ot(),c=Je;if(c!==null)return Av(a,c,s);Ot(),a=a.memoizedState,c=Ot();var u=c.queue.dispatch;return c.memoizedState=s,[a,u,!1]}function Fa(s,a,c,u){return s={tag:s,create:c,deps:u,inst:a,next:null},a=Ae.updateQueue,a===null&&(a=ju(),Ae.updateQueue=a),c=a.lastEffect,c===null?a.lastEffect=s.next=s:(u=c.next,c.next=s,s.next=u,a.lastEffect=s),s}function Tv(){return Ot().memoizedState}function Fu(s,a,c,u){var d=fn();Ae.flags|=s,d.memoizedState=Fa(1|a,{destroy:void 0},c,u===void 0?null:u)}function Vu(s,a,c,u){var d=Ot();u=u===void 0?null:u;var p=d.memoizedState.inst;Je!==null&&u!==null&&Sm(u,Je.memoizedState.deps)?d.memoizedState=Fa(a,p,c,u):(Ae.flags|=s,d.memoizedState=Fa(1|a,p,c,u))}function Ov(s,a){Fu(8390656,8,s,a)}function Rm(s,a){Vu(2048,8,s,a)}function eM(s){Ae.flags|=4;var a=Ae.updateQueue;if(a===null)a=ju(),Ae.updateQueue=a,a.events=[s];else{var c=a.events;c===null?a.events=[s]:c.push(s)}}function Cv(s){var a=Ot().memoizedState;return eM({ref:a,nextImpl:s}),function(){if((He&2)!==0)throw Error(r(440));return a.impl.apply(void 0,arguments)}}function Mv(s,a){return Vu(4,2,s,a)}function Nv(s,a){return Vu(4,4,s,a)}function Rv(s,a){if(typeof a=="function"){s=s();var c=a(s);return function(){typeof c=="function"?c():a(null)}}if(a!=null)return s=s(),a.current=s,function(){a.current=null}}function Dv(s,a,c){c=c!=null?c.concat([s]):null,Vu(4,4,Rv.bind(null,a,s),c)}function Dm(){}function xv(s,a){var c=Ot();a=a===void 0?null:a;var u=c.memoizedState;return a!==null&&Sm(a,u[1])?u[0]:(c.memoizedState=[s,a],s)}function Iv(s,a){var c=Ot();a=a===void 0?null:a;var u=c.memoizedState;if(a!==null&&Sm(a,u[1]))return u[0];if(u=s(),Bi){qt(!0);try{s()}finally{qt(!1)}}return c.memoizedState=[u,a],u}function xm(s,a,c){return c===void 0||(is&1073741824)!==0&&(Ie&261930)===0?s.memoizedState=a:(s.memoizedState=c,s=US(),Ae.lanes|=s,Ps|=s,c)}function Uv(s,a,c,u){return xn(c,a)?c:ja.current!==null?(s=xm(s,c,u),xn(s,a)||(It=!0),s):(is&42)===0||(is&1073741824)!==0&&(Ie&261930)===0?(It=!0,s.memoizedState=c):(s=US(),Ae.lanes|=s,Ps|=s,a)}function zv(s,a,c,u,d){var p=ne.p;ne.p=p!==0&&8>p?p:8;var w=P.T,v={};P.T=v,zm(s,!1,a,c);try{var O=d(),z=P.S;if(z!==null&&z(v,O),O!==null&&typeof O=="object"&&typeof O.then=="function"){var q=JC(O,u);Pc(s,a,q,Pn(s))}else Pc(s,a,u,Pn(s))}catch(J){Pc(s,a,{then:function(){},status:"rejected",reason:J},Pn())}finally{ne.p=p,w!==null&&v.types!==null&&(w.types=v.types),P.T=w}}function tM(){}function Im(s,a,c,u){if(s.tag!==5)throw Error(r(476));var d=Lv(s).queue;zv(s,d,a,me,c===null?tM:function(){return Bv(s),c(u)})}function Lv(s){var a=s.memoizedState;if(a!==null)return a;a={memoizedState:me,baseState:me,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:as,lastRenderedState:me},next:null};var c={};return a.next={memoizedState:c,baseState:c,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:as,lastRenderedState:c},next:null},s.memoizedState=a,s=s.alternate,s!==null&&(s.memoizedState=a),a}function Bv(s){var a=Lv(s);a.next===null&&(a=s.alternate.memoizedState),Pc(s,a.next.queue,{},Pn())}function Um(){return Qt(nl)}function Pv(){return Ot().memoizedState}function $v(){return Ot().memoizedState}function nM(s){for(var a=s.return;a!==null;){switch(a.tag){case 24:case 3:var c=Pn();s=xs(c);var u=Is(a,s,c);u!==null&&(kn(u,a,c),Ic(u,a,c)),a={cache:um()},s.payload=a;return}a=a.return}}function rM(s,a,c){var u=Pn();c={lane:u,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},Gu(s)?jv(a,c):(c=Xd(s,a,c,u),c!==null&&(kn(c,s,u),Hv(c,a,u)))}function Kv(s,a,c){var u=Pn();Pc(s,a,c,u)}function Pc(s,a,c,u){var d={lane:u,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null};if(Gu(s))jv(a,d);else{var p=s.alternate;if(s.lanes===0&&(p===null||p.lanes===0)&&(p=a.lastRenderedReducer,p!==null))try{var w=a.lastRenderedState,v=p(w,c);if(d.hasEagerState=!0,d.eagerState=v,xn(v,w))return Ou(s,a,d,0),et===null&&Tu(),!1}catch{}if(c=Xd(s,a,d,u),c!==null)return kn(c,s,u),Hv(c,a,u),!0}return!1}function zm(s,a,c,u){if(u={lane:2,revertLane:mp(),gesture:null,action:u,hasEagerState:!1,eagerState:null,next:null},Gu(s)){if(a)throw Error(r(479))}else a=Xd(s,c,u,2),a!==null&&kn(a,s,2)}function Gu(s){var a=s.alternate;return s===Ae||a!==null&&a===Ae}function jv(s,a){Ha=$u=!0;var c=s.pending;c===null?a.next=a:(a.next=c.next,c.next=a),s.pending=a}function Hv(s,a,c){if((c&4194048)!==0){var u=a.lanes;u&=s.pendingLanes,c|=u,a.lanes=c,mc(s,c)}}var $c={readContext:Qt,use:Hu,useCallback:vt,useContext:vt,useEffect:vt,useImperativeHandle:vt,useLayoutEffect:vt,useInsertionEffect:vt,useMemo:vt,useReducer:vt,useRef:vt,useState:vt,useDebugValue:vt,useDeferredValue:vt,useTransition:vt,useSyncExternalStore:vt,useId:vt,useHostTransitionStatus:vt,useFormState:vt,useActionState:vt,useOptimistic:vt,useMemoCache:vt,useCacheRefresh:vt};$c.useEffectEvent=vt;var qv={readContext:Qt,use:Hu,useCallback:function(s,a){return fn().memoizedState=[s,a===void 0?null:a],s},useContext:Qt,useEffect:Ov,useImperativeHandle:function(s,a,c){c=c!=null?c.concat([s]):null,Fu(4194308,4,Rv.bind(null,a,s),c)},useLayoutEffect:function(s,a){return Fu(4194308,4,s,a)},useInsertionEffect:function(s,a){Fu(4,2,s,a)},useMemo:function(s,a){var c=fn();a=a===void 0?null:a;var u=s();if(Bi){qt(!0);try{s()}finally{qt(!1)}}return c.memoizedState=[u,a],u},useReducer:function(s,a,c){var u=fn();if(c!==void 0){var d=c(a);if(Bi){qt(!0);try{c(a)}finally{qt(!1)}}}else d=a;return u.memoizedState=u.baseState=d,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:d},u.queue=s,s=s.dispatch=rM.bind(null,Ae,s),[u.memoizedState,s]},useRef:function(s){var a=fn();return s={current:s},a.memoizedState=s},useState:function(s){s=Mm(s);var a=s.queue,c=Kv.bind(null,Ae,a);return a.dispatch=c,[s.memoizedState,c]},useDebugValue:Dm,useDeferredValue:function(s,a){var c=fn();return xm(c,s,a)},useTransition:function(){var s=Mm(!1);return s=zv.bind(null,Ae,s.queue,!0,!1),fn().memoizedState=s,[!1,s]},useSyncExternalStore:function(s,a,c){var u=Ae,d=fn();if(ze){if(c===void 0)throw Error(r(407));c=c()}else{if(c=a(),et===null)throw Error(r(349));(Ie&127)!==0||fv(u,a,c)}d.memoizedState=c;var p={value:c,getSnapshot:a};return d.queue=p,Ov(dv.bind(null,u,p,s),[s]),u.flags|=2048,Fa(9,{destroy:void 0},hv.bind(null,u,p,c,a),null),c},useId:function(){var s=fn(),a=et.identifierPrefix;if(ze){var c=Rr,u=Nr;c=(u&~(1<<32-Nt(u)-1)).toString(32)+c,a="_"+a+"R_"+c,c=Ku++,0<c&&(a+="H"+c.toString(32)),a+="_"}else c=WC++,a="_"+a+"r_"+c.toString(32)+"_";return s.memoizedState=a},useHostTransitionStatus:Um,useFormState:Ev,useActionState:Ev,useOptimistic:function(s){var a=fn();a.memoizedState=a.baseState=s;var c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return a.queue=c,a=zm.bind(null,Ae,!0,c),c.dispatch=a,[s,a]},useMemoCache:Tm,useCacheRefresh:function(){return fn().memoizedState=nM.bind(null,Ae)},useEffectEvent:function(s){var a=fn(),c={impl:s};return a.memoizedState=c,function(){if((He&2)!==0)throw Error(r(440));return c.impl.apply(void 0,arguments)}}},Lm={readContext:Qt,use:Hu,useCallback:xv,useContext:Qt,useEffect:Rm,useImperativeHandle:Dv,useInsertionEffect:Mv,useLayoutEffect:Nv,useMemo:Iv,useReducer:qu,useRef:Tv,useState:function(){return qu(as)},useDebugValue:Dm,useDeferredValue:function(s,a){var c=Ot();return Uv(c,Je.memoizedState,s,a)},useTransition:function(){var s=qu(as)[0],a=Ot().memoizedState;return[typeof s=="boolean"?s:Bc(s),a]},useSyncExternalStore:uv,useId:Pv,useHostTransitionStatus:Um,useFormState:_v,useActionState:_v,useOptimistic:function(s,a){var c=Ot();return yv(c,Je,s,a)},useMemoCache:Tm,useCacheRefresh:$v};Lm.useEffectEvent=Cv;var Fv={readContext:Qt,use:Hu,useCallback:xv,useContext:Qt,useEffect:Rm,useImperativeHandle:Dv,useInsertionEffect:Mv,useLayoutEffect:Nv,useMemo:Iv,useReducer:Cm,useRef:Tv,useState:function(){return Cm(as)},useDebugValue:Dm,useDeferredValue:function(s,a){var c=Ot();return Je===null?xm(c,s,a):Uv(c,Je.memoizedState,s,a)},useTransition:function(){var s=Cm(as)[0],a=Ot().memoizedState;return[typeof s=="boolean"?s:Bc(s),a]},useSyncExternalStore:uv,useId:Pv,useHostTransitionStatus:Um,useFormState:kv,useActionState:kv,useOptimistic:function(s,a){var c=Ot();return Je!==null?yv(c,Je,s,a):(c.baseState=s,[s,c.queue.dispatch])},useMemoCache:Tm,useCacheRefresh:$v};Fv.useEffectEvent=Cv;function Bm(s,a,c,u){a=s.memoizedState,c=c(u,a),c=c==null?a:g({},a,c),s.memoizedState=c,s.lanes===0&&(s.updateQueue.baseState=c)}var Pm={enqueueSetState:function(s,a,c){s=s._reactInternals;var u=Pn(),d=xs(u);d.payload=a,c!=null&&(d.callback=c),a=Is(s,d,u),a!==null&&(kn(a,s,u),Ic(a,s,u))},enqueueReplaceState:function(s,a,c){s=s._reactInternals;var u=Pn(),d=xs(u);d.tag=1,d.payload=a,c!=null&&(d.callback=c),a=Is(s,d,u),a!==null&&(kn(a,s,u),Ic(a,s,u))},enqueueForceUpdate:function(s,a){s=s._reactInternals;var c=Pn(),u=xs(c);u.tag=2,a!=null&&(u.callback=a),a=Is(s,u,c),a!==null&&(kn(a,s,c),Ic(a,s,c))}};function Vv(s,a,c,u,d,p,w){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(u,p,w):a.prototype&&a.prototype.isPureReactComponent?!Tc(c,u)||!Tc(d,p):!0}function Gv(s,a,c,u){s=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(c,u),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(c,u),a.state!==s&&Pm.enqueueReplaceState(a,a.state,null)}function Pi(s,a){var c=a;if("ref"in a){c={};for(var u in a)u!=="ref"&&(c[u]=a[u])}if(s=s.defaultProps){c===a&&(c=g({},c));for(var d in s)c[d]===void 0&&(c[d]=s[d])}return c}function Zv(s){ku(s)}function Jv(s){console.error(s)}function Wv(s){ku(s)}function Zu(s,a){try{var c=s.onUncaughtError;c(a.value,{componentStack:a.stack})}catch(u){setTimeout(function(){throw u})}}function Yv(s,a,c){try{var u=s.onCaughtError;u(c.value,{componentStack:c.stack,errorBoundary:a.tag===1?a.stateNode:null})}catch(d){setTimeout(function(){throw d})}}function $m(s,a,c){return c=xs(c),c.tag=3,c.payload={element:null},c.callback=function(){Zu(s,a)},c}function Qv(s){return s=xs(s),s.tag=3,s}function Xv(s,a,c,u){var d=c.type.getDerivedStateFromError;if(typeof d=="function"){var p=u.value;s.payload=function(){return d(p)},s.callback=function(){Yv(a,c,u)}}var w=c.stateNode;w!==null&&typeof w.componentDidCatch=="function"&&(s.callback=function(){Yv(a,c,u),typeof d!="function"&&($s===null?$s=new Set([this]):$s.add(this));var v=u.stack;this.componentDidCatch(u.value,{componentStack:v!==null?v:""})})}function sM(s,a,c,u,d){if(c.flags|=32768,u!==null&&typeof u=="object"&&typeof u.then=="function"){if(a=c.alternate,a!==null&&La(a,c,d,!0),c=Un.current,c!==null){switch(c.tag){case 31:case 13:return tr===null?of():c.alternate===null&&St===0&&(St=3),c.flags&=-257,c.flags|=65536,c.lanes=d,u===Uu?c.flags|=16384:(a=c.updateQueue,a===null?c.updateQueue=new Set([u]):a.add(u),fp(s,u,d)),!1;case 22:return c.flags|=65536,u===Uu?c.flags|=16384:(a=c.updateQueue,a===null?(a={transitions:null,markerInstances:null,retryQueue:new Set([u])},c.updateQueue=a):(c=a.retryQueue,c===null?a.retryQueue=new Set([u]):c.add(u)),fp(s,u,d)),!1}throw Error(r(435,c.tag))}return fp(s,u,d),of(),!1}if(ze)return a=Un.current,a!==null?((a.flags&65536)===0&&(a.flags|=256),a.flags|=65536,a.lanes=d,u!==im&&(s=Error(r(422),{cause:u}),Mc(Yn(s,c)))):(u!==im&&(a=Error(r(423),{cause:u}),Mc(Yn(a,c))),s=s.current.alternate,s.flags|=65536,d&=-d,s.lanes|=d,u=Yn(u,c),d=$m(s.stateNode,u,d),ym(s,d),St!==4&&(St=2)),!1;var p=Error(r(520),{cause:u});if(p=Yn(p,c),Zc===null?Zc=[p]:Zc.push(p),St!==4&&(St=2),a===null)return!0;u=Yn(u,c),c=a;do{switch(c.tag){case 3:return c.flags|=65536,s=d&-d,c.lanes|=s,s=$m(c.stateNode,u,s),ym(c,s),!1;case 1:if(a=c.type,p=c.stateNode,(c.flags&128)===0&&(typeof a.getDerivedStateFromError=="function"||p!==null&&typeof p.componentDidCatch=="function"&&($s===null||!$s.has(p))))return c.flags|=65536,d&=-d,c.lanes|=d,d=Qv(d),Xv(d,s,c,u),ym(c,d),!1}c=c.return}while(c!==null);return!1}var Km=Error(r(461)),It=!1;function Xt(s,a,c,u){a.child=s===null?rv(a,null,c,u):Li(a,s.child,c,u)}function eS(s,a,c,u,d){c=c.render;var p=a.ref;if("ref"in u){var w={};for(var v in u)v!=="ref"&&(w[v]=u[v])}else w=u;return xi(a),u=Em(s,a,c,w,p,d),v=_m(),s!==null&&!It?(Am(s,a,d),os(s,a,d)):(ze&&v&&rm(a),a.flags|=1,Xt(s,a,u,d),a.child)}function tS(s,a,c,u,d){if(s===null){var p=c.type;return typeof p=="function"&&!em(p)&&p.defaultProps===void 0&&c.compare===null?(a.tag=15,a.type=p,nS(s,a,p,u,d)):(s=Mu(c.type,null,u,a,a.mode,d),s.ref=a.ref,s.return=a,a.child=s)}if(p=s.child,!Jm(s,d)){var w=p.memoizedProps;if(c=c.compare,c=c!==null?c:Tc,c(w,u)&&s.ref===a.ref)return os(s,a,d)}return a.flags|=1,s=ts(p,u),s.ref=a.ref,s.return=a,a.child=s}function nS(s,a,c,u,d){if(s!==null){var p=s.memoizedProps;if(Tc(p,u)&&s.ref===a.ref)if(It=!1,a.pendingProps=u=p,Jm(s,d))(s.flags&131072)!==0&&(It=!0);else return a.lanes=s.lanes,os(s,a,d)}return jm(s,a,c,u,d)}function rS(s,a,c,u){var d=u.children,p=s!==null?s.memoizedState:null;if(s===null&&a.stateNode===null&&(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),u.mode==="hidden"){if((a.flags&128)!==0){if(p=p!==null?p.baseLanes|c:c,s!==null){for(u=a.child=s.child,d=0;u!==null;)d=d|u.lanes|u.childLanes,u=u.sibling;u=d&~p}else u=0,a.child=null;return sS(s,a,p,c,u)}if((c&536870912)!==0)a.memoizedState={baseLanes:0,cachePool:null},s!==null&&xu(a,p!==null?p.cachePool:null),p!==null?av(a,p):wm(),ov(a);else return u=a.lanes=536870912,sS(s,a,p!==null?p.baseLanes|c:c,c,u)}else p!==null?(xu(a,p.cachePool),av(a,p),zs(),a.memoizedState=null):(s!==null&&xu(a,null),wm(),zs());return Xt(s,a,d,c),a.child}function Kc(s,a){return s!==null&&s.tag===22||a.stateNode!==null||(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),a.sibling}function sS(s,a,c,u,d){var p=hm();return p=p===null?null:{parent:Dt._currentValue,pool:p},a.memoizedState={baseLanes:c,cachePool:p},s!==null&&xu(a,null),wm(),ov(a),s!==null&&La(s,a,u,!0),a.childLanes=d,null}function Ju(s,a){return a=Yu({mode:a.mode,children:a.children},s.mode),a.ref=s.ref,s.child=a,a.return=s,a}function iS(s,a,c){return Li(a,s.child,null,c),s=Ju(a,a.pendingProps),s.flags|=2,zn(a),a.memoizedState=null,s}function iM(s,a,c){var u=a.pendingProps,d=(a.flags&128)!==0;if(a.flags&=-129,s===null){if(ze){if(u.mode==="hidden")return s=Ju(a,u),a.lanes=536870912,Kc(null,s);if(vm(a),(s=nt)?(s=gE(s,er),s=s!==null&&s.data==="&"?s:null,s!==null&&(a.memoizedState={dehydrated:s,treeContext:Cs!==null?{id:Nr,overflow:Rr}:null,retryLane:536870912,hydrationErrors:null},c=jb(s),c.return=a,a.child=c,Yt=a,nt=null)):s=null,s===null)throw Ns(a);return a.lanes=536870912,null}return Ju(a,u)}var p=s.memoizedState;if(p!==null){var w=p.dehydrated;if(vm(a),d)if(a.flags&256)a.flags&=-257,a=iS(s,a,c);else if(a.memoizedState!==null)a.child=s.child,a.flags|=128,a=null;else throw Error(r(558));else if(It||La(s,a,c,!1),d=(c&s.childLanes)!==0,It||d){if(u=et,u!==null&&(w=fu(u,c),w!==0&&w!==p.retryLane))throw p.retryLane=w,Mi(s,w),kn(u,s,w),Km;of(),a=iS(s,a,c)}else s=p.treeContext,nt=nr(w.nextSibling),Yt=a,ze=!0,Ms=null,er=!1,s!==null&&Fb(a,s),a=Ju(a,u),a.flags|=4096;return a}return s=ts(s.child,{mode:u.mode,children:u.children}),s.ref=a.ref,a.child=s,s.return=a,s}function Wu(s,a){var c=a.ref;if(c===null)s!==null&&s.ref!==null&&(a.flags|=4194816);else{if(typeof c!="function"&&typeof c!="object")throw Error(r(284));(s===null||s.ref!==c)&&(a.flags|=4194816)}}function jm(s,a,c,u,d){return xi(a),c=Em(s,a,c,u,void 0,d),u=_m(),s!==null&&!It?(Am(s,a,d),os(s,a,d)):(ze&&u&&rm(a),a.flags|=1,Xt(s,a,c,d),a.child)}function aS(s,a,c,u,d,p){return xi(a),a.updateQueue=null,c=lv(a,u,c,d),cv(s),u=_m(),s!==null&&!It?(Am(s,a,p),os(s,a,p)):(ze&&u&&rm(a),a.flags|=1,Xt(s,a,c,p),a.child)}function oS(s,a,c,u,d){if(xi(a),a.stateNode===null){var p=xa,w=c.contextType;typeof w=="object"&&w!==null&&(p=Qt(w)),p=new c(u,p),a.memoizedState=p.state!==null&&p.state!==void 0?p.state:null,p.updater=Pm,a.stateNode=p,p._reactInternals=a,p=a.stateNode,p.props=u,p.state=a.memoizedState,p.refs={},mm(a),w=c.contextType,p.context=typeof w=="object"&&w!==null?Qt(w):xa,p.state=a.memoizedState,w=c.getDerivedStateFromProps,typeof w=="function"&&(Bm(a,c,w,u),p.state=a.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof p.getSnapshotBeforeUpdate=="function"||typeof p.UNSAFE_componentWillMount!="function"&&typeof p.componentWillMount!="function"||(w=p.state,typeof p.componentWillMount=="function"&&p.componentWillMount(),typeof p.UNSAFE_componentWillMount=="function"&&p.UNSAFE_componentWillMount(),w!==p.state&&Pm.enqueueReplaceState(p,p.state,null),zc(a,u,p,d),Uc(),p.state=a.memoizedState),typeof p.componentDidMount=="function"&&(a.flags|=4194308),u=!0}else if(s===null){p=a.stateNode;var v=a.memoizedProps,O=Pi(c,v);p.props=O;var z=p.context,q=c.contextType;w=xa,typeof q=="object"&&q!==null&&(w=Qt(q));var J=c.getDerivedStateFromProps;q=typeof J=="function"||typeof p.getSnapshotBeforeUpdate=="function",v=a.pendingProps!==v,q||typeof p.UNSAFE_componentWillReceiveProps!="function"&&typeof p.componentWillReceiveProps!="function"||(v||z!==w)&&Gv(a,p,u,w),Ds=!1;var B=a.memoizedState;p.state=B,zc(a,u,p,d),Uc(),z=a.memoizedState,v||B!==z||Ds?(typeof J=="function"&&(Bm(a,c,J,u),z=a.memoizedState),(O=Ds||Vv(a,c,O,u,B,z,w))?(q||typeof p.UNSAFE_componentWillMount!="function"&&typeof p.componentWillMount!="function"||(typeof p.componentWillMount=="function"&&p.componentWillMount(),typeof p.UNSAFE_componentWillMount=="function"&&p.UNSAFE_componentWillMount()),typeof p.componentDidMount=="function"&&(a.flags|=4194308)):(typeof p.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=u,a.memoizedState=z),p.props=u,p.state=z,p.context=w,u=O):(typeof p.componentDidMount=="function"&&(a.flags|=4194308),u=!1)}else{p=a.stateNode,pm(s,a),w=a.memoizedProps,q=Pi(c,w),p.props=q,J=a.pendingProps,B=p.context,z=c.contextType,O=xa,typeof z=="object"&&z!==null&&(O=Qt(z)),v=c.getDerivedStateFromProps,(z=typeof v=="function"||typeof p.getSnapshotBeforeUpdate=="function")||typeof p.UNSAFE_componentWillReceiveProps!="function"&&typeof p.componentWillReceiveProps!="function"||(w!==J||B!==O)&&Gv(a,p,u,O),Ds=!1,B=a.memoizedState,p.state=B,zc(a,u,p,d),Uc();var K=a.memoizedState;w!==J||B!==K||Ds||s!==null&&s.dependencies!==null&&Ru(s.dependencies)?(typeof v=="function"&&(Bm(a,c,v,u),K=a.memoizedState),(q=Ds||Vv(a,c,q,u,B,K,O)||s!==null&&s.dependencies!==null&&Ru(s.dependencies))?(z||typeof p.UNSAFE_componentWillUpdate!="function"&&typeof p.componentWillUpdate!="function"||(typeof p.componentWillUpdate=="function"&&p.componentWillUpdate(u,K,O),typeof p.UNSAFE_componentWillUpdate=="function"&&p.UNSAFE_componentWillUpdate(u,K,O)),typeof p.componentDidUpdate=="function"&&(a.flags|=4),typeof p.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof p.componentDidUpdate!="function"||w===s.memoizedProps&&B===s.memoizedState||(a.flags|=4),typeof p.getSnapshotBeforeUpdate!="function"||w===s.memoizedProps&&B===s.memoizedState||(a.flags|=1024),a.memoizedProps=u,a.memoizedState=K),p.props=u,p.state=K,p.context=O,u=q):(typeof p.componentDidUpdate!="function"||w===s.memoizedProps&&B===s.memoizedState||(a.flags|=4),typeof p.getSnapshotBeforeUpdate!="function"||w===s.memoizedProps&&B===s.memoizedState||(a.flags|=1024),u=!1)}return p=u,Wu(s,a),u=(a.flags&128)!==0,p||u?(p=a.stateNode,c=u&&typeof c.getDerivedStateFromError!="function"?null:p.render(),a.flags|=1,s!==null&&u?(a.child=Li(a,s.child,null,d),a.child=Li(a,null,c,d)):Xt(s,a,c,d),a.memoizedState=p.state,s=a.child):s=os(s,a,d),s}function cS(s,a,c,u){return Ri(),a.flags|=256,Xt(s,a,c,u),a.child}var Hm={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function qm(s){return{baseLanes:s,cachePool:Yb()}}function Fm(s,a,c){return s=s!==null?s.childLanes&~c:0,a&&(s|=Bn),s}function lS(s,a,c){var u=a.pendingProps,d=!1,p=(a.flags&128)!==0,w;if((w=p)||(w=s!==null&&s.memoizedState===null?!1:(Tt.current&2)!==0),w&&(d=!0,a.flags&=-129),w=(a.flags&32)!==0,a.flags&=-33,s===null){if(ze){if(d?Us(a):zs(),(s=nt)?(s=gE(s,er),s=s!==null&&s.data!=="&"?s:null,s!==null&&(a.memoizedState={dehydrated:s,treeContext:Cs!==null?{id:Nr,overflow:Rr}:null,retryLane:536870912,hydrationErrors:null},c=jb(s),c.return=a,a.child=c,Yt=a,nt=null)):s=null,s===null)throw Ns(a);return Op(s)?a.lanes=32:a.lanes=536870912,null}var v=u.children;return u=u.fallback,d?(zs(),d=a.mode,v=Yu({mode:"hidden",children:v},d),u=Ni(u,d,c,null),v.return=a,u.return=a,v.sibling=u,a.child=v,u=a.child,u.memoizedState=qm(c),u.childLanes=Fm(s,w,c),a.memoizedState=Hm,Kc(null,u)):(Us(a),Vm(a,v))}var O=s.memoizedState;if(O!==null&&(v=O.dehydrated,v!==null)){if(p)a.flags&256?(Us(a),a.flags&=-257,a=Gm(s,a,c)):a.memoizedState!==null?(zs(),a.child=s.child,a.flags|=128,a=null):(zs(),v=u.fallback,d=a.mode,u=Yu({mode:"visible",children:u.children},d),v=Ni(v,d,c,null),v.flags|=2,u.return=a,v.return=a,u.sibling=v,a.child=u,Li(a,s.child,null,c),u=a.child,u.memoizedState=qm(c),u.childLanes=Fm(s,w,c),a.memoizedState=Hm,a=Kc(null,u));else if(Us(a),Op(v)){if(w=v.nextSibling&&v.nextSibling.dataset,w)var z=w.dgst;w=z,u=Error(r(419)),u.stack="",u.digest=w,Mc({value:u,source:null,stack:null}),a=Gm(s,a,c)}else if(It||La(s,a,c,!1),w=(c&s.childLanes)!==0,It||w){if(w=et,w!==null&&(u=fu(w,c),u!==0&&u!==O.retryLane))throw O.retryLane=u,Mi(s,u),kn(w,s,u),Km;Tp(v)||of(),a=Gm(s,a,c)}else Tp(v)?(a.flags|=192,a.child=s.child,a=null):(s=O.treeContext,nt=nr(v.nextSibling),Yt=a,ze=!0,Ms=null,er=!1,s!==null&&Fb(a,s),a=Vm(a,u.children),a.flags|=4096);return a}return d?(zs(),v=u.fallback,d=a.mode,O=s.child,z=O.sibling,u=ts(O,{mode:"hidden",children:u.children}),u.subtreeFlags=O.subtreeFlags&65011712,z!==null?v=ts(z,v):(v=Ni(v,d,c,null),v.flags|=2),v.return=a,u.return=a,u.sibling=v,a.child=u,Kc(null,u),u=a.child,v=s.child.memoizedState,v===null?v=qm(c):(d=v.cachePool,d!==null?(O=Dt._currentValue,d=d.parent!==O?{parent:O,pool:O}:d):d=Yb(),v={baseLanes:v.baseLanes|c,cachePool:d}),u.memoizedState=v,u.childLanes=Fm(s,w,c),a.memoizedState=Hm,Kc(s.child,u)):(Us(a),c=s.child,s=c.sibling,c=ts(c,{mode:"visible",children:u.children}),c.return=a,c.sibling=null,s!==null&&(w=a.deletions,w===null?(a.deletions=[s],a.flags|=16):w.push(s)),a.child=c,a.memoizedState=null,c)}function Vm(s,a){return a=Yu({mode:"visible",children:a},s.mode),a.return=s,s.child=a}function Yu(s,a){return s=In(22,s,null,a),s.lanes=0,s}function Gm(s,a,c){return Li(a,s.child,null,c),s=Vm(a,a.pendingProps.children),s.flags|=2,a.memoizedState=null,s}function uS(s,a,c){s.lanes|=a;var u=s.alternate;u!==null&&(u.lanes|=a),cm(s.return,a,c)}function Zm(s,a,c,u,d,p){var w=s.memoizedState;w===null?s.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:u,tail:c,tailMode:d,treeForkCount:p}:(w.isBackwards=a,w.rendering=null,w.renderingStartTime=0,w.last=u,w.tail=c,w.tailMode=d,w.treeForkCount=p)}function fS(s,a,c){var u=a.pendingProps,d=u.revealOrder,p=u.tail;u=u.children;var w=Tt.current,v=(w&2)!==0;if(v?(w=w&1|2,a.flags|=128):w&=1,Q(Tt,w),Xt(s,a,u,c),u=ze?Cc:0,!v&&s!==null&&(s.flags&128)!==0)e:for(s=a.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&uS(s,c,a);else if(s.tag===19)uS(s,c,a);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===a)break e;for(;s.sibling===null;){if(s.return===null||s.return===a)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}switch(d){case"forwards":for(c=a.child,d=null;c!==null;)s=c.alternate,s!==null&&Pu(s)===null&&(d=c),c=c.sibling;c=d,c===null?(d=a.child,a.child=null):(d=c.sibling,c.sibling=null),Zm(a,!1,d,c,p,u);break;case"backwards":case"unstable_legacy-backwards":for(c=null,d=a.child,a.child=null;d!==null;){if(s=d.alternate,s!==null&&Pu(s)===null){a.child=d;break}s=d.sibling,d.sibling=c,c=d,d=s}Zm(a,!0,c,null,p,u);break;case"together":Zm(a,!1,null,null,void 0,u);break;default:a.memoizedState=null}return a.child}function os(s,a,c){if(s!==null&&(a.dependencies=s.dependencies),Ps|=a.lanes,(c&a.childLanes)===0)if(s!==null){if(La(s,a,c,!1),(c&a.childLanes)===0)return null}else return null;if(s!==null&&a.child!==s.child)throw Error(r(153));if(a.child!==null){for(s=a.child,c=ts(s,s.pendingProps),a.child=c,c.return=a;s.sibling!==null;)s=s.sibling,c=c.sibling=ts(s,s.pendingProps),c.return=a;c.sibling=null}return a.child}function Jm(s,a){return(s.lanes&a)!==0?!0:(s=s.dependencies,!!(s!==null&&Ru(s)))}function aM(s,a,c){switch(a.tag){case 3:bt(a,a.stateNode.containerInfo),Rs(a,Dt,s.memoizedState.cache),Ri();break;case 27:case 5:qr(a);break;case 4:bt(a,a.stateNode.containerInfo);break;case 10:Rs(a,a.type,a.memoizedProps.value);break;case 31:if(a.memoizedState!==null)return a.flags|=128,vm(a),null;break;case 13:var u=a.memoizedState;if(u!==null)return u.dehydrated!==null?(Us(a),a.flags|=128,null):(c&a.child.childLanes)!==0?lS(s,a,c):(Us(a),s=os(s,a,c),s!==null?s.sibling:null);Us(a);break;case 19:var d=(s.flags&128)!==0;if(u=(c&a.childLanes)!==0,u||(La(s,a,c,!1),u=(c&a.childLanes)!==0),d){if(u)return fS(s,a,c);a.flags|=128}if(d=a.memoizedState,d!==null&&(d.rendering=null,d.tail=null,d.lastEffect=null),Q(Tt,Tt.current),u)break;return null;case 22:return a.lanes=0,rS(s,a,c,a.pendingProps);case 24:Rs(a,Dt,s.memoizedState.cache)}return os(s,a,c)}function hS(s,a,c){if(s!==null)if(s.memoizedProps!==a.pendingProps)It=!0;else{if(!Jm(s,c)&&(a.flags&128)===0)return It=!1,aM(s,a,c);It=(s.flags&131072)!==0}else It=!1,ze&&(a.flags&1048576)!==0&&qb(a,Cc,a.index);switch(a.lanes=0,a.tag){case 16:e:{var u=a.pendingProps;if(s=Ui(a.elementType),a.type=s,typeof s=="function")em(s)?(u=Pi(s,u),a.tag=1,a=oS(null,a,s,u,c)):(a.tag=0,a=jm(null,a,s,u,c));else{if(s!=null){var d=s.$$typeof;if(d===L){a.tag=11,a=eS(null,a,s,u,c);break e}else if(d===G){a.tag=14,a=tS(null,a,s,u,c);break e}}throw a=$t(s)||s,Error(r(306,a,""))}}return a;case 0:return jm(s,a,a.type,a.pendingProps,c);case 1:return u=a.type,d=Pi(u,a.pendingProps),oS(s,a,u,d,c);case 3:e:{if(bt(a,a.stateNode.containerInfo),s===null)throw Error(r(387));u=a.pendingProps;var p=a.memoizedState;d=p.element,pm(s,a),zc(a,u,null,c);var w=a.memoizedState;if(u=w.cache,Rs(a,Dt,u),u!==p.cache&&lm(a,[Dt],c,!0),Uc(),u=w.element,p.isDehydrated)if(p={element:u,isDehydrated:!1,cache:w.cache},a.updateQueue.baseState=p,a.memoizedState=p,a.flags&256){a=cS(s,a,u,c);break e}else if(u!==d){d=Yn(Error(r(424)),a),Mc(d),a=cS(s,a,u,c);break e}else for(s=a.stateNode.containerInfo,s.nodeType===9?s=s.body:s=s.nodeName==="HTML"?s.ownerDocument.body:s,nt=nr(s.firstChild),Yt=a,ze=!0,Ms=null,er=!0,c=rv(a,null,u,c),a.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling;else{if(Ri(),u===d){a=os(s,a,c);break e}Xt(s,a,u,c)}a=a.child}return a;case 26:return Wu(s,a),s===null?(c=_E(a.type,null,a.pendingProps,null))?a.memoizedState=c:ze||(c=a.type,s=a.pendingProps,u=mf(_e.current).createElement(c),u[Rt]=a,u[lt]=s,en(u,c,s),Ce(u),a.stateNode=u):a.memoizedState=_E(a.type,s.memoizedProps,a.pendingProps,s.memoizedState),null;case 27:return qr(a),s===null&&ze&&(u=a.stateNode=vE(a.type,a.pendingProps,_e.current),Yt=a,er=!0,d=nt,qs(a.type)?(Cp=d,nt=nr(u.firstChild)):nt=d),Xt(s,a,a.pendingProps.children,c),Wu(s,a),s===null&&(a.flags|=4194304),a.child;case 5:return s===null&&ze&&((d=u=nt)&&(u=zM(u,a.type,a.pendingProps,er),u!==null?(a.stateNode=u,Yt=a,nt=nr(u.firstChild),er=!1,d=!0):d=!1),d||Ns(a)),qr(a),d=a.type,p=a.pendingProps,w=s!==null?s.memoizedProps:null,u=p.children,_p(d,p)?u=null:w!==null&&_p(d,w)&&(a.flags|=32),a.memoizedState!==null&&(d=Em(s,a,YC,null,null,c),nl._currentValue=d),Wu(s,a),Xt(s,a,u,c),a.child;case 6:return s===null&&ze&&((s=c=nt)&&(c=LM(c,a.pendingProps,er),c!==null?(a.stateNode=c,Yt=a,nt=null,s=!0):s=!1),s||Ns(a)),null;case 13:return lS(s,a,c);case 4:return bt(a,a.stateNode.containerInfo),u=a.pendingProps,s===null?a.child=Li(a,null,u,c):Xt(s,a,u,c),a.child;case 11:return eS(s,a,a.type,a.pendingProps,c);case 7:return Xt(s,a,a.pendingProps,c),a.child;case 8:return Xt(s,a,a.pendingProps.children,c),a.child;case 12:return Xt(s,a,a.pendingProps.children,c),a.child;case 10:return u=a.pendingProps,Rs(a,a.type,u.value),Xt(s,a,u.children,c),a.child;case 9:return d=a.type._context,u=a.pendingProps.children,xi(a),d=Qt(d),u=u(d),a.flags|=1,Xt(s,a,u,c),a.child;case 14:return tS(s,a,a.type,a.pendingProps,c);case 15:return nS(s,a,a.type,a.pendingProps,c);case 19:return fS(s,a,c);case 31:return iM(s,a,c);case 22:return rS(s,a,c,a.pendingProps);case 24:return xi(a),u=Qt(Dt),s===null?(d=hm(),d===null&&(d=et,p=um(),d.pooledCache=p,p.refCount++,p!==null&&(d.pooledCacheLanes|=c),d=p),a.memoizedState={parent:u,cache:d},mm(a),Rs(a,Dt,d)):((s.lanes&c)!==0&&(pm(s,a),zc(a,null,null,c),Uc()),d=s.memoizedState,p=a.memoizedState,d.parent!==u?(d={parent:u,cache:u},a.memoizedState=d,a.lanes===0&&(a.memoizedState=a.updateQueue.baseState=d),Rs(a,Dt,u)):(u=p.cache,Rs(a,Dt,u),u!==d.cache&&lm(a,[Dt],c,!0))),Xt(s,a,a.pendingProps.children,c),a.child;case 29:throw a.pendingProps}throw Error(r(156,a.tag))}function cs(s){s.flags|=4}function Wm(s,a,c,u,d){if((a=(s.mode&32)!==0)&&(a=!1),a){if(s.flags|=16777216,(d&335544128)===d)if(s.stateNode.complete)s.flags|=8192;else if(PS())s.flags|=8192;else throw zi=Uu,dm}else s.flags&=-16777217}function dS(s,a){if(a.type!=="stylesheet"||(a.state.loading&4)!==0)s.flags&=-16777217;else if(s.flags|=16777216,!CE(a))if(PS())s.flags|=8192;else throw zi=Uu,dm}function Qu(s,a){a!==null&&(s.flags|=4),s.flags&16384&&(a=s.tag!==22?Wr():536870912,s.lanes|=a,Ja|=a)}function jc(s,a){if(!ze)switch(s.tailMode){case"hidden":a=s.tail;for(var c=null;a!==null;)a.alternate!==null&&(c=a),a=a.sibling;c===null?s.tail=null:c.sibling=null;break;case"collapsed":c=s.tail;for(var u=null;c!==null;)c.alternate!==null&&(u=c),c=c.sibling;u===null?a||s.tail===null?s.tail=null:s.tail.sibling=null:u.sibling=null}}function rt(s){var a=s.alternate!==null&&s.alternate.child===s.child,c=0,u=0;if(a)for(var d=s.child;d!==null;)c|=d.lanes|d.childLanes,u|=d.subtreeFlags&65011712,u|=d.flags&65011712,d.return=s,d=d.sibling;else for(d=s.child;d!==null;)c|=d.lanes|d.childLanes,u|=d.subtreeFlags,u|=d.flags,d.return=s,d=d.sibling;return s.subtreeFlags|=u,s.childLanes=c,a}function oM(s,a,c){var u=a.pendingProps;switch(sm(a),a.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return rt(a),null;case 1:return rt(a),null;case 3:return c=a.stateNode,u=null,s!==null&&(u=s.memoizedState.cache),a.memoizedState.cache!==u&&(a.flags|=2048),ss(Dt),ct(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(s===null||s.child===null)&&(za(a)?cs(a):s===null||s.memoizedState.isDehydrated&&(a.flags&256)===0||(a.flags|=1024,am())),rt(a),null;case 26:var d=a.type,p=a.memoizedState;return s===null?(cs(a),p!==null?(rt(a),dS(a,p)):(rt(a),Wm(a,d,null,u,c))):p?p!==s.memoizedState?(cs(a),rt(a),dS(a,p)):(rt(a),a.flags&=-16777217):(s=s.memoizedProps,s!==u&&cs(a),rt(a),Wm(a,d,s,u,c)),null;case 27:if(Ei(a),c=_e.current,d=a.type,s!==null&&a.stateNode!=null)s.memoizedProps!==u&&cs(a);else{if(!u){if(a.stateNode===null)throw Error(r(166));return rt(a),null}s=ae.current,za(a)?Vb(a):(s=vE(d,u,c),a.stateNode=s,cs(a))}return rt(a),null;case 5:if(Ei(a),d=a.type,s!==null&&a.stateNode!=null)s.memoizedProps!==u&&cs(a);else{if(!u){if(a.stateNode===null)throw Error(r(166));return rt(a),null}if(p=ae.current,za(a))Vb(a);else{var w=mf(_e.current);switch(p){case 1:p=w.createElementNS("http://www.w3.org/2000/svg",d);break;case 2:p=w.createElementNS("http://www.w3.org/1998/Math/MathML",d);break;default:switch(d){case"svg":p=w.createElementNS("http://www.w3.org/2000/svg",d);break;case"math":p=w.createElementNS("http://www.w3.org/1998/Math/MathML",d);break;case"script":p=w.createElement("div"),p.innerHTML="<script><\/script>",p=p.removeChild(p.firstChild);break;case"select":p=typeof u.is=="string"?w.createElement("select",{is:u.is}):w.createElement("select"),u.multiple?p.multiple=!0:u.size&&(p.size=u.size);break;default:p=typeof u.is=="string"?w.createElement(d,{is:u.is}):w.createElement(d)}}p[Rt]=a,p[lt]=u;e:for(w=a.child;w!==null;){if(w.tag===5||w.tag===6)p.appendChild(w.stateNode);else if(w.tag!==4&&w.tag!==27&&w.child!==null){w.child.return=w,w=w.child;continue}if(w===a)break e;for(;w.sibling===null;){if(w.return===null||w.return===a)break e;w=w.return}w.sibling.return=w.return,w=w.sibling}a.stateNode=p;e:switch(en(p,d,u),d){case"button":case"input":case"select":case"textarea":u=!!u.autoFocus;break e;case"img":u=!0;break e;default:u=!1}u&&cs(a)}}return rt(a),Wm(a,a.type,s===null?null:s.memoizedProps,a.pendingProps,c),null;case 6:if(s&&a.stateNode!=null)s.memoizedProps!==u&&cs(a);else{if(typeof u!="string"&&a.stateNode===null)throw Error(r(166));if(s=_e.current,za(a)){if(s=a.stateNode,c=a.memoizedProps,u=null,d=Yt,d!==null)switch(d.tag){case 27:case 5:u=d.memoizedProps}s[Rt]=a,s=!!(s.nodeValue===c||u!==null&&u.suppressHydrationWarning===!0||lE(s.nodeValue,c)),s||Ns(a,!0)}else s=mf(s).createTextNode(u),s[Rt]=a,a.stateNode=s}return rt(a),null;case 31:if(c=a.memoizedState,s===null||s.memoizedState!==null){if(u=za(a),c!==null){if(s===null){if(!u)throw Error(r(318));if(s=a.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(r(557));s[Rt]=a}else Ri(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;rt(a),s=!1}else c=am(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=c),s=!0;if(!s)return a.flags&256?(zn(a),a):(zn(a),null);if((a.flags&128)!==0)throw Error(r(558))}return rt(a),null;case 13:if(u=a.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(d=za(a),u!==null&&u.dehydrated!==null){if(s===null){if(!d)throw Error(r(318));if(d=a.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(r(317));d[Rt]=a}else Ri(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;rt(a),d=!1}else d=am(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=d),d=!0;if(!d)return a.flags&256?(zn(a),a):(zn(a),null)}return zn(a),(a.flags&128)!==0?(a.lanes=c,a):(c=u!==null,s=s!==null&&s.memoizedState!==null,c&&(u=a.child,d=null,u.alternate!==null&&u.alternate.memoizedState!==null&&u.alternate.memoizedState.cachePool!==null&&(d=u.alternate.memoizedState.cachePool.pool),p=null,u.memoizedState!==null&&u.memoizedState.cachePool!==null&&(p=u.memoizedState.cachePool.pool),p!==d&&(u.flags|=2048)),c!==s&&c&&(a.child.flags|=8192),Qu(a,a.updateQueue),rt(a),null);case 4:return ct(),s===null&&wp(a.stateNode.containerInfo),rt(a),null;case 10:return ss(a.type),rt(a),null;case 19:if(V(Tt),u=a.memoizedState,u===null)return rt(a),null;if(d=(a.flags&128)!==0,p=u.rendering,p===null)if(d)jc(u,!1);else{if(St!==0||s!==null&&(s.flags&128)!==0)for(s=a.child;s!==null;){if(p=Pu(s),p!==null){for(a.flags|=128,jc(u,!1),s=p.updateQueue,a.updateQueue=s,Qu(a,s),a.subtreeFlags=0,s=c,c=a.child;c!==null;)Kb(c,s),c=c.sibling;return Q(Tt,Tt.current&1|2),ze&&ns(a,u.treeForkCount),a.child}s=s.sibling}u.tail!==null&&Jt()>rf&&(a.flags|=128,d=!0,jc(u,!1),a.lanes=4194304)}else{if(!d)if(s=Pu(p),s!==null){if(a.flags|=128,d=!0,s=s.updateQueue,a.updateQueue=s,Qu(a,s),jc(u,!0),u.tail===null&&u.tailMode==="hidden"&&!p.alternate&&!ze)return rt(a),null}else 2*Jt()-u.renderingStartTime>rf&&c!==536870912&&(a.flags|=128,d=!0,jc(u,!1),a.lanes=4194304);u.isBackwards?(p.sibling=a.child,a.child=p):(s=u.last,s!==null?s.sibling=p:a.child=p,u.last=p)}return u.tail!==null?(s=u.tail,u.rendering=s,u.tail=s.sibling,u.renderingStartTime=Jt(),s.sibling=null,c=Tt.current,Q(Tt,d?c&1|2:c&1),ze&&ns(a,u.treeForkCount),s):(rt(a),null);case 22:case 23:return zn(a),bm(),u=a.memoizedState!==null,s!==null?s.memoizedState!==null!==u&&(a.flags|=8192):u&&(a.flags|=8192),u?(c&536870912)!==0&&(a.flags&128)===0&&(rt(a),a.subtreeFlags&6&&(a.flags|=8192)):rt(a),c=a.updateQueue,c!==null&&Qu(a,c.retryQueue),c=null,s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(c=s.memoizedState.cachePool.pool),u=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(u=a.memoizedState.cachePool.pool),u!==c&&(a.flags|=2048),s!==null&&V(Ii),null;case 24:return c=null,s!==null&&(c=s.memoizedState.cache),a.memoizedState.cache!==c&&(a.flags|=2048),ss(Dt),rt(a),null;case 25:return null;case 30:return null}throw Error(r(156,a.tag))}function cM(s,a){switch(sm(a),a.tag){case 1:return s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 3:return ss(Dt),ct(),s=a.flags,(s&65536)!==0&&(s&128)===0?(a.flags=s&-65537|128,a):null;case 26:case 27:case 5:return Ei(a),null;case 31:if(a.memoizedState!==null){if(zn(a),a.alternate===null)throw Error(r(340));Ri()}return s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 13:if(zn(a),s=a.memoizedState,s!==null&&s.dehydrated!==null){if(a.alternate===null)throw Error(r(340));Ri()}return s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 19:return V(Tt),null;case 4:return ct(),null;case 10:return ss(a.type),null;case 22:case 23:return zn(a),bm(),s!==null&&V(Ii),s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 24:return ss(Dt),null;case 25:return null;default:return null}}function mS(s,a){switch(sm(a),a.tag){case 3:ss(Dt),ct();break;case 26:case 27:case 5:Ei(a);break;case 4:ct();break;case 31:a.memoizedState!==null&&zn(a);break;case 13:zn(a);break;case 19:V(Tt);break;case 10:ss(a.type);break;case 22:case 23:zn(a),bm(),s!==null&&V(Ii);break;case 24:ss(Dt)}}function Hc(s,a){try{var c=a.updateQueue,u=c!==null?c.lastEffect:null;if(u!==null){var d=u.next;c=d;do{if((c.tag&s)===s){u=void 0;var p=c.create,w=c.inst;u=p(),w.destroy=u}c=c.next}while(c!==d)}}catch(v){Ze(a,a.return,v)}}function Ls(s,a,c){try{var u=a.updateQueue,d=u!==null?u.lastEffect:null;if(d!==null){var p=d.next;u=p;do{if((u.tag&s)===s){var w=u.inst,v=w.destroy;if(v!==void 0){w.destroy=void 0,d=a;var O=c,z=v;try{z()}catch(q){Ze(d,O,q)}}}u=u.next}while(u!==p)}}catch(q){Ze(a,a.return,q)}}function pS(s){var a=s.updateQueue;if(a!==null){var c=s.stateNode;try{iv(a,c)}catch(u){Ze(s,s.return,u)}}}function yS(s,a,c){c.props=Pi(s.type,s.memoizedProps),c.state=s.memoizedState;try{c.componentWillUnmount()}catch(u){Ze(s,a,u)}}function qc(s,a){try{var c=s.ref;if(c!==null){switch(s.tag){case 26:case 27:case 5:var u=s.stateNode;break;case 30:u=s.stateNode;break;default:u=s.stateNode}typeof c=="function"?s.refCleanup=c(u):c.current=u}}catch(d){Ze(s,a,d)}}function Dr(s,a){var c=s.ref,u=s.refCleanup;if(c!==null)if(typeof u=="function")try{u()}catch(d){Ze(s,a,d)}finally{s.refCleanup=null,s=s.alternate,s!=null&&(s.refCleanup=null)}else if(typeof c=="function")try{c(null)}catch(d){Ze(s,a,d)}else c.current=null}function gS(s){var a=s.type,c=s.memoizedProps,u=s.stateNode;try{e:switch(a){case"button":case"input":case"select":case"textarea":c.autoFocus&&u.focus();break e;case"img":c.src?u.src=c.src:c.srcSet&&(u.srcset=c.srcSet)}}catch(d){Ze(s,s.return,d)}}function Ym(s,a,c){try{var u=s.stateNode;NM(u,s.type,c,a),u[lt]=a}catch(d){Ze(s,s.return,d)}}function wS(s){return s.tag===5||s.tag===3||s.tag===26||s.tag===27&&qs(s.type)||s.tag===4}function Qm(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||wS(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.tag===27&&qs(s.type)||s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function Xm(s,a,c){var u=s.tag;if(u===5||u===6)s=s.stateNode,a?(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c).insertBefore(s,a):(a=c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,a.appendChild(s),c=c._reactRootContainer,c!=null||a.onclick!==null||(a.onclick=Xr));else if(u!==4&&(u===27&&qs(s.type)&&(c=s.stateNode,a=null),s=s.child,s!==null))for(Xm(s,a,c),s=s.sibling;s!==null;)Xm(s,a,c),s=s.sibling}function Xu(s,a,c){var u=s.tag;if(u===5||u===6)s=s.stateNode,a?c.insertBefore(s,a):c.appendChild(s);else if(u!==4&&(u===27&&qs(s.type)&&(c=s.stateNode),s=s.child,s!==null))for(Xu(s,a,c),s=s.sibling;s!==null;)Xu(s,a,c),s=s.sibling}function bS(s){var a=s.stateNode,c=s.memoizedProps;try{for(var u=s.type,d=a.attributes;d.length;)a.removeAttributeNode(d[0]);en(a,u,c),a[Rt]=s,a[lt]=c}catch(p){Ze(s,s.return,p)}}var ls=!1,Ut=!1,ep=!1,vS=typeof WeakSet=="function"?WeakSet:Set,Ft=null;function lM(s,a){if(s=s.containerInfo,Sp=Sf,s=Db(s),Gd(s)){if("selectionStart"in s)var c={start:s.selectionStart,end:s.selectionEnd};else e:{c=(c=s.ownerDocument)&&c.defaultView||window;var u=c.getSelection&&c.getSelection();if(u&&u.rangeCount!==0){c=u.anchorNode;var d=u.anchorOffset,p=u.focusNode;u=u.focusOffset;try{c.nodeType,p.nodeType}catch{c=null;break e}var w=0,v=-1,O=-1,z=0,q=0,J=s,B=null;t:for(;;){for(var K;J!==c||d!==0&&J.nodeType!==3||(v=w+d),J!==p||u!==0&&J.nodeType!==3||(O=w+u),J.nodeType===3&&(w+=J.nodeValue.length),(K=J.firstChild)!==null;)B=J,J=K;for(;;){if(J===s)break t;if(B===c&&++z===d&&(v=w),B===p&&++q===u&&(O=w),(K=J.nextSibling)!==null)break;J=B,B=J.parentNode}J=K}c=v===-1||O===-1?null:{start:v,end:O}}else c=null}c=c||{start:0,end:0}}else c=null;for(Ep={focusedElem:s,selectionRange:c},Sf=!1,Ft=a;Ft!==null;)if(a=Ft,s=a.child,(a.subtreeFlags&1028)!==0&&s!==null)s.return=a,Ft=s;else for(;Ft!==null;){switch(a=Ft,p=a.alternate,s=a.flags,a.tag){case 0:if((s&4)!==0&&(s=a.updateQueue,s=s!==null?s.events:null,s!==null))for(c=0;c<s.length;c++)d=s[c],d.ref.impl=d.nextImpl;break;case 11:case 15:break;case 1:if((s&1024)!==0&&p!==null){s=void 0,c=a,d=p.memoizedProps,p=p.memoizedState,u=c.stateNode;try{var ce=Pi(c.type,d);s=u.getSnapshotBeforeUpdate(ce,p),u.__reactInternalSnapshotBeforeUpdate=s}catch(we){Ze(c,c.return,we)}}break;case 3:if((s&1024)!==0){if(s=a.stateNode.containerInfo,c=s.nodeType,c===9)kp(s);else if(c===1)switch(s.nodeName){case"HEAD":case"HTML":case"BODY":kp(s);break;default:s.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((s&1024)!==0)throw Error(r(163))}if(s=a.sibling,s!==null){s.return=a.return,Ft=s;break}Ft=a.return}}function SS(s,a,c){var u=c.flags;switch(c.tag){case 0:case 11:case 15:fs(s,c),u&4&&Hc(5,c);break;case 1:if(fs(s,c),u&4)if(s=c.stateNode,a===null)try{s.componentDidMount()}catch(w){Ze(c,c.return,w)}else{var d=Pi(c.type,a.memoizedProps);a=a.memoizedState;try{s.componentDidUpdate(d,a,s.__reactInternalSnapshotBeforeUpdate)}catch(w){Ze(c,c.return,w)}}u&64&&pS(c),u&512&&qc(c,c.return);break;case 3:if(fs(s,c),u&64&&(s=c.updateQueue,s!==null)){if(a=null,c.child!==null)switch(c.child.tag){case 27:case 5:a=c.child.stateNode;break;case 1:a=c.child.stateNode}try{iv(s,a)}catch(w){Ze(c,c.return,w)}}break;case 27:a===null&&u&4&&bS(c);case 26:case 5:fs(s,c),a===null&&u&4&&gS(c),u&512&&qc(c,c.return);break;case 12:fs(s,c);break;case 31:fs(s,c),u&4&&AS(s,c);break;case 13:fs(s,c),u&4&&kS(s,c),u&64&&(s=c.memoizedState,s!==null&&(s=s.dehydrated,s!==null&&(c=wM.bind(null,c),BM(s,c))));break;case 22:if(u=c.memoizedState!==null||ls,!u){a=a!==null&&a.memoizedState!==null||Ut,d=ls;var p=Ut;ls=u,(Ut=a)&&!p?hs(s,c,(c.subtreeFlags&8772)!==0):fs(s,c),ls=d,Ut=p}break;case 30:break;default:fs(s,c)}}function ES(s){var a=s.alternate;a!==null&&(s.alternate=null,ES(a)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(a=s.stateNode,a!==null&&C(a)),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}var ut=null,Sn=!1;function us(s,a,c){for(c=c.child;c!==null;)_S(s,a,c),c=c.sibling}function _S(s,a,c){if(Ht&&typeof Ht.onCommitFiberUnmount=="function")try{Ht.onCommitFiberUnmount(Cr,c)}catch{}switch(c.tag){case 26:Ut||Dr(c,a),us(s,a,c),c.memoizedState?c.memoizedState.count--:c.stateNode&&(c=c.stateNode,c.parentNode.removeChild(c));break;case 27:Ut||Dr(c,a);var u=ut,d=Sn;qs(c.type)&&(ut=c.stateNode,Sn=!1),us(s,a,c),Xc(c.stateNode),ut=u,Sn=d;break;case 5:Ut||Dr(c,a);case 6:if(u=ut,d=Sn,ut=null,us(s,a,c),ut=u,Sn=d,ut!==null)if(Sn)try{(ut.nodeType===9?ut.body:ut.nodeName==="HTML"?ut.ownerDocument.body:ut).removeChild(c.stateNode)}catch(p){Ze(c,a,p)}else try{ut.removeChild(c.stateNode)}catch(p){Ze(c,a,p)}break;case 18:ut!==null&&(Sn?(s=ut,pE(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,c.stateNode),ro(s)):pE(ut,c.stateNode));break;case 4:u=ut,d=Sn,ut=c.stateNode.containerInfo,Sn=!0,us(s,a,c),ut=u,Sn=d;break;case 0:case 11:case 14:case 15:Ls(2,c,a),Ut||Ls(4,c,a),us(s,a,c);break;case 1:Ut||(Dr(c,a),u=c.stateNode,typeof u.componentWillUnmount=="function"&&yS(c,a,u)),us(s,a,c);break;case 21:us(s,a,c);break;case 22:Ut=(u=Ut)||c.memoizedState!==null,us(s,a,c),Ut=u;break;default:us(s,a,c)}}function AS(s,a){if(a.memoizedState===null&&(s=a.alternate,s!==null&&(s=s.memoizedState,s!==null))){s=s.dehydrated;try{ro(s)}catch(c){Ze(a,a.return,c)}}}function kS(s,a){if(a.memoizedState===null&&(s=a.alternate,s!==null&&(s=s.memoizedState,s!==null&&(s=s.dehydrated,s!==null))))try{ro(s)}catch(c){Ze(a,a.return,c)}}function uM(s){switch(s.tag){case 31:case 13:case 19:var a=s.stateNode;return a===null&&(a=s.stateNode=new vS),a;case 22:return s=s.stateNode,a=s._retryCache,a===null&&(a=s._retryCache=new vS),a;default:throw Error(r(435,s.tag))}}function ef(s,a){var c=uM(s);a.forEach(function(u){if(!c.has(u)){c.add(u);var d=bM.bind(null,s,u);u.then(d,d)}})}function En(s,a){var c=a.deletions;if(c!==null)for(var u=0;u<c.length;u++){var d=c[u],p=s,w=a,v=w;e:for(;v!==null;){switch(v.tag){case 27:if(qs(v.type)){ut=v.stateNode,Sn=!1;break e}break;case 5:ut=v.stateNode,Sn=!1;break e;case 3:case 4:ut=v.stateNode.containerInfo,Sn=!0;break e}v=v.return}if(ut===null)throw Error(r(160));_S(p,w,d),ut=null,Sn=!1,p=d.alternate,p!==null&&(p.return=null),d.return=null}if(a.subtreeFlags&13886)for(a=a.child;a!==null;)TS(a,s),a=a.sibling}var pr=null;function TS(s,a){var c=s.alternate,u=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:En(a,s),_n(s),u&4&&(Ls(3,s,s.return),Hc(3,s),Ls(5,s,s.return));break;case 1:En(a,s),_n(s),u&512&&(Ut||c===null||Dr(c,c.return)),u&64&&ls&&(s=s.updateQueue,s!==null&&(u=s.callbacks,u!==null&&(c=s.shared.hiddenCallbacks,s.shared.hiddenCallbacks=c===null?u:c.concat(u))));break;case 26:var d=pr;if(En(a,s),_n(s),u&512&&(Ut||c===null||Dr(c,c.return)),u&4){var p=c!==null?c.memoizedState:null;if(u=s.memoizedState,c===null)if(u===null)if(s.stateNode===null){e:{u=s.type,c=s.memoizedProps,d=d.ownerDocument||d;t:switch(u){case"title":p=d.getElementsByTagName("title")[0],(!p||p[ue]||p[Rt]||p.namespaceURI==="http://www.w3.org/2000/svg"||p.hasAttribute("itemprop"))&&(p=d.createElement(u),d.head.insertBefore(p,d.querySelector("head > title"))),en(p,u,c),p[Rt]=s,Ce(p),u=p;break e;case"link":var w=TE("link","href",d).get(u+(c.href||""));if(w){for(var v=0;v<w.length;v++)if(p=w[v],p.getAttribute("href")===(c.href==null||c.href===""?null:c.href)&&p.getAttribute("rel")===(c.rel==null?null:c.rel)&&p.getAttribute("title")===(c.title==null?null:c.title)&&p.getAttribute("crossorigin")===(c.crossOrigin==null?null:c.crossOrigin)){w.splice(v,1);break t}}p=d.createElement(u),en(p,u,c),d.head.appendChild(p);break;case"meta":if(w=TE("meta","content",d).get(u+(c.content||""))){for(v=0;v<w.length;v++)if(p=w[v],p.getAttribute("content")===(c.content==null?null:""+c.content)&&p.getAttribute("name")===(c.name==null?null:c.name)&&p.getAttribute("property")===(c.property==null?null:c.property)&&p.getAttribute("http-equiv")===(c.httpEquiv==null?null:c.httpEquiv)&&p.getAttribute("charset")===(c.charSet==null?null:c.charSet)){w.splice(v,1);break t}}p=d.createElement(u),en(p,u,c),d.head.appendChild(p);break;default:throw Error(r(468,u))}p[Rt]=s,Ce(p),u=p}s.stateNode=u}else OE(d,s.type,s.stateNode);else s.stateNode=kE(d,u,s.memoizedProps);else p!==u?(p===null?c.stateNode!==null&&(c=c.stateNode,c.parentNode.removeChild(c)):p.count--,u===null?OE(d,s.type,s.stateNode):kE(d,u,s.memoizedProps)):u===null&&s.stateNode!==null&&Ym(s,s.memoizedProps,c.memoizedProps)}break;case 27:En(a,s),_n(s),u&512&&(Ut||c===null||Dr(c,c.return)),c!==null&&u&4&&Ym(s,s.memoizedProps,c.memoizedProps);break;case 5:if(En(a,s),_n(s),u&512&&(Ut||c===null||Dr(c,c.return)),s.flags&32){d=s.stateNode;try{Ta(d,"")}catch(ce){Ze(s,s.return,ce)}}u&4&&s.stateNode!=null&&(d=s.memoizedProps,Ym(s,d,c!==null?c.memoizedProps:d)),u&1024&&(ep=!0);break;case 6:if(En(a,s),_n(s),u&4){if(s.stateNode===null)throw Error(r(162));u=s.memoizedProps,c=s.stateNode;try{c.nodeValue=u}catch(ce){Ze(s,s.return,ce)}}break;case 3:if(gf=null,d=pr,pr=pf(a.containerInfo),En(a,s),pr=d,_n(s),u&4&&c!==null&&c.memoizedState.isDehydrated)try{ro(a.containerInfo)}catch(ce){Ze(s,s.return,ce)}ep&&(ep=!1,OS(s));break;case 4:u=pr,pr=pf(s.stateNode.containerInfo),En(a,s),_n(s),pr=u;break;case 12:En(a,s),_n(s);break;case 31:En(a,s),_n(s),u&4&&(u=s.updateQueue,u!==null&&(s.updateQueue=null,ef(s,u)));break;case 13:En(a,s),_n(s),s.child.flags&8192&&s.memoizedState!==null!=(c!==null&&c.memoizedState!==null)&&(nf=Jt()),u&4&&(u=s.updateQueue,u!==null&&(s.updateQueue=null,ef(s,u)));break;case 22:d=s.memoizedState!==null;var O=c!==null&&c.memoizedState!==null,z=ls,q=Ut;if(ls=z||d,Ut=q||O,En(a,s),Ut=q,ls=z,_n(s),u&8192)e:for(a=s.stateNode,a._visibility=d?a._visibility&-2:a._visibility|1,d&&(c===null||O||ls||Ut||$i(s)),c=null,a=s;;){if(a.tag===5||a.tag===26){if(c===null){O=c=a;try{if(p=O.stateNode,d)w=p.style,typeof w.setProperty=="function"?w.setProperty("display","none","important"):w.display="none";else{v=O.stateNode;var J=O.memoizedProps.style,B=J!=null&&J.hasOwnProperty("display")?J.display:null;v.style.display=B==null||typeof B=="boolean"?"":(""+B).trim()}}catch(ce){Ze(O,O.return,ce)}}}else if(a.tag===6){if(c===null){O=a;try{O.stateNode.nodeValue=d?"":O.memoizedProps}catch(ce){Ze(O,O.return,ce)}}}else if(a.tag===18){if(c===null){O=a;try{var K=O.stateNode;d?yE(K,!0):yE(O.stateNode,!1)}catch(ce){Ze(O,O.return,ce)}}}else if((a.tag!==22&&a.tag!==23||a.memoizedState===null||a===s)&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===s)break e;for(;a.sibling===null;){if(a.return===null||a.return===s)break e;c===a&&(c=null),a=a.return}c===a&&(c=null),a.sibling.return=a.return,a=a.sibling}u&4&&(u=s.updateQueue,u!==null&&(c=u.retryQueue,c!==null&&(u.retryQueue=null,ef(s,c))));break;case 19:En(a,s),_n(s),u&4&&(u=s.updateQueue,u!==null&&(s.updateQueue=null,ef(s,u)));break;case 30:break;case 21:break;default:En(a,s),_n(s)}}function _n(s){var a=s.flags;if(a&2){try{for(var c,u=s.return;u!==null;){if(wS(u)){c=u;break}u=u.return}if(c==null)throw Error(r(160));switch(c.tag){case 27:var d=c.stateNode,p=Qm(s);Xu(s,p,d);break;case 5:var w=c.stateNode;c.flags&32&&(Ta(w,""),c.flags&=-33);var v=Qm(s);Xu(s,v,w);break;case 3:case 4:var O=c.stateNode.containerInfo,z=Qm(s);Xm(s,z,O);break;default:throw Error(r(161))}}catch(q){Ze(s,s.return,q)}s.flags&=-3}a&4096&&(s.flags&=-4097)}function OS(s){if(s.subtreeFlags&1024)for(s=s.child;s!==null;){var a=s;OS(a),a.tag===5&&a.flags&1024&&a.stateNode.reset(),s=s.sibling}}function fs(s,a){if(a.subtreeFlags&8772)for(a=a.child;a!==null;)SS(s,a.alternate,a),a=a.sibling}function $i(s){for(s=s.child;s!==null;){var a=s;switch(a.tag){case 0:case 11:case 14:case 15:Ls(4,a,a.return),$i(a);break;case 1:Dr(a,a.return);var c=a.stateNode;typeof c.componentWillUnmount=="function"&&yS(a,a.return,c),$i(a);break;case 27:Xc(a.stateNode);case 26:case 5:Dr(a,a.return),$i(a);break;case 22:a.memoizedState===null&&$i(a);break;case 30:$i(a);break;default:$i(a)}s=s.sibling}}function hs(s,a,c){for(c=c&&(a.subtreeFlags&8772)!==0,a=a.child;a!==null;){var u=a.alternate,d=s,p=a,w=p.flags;switch(p.tag){case 0:case 11:case 15:hs(d,p,c),Hc(4,p);break;case 1:if(hs(d,p,c),u=p,d=u.stateNode,typeof d.componentDidMount=="function")try{d.componentDidMount()}catch(z){Ze(u,u.return,z)}if(u=p,d=u.updateQueue,d!==null){var v=u.stateNode;try{var O=d.shared.hiddenCallbacks;if(O!==null)for(d.shared.hiddenCallbacks=null,d=0;d<O.length;d++)sv(O[d],v)}catch(z){Ze(u,u.return,z)}}c&&w&64&&pS(p),qc(p,p.return);break;case 27:bS(p);case 26:case 5:hs(d,p,c),c&&u===null&&w&4&&gS(p),qc(p,p.return);break;case 12:hs(d,p,c);break;case 31:hs(d,p,c),c&&w&4&&AS(d,p);break;case 13:hs(d,p,c),c&&w&4&&kS(d,p);break;case 22:p.memoizedState===null&&hs(d,p,c),qc(p,p.return);break;case 30:break;default:hs(d,p,c)}a=a.sibling}}function tp(s,a){var c=null;s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(c=s.memoizedState.cachePool.pool),s=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(s=a.memoizedState.cachePool.pool),s!==c&&(s!=null&&s.refCount++,c!=null&&Nc(c))}function np(s,a){s=null,a.alternate!==null&&(s=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==s&&(a.refCount++,s!=null&&Nc(s))}function yr(s,a,c,u){if(a.subtreeFlags&10256)for(a=a.child;a!==null;)CS(s,a,c,u),a=a.sibling}function CS(s,a,c,u){var d=a.flags;switch(a.tag){case 0:case 11:case 15:yr(s,a,c,u),d&2048&&Hc(9,a);break;case 1:yr(s,a,c,u);break;case 3:yr(s,a,c,u),d&2048&&(s=null,a.alternate!==null&&(s=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==s&&(a.refCount++,s!=null&&Nc(s)));break;case 12:if(d&2048){yr(s,a,c,u),s=a.stateNode;try{var p=a.memoizedProps,w=p.id,v=p.onPostCommit;typeof v=="function"&&v(w,a.alternate===null?"mount":"update",s.passiveEffectDuration,-0)}catch(O){Ze(a,a.return,O)}}else yr(s,a,c,u);break;case 31:yr(s,a,c,u);break;case 13:yr(s,a,c,u);break;case 23:break;case 22:p=a.stateNode,w=a.alternate,a.memoizedState!==null?p._visibility&2?yr(s,a,c,u):Fc(s,a):p._visibility&2?yr(s,a,c,u):(p._visibility|=2,Va(s,a,c,u,(a.subtreeFlags&10256)!==0||!1)),d&2048&&tp(w,a);break;case 24:yr(s,a,c,u),d&2048&&np(a.alternate,a);break;default:yr(s,a,c,u)}}function Va(s,a,c,u,d){for(d=d&&((a.subtreeFlags&10256)!==0||!1),a=a.child;a!==null;){var p=s,w=a,v=c,O=u,z=w.flags;switch(w.tag){case 0:case 11:case 15:Va(p,w,v,O,d),Hc(8,w);break;case 23:break;case 22:var q=w.stateNode;w.memoizedState!==null?q._visibility&2?Va(p,w,v,O,d):Fc(p,w):(q._visibility|=2,Va(p,w,v,O,d)),d&&z&2048&&tp(w.alternate,w);break;case 24:Va(p,w,v,O,d),d&&z&2048&&np(w.alternate,w);break;default:Va(p,w,v,O,d)}a=a.sibling}}function Fc(s,a){if(a.subtreeFlags&10256)for(a=a.child;a!==null;){var c=s,u=a,d=u.flags;switch(u.tag){case 22:Fc(c,u),d&2048&&tp(u.alternate,u);break;case 24:Fc(c,u),d&2048&&np(u.alternate,u);break;default:Fc(c,u)}a=a.sibling}}var Vc=8192;function Ga(s,a,c){if(s.subtreeFlags&Vc)for(s=s.child;s!==null;)MS(s,a,c),s=s.sibling}function MS(s,a,c){switch(s.tag){case 26:Ga(s,a,c),s.flags&Vc&&s.memoizedState!==null&&WM(c,pr,s.memoizedState,s.memoizedProps);break;case 5:Ga(s,a,c);break;case 3:case 4:var u=pr;pr=pf(s.stateNode.containerInfo),Ga(s,a,c),pr=u;break;case 22:s.memoizedState===null&&(u=s.alternate,u!==null&&u.memoizedState!==null?(u=Vc,Vc=16777216,Ga(s,a,c),Vc=u):Ga(s,a,c));break;default:Ga(s,a,c)}}function NS(s){var a=s.alternate;if(a!==null&&(s=a.child,s!==null)){a.child=null;do a=s.sibling,s.sibling=null,s=a;while(s!==null)}}function Gc(s){var a=s.deletions;if((s.flags&16)!==0){if(a!==null)for(var c=0;c<a.length;c++){var u=a[c];Ft=u,DS(u,s)}NS(s)}if(s.subtreeFlags&10256)for(s=s.child;s!==null;)RS(s),s=s.sibling}function RS(s){switch(s.tag){case 0:case 11:case 15:Gc(s),s.flags&2048&&Ls(9,s,s.return);break;case 3:Gc(s);break;case 12:Gc(s);break;case 22:var a=s.stateNode;s.memoizedState!==null&&a._visibility&2&&(s.return===null||s.return.tag!==13)?(a._visibility&=-3,tf(s)):Gc(s);break;default:Gc(s)}}function tf(s){var a=s.deletions;if((s.flags&16)!==0){if(a!==null)for(var c=0;c<a.length;c++){var u=a[c];Ft=u,DS(u,s)}NS(s)}for(s=s.child;s!==null;){switch(a=s,a.tag){case 0:case 11:case 15:Ls(8,a,a.return),tf(a);break;case 22:c=a.stateNode,c._visibility&2&&(c._visibility&=-3,tf(a));break;default:tf(a)}s=s.sibling}}function DS(s,a){for(;Ft!==null;){var c=Ft;switch(c.tag){case 0:case 11:case 15:Ls(8,c,a);break;case 23:case 22:if(c.memoizedState!==null&&c.memoizedState.cachePool!==null){var u=c.memoizedState.cachePool.pool;u!=null&&u.refCount++}break;case 24:Nc(c.memoizedState.cache)}if(u=c.child,u!==null)u.return=c,Ft=u;else e:for(c=s;Ft!==null;){u=Ft;var d=u.sibling,p=u.return;if(ES(u),u===c){Ft=null;break e}if(d!==null){d.return=p,Ft=d;break e}Ft=p}}}var fM={getCacheForType:function(s){var a=Qt(Dt),c=a.data.get(s);return c===void 0&&(c=s(),a.data.set(s,c)),c},cacheSignal:function(){return Qt(Dt).controller.signal}},hM=typeof WeakMap=="function"?WeakMap:Map,He=0,et=null,De=null,Ie=0,Ge=0,Ln=null,Bs=!1,Za=!1,rp=!1,ds=0,St=0,Ps=0,Ki=0,sp=0,Bn=0,Ja=0,Zc=null,An=null,ip=!1,nf=0,xS=0,rf=1/0,sf=null,$s=null,jt=0,Ks=null,Wa=null,ms=0,ap=0,op=null,IS=null,Jc=0,cp=null;function Pn(){return(He&2)!==0&&Ie!==0?Ie&-Ie:P.T!==null?mp():pc()}function US(){if(Bn===0)if((Ie&536870912)===0||ze){var s=Jr;Jr<<=1,(Jr&3932160)===0&&(Jr=262144),Bn=s}else Bn=536870912;return s=Un.current,s!==null&&(s.flags|=32),Bn}function kn(s,a,c){(s===et&&(Ge===2||Ge===9)||s.cancelPendingCommit!==null)&&(Ya(s,0),js(s,Ie,Bn,!1)),Ts(s,c),((He&2)===0||s!==et)&&(s===et&&((He&2)===0&&(Ki|=c),St===4&&js(s,Ie,Bn,!1)),xr(s))}function zS(s,a,c){if((He&6)!==0)throw Error(r(327));var u=!c&&(a&127)===0&&(a&s.expiredLanes)===0||ki(s,a),d=u?pM(s,a):up(s,a,!0),p=u;do{if(d===0){Za&&!u&&js(s,a,0,!1);break}else{if(c=s.current.alternate,p&&!dM(c)){d=up(s,a,!1),p=!1;continue}if(d===2){if(p=a,s.errorRecoveryDisabledLanes&p)var w=0;else w=s.pendingLanes&-536870913,w=w!==0?w:w&536870912?536870912:0;if(w!==0){a=w;e:{var v=s;d=Zc;var O=v.current.memoizedState.isDehydrated;if(O&&(Ya(v,w).flags|=256),w=up(v,w,!1),w!==2){if(rp&&!O){v.errorRecoveryDisabledLanes|=p,Ki|=p,d=4;break e}p=An,An=d,p!==null&&(An===null?An=p:An.push.apply(An,p))}d=w}if(p=!1,d!==2)continue}}if(d===1){Ya(s,0),js(s,a,0,!0);break}e:{switch(u=s,p=d,p){case 0:case 1:throw Error(r(345));case 4:if((a&4194048)!==a)break;case 6:js(u,a,Bn,!Bs);break e;case 2:An=null;break;case 3:case 5:break;default:throw Error(r(329))}if((a&62914560)===a&&(d=nf+300-Jt(),10<d)){if(js(u,a,Bn,!Bs),_a(u,0,!0)!==0)break e;ms=a,u.timeoutHandle=dE(LS.bind(null,u,c,An,sf,ip,a,Bn,Ki,Ja,Bs,p,"Throttled",-0,0),d);break e}LS(u,c,An,sf,ip,a,Bn,Ki,Ja,Bs,p,null,-0,0)}}break}while(!0);xr(s)}function LS(s,a,c,u,d,p,w,v,O,z,q,J,B,K){if(s.timeoutHandle=-1,J=a.subtreeFlags,J&8192||(J&16785408)===16785408){J={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Xr},MS(a,p,J);var ce=(p&62914560)===p?nf-Jt():(p&4194048)===p?xS-Jt():0;if(ce=YM(J,ce),ce!==null){ms=p,s.cancelPendingCommit=ce(FS.bind(null,s,a,p,c,u,d,w,v,O,q,J,null,B,K)),js(s,p,w,!z);return}}FS(s,a,p,c,u,d,w,v,O)}function dM(s){for(var a=s;;){var c=a.tag;if((c===0||c===11||c===15)&&a.flags&16384&&(c=a.updateQueue,c!==null&&(c=c.stores,c!==null)))for(var u=0;u<c.length;u++){var d=c[u],p=d.getSnapshot;d=d.value;try{if(!xn(p(),d))return!1}catch{return!1}}if(c=a.child,a.subtreeFlags&16384&&c!==null)c.return=a,a=c;else{if(a===s)break;for(;a.sibling===null;){if(a.return===null||a.return===s)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function js(s,a,c,u){a&=~sp,a&=~Ki,s.suspendedLanes|=a,s.pingedLanes&=~a,u&&(s.warmLanes|=a),u=s.expirationTimes;for(var d=a;0<d;){var p=31-Nt(d),w=1<<p;u[p]=-1,d&=~w}c!==0&&dc(s,c,a)}function af(){return(He&6)===0?(Wc(0),!1):!0}function lp(){if(De!==null){if(Ge===0)var s=De.return;else s=De,rs=Di=null,km(s),Ka=null,Dc=0,s=De;for(;s!==null;)mS(s.alternate,s),s=s.return;De=null}}function Ya(s,a){var c=s.timeoutHandle;c!==-1&&(s.timeoutHandle=-1,xM(c)),c=s.cancelPendingCommit,c!==null&&(s.cancelPendingCommit=null,c()),ms=0,lp(),et=s,De=c=ts(s.current,null),Ie=a,Ge=0,Ln=null,Bs=!1,Za=ki(s,a),rp=!1,Ja=Bn=sp=Ki=Ps=St=0,An=Zc=null,ip=!1,(a&8)!==0&&(a|=a&32);var u=s.entangledLanes;if(u!==0)for(s=s.entanglements,u&=a;0<u;){var d=31-Nt(u),p=1<<d;a|=s[d],u&=~p}return ds=a,Tu(),c}function BS(s,a){Ae=null,P.H=$c,a===$a||a===Iu?(a=ev(),Ge=3):a===dm?(a=ev(),Ge=4):Ge=a===Km?8:a!==null&&typeof a=="object"&&typeof a.then=="function"?6:1,Ln=a,De===null&&(St=1,Zu(s,Yn(a,s.current)))}function PS(){var s=Un.current;return s===null?!0:(Ie&4194048)===Ie?tr===null:(Ie&62914560)===Ie||(Ie&536870912)!==0?s===tr:!1}function $S(){var s=P.H;return P.H=$c,s===null?$c:s}function KS(){var s=P.A;return P.A=fM,s}function of(){St=4,Bs||(Ie&4194048)!==Ie&&Un.current!==null||(Za=!0),(Ps&134217727)===0&&(Ki&134217727)===0||et===null||js(et,Ie,Bn,!1)}function up(s,a,c){var u=He;He|=2;var d=$S(),p=KS();(et!==s||Ie!==a)&&(sf=null,Ya(s,a)),a=!1;var w=St;e:do try{if(Ge!==0&&De!==null){var v=De,O=Ln;switch(Ge){case 8:lp(),w=6;break e;case 3:case 2:case 9:case 6:Un.current===null&&(a=!0);var z=Ge;if(Ge=0,Ln=null,Qa(s,v,O,z),c&&Za){w=0;break e}break;default:z=Ge,Ge=0,Ln=null,Qa(s,v,O,z)}}mM(),w=St;break}catch(q){BS(s,q)}while(!0);return a&&s.shellSuspendCounter++,rs=Di=null,He=u,P.H=d,P.A=p,De===null&&(et=null,Ie=0,Tu()),w}function mM(){for(;De!==null;)jS(De)}function pM(s,a){var c=He;He|=2;var u=$S(),d=KS();et!==s||Ie!==a?(sf=null,rf=Jt()+500,Ya(s,a)):Za=ki(s,a);e:do try{if(Ge!==0&&De!==null){a=De;var p=Ln;t:switch(Ge){case 1:Ge=0,Ln=null,Qa(s,a,p,1);break;case 2:case 9:if(Qb(p)){Ge=0,Ln=null,HS(a);break}a=function(){Ge!==2&&Ge!==9||et!==s||(Ge=7),xr(s)},p.then(a,a);break e;case 3:Ge=7;break e;case 4:Ge=5;break e;case 7:Qb(p)?(Ge=0,Ln=null,HS(a)):(Ge=0,Ln=null,Qa(s,a,p,7));break;case 5:var w=null;switch(De.tag){case 26:w=De.memoizedState;case 5:case 27:var v=De;if(w?CE(w):v.stateNode.complete){Ge=0,Ln=null;var O=v.sibling;if(O!==null)De=O;else{var z=v.return;z!==null?(De=z,cf(z)):De=null}break t}}Ge=0,Ln=null,Qa(s,a,p,5);break;case 6:Ge=0,Ln=null,Qa(s,a,p,6);break;case 8:lp(),St=6;break e;default:throw Error(r(462))}}yM();break}catch(q){BS(s,q)}while(!0);return rs=Di=null,P.H=u,P.A=d,He=c,De!==null?0:(et=null,Ie=0,Tu(),St)}function yM(){for(;De!==null&&!cu();)jS(De)}function jS(s){var a=hS(s.alternate,s,ds);s.memoizedProps=s.pendingProps,a===null?cf(s):De=a}function HS(s){var a=s,c=a.alternate;switch(a.tag){case 15:case 0:a=aS(c,a,a.pendingProps,a.type,void 0,Ie);break;case 11:a=aS(c,a,a.pendingProps,a.type.render,a.ref,Ie);break;case 5:km(a);default:mS(c,a),a=De=Kb(a,ds),a=hS(c,a,ds)}s.memoizedProps=s.pendingProps,a===null?cf(s):De=a}function Qa(s,a,c,u){rs=Di=null,km(a),Ka=null,Dc=0;var d=a.return;try{if(sM(s,d,a,c,Ie)){St=1,Zu(s,Yn(c,s.current)),De=null;return}}catch(p){if(d!==null)throw De=d,p;St=1,Zu(s,Yn(c,s.current)),De=null;return}a.flags&32768?(ze||u===1?s=!0:Za||(Ie&536870912)!==0?s=!1:(Bs=s=!0,(u===2||u===9||u===3||u===6)&&(u=Un.current,u!==null&&u.tag===13&&(u.flags|=16384))),qS(a,s)):cf(a)}function cf(s){var a=s;do{if((a.flags&32768)!==0){qS(a,Bs);return}s=a.return;var c=oM(a.alternate,a,ds);if(c!==null){De=c;return}if(a=a.sibling,a!==null){De=a;return}De=a=s}while(a!==null);St===0&&(St=5)}function qS(s,a){do{var c=cM(s.alternate,s);if(c!==null){c.flags&=32767,De=c;return}if(c=s.return,c!==null&&(c.flags|=32768,c.subtreeFlags=0,c.deletions=null),!a&&(s=s.sibling,s!==null)){De=s;return}De=s=c}while(s!==null);St=6,De=null}function FS(s,a,c,u,d,p,w,v,O){s.cancelPendingCommit=null;do lf();while(jt!==0);if((He&6)!==0)throw Error(r(327));if(a!==null){if(a===s.current)throw Error(r(177));if(p=a.lanes|a.childLanes,p|=Qd,hc(s,c,p,w,v,O),s===et&&(De=et=null,Ie=0),Wa=a,Ks=s,ms=c,ap=p,op=d,IS=u,(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?(s.callbackNode=null,s.callbackPriority=0,vM(ks,function(){return WS(),null})):(s.callbackNode=null,s.callbackPriority=0),u=(a.flags&13878)!==0,(a.subtreeFlags&13878)!==0||u){u=P.T,P.T=null,d=ne.p,ne.p=2,w=He,He|=4;try{lM(s,a,c)}finally{He=w,ne.p=d,P.T=u}}jt=1,VS(),GS(),ZS()}}function VS(){if(jt===1){jt=0;var s=Ks,a=Wa,c=(a.flags&13878)!==0;if((a.subtreeFlags&13878)!==0||c){c=P.T,P.T=null;var u=ne.p;ne.p=2;var d=He;He|=4;try{TS(a,s);var p=Ep,w=Db(s.containerInfo),v=p.focusedElem,O=p.selectionRange;if(w!==v&&v&&v.ownerDocument&&Rb(v.ownerDocument.documentElement,v)){if(O!==null&&Gd(v)){var z=O.start,q=O.end;if(q===void 0&&(q=z),"selectionStart"in v)v.selectionStart=z,v.selectionEnd=Math.min(q,v.value.length);else{var J=v.ownerDocument||document,B=J&&J.defaultView||window;if(B.getSelection){var K=B.getSelection(),ce=v.textContent.length,we=Math.min(O.start,ce),Ye=O.end===void 0?we:Math.min(O.end,ce);!K.extend&&we>Ye&&(w=Ye,Ye=we,we=w);var D=Nb(v,we),N=Nb(v,Ye);if(D&&N&&(K.rangeCount!==1||K.anchorNode!==D.node||K.anchorOffset!==D.offset||K.focusNode!==N.node||K.focusOffset!==N.offset)){var U=J.createRange();U.setStart(D.node,D.offset),K.removeAllRanges(),we>Ye?(K.addRange(U),K.extend(N.node,N.offset)):(U.setEnd(N.node,N.offset),K.addRange(U))}}}}for(J=[],K=v;K=K.parentNode;)K.nodeType===1&&J.push({element:K,left:K.scrollLeft,top:K.scrollTop});for(typeof v.focus=="function"&&v.focus(),v=0;v<J.length;v++){var Z=J[v];Z.element.scrollLeft=Z.left,Z.element.scrollTop=Z.top}}Sf=!!Sp,Ep=Sp=null}finally{He=d,ne.p=u,P.T=c}}s.current=a,jt=2}}function GS(){if(jt===2){jt=0;var s=Ks,a=Wa,c=(a.flags&8772)!==0;if((a.subtreeFlags&8772)!==0||c){c=P.T,P.T=null;var u=ne.p;ne.p=2;var d=He;He|=4;try{SS(s,a.alternate,a)}finally{He=d,ne.p=u,P.T=c}}jt=3}}function ZS(){if(jt===4||jt===3){jt=0,Md();var s=Ks,a=Wa,c=ms,u=IS;(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?jt=5:(jt=0,Wa=Ks=null,JS(s,s.pendingLanes));var d=s.pendingLanes;if(d===0&&($s=null),dr(c),a=a.stateNode,Ht&&typeof Ht.onCommitFiberRoot=="function")try{Ht.onCommitFiberRoot(Cr,a,void 0,(a.current.flags&128)===128)}catch{}if(u!==null){a=P.T,d=ne.p,ne.p=2,P.T=null;try{for(var p=s.onRecoverableError,w=0;w<u.length;w++){var v=u[w];p(v.value,{componentStack:v.stack})}}finally{P.T=a,ne.p=d}}(ms&3)!==0&&lf(),xr(s),d=s.pendingLanes,(c&261930)!==0&&(d&42)!==0?s===cp?Jc++:(Jc=0,cp=s):Jc=0,Wc(0)}}function JS(s,a){(s.pooledCacheLanes&=a)===0&&(a=s.pooledCache,a!=null&&(s.pooledCache=null,Nc(a)))}function lf(){return VS(),GS(),ZS(),WS()}function WS(){if(jt!==5)return!1;var s=Ks,a=ap;ap=0;var c=dr(ms),u=P.T,d=ne.p;try{ne.p=32>c?32:c,P.T=null,c=op,op=null;var p=Ks,w=ms;if(jt=0,Wa=Ks=null,ms=0,(He&6)!==0)throw Error(r(331));var v=He;if(He|=4,RS(p.current),CS(p,p.current,w,c),He=v,Wc(0,!1),Ht&&typeof Ht.onPostCommitFiberRoot=="function")try{Ht.onPostCommitFiberRoot(Cr,p)}catch{}return!0}finally{ne.p=d,P.T=u,JS(s,a)}}function YS(s,a,c){a=Yn(c,a),a=$m(s.stateNode,a,2),s=Is(s,a,2),s!==null&&(Ts(s,2),xr(s))}function Ze(s,a,c){if(s.tag===3)YS(s,s,c);else for(;a!==null;){if(a.tag===3){YS(a,s,c);break}else if(a.tag===1){var u=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof u.componentDidCatch=="function"&&($s===null||!$s.has(u))){s=Yn(c,s),c=Qv(2),u=Is(a,c,2),u!==null&&(Xv(c,u,a,s),Ts(u,2),xr(u));break}}a=a.return}}function fp(s,a,c){var u=s.pingCache;if(u===null){u=s.pingCache=new hM;var d=new Set;u.set(a,d)}else d=u.get(a),d===void 0&&(d=new Set,u.set(a,d));d.has(c)||(rp=!0,d.add(c),s=gM.bind(null,s,a,c),a.then(s,s))}function gM(s,a,c){var u=s.pingCache;u!==null&&u.delete(a),s.pingedLanes|=s.suspendedLanes&c,s.warmLanes&=~c,et===s&&(Ie&c)===c&&(St===4||St===3&&(Ie&62914560)===Ie&&300>Jt()-nf?(He&2)===0&&Ya(s,0):sp|=c,Ja===Ie&&(Ja=0)),xr(s)}function QS(s,a){a===0&&(a=Wr()),s=Mi(s,a),s!==null&&(Ts(s,a),xr(s))}function wM(s){var a=s.memoizedState,c=0;a!==null&&(c=a.retryLane),QS(s,c)}function bM(s,a){var c=0;switch(s.tag){case 31:case 13:var u=s.stateNode,d=s.memoizedState;d!==null&&(c=d.retryLane);break;case 19:u=s.stateNode;break;case 22:u=s.stateNode._retryCache;break;default:throw Error(r(314))}u!==null&&u.delete(a),QS(s,c)}function vM(s,a){return As(s,a)}var uf=null,Xa=null,hp=!1,ff=!1,dp=!1,Hs=0;function xr(s){s!==Xa&&s.next===null&&(Xa===null?uf=Xa=s:Xa=Xa.next=s),ff=!0,hp||(hp=!0,EM())}function Wc(s,a){if(!dp&&ff){dp=!0;do for(var c=!1,u=uf;u!==null;){if(s!==0){var d=u.pendingLanes;if(d===0)var p=0;else{var w=u.suspendedLanes,v=u.pingedLanes;p=(1<<31-Nt(42|s)+1)-1,p&=d&~(w&~v),p=p&201326741?p&201326741|1:p?p|2:0}p!==0&&(c=!0,nE(u,p))}else p=Ie,p=_a(u,u===et?p:0,u.cancelPendingCommit!==null||u.timeoutHandle!==-1),(p&3)===0||ki(u,p)||(c=!0,nE(u,p));u=u.next}while(c);dp=!1}}function SM(){XS()}function XS(){ff=hp=!1;var s=0;Hs!==0&&DM()&&(s=Hs);for(var a=Jt(),c=null,u=uf;u!==null;){var d=u.next,p=eE(u,a);p===0?(u.next=null,c===null?uf=d:c.next=d,d===null&&(Xa=c)):(c=u,(s!==0||(p&3)!==0)&&(ff=!0)),u=d}jt!==0&&jt!==5||Wc(s),Hs!==0&&(Hs=0)}function eE(s,a){for(var c=s.suspendedLanes,u=s.pingedLanes,d=s.expirationTimes,p=s.pendingLanes&-62914561;0<p;){var w=31-Nt(p),v=1<<w,O=d[w];O===-1?((v&c)===0||(v&u)!==0)&&(d[w]=kt(v,a)):O<=a&&(s.expiredLanes|=v),p&=~v}if(a=et,c=Ie,c=_a(s,s===a?c:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),u=s.callbackNode,c===0||s===a&&(Ge===2||Ge===9)||s.cancelPendingCommit!==null)return u!==null&&u!==null&&Sa(u),s.callbackNode=null,s.callbackPriority=0;if((c&3)===0||ki(s,c)){if(a=c&-c,a===s.callbackPriority)return a;switch(u!==null&&Sa(u),dr(c)){case 2:case 8:c=Rn;break;case 32:c=ks;break;case 268435456:c=oc;break;default:c=ks}return u=tE.bind(null,s),c=As(c,u),s.callbackPriority=a,s.callbackNode=c,a}return u!==null&&u!==null&&Sa(u),s.callbackPriority=2,s.callbackNode=null,2}function tE(s,a){if(jt!==0&&jt!==5)return s.callbackNode=null,s.callbackPriority=0,null;var c=s.callbackNode;if(lf()&&s.callbackNode!==c)return null;var u=Ie;return u=_a(s,s===et?u:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),u===0?null:(zS(s,u,a),eE(s,Jt()),s.callbackNode!=null&&s.callbackNode===c?tE.bind(null,s):null)}function nE(s,a){if(lf())return null;zS(s,a,!0)}function EM(){IM(function(){(He&6)!==0?As(Gr,SM):XS()})}function mp(){if(Hs===0){var s=Ba;s===0&&(s=Zr,Zr<<=1,(Zr&261888)===0&&(Zr=256)),Hs=s}return Hs}function rE(s){return s==null||typeof s=="symbol"||typeof s=="boolean"?null:typeof s=="function"?s:wu(""+s)}function sE(s,a){var c=a.ownerDocument.createElement("input");return c.name=a.name,c.value=a.value,s.id&&c.setAttribute("form",s.id),a.parentNode.insertBefore(c,a),s=new FormData(s),c.parentNode.removeChild(c),s}function _M(s,a,c,u,d){if(a==="submit"&&c&&c.stateNode===d){var p=rE((d[lt]||null).action),w=u.submitter;w&&(a=(a=w[lt]||null)?rE(a.formAction):w.getAttribute("formAction"),a!==null&&(p=a,w=null));var v=new Eu("action","action",null,u,d);s.push({event:v,listeners:[{instance:null,listener:function(){if(u.defaultPrevented){if(Hs!==0){var O=w?sE(d,w):new FormData(d);Im(c,{pending:!0,data:O,method:d.method,action:p},null,O)}}else typeof p=="function"&&(v.preventDefault(),O=w?sE(d,w):new FormData(d),Im(c,{pending:!0,data:O,method:d.method,action:p},p,O))},currentTarget:d}]})}}for(var pp=0;pp<Yd.length;pp++){var yp=Yd[pp],AM=yp.toLowerCase(),kM=yp[0].toUpperCase()+yp.slice(1);mr(AM,"on"+kM)}mr(Ub,"onAnimationEnd"),mr(zb,"onAnimationIteration"),mr(Lb,"onAnimationStart"),mr("dblclick","onDoubleClick"),mr("focusin","onFocus"),mr("focusout","onBlur"),mr(KC,"onTransitionRun"),mr(jC,"onTransitionStart"),mr(HC,"onTransitionCancel"),mr(Bb,"onTransitionEnd"),Mr("onMouseEnter",["mouseout","mouseover"]),Mr("onMouseLeave",["mouseout","mouseover"]),Mr("onPointerEnter",["pointerout","pointerover"]),Mr("onPointerLeave",["pointerout","pointerover"]),bn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),bn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),bn("onBeforeInput",["compositionend","keypress","textInput","paste"]),bn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),bn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),bn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Yc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),TM=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Yc));function iE(s,a){a=(a&4)!==0;for(var c=0;c<s.length;c++){var u=s[c],d=u.event;u=u.listeners;e:{var p=void 0;if(a)for(var w=u.length-1;0<=w;w--){var v=u[w],O=v.instance,z=v.currentTarget;if(v=v.listener,O!==p&&d.isPropagationStopped())break e;p=v,d.currentTarget=z;try{p(d)}catch(q){ku(q)}d.currentTarget=null,p=O}else for(w=0;w<u.length;w++){if(v=u[w],O=v.instance,z=v.currentTarget,v=v.listener,O!==p&&d.isPropagationStopped())break e;p=v,d.currentTarget=z;try{p(d)}catch(q){ku(q)}d.currentTarget=null,p=O}}}}function xe(s,a){var c=a[Aa];c===void 0&&(c=a[Aa]=new Set);var u=s+"__bubble";c.has(u)||(aE(a,s,2,!1),c.add(u))}function gp(s,a,c){var u=0;a&&(u|=4),aE(c,s,u,a)}var hf="_reactListening"+Math.random().toString(36).slice(2);function wp(s){if(!s[hf]){s[hf]=!0,Wt.forEach(function(c){c!=="selectionchange"&&(TM.has(c)||gp(c,!1,s),gp(c,!0,s))});var a=s.nodeType===9?s:s.ownerDocument;a===null||a[hf]||(a[hf]=!0,gp("selectionchange",!1,a))}}function aE(s,a,c,u){switch(UE(a)){case 2:var d=eN;break;case 8:d=tN;break;default:d=xp}c=d.bind(null,a,c,s),d=void 0,!Bd||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(d=!0),u?d!==void 0?s.addEventListener(a,c,{capture:!0,passive:d}):s.addEventListener(a,c,!0):d!==void 0?s.addEventListener(a,c,{passive:d}):s.addEventListener(a,c,!1)}function bp(s,a,c,u,d){var p=u;if((a&1)===0&&(a&2)===0&&u!==null)e:for(;;){if(u===null)return;var w=u.tag;if(w===3||w===4){var v=u.stateNode.containerInfo;if(v===d)break;if(w===4)for(w=u.return;w!==null;){var O=w.tag;if((O===3||O===4)&&w.stateNode.containerInfo===d)return;w=w.return}for(;v!==null;){if(w=Y(v),w===null)return;if(O=w.tag,O===5||O===6||O===26||O===27){u=p=w;continue e}v=v.parentNode}}u=u.return}fb(function(){var z=p,q=zd(c),J=[];e:{var B=Pb.get(s);if(B!==void 0){var K=Eu,ce=s;switch(s){case"keypress":if(vu(c)===0)break e;case"keydown":case"keyup":K=bC;break;case"focusin":ce="focus",K=jd;break;case"focusout":ce="blur",K=jd;break;case"beforeblur":case"afterblur":K=jd;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":K=mb;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":K=oC;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":K=EC;break;case Ub:case zb:case Lb:K=uC;break;case Bb:K=AC;break;case"scroll":case"scrollend":K=iC;break;case"wheel":K=TC;break;case"copy":case"cut":case"paste":K=hC;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":K=yb;break;case"toggle":case"beforetoggle":K=CC}var we=(a&4)!==0,Ye=!we&&(s==="scroll"||s==="scrollend"),D=we?B!==null?B+"Capture":null:B;we=[];for(var N=z,U;N!==null;){var Z=N;if(U=Z.stateNode,Z=Z.tag,Z!==5&&Z!==26&&Z!==27||U===null||D===null||(Z=bc(N,D),Z!=null&&we.push(Qc(N,Z,U))),Ye)break;N=N.return}0<we.length&&(B=new K(B,ce,null,c,q),J.push({event:B,listeners:we}))}}if((a&7)===0){e:{if(B=s==="mouseover"||s==="pointerover",K=s==="mouseout"||s==="pointerout",B&&c!==Ud&&(ce=c.relatedTarget||c.fromElement)&&(Y(ce)||ce[Yr]))break e;if((K||B)&&(B=q.window===q?q:(B=q.ownerDocument)?B.defaultView||B.parentWindow:window,K?(ce=c.relatedTarget||c.toElement,K=z,ce=ce?Y(ce):null,ce!==null&&(Ye=o(ce),we=ce.tag,ce!==Ye||we!==5&&we!==27&&we!==6)&&(ce=null)):(K=null,ce=z),K!==ce)){if(we=mb,Z="onMouseLeave",D="onMouseEnter",N="mouse",(s==="pointerout"||s==="pointerover")&&(we=yb,Z="onPointerLeave",D="onPointerEnter",N="pointer"),Ye=K==null?B:qe(K),U=ce==null?B:qe(ce),B=new we(Z,N+"leave",K,c,q),B.target=Ye,B.relatedTarget=U,Z=null,Y(q)===z&&(we=new we(D,N+"enter",ce,c,q),we.target=U,we.relatedTarget=Ye,Z=we),Ye=Z,K&&ce)t:{for(we=OM,D=K,N=ce,U=0,Z=D;Z;Z=we(Z))U++;Z=0;for(var pe=N;pe;pe=we(pe))Z++;for(;0<U-Z;)D=we(D),U--;for(;0<Z-U;)N=we(N),Z--;for(;U--;){if(D===N||N!==null&&D===N.alternate){we=D;break t}D=we(D),N=we(N)}we=null}else we=null;K!==null&&oE(J,B,K,we,!1),ce!==null&&Ye!==null&&oE(J,Ye,ce,we,!0)}}e:{if(B=z?qe(z):window,K=B.nodeName&&B.nodeName.toLowerCase(),K==="select"||K==="input"&&B.type==="file")var $e=Ab;else if(Eb(B))if(kb)$e=BC;else{$e=zC;var fe=UC}else K=B.nodeName,!K||K.toLowerCase()!=="input"||B.type!=="checkbox"&&B.type!=="radio"?z&&Id(z.elementType)&&($e=Ab):$e=LC;if($e&&($e=$e(s,z))){_b(J,$e,c,q);break e}fe&&fe(s,B,z),s==="focusout"&&z&&B.type==="number"&&z.memoizedProps.value!=null&&xd(B,"number",B.value)}switch(fe=z?qe(z):window,s){case"focusin":(Eb(fe)||fe.contentEditable==="true")&&(Na=fe,Zd=z,Oc=null);break;case"focusout":Oc=Zd=Na=null;break;case"mousedown":Jd=!0;break;case"contextmenu":case"mouseup":case"dragend":Jd=!1,xb(J,c,q);break;case"selectionchange":if($C)break;case"keydown":case"keyup":xb(J,c,q)}var Oe;if(qd)e:{switch(s){case"compositionstart":var Ue="onCompositionStart";break e;case"compositionend":Ue="onCompositionEnd";break e;case"compositionupdate":Ue="onCompositionUpdate";break e}Ue=void 0}else Ma?vb(s,c)&&(Ue="onCompositionEnd"):s==="keydown"&&c.keyCode===229&&(Ue="onCompositionStart");Ue&&(gb&&c.locale!=="ko"&&(Ma||Ue!=="onCompositionStart"?Ue==="onCompositionEnd"&&Ma&&(Oe=hb()):(Os=q,Pd="value"in Os?Os.value:Os.textContent,Ma=!0)),fe=df(z,Ue),0<fe.length&&(Ue=new pb(Ue,s,null,c,q),J.push({event:Ue,listeners:fe}),Oe?Ue.data=Oe:(Oe=Sb(c),Oe!==null&&(Ue.data=Oe)))),(Oe=NC?RC(s,c):DC(s,c))&&(Ue=df(z,"onBeforeInput"),0<Ue.length&&(fe=new pb("onBeforeInput","beforeinput",null,c,q),J.push({event:fe,listeners:Ue}),fe.data=Oe)),_M(J,s,z,c,q)}iE(J,a)})}function Qc(s,a,c){return{instance:s,listener:a,currentTarget:c}}function df(s,a){for(var c=a+"Capture",u=[];s!==null;){var d=s,p=d.stateNode;if(d=d.tag,d!==5&&d!==26&&d!==27||p===null||(d=bc(s,c),d!=null&&u.unshift(Qc(s,d,p)),d=bc(s,a),d!=null&&u.push(Qc(s,d,p))),s.tag===3)return u;s=s.return}return[]}function OM(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5&&s.tag!==27);return s||null}function oE(s,a,c,u,d){for(var p=a._reactName,w=[];c!==null&&c!==u;){var v=c,O=v.alternate,z=v.stateNode;if(v=v.tag,O!==null&&O===u)break;v!==5&&v!==26&&v!==27||z===null||(O=z,d?(z=bc(c,p),z!=null&&w.unshift(Qc(c,z,O))):d||(z=bc(c,p),z!=null&&w.push(Qc(c,z,O)))),c=c.return}w.length!==0&&s.push({event:a,listeners:w})}var CM=/\r\n?/g,MM=/\u0000|\uFFFD/g;function cE(s){return(typeof s=="string"?s:""+s).replace(CM,`
`).replace(MM,"")}function lE(s,a){return a=cE(a),cE(s)===a}function We(s,a,c,u,d,p){switch(c){case"children":typeof u=="string"?a==="body"||a==="textarea"&&u===""||Ta(s,u):(typeof u=="number"||typeof u=="bigint")&&a!=="body"&&Ta(s,""+u);break;case"className":yu(s,"class",u);break;case"tabIndex":yu(s,"tabindex",u);break;case"dir":case"role":case"viewBox":case"width":case"height":yu(s,c,u);break;case"style":lb(s,u,p);break;case"data":if(a!=="object"){yu(s,"data",u);break}case"src":case"href":if(u===""&&(a!=="a"||c!=="href")){s.removeAttribute(c);break}if(u==null||typeof u=="function"||typeof u=="symbol"||typeof u=="boolean"){s.removeAttribute(c);break}u=wu(""+u),s.setAttribute(c,u);break;case"action":case"formAction":if(typeof u=="function"){s.setAttribute(c,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof p=="function"&&(c==="formAction"?(a!=="input"&&We(s,a,"name",d.name,d,null),We(s,a,"formEncType",d.formEncType,d,null),We(s,a,"formMethod",d.formMethod,d,null),We(s,a,"formTarget",d.formTarget,d,null)):(We(s,a,"encType",d.encType,d,null),We(s,a,"method",d.method,d,null),We(s,a,"target",d.target,d,null)));if(u==null||typeof u=="symbol"||typeof u=="boolean"){s.removeAttribute(c);break}u=wu(""+u),s.setAttribute(c,u);break;case"onClick":u!=null&&(s.onclick=Xr);break;case"onScroll":u!=null&&xe("scroll",s);break;case"onScrollEnd":u!=null&&xe("scrollend",s);break;case"dangerouslySetInnerHTML":if(u!=null){if(typeof u!="object"||!("__html"in u))throw Error(r(61));if(c=u.__html,c!=null){if(d.children!=null)throw Error(r(60));s.innerHTML=c}}break;case"multiple":s.multiple=u&&typeof u!="function"&&typeof u!="symbol";break;case"muted":s.muted=u&&typeof u!="function"&&typeof u!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(u==null||typeof u=="function"||typeof u=="boolean"||typeof u=="symbol"){s.removeAttribute("xlink:href");break}c=wu(""+u),s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",c);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":u!=null&&typeof u!="function"&&typeof u!="symbol"?s.setAttribute(c,""+u):s.removeAttribute(c);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":u&&typeof u!="function"&&typeof u!="symbol"?s.setAttribute(c,""):s.removeAttribute(c);break;case"capture":case"download":u===!0?s.setAttribute(c,""):u!==!1&&u!=null&&typeof u!="function"&&typeof u!="symbol"?s.setAttribute(c,u):s.removeAttribute(c);break;case"cols":case"rows":case"size":case"span":u!=null&&typeof u!="function"&&typeof u!="symbol"&&!isNaN(u)&&1<=u?s.setAttribute(c,u):s.removeAttribute(c);break;case"rowSpan":case"start":u==null||typeof u=="function"||typeof u=="symbol"||isNaN(u)?s.removeAttribute(c):s.setAttribute(c,u);break;case"popover":xe("beforetoggle",s),xe("toggle",s),pu(s,"popover",u);break;case"xlinkActuate":Qr(s,"http://www.w3.org/1999/xlink","xlink:actuate",u);break;case"xlinkArcrole":Qr(s,"http://www.w3.org/1999/xlink","xlink:arcrole",u);break;case"xlinkRole":Qr(s,"http://www.w3.org/1999/xlink","xlink:role",u);break;case"xlinkShow":Qr(s,"http://www.w3.org/1999/xlink","xlink:show",u);break;case"xlinkTitle":Qr(s,"http://www.w3.org/1999/xlink","xlink:title",u);break;case"xlinkType":Qr(s,"http://www.w3.org/1999/xlink","xlink:type",u);break;case"xmlBase":Qr(s,"http://www.w3.org/XML/1998/namespace","xml:base",u);break;case"xmlLang":Qr(s,"http://www.w3.org/XML/1998/namespace","xml:lang",u);break;case"xmlSpace":Qr(s,"http://www.w3.org/XML/1998/namespace","xml:space",u);break;case"is":pu(s,"is",u);break;case"innerText":case"textContent":break;default:(!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(c=rC.get(c)||c,pu(s,c,u))}}function vp(s,a,c,u,d,p){switch(c){case"style":lb(s,u,p);break;case"dangerouslySetInnerHTML":if(u!=null){if(typeof u!="object"||!("__html"in u))throw Error(r(61));if(c=u.__html,c!=null){if(d.children!=null)throw Error(r(60));s.innerHTML=c}}break;case"children":typeof u=="string"?Ta(s,u):(typeof u=="number"||typeof u=="bigint")&&Ta(s,""+u);break;case"onScroll":u!=null&&xe("scroll",s);break;case"onScrollEnd":u!=null&&xe("scrollend",s);break;case"onClick":u!=null&&(s.onclick=Xr);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Gn.hasOwnProperty(c))e:{if(c[0]==="o"&&c[1]==="n"&&(d=c.endsWith("Capture"),a=c.slice(2,d?c.length-7:void 0),p=s[lt]||null,p=p!=null?p[c]:null,typeof p=="function"&&s.removeEventListener(a,p,d),typeof u=="function")){typeof p!="function"&&p!==null&&(c in s?s[c]=null:s.hasAttribute(c)&&s.removeAttribute(c)),s.addEventListener(a,u,d);break e}c in s?s[c]=u:u===!0?s.setAttribute(c,""):pu(s,c,u)}}}function en(s,a,c){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":xe("error",s),xe("load",s);var u=!1,d=!1,p;for(p in c)if(c.hasOwnProperty(p)){var w=c[p];if(w!=null)switch(p){case"src":u=!0;break;case"srcSet":d=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,a));default:We(s,a,p,w,c,null)}}d&&We(s,a,"srcSet",c.srcSet,c,null),u&&We(s,a,"src",c.src,c,null);return;case"input":xe("invalid",s);var v=p=w=d=null,O=null,z=null;for(u in c)if(c.hasOwnProperty(u)){var q=c[u];if(q!=null)switch(u){case"name":d=q;break;case"type":w=q;break;case"checked":O=q;break;case"defaultChecked":z=q;break;case"value":p=q;break;case"defaultValue":v=q;break;case"children":case"dangerouslySetInnerHTML":if(q!=null)throw Error(r(137,a));break;default:We(s,a,u,q,c,null)}}ib(s,p,v,O,z,w,d,!1);return;case"select":xe("invalid",s),u=w=p=null;for(d in c)if(c.hasOwnProperty(d)&&(v=c[d],v!=null))switch(d){case"value":p=v;break;case"defaultValue":w=v;break;case"multiple":u=v;default:We(s,a,d,v,c,null)}a=p,c=w,s.multiple=!!u,a!=null?ka(s,!!u,a,!1):c!=null&&ka(s,!!u,c,!0);return;case"textarea":xe("invalid",s),p=d=u=null;for(w in c)if(c.hasOwnProperty(w)&&(v=c[w],v!=null))switch(w){case"value":u=v;break;case"defaultValue":d=v;break;case"children":p=v;break;case"dangerouslySetInnerHTML":if(v!=null)throw Error(r(91));break;default:We(s,a,w,v,c,null)}ob(s,u,d,p);return;case"option":for(O in c)c.hasOwnProperty(O)&&(u=c[O],u!=null)&&(O==="selected"?s.selected=u&&typeof u!="function"&&typeof u!="symbol":We(s,a,O,u,c,null));return;case"dialog":xe("beforetoggle",s),xe("toggle",s),xe("cancel",s),xe("close",s);break;case"iframe":case"object":xe("load",s);break;case"video":case"audio":for(u=0;u<Yc.length;u++)xe(Yc[u],s);break;case"image":xe("error",s),xe("load",s);break;case"details":xe("toggle",s);break;case"embed":case"source":case"link":xe("error",s),xe("load",s);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(z in c)if(c.hasOwnProperty(z)&&(u=c[z],u!=null))switch(z){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,a));default:We(s,a,z,u,c,null)}return;default:if(Id(a)){for(q in c)c.hasOwnProperty(q)&&(u=c[q],u!==void 0&&vp(s,a,q,u,c,void 0));return}}for(v in c)c.hasOwnProperty(v)&&(u=c[v],u!=null&&We(s,a,v,u,c,null))}function NM(s,a,c,u){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var d=null,p=null,w=null,v=null,O=null,z=null,q=null;for(K in c){var J=c[K];if(c.hasOwnProperty(K)&&J!=null)switch(K){case"checked":break;case"value":break;case"defaultValue":O=J;default:u.hasOwnProperty(K)||We(s,a,K,null,u,J)}}for(var B in u){var K=u[B];if(J=c[B],u.hasOwnProperty(B)&&(K!=null||J!=null))switch(B){case"type":p=K;break;case"name":d=K;break;case"checked":z=K;break;case"defaultChecked":q=K;break;case"value":w=K;break;case"defaultValue":v=K;break;case"children":case"dangerouslySetInnerHTML":if(K!=null)throw Error(r(137,a));break;default:K!==J&&We(s,a,B,K,u,J)}}Dd(s,w,v,O,z,q,p,d);return;case"select":K=w=v=B=null;for(p in c)if(O=c[p],c.hasOwnProperty(p)&&O!=null)switch(p){case"value":break;case"multiple":K=O;default:u.hasOwnProperty(p)||We(s,a,p,null,u,O)}for(d in u)if(p=u[d],O=c[d],u.hasOwnProperty(d)&&(p!=null||O!=null))switch(d){case"value":B=p;break;case"defaultValue":v=p;break;case"multiple":w=p;default:p!==O&&We(s,a,d,p,u,O)}a=v,c=w,u=K,B!=null?ka(s,!!c,B,!1):!!u!=!!c&&(a!=null?ka(s,!!c,a,!0):ka(s,!!c,c?[]:"",!1));return;case"textarea":K=B=null;for(v in c)if(d=c[v],c.hasOwnProperty(v)&&d!=null&&!u.hasOwnProperty(v))switch(v){case"value":break;case"children":break;default:We(s,a,v,null,u,d)}for(w in u)if(d=u[w],p=c[w],u.hasOwnProperty(w)&&(d!=null||p!=null))switch(w){case"value":B=d;break;case"defaultValue":K=d;break;case"children":break;case"dangerouslySetInnerHTML":if(d!=null)throw Error(r(91));break;default:d!==p&&We(s,a,w,d,u,p)}ab(s,B,K);return;case"option":for(var ce in c)B=c[ce],c.hasOwnProperty(ce)&&B!=null&&!u.hasOwnProperty(ce)&&(ce==="selected"?s.selected=!1:We(s,a,ce,null,u,B));for(O in u)B=u[O],K=c[O],u.hasOwnProperty(O)&&B!==K&&(B!=null||K!=null)&&(O==="selected"?s.selected=B&&typeof B!="function"&&typeof B!="symbol":We(s,a,O,B,u,K));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var we in c)B=c[we],c.hasOwnProperty(we)&&B!=null&&!u.hasOwnProperty(we)&&We(s,a,we,null,u,B);for(z in u)if(B=u[z],K=c[z],u.hasOwnProperty(z)&&B!==K&&(B!=null||K!=null))switch(z){case"children":case"dangerouslySetInnerHTML":if(B!=null)throw Error(r(137,a));break;default:We(s,a,z,B,u,K)}return;default:if(Id(a)){for(var Ye in c)B=c[Ye],c.hasOwnProperty(Ye)&&B!==void 0&&!u.hasOwnProperty(Ye)&&vp(s,a,Ye,void 0,u,B);for(q in u)B=u[q],K=c[q],!u.hasOwnProperty(q)||B===K||B===void 0&&K===void 0||vp(s,a,q,B,u,K);return}}for(var D in c)B=c[D],c.hasOwnProperty(D)&&B!=null&&!u.hasOwnProperty(D)&&We(s,a,D,null,u,B);for(J in u)B=u[J],K=c[J],!u.hasOwnProperty(J)||B===K||B==null&&K==null||We(s,a,J,B,u,K)}function uE(s){switch(s){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function RM(){if(typeof performance.getEntriesByType=="function"){for(var s=0,a=0,c=performance.getEntriesByType("resource"),u=0;u<c.length;u++){var d=c[u],p=d.transferSize,w=d.initiatorType,v=d.duration;if(p&&v&&uE(w)){for(w=0,v=d.responseEnd,u+=1;u<c.length;u++){var O=c[u],z=O.startTime;if(z>v)break;var q=O.transferSize,J=O.initiatorType;q&&uE(J)&&(O=O.responseEnd,w+=q*(O<v?1:(v-z)/(O-z)))}if(--u,a+=8*(p+w)/(d.duration/1e3),s++,10<s)break}}if(0<s)return a/s/1e6}return navigator.connection&&(s=navigator.connection.downlink,typeof s=="number")?s:5}var Sp=null,Ep=null;function mf(s){return s.nodeType===9?s:s.ownerDocument}function fE(s){switch(s){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function hE(s,a){if(s===0)switch(a){case"svg":return 1;case"math":return 2;default:return 0}return s===1&&a==="foreignObject"?0:s}function _p(s,a){return s==="textarea"||s==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.children=="bigint"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var Ap=null;function DM(){var s=window.event;return s&&s.type==="popstate"?s===Ap?!1:(Ap=s,!0):(Ap=null,!1)}var dE=typeof setTimeout=="function"?setTimeout:void 0,xM=typeof clearTimeout=="function"?clearTimeout:void 0,mE=typeof Promise=="function"?Promise:void 0,IM=typeof queueMicrotask=="function"?queueMicrotask:typeof mE<"u"?function(s){return mE.resolve(null).then(s).catch(UM)}:dE;function UM(s){setTimeout(function(){throw s})}function qs(s){return s==="head"}function pE(s,a){var c=a,u=0;do{var d=c.nextSibling;if(s.removeChild(c),d&&d.nodeType===8)if(c=d.data,c==="/$"||c==="/&"){if(u===0){s.removeChild(d),ro(a);return}u--}else if(c==="$"||c==="$?"||c==="$~"||c==="$!"||c==="&")u++;else if(c==="html")Xc(s.ownerDocument.documentElement);else if(c==="head"){c=s.ownerDocument.head,Xc(c);for(var p=c.firstChild;p;){var w=p.nextSibling,v=p.nodeName;p[ue]||v==="SCRIPT"||v==="STYLE"||v==="LINK"&&p.rel.toLowerCase()==="stylesheet"||c.removeChild(p),p=w}}else c==="body"&&Xc(s.ownerDocument.body);c=d}while(c);ro(a)}function yE(s,a){var c=s;s=0;do{var u=c.nextSibling;if(c.nodeType===1?a?(c._stashedDisplay=c.style.display,c.style.display="none"):(c.style.display=c._stashedDisplay||"",c.getAttribute("style")===""&&c.removeAttribute("style")):c.nodeType===3&&(a?(c._stashedText=c.nodeValue,c.nodeValue=""):c.nodeValue=c._stashedText||""),u&&u.nodeType===8)if(c=u.data,c==="/$"){if(s===0)break;s--}else c!=="$"&&c!=="$?"&&c!=="$~"&&c!=="$!"||s++;c=u}while(c)}function kp(s){var a=s.firstChild;for(a&&a.nodeType===10&&(a=a.nextSibling);a;){var c=a;switch(a=a.nextSibling,c.nodeName){case"HTML":case"HEAD":case"BODY":kp(c),C(c);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(c.rel.toLowerCase()==="stylesheet")continue}s.removeChild(c)}}function zM(s,a,c,u){for(;s.nodeType===1;){var d=c;if(s.nodeName.toLowerCase()!==a.toLowerCase()){if(!u&&(s.nodeName!=="INPUT"||s.type!=="hidden"))break}else if(u){if(!s[ue])switch(a){case"meta":if(!s.hasAttribute("itemprop"))break;return s;case"link":if(p=s.getAttribute("rel"),p==="stylesheet"&&s.hasAttribute("data-precedence"))break;if(p!==d.rel||s.getAttribute("href")!==(d.href==null||d.href===""?null:d.href)||s.getAttribute("crossorigin")!==(d.crossOrigin==null?null:d.crossOrigin)||s.getAttribute("title")!==(d.title==null?null:d.title))break;return s;case"style":if(s.hasAttribute("data-precedence"))break;return s;case"script":if(p=s.getAttribute("src"),(p!==(d.src==null?null:d.src)||s.getAttribute("type")!==(d.type==null?null:d.type)||s.getAttribute("crossorigin")!==(d.crossOrigin==null?null:d.crossOrigin))&&p&&s.hasAttribute("async")&&!s.hasAttribute("itemprop"))break;return s;default:return s}}else if(a==="input"&&s.type==="hidden"){var p=d.name==null?null:""+d.name;if(d.type==="hidden"&&s.getAttribute("name")===p)return s}else return s;if(s=nr(s.nextSibling),s===null)break}return null}function LM(s,a,c){if(a==="")return null;for(;s.nodeType!==3;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!c||(s=nr(s.nextSibling),s===null))return null;return s}function gE(s,a){for(;s.nodeType!==8;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!a||(s=nr(s.nextSibling),s===null))return null;return s}function Tp(s){return s.data==="$?"||s.data==="$~"}function Op(s){return s.data==="$!"||s.data==="$?"&&s.ownerDocument.readyState!=="loading"}function BM(s,a){var c=s.ownerDocument;if(s.data==="$~")s._reactRetry=a;else if(s.data!=="$?"||c.readyState!=="loading")a();else{var u=function(){a(),c.removeEventListener("DOMContentLoaded",u)};c.addEventListener("DOMContentLoaded",u),s._reactRetry=u}}function nr(s){for(;s!=null;s=s.nextSibling){var a=s.nodeType;if(a===1||a===3)break;if(a===8){if(a=s.data,a==="$"||a==="$!"||a==="$?"||a==="$~"||a==="&"||a==="F!"||a==="F")break;if(a==="/$"||a==="/&")return null}}return s}var Cp=null;function wE(s){s=s.nextSibling;for(var a=0;s;){if(s.nodeType===8){var c=s.data;if(c==="/$"||c==="/&"){if(a===0)return nr(s.nextSibling);a--}else c!=="$"&&c!=="$!"&&c!=="$?"&&c!=="$~"&&c!=="&"||a++}s=s.nextSibling}return null}function bE(s){s=s.previousSibling;for(var a=0;s;){if(s.nodeType===8){var c=s.data;if(c==="$"||c==="$!"||c==="$?"||c==="$~"||c==="&"){if(a===0)return s;a--}else c!=="/$"&&c!=="/&"||a++}s=s.previousSibling}return null}function vE(s,a,c){switch(a=mf(c),s){case"html":if(s=a.documentElement,!s)throw Error(r(452));return s;case"head":if(s=a.head,!s)throw Error(r(453));return s;case"body":if(s=a.body,!s)throw Error(r(454));return s;default:throw Error(r(451))}}function Xc(s){for(var a=s.attributes;a.length;)s.removeAttributeNode(a[0]);C(s)}var rr=new Map,SE=new Set;function pf(s){return typeof s.getRootNode=="function"?s.getRootNode():s.nodeType===9?s:s.ownerDocument}var ps=ne.d;ne.d={f:PM,r:$M,D:KM,C:jM,L:HM,m:qM,X:VM,S:FM,M:GM};function PM(){var s=ps.f(),a=af();return s||a}function $M(s){var a=oe(s);a!==null&&a.tag===5&&a.type==="form"?Bv(a):ps.r(s)}var eo=typeof document>"u"?null:document;function EE(s,a,c){var u=eo;if(u&&typeof a=="string"&&a){var d=Jn(a);d='link[rel="'+s+'"][href="'+d+'"]',typeof c=="string"&&(d+='[crossorigin="'+c+'"]'),SE.has(d)||(SE.add(d),s={rel:s,crossOrigin:c,href:a},u.querySelector(d)===null&&(a=u.createElement("link"),en(a,"link",s),Ce(a),u.head.appendChild(a)))}}function KM(s){ps.D(s),EE("dns-prefetch",s,null)}function jM(s,a){ps.C(s,a),EE("preconnect",s,a)}function HM(s,a,c){ps.L(s,a,c);var u=eo;if(u&&s&&a){var d='link[rel="preload"][as="'+Jn(a)+'"]';a==="image"&&c&&c.imageSrcSet?(d+='[imagesrcset="'+Jn(c.imageSrcSet)+'"]',typeof c.imageSizes=="string"&&(d+='[imagesizes="'+Jn(c.imageSizes)+'"]')):d+='[href="'+Jn(s)+'"]';var p=d;switch(a){case"style":p=to(s);break;case"script":p=no(s)}rr.has(p)||(s=g({rel:"preload",href:a==="image"&&c&&c.imageSrcSet?void 0:s,as:a},c),rr.set(p,s),u.querySelector(d)!==null||a==="style"&&u.querySelector(el(p))||a==="script"&&u.querySelector(tl(p))||(a=u.createElement("link"),en(a,"link",s),Ce(a),u.head.appendChild(a)))}}function qM(s,a){ps.m(s,a);var c=eo;if(c&&s){var u=a&&typeof a.as=="string"?a.as:"script",d='link[rel="modulepreload"][as="'+Jn(u)+'"][href="'+Jn(s)+'"]',p=d;switch(u){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":p=no(s)}if(!rr.has(p)&&(s=g({rel:"modulepreload",href:s},a),rr.set(p,s),c.querySelector(d)===null)){switch(u){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(c.querySelector(tl(p)))return}u=c.createElement("link"),en(u,"link",s),Ce(u),c.head.appendChild(u)}}}function FM(s,a,c){ps.S(s,a,c);var u=eo;if(u&&s){var d=pt(u).hoistableStyles,p=to(s);a=a||"default";var w=d.get(p);if(!w){var v={loading:0,preload:null};if(w=u.querySelector(el(p)))v.loading=5;else{s=g({rel:"stylesheet",href:s,"data-precedence":a},c),(c=rr.get(p))&&Mp(s,c);var O=w=u.createElement("link");Ce(O),en(O,"link",s),O._p=new Promise(function(z,q){O.onload=z,O.onerror=q}),O.addEventListener("load",function(){v.loading|=1}),O.addEventListener("error",function(){v.loading|=2}),v.loading|=4,yf(w,a,u)}w={type:"stylesheet",instance:w,count:1,state:v},d.set(p,w)}}}function VM(s,a){ps.X(s,a);var c=eo;if(c&&s){var u=pt(c).hoistableScripts,d=no(s),p=u.get(d);p||(p=c.querySelector(tl(d)),p||(s=g({src:s,async:!0},a),(a=rr.get(d))&&Np(s,a),p=c.createElement("script"),Ce(p),en(p,"link",s),c.head.appendChild(p)),p={type:"script",instance:p,count:1,state:null},u.set(d,p))}}function GM(s,a){ps.M(s,a);var c=eo;if(c&&s){var u=pt(c).hoistableScripts,d=no(s),p=u.get(d);p||(p=c.querySelector(tl(d)),p||(s=g({src:s,async:!0,type:"module"},a),(a=rr.get(d))&&Np(s,a),p=c.createElement("script"),Ce(p),en(p,"link",s),c.head.appendChild(p)),p={type:"script",instance:p,count:1,state:null},u.set(d,p))}}function _E(s,a,c,u){var d=(d=_e.current)?pf(d):null;if(!d)throw Error(r(446));switch(s){case"meta":case"title":return null;case"style":return typeof c.precedence=="string"&&typeof c.href=="string"?(a=to(c.href),c=pt(d).hoistableStyles,u=c.get(a),u||(u={type:"style",instance:null,count:0,state:null},c.set(a,u)),u):{type:"void",instance:null,count:0,state:null};case"link":if(c.rel==="stylesheet"&&typeof c.href=="string"&&typeof c.precedence=="string"){s=to(c.href);var p=pt(d).hoistableStyles,w=p.get(s);if(w||(d=d.ownerDocument||d,w={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},p.set(s,w),(p=d.querySelector(el(s)))&&!p._p&&(w.instance=p,w.state.loading=5),rr.has(s)||(c={rel:"preload",as:"style",href:c.href,crossOrigin:c.crossOrigin,integrity:c.integrity,media:c.media,hrefLang:c.hrefLang,referrerPolicy:c.referrerPolicy},rr.set(s,c),p||ZM(d,s,c,w.state))),a&&u===null)throw Error(r(528,""));return w}if(a&&u!==null)throw Error(r(529,""));return null;case"script":return a=c.async,c=c.src,typeof c=="string"&&a&&typeof a!="function"&&typeof a!="symbol"?(a=no(c),c=pt(d).hoistableScripts,u=c.get(a),u||(u={type:"script",instance:null,count:0,state:null},c.set(a,u)),u):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,s))}}function to(s){return'href="'+Jn(s)+'"'}function el(s){return'link[rel="stylesheet"]['+s+"]"}function AE(s){return g({},s,{"data-precedence":s.precedence,precedence:null})}function ZM(s,a,c,u){s.querySelector('link[rel="preload"][as="style"]['+a+"]")?u.loading=1:(a=s.createElement("link"),u.preload=a,a.addEventListener("load",function(){return u.loading|=1}),a.addEventListener("error",function(){return u.loading|=2}),en(a,"link",c),Ce(a),s.head.appendChild(a))}function no(s){return'[src="'+Jn(s)+'"]'}function tl(s){return"script[async]"+s}function kE(s,a,c){if(a.count++,a.instance===null)switch(a.type){case"style":var u=s.querySelector('style[data-href~="'+Jn(c.href)+'"]');if(u)return a.instance=u,Ce(u),u;var d=g({},c,{"data-href":c.href,"data-precedence":c.precedence,href:null,precedence:null});return u=(s.ownerDocument||s).createElement("style"),Ce(u),en(u,"style",d),yf(u,c.precedence,s),a.instance=u;case"stylesheet":d=to(c.href);var p=s.querySelector(el(d));if(p)return a.state.loading|=4,a.instance=p,Ce(p),p;u=AE(c),(d=rr.get(d))&&Mp(u,d),p=(s.ownerDocument||s).createElement("link"),Ce(p);var w=p;return w._p=new Promise(function(v,O){w.onload=v,w.onerror=O}),en(p,"link",u),a.state.loading|=4,yf(p,c.precedence,s),a.instance=p;case"script":return p=no(c.src),(d=s.querySelector(tl(p)))?(a.instance=d,Ce(d),d):(u=c,(d=rr.get(p))&&(u=g({},c),Np(u,d)),s=s.ownerDocument||s,d=s.createElement("script"),Ce(d),en(d,"link",u),s.head.appendChild(d),a.instance=d);case"void":return null;default:throw Error(r(443,a.type))}else a.type==="stylesheet"&&(a.state.loading&4)===0&&(u=a.instance,a.state.loading|=4,yf(u,c.precedence,s));return a.instance}function yf(s,a,c){for(var u=c.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),d=u.length?u[u.length-1]:null,p=d,w=0;w<u.length;w++){var v=u[w];if(v.dataset.precedence===a)p=v;else if(p!==d)break}p?p.parentNode.insertBefore(s,p.nextSibling):(a=c.nodeType===9?c.head:c,a.insertBefore(s,a.firstChild))}function Mp(s,a){s.crossOrigin==null&&(s.crossOrigin=a.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=a.referrerPolicy),s.title==null&&(s.title=a.title)}function Np(s,a){s.crossOrigin==null&&(s.crossOrigin=a.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=a.referrerPolicy),s.integrity==null&&(s.integrity=a.integrity)}var gf=null;function TE(s,a,c){if(gf===null){var u=new Map,d=gf=new Map;d.set(c,u)}else d=gf,u=d.get(c),u||(u=new Map,d.set(c,u));if(u.has(s))return u;for(u.set(s,null),c=c.getElementsByTagName(s),d=0;d<c.length;d++){var p=c[d];if(!(p[ue]||p[Rt]||s==="link"&&p.getAttribute("rel")==="stylesheet")&&p.namespaceURI!=="http://www.w3.org/2000/svg"){var w=p.getAttribute(a)||"";w=s+w;var v=u.get(w);v?v.push(p):u.set(w,[p])}}return u}function OE(s,a,c){s=s.ownerDocument||s,s.head.insertBefore(c,a==="title"?s.querySelector("head > title"):null)}function JM(s,a,c){if(c===1||a.itemProp!=null)return!1;switch(s){case"meta":case"title":return!0;case"style":if(typeof a.precedence!="string"||typeof a.href!="string"||a.href==="")break;return!0;case"link":if(typeof a.rel!="string"||typeof a.href!="string"||a.href===""||a.onLoad||a.onError)break;return a.rel==="stylesheet"?(s=a.disabled,typeof a.precedence=="string"&&s==null):!0;case"script":if(a.async&&typeof a.async!="function"&&typeof a.async!="symbol"&&!a.onLoad&&!a.onError&&a.src&&typeof a.src=="string")return!0}return!1}function CE(s){return!(s.type==="stylesheet"&&(s.state.loading&3)===0)}function WM(s,a,c,u){if(c.type==="stylesheet"&&(typeof u.media!="string"||matchMedia(u.media).matches!==!1)&&(c.state.loading&4)===0){if(c.instance===null){var d=to(u.href),p=a.querySelector(el(d));if(p){a=p._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(s.count++,s=wf.bind(s),a.then(s,s)),c.state.loading|=4,c.instance=p,Ce(p);return}p=a.ownerDocument||a,u=AE(u),(d=rr.get(d))&&Mp(u,d),p=p.createElement("link"),Ce(p);var w=p;w._p=new Promise(function(v,O){w.onload=v,w.onerror=O}),en(p,"link",u),c.instance=p}s.stylesheets===null&&(s.stylesheets=new Map),s.stylesheets.set(c,a),(a=c.state.preload)&&(c.state.loading&3)===0&&(s.count++,c=wf.bind(s),a.addEventListener("load",c),a.addEventListener("error",c))}}var Rp=0;function YM(s,a){return s.stylesheets&&s.count===0&&vf(s,s.stylesheets),0<s.count||0<s.imgCount?function(c){var u=setTimeout(function(){if(s.stylesheets&&vf(s,s.stylesheets),s.unsuspend){var p=s.unsuspend;s.unsuspend=null,p()}},6e4+a);0<s.imgBytes&&Rp===0&&(Rp=62500*RM());var d=setTimeout(function(){if(s.waitingForImages=!1,s.count===0&&(s.stylesheets&&vf(s,s.stylesheets),s.unsuspend)){var p=s.unsuspend;s.unsuspend=null,p()}},(s.imgBytes>Rp?50:800)+a);return s.unsuspend=c,function(){s.unsuspend=null,clearTimeout(u),clearTimeout(d)}}:null}function wf(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)vf(this,this.stylesheets);else if(this.unsuspend){var s=this.unsuspend;this.unsuspend=null,s()}}}var bf=null;function vf(s,a){s.stylesheets=null,s.unsuspend!==null&&(s.count++,bf=new Map,a.forEach(QM,s),bf=null,wf.call(s))}function QM(s,a){if(!(a.state.loading&4)){var c=bf.get(s);if(c)var u=c.get(null);else{c=new Map,bf.set(s,c);for(var d=s.querySelectorAll("link[data-precedence],style[data-precedence]"),p=0;p<d.length;p++){var w=d[p];(w.nodeName==="LINK"||w.getAttribute("media")!=="not all")&&(c.set(w.dataset.precedence,w),u=w)}u&&c.set(null,u)}d=a.instance,w=d.getAttribute("data-precedence"),p=c.get(w)||u,p===u&&c.set(null,d),c.set(w,d),this.count++,u=wf.bind(this),d.addEventListener("load",u),d.addEventListener("error",u),p?p.parentNode.insertBefore(d,p.nextSibling):(s=s.nodeType===9?s.head:s,s.insertBefore(d,s.firstChild)),a.state.loading|=4}}var nl={$$typeof:$,Provider:null,Consumer:null,_currentValue:me,_currentValue2:me,_threadCount:0};function XM(s,a,c,u,d,p,w,v,O){this.tag=1,this.containerInfo=s,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=fc(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=fc(0),this.hiddenUpdates=fc(null),this.identifierPrefix=u,this.onUncaughtError=d,this.onCaughtError=p,this.onRecoverableError=w,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=O,this.incompleteTransitions=new Map}function ME(s,a,c,u,d,p,w,v,O,z,q,J){return s=new XM(s,a,c,w,O,z,q,J,v),a=1,p===!0&&(a|=24),p=In(3,null,null,a),s.current=p,p.stateNode=s,a=um(),a.refCount++,s.pooledCache=a,a.refCount++,p.memoizedState={element:u,isDehydrated:c,cache:a},mm(p),s}function NE(s){return s?(s=xa,s):xa}function RE(s,a,c,u,d,p){d=NE(d),u.context===null?u.context=d:u.pendingContext=d,u=xs(a),u.payload={element:c},p=p===void 0?null:p,p!==null&&(u.callback=p),c=Is(s,u,a),c!==null&&(kn(c,s,a),Ic(c,s,a))}function DE(s,a){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var c=s.retryLane;s.retryLane=c!==0&&c<a?c:a}}function Dp(s,a){DE(s,a),(s=s.alternate)&&DE(s,a)}function xE(s){if(s.tag===13||s.tag===31){var a=Mi(s,67108864);a!==null&&kn(a,s,67108864),Dp(s,67108864)}}function IE(s){if(s.tag===13||s.tag===31){var a=Pn();a=wn(a);var c=Mi(s,a);c!==null&&kn(c,s,a),Dp(s,a)}}var Sf=!0;function eN(s,a,c,u){var d=P.T;P.T=null;var p=ne.p;try{ne.p=2,xp(s,a,c,u)}finally{ne.p=p,P.T=d}}function tN(s,a,c,u){var d=P.T;P.T=null;var p=ne.p;try{ne.p=8,xp(s,a,c,u)}finally{ne.p=p,P.T=d}}function xp(s,a,c,u){if(Sf){var d=Ip(u);if(d===null)bp(s,a,u,Ef,c),zE(s,u);else if(rN(d,s,a,c,u))u.stopPropagation();else if(zE(s,u),a&4&&-1<nN.indexOf(s)){for(;d!==null;){var p=oe(d);if(p!==null)switch(p.tag){case 3:if(p=p.stateNode,p.current.memoizedState.isDehydrated){var w=Dn(p.pendingLanes);if(w!==0){var v=p;for(v.pendingLanes|=2,v.entangledLanes|=2;w;){var O=1<<31-Nt(w);v.entanglements[1]|=O,w&=~O}xr(p),(He&6)===0&&(rf=Jt()+500,Wc(0))}}break;case 31:case 13:v=Mi(p,2),v!==null&&kn(v,p,2),af(),Dp(p,2)}if(p=Ip(u),p===null&&bp(s,a,u,Ef,c),p===d)break;d=p}d!==null&&u.stopPropagation()}else bp(s,a,u,null,c)}}function Ip(s){return s=zd(s),Up(s)}var Ef=null;function Up(s){if(Ef=null,s=Y(s),s!==null){var a=o(s);if(a===null)s=null;else{var c=a.tag;if(c===13){if(s=l(a),s!==null)return s;s=null}else if(c===31){if(s=f(a),s!==null)return s;s=null}else if(c===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;s=null}else a!==s&&(s=null)}}return Ef=s,null}function UE(s){switch(s){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Ai()){case Gr:return 2;case Rn:return 8;case ks:case lu:return 32;case oc:return 268435456;default:return 32}default:return 32}}var zp=!1,Fs=null,Vs=null,Gs=null,rl=new Map,sl=new Map,Zs=[],nN="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function zE(s,a){switch(s){case"focusin":case"focusout":Fs=null;break;case"dragenter":case"dragleave":Vs=null;break;case"mouseover":case"mouseout":Gs=null;break;case"pointerover":case"pointerout":rl.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":sl.delete(a.pointerId)}}function il(s,a,c,u,d,p){return s===null||s.nativeEvent!==p?(s={blockedOn:a,domEventName:c,eventSystemFlags:u,nativeEvent:p,targetContainers:[d]},a!==null&&(a=oe(a),a!==null&&xE(a)),s):(s.eventSystemFlags|=u,a=s.targetContainers,d!==null&&a.indexOf(d)===-1&&a.push(d),s)}function rN(s,a,c,u,d){switch(a){case"focusin":return Fs=il(Fs,s,a,c,u,d),!0;case"dragenter":return Vs=il(Vs,s,a,c,u,d),!0;case"mouseover":return Gs=il(Gs,s,a,c,u,d),!0;case"pointerover":var p=d.pointerId;return rl.set(p,il(rl.get(p)||null,s,a,c,u,d)),!0;case"gotpointercapture":return p=d.pointerId,sl.set(p,il(sl.get(p)||null,s,a,c,u,d)),!0}return!1}function LE(s){var a=Y(s.target);if(a!==null){var c=o(a);if(c!==null){if(a=c.tag,a===13){if(a=l(c),a!==null){s.blockedOn=a,yc(s.priority,function(){IE(c)});return}}else if(a===31){if(a=f(c),a!==null){s.blockedOn=a,yc(s.priority,function(){IE(c)});return}}else if(a===3&&c.stateNode.current.memoizedState.isDehydrated){s.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}s.blockedOn=null}function _f(s){if(s.blockedOn!==null)return!1;for(var a=s.targetContainers;0<a.length;){var c=Ip(s.nativeEvent);if(c===null){c=s.nativeEvent;var u=new c.constructor(c.type,c);Ud=u,c.target.dispatchEvent(u),Ud=null}else return a=oe(c),a!==null&&xE(a),s.blockedOn=c,!1;a.shift()}return!0}function BE(s,a,c){_f(s)&&c.delete(a)}function sN(){zp=!1,Fs!==null&&_f(Fs)&&(Fs=null),Vs!==null&&_f(Vs)&&(Vs=null),Gs!==null&&_f(Gs)&&(Gs=null),rl.forEach(BE),sl.forEach(BE)}function Af(s,a){s.blockedOn===a&&(s.blockedOn=null,zp||(zp=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,sN)))}var kf=null;function PE(s){kf!==s&&(kf=s,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){kf===s&&(kf=null);for(var a=0;a<s.length;a+=3){var c=s[a],u=s[a+1],d=s[a+2];if(typeof u!="function"){if(Up(u||c)===null)continue;break}var p=oe(c);p!==null&&(s.splice(a,3),a-=3,Im(p,{pending:!0,data:d,method:c.method,action:u},u,d))}}))}function ro(s){function a(O){return Af(O,s)}Fs!==null&&Af(Fs,s),Vs!==null&&Af(Vs,s),Gs!==null&&Af(Gs,s),rl.forEach(a),sl.forEach(a);for(var c=0;c<Zs.length;c++){var u=Zs[c];u.blockedOn===s&&(u.blockedOn=null)}for(;0<Zs.length&&(c=Zs[0],c.blockedOn===null);)LE(c),c.blockedOn===null&&Zs.shift();if(c=(s.ownerDocument||s).$$reactFormReplay,c!=null)for(u=0;u<c.length;u+=3){var d=c[u],p=c[u+1],w=d[lt]||null;if(typeof p=="function")w||PE(c);else if(w){var v=null;if(p&&p.hasAttribute("formAction")){if(d=p,w=p[lt]||null)v=w.formAction;else if(Up(d)!==null)continue}else v=w.action;typeof v=="function"?c[u+1]=v:(c.splice(u,3),u-=3),PE(c)}}}function $E(){function s(p){p.canIntercept&&p.info==="react-transition"&&p.intercept({handler:function(){return new Promise(function(w){return d=w})},focusReset:"manual",scroll:"manual"})}function a(){d!==null&&(d(),d=null),u||setTimeout(c,20)}function c(){if(!u&&!navigation.transition){var p=navigation.currentEntry;p&&p.url!=null&&navigation.navigate(p.url,{state:p.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var u=!1,d=null;return navigation.addEventListener("navigate",s),navigation.addEventListener("navigatesuccess",a),navigation.addEventListener("navigateerror",a),setTimeout(c,100),function(){u=!0,navigation.removeEventListener("navigate",s),navigation.removeEventListener("navigatesuccess",a),navigation.removeEventListener("navigateerror",a),d!==null&&(d(),d=null)}}}function Lp(s){this._internalRoot=s}Tf.prototype.render=Lp.prototype.render=function(s){var a=this._internalRoot;if(a===null)throw Error(r(409));var c=a.current,u=Pn();RE(c,u,s,a,null,null)},Tf.prototype.unmount=Lp.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var a=s.containerInfo;RE(s.current,2,null,s,null,null),af(),a[Yr]=null}};function Tf(s){this._internalRoot=s}Tf.prototype.unstable_scheduleHydration=function(s){if(s){var a=pc();s={blockedOn:null,target:s,priority:a};for(var c=0;c<Zs.length&&a!==0&&a<Zs[c].priority;c++);Zs.splice(c,0,s),c===0&&LE(s)}};var KE=e.version;if(KE!=="19.2.4")throw Error(r(527,KE,"19.2.4"));ne.findDOMNode=function(s){var a=s._reactInternals;if(a===void 0)throw typeof s.render=="function"?Error(r(188)):(s=Object.keys(s).join(","),Error(r(268,s)));return s=m(a),s=s!==null?y(s):null,s=s===null?null:s.stateNode,s};var iN={bundleType:0,version:"19.2.4",rendererPackageName:"react-dom",currentDispatcherRef:P,reconcilerVersion:"19.2.4"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Of=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Of.isDisabled&&Of.supportsFiber)try{Cr=Of.inject(iN),Ht=Of}catch{}}return ol.createRoot=function(s,a){if(!i(s))throw Error(r(299));var c=!1,u="",d=Zv,p=Jv,w=Wv;return a!=null&&(a.unstable_strictMode===!0&&(c=!0),a.identifierPrefix!==void 0&&(u=a.identifierPrefix),a.onUncaughtError!==void 0&&(d=a.onUncaughtError),a.onCaughtError!==void 0&&(p=a.onCaughtError),a.onRecoverableError!==void 0&&(w=a.onRecoverableError)),a=ME(s,1,!1,null,null,c,u,null,d,p,w,$E),s[Yr]=a.current,wp(s),new Lp(a)},ol.hydrateRoot=function(s,a,c){if(!i(s))throw Error(r(299));var u=!1,d="",p=Zv,w=Jv,v=Wv,O=null;return c!=null&&(c.unstable_strictMode===!0&&(u=!0),c.identifierPrefix!==void 0&&(d=c.identifierPrefix),c.onUncaughtError!==void 0&&(p=c.onUncaughtError),c.onCaughtError!==void 0&&(w=c.onCaughtError),c.onRecoverableError!==void 0&&(v=c.onRecoverableError),c.formState!==void 0&&(O=c.formState)),a=ME(s,1,!0,a,c??null,u,d,O,p,w,v,$E),a.context=NE(null),c=a.current,u=Pn(),u=wn(u),d=xs(u),d.callback=null,Is(c,d,u),c=u,a.current.lanes=c,Ts(a,c),xr(a),s[Yr]=a.current,wp(s),new Tf(a)},ol.version="19.2.4",ol}var YE;function pN(){if(YE)return Pp.exports;YE=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),Pp.exports=mN(),Pp.exports}var yN=pN();const vH=Gl(yN);var ee=Pg();const Ao=Gl(ee);function QE(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function gN(n){if(Array.isArray(n))return n}function wN(n,e,t){return(e=kN(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function bN(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,i,o,l,f=[],h=!0,m=!1;try{if(o=(t=t.call(n)).next,e!==0)for(;!(h=(r=o.call(t)).done)&&(f.push(r.value),f.length!==e);h=!0);}catch(y){m=!0,i=y}finally{try{if(!h&&t.return!=null&&(l=t.return(),Object(l)!==l))return}finally{if(m)throw i}}return f}}function vN(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function XE(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function e0(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?XE(Object(t),!0).forEach(function(r){wN(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):XE(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function SN(n,e){if(n==null)return{};var t,r,i=EN(n,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);for(r=0;r<o.length;r++)t=o[r],e.indexOf(t)===-1&&{}.propertyIsEnumerable.call(n,t)&&(i[t]=n[t])}return i}function EN(n,e){if(n==null)return{};var t={};for(var r in n)if({}.hasOwnProperty.call(n,r)){if(e.indexOf(r)!==-1)continue;t[r]=n[r]}return t}function _N(n,e){return gN(n)||bN(n,e)||TN(n,e)||vN()}function AN(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function kN(n){var e=AN(n,"string");return typeof e=="symbol"?e:e+""}function TN(n,e){if(n){if(typeof n=="string")return QE(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?QE(n,e):void 0}}function ON(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function t0(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function n0(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?t0(Object(t),!0).forEach(function(r){ON(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):t0(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function CN(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return function(r){return e.reduceRight(function(i,o){return o(i)},r)}}function vl(n){return function e(){for(var t=this,r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return i.length>=n.length?n.apply(this,i):function(){for(var l=arguments.length,f=new Array(l),h=0;h<l;h++)f[h]=arguments[h];return e.apply(t,[].concat(i,f))}}}function ph(n){return{}.toString.call(n).includes("Object")}function MN(n){return!Object.keys(n).length}function Dl(n){return typeof n=="function"}function NN(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function RN(n,e){return ph(e)||ai("changeType"),Object.keys(e).some(function(t){return!NN(n,t)})&&ai("changeField"),e}function DN(n){Dl(n)||ai("selectorType")}function xN(n){Dl(n)||ph(n)||ai("handlerType"),ph(n)&&Object.values(n).some(function(e){return!Dl(e)})&&ai("handlersType")}function IN(n){n||ai("initialIsRequired"),ph(n)||ai("initialType"),MN(n)&&ai("initialContent")}function UN(n,e){throw new Error(n[e]||n.default)}var zN={initialIsRequired:"initial state is required",initialType:"initial state should be an object",initialContent:"initial state shouldn't be an empty object",handlerType:"handler should be an object or a function",handlersType:"all handlers should be a functions",selectorType:"selector should be a function",changeType:"provided value of changes should be an object",changeField:'it seams you want to change a field in the state which is not specified in the "initial" state',default:"an unknown error accured in `state-local` package"},ai=vl(UN)(zN),Cf={changes:RN,selector:DN,handler:xN,initial:IN};function LN(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Cf.initial(n),Cf.handler(e);var t={current:n},r=vl($N)(t,e),i=vl(PN)(t),o=vl(Cf.changes)(n),l=vl(BN)(t);function f(){var m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:function(y){return y};return Cf.selector(m),m(t.current)}function h(m){CN(r,i,o,l)(m)}return[f,h]}function BN(n,e){return Dl(e)?e(n.current):e}function PN(n,e){return n.current=n0(n0({},n.current),e),e}function $N(n,e,t){return Dl(e)?e(n.current):Object.keys(t).forEach(function(r){var i;return(i=e[r])===null||i===void 0?void 0:i.call(e,n.current[r])}),t}var KN={create:LN},jN={paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.55.1/min/vs"}};function HN(n){return function e(){for(var t=this,r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return i.length>=n.length?n.apply(this,i):function(){for(var l=arguments.length,f=new Array(l),h=0;h<l;h++)f[h]=arguments[h];return e.apply(t,[].concat(i,f))}}}function qN(n){return{}.toString.call(n).includes("Object")}function FN(n){return n||r0("configIsRequired"),qN(n)||r0("configType"),n.urls?(VN(),{paths:{vs:n.urls.monacoBase}}):n}function VN(){console.warn(v1.deprecation)}function GN(n,e){throw new Error(n[e]||n.default)}var v1={configIsRequired:"the configuration object is required",configType:"the configuration object should be an object",default:"an unknown error accured in `@monaco-editor/loader` package",deprecation:`Deprecation warning!
    You are using deprecated way of configuration.

    Instead of using
      monaco.config({ urls: { monacoBase: '...' } })
    use
      monaco.config({ paths: { vs: '...' } })

    For more please check the link https://github.com/suren-atoyan/monaco-loader#config
  `},r0=HN(GN)(v1),ZN={config:FN},JN=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(i){return t.reduceRight(function(o,l){return l(o)},i)}};function S1(n,e){return Object.keys(e).forEach(function(t){e[t]instanceof Object&&n[t]&&Object.assign(e[t],S1(n[t],e[t]))}),e0(e0({},n),e)}var WN={type:"cancelation",msg:"operation is manually canceled"};function qp(n){var e=!1,t=new Promise(function(r,i){n.then(function(o){return e?i(WN):r(o)}),n.catch(i)});return t.cancel=function(){return e=!0},t}var YN=["monaco"],QN=KN.create({config:jN,isInitialized:!1,resolve:null,reject:null,monaco:null}),E1=_N(QN,2),Zl=E1[0],qh=E1[1];function XN(n){var e=ZN.config(n),t=e.monaco,r=SN(e,YN);qh(function(i){return{config:S1(i.config,r),monaco:t}})}function eR(){var n=Zl(function(e){var t=e.monaco,r=e.isInitialized,i=e.resolve;return{monaco:t,isInitialized:r,resolve:i}});if(!n.isInitialized){if(qh({isInitialized:!0}),n.monaco)return n.resolve(n.monaco),qp(Fp);if(window.monaco&&window.monaco.editor)return _1(window.monaco),n.resolve(window.monaco),qp(Fp);JN(tR,rR)(sR)}return qp(Fp)}function tR(n){return document.body.appendChild(n)}function nR(n){var e=document.createElement("script");return n&&(e.src=n),e}function rR(n){var e=Zl(function(r){var i=r.config,o=r.reject;return{config:i,reject:o}}),t=nR("".concat(e.config.paths.vs,"/loader.js"));return t.onload=function(){return n()},t.onerror=e.reject,t}function sR(){var n=Zl(function(t){var r=t.config,i=t.resolve,o=t.reject;return{config:r,resolve:i,reject:o}}),e=window.require;e.config(n.config),e(["vs/editor/editor.main"],function(t){var r=t.m||t;_1(r),n.resolve(r)},function(t){n.reject(t)})}function _1(n){Zl().monaco||qh({monaco:n})}function iR(){return Zl(function(n){var e=n.monaco;return e})}var Fp=new Promise(function(n,e){return qh({resolve:n,reject:e})}),A1={config:XN,init:eR,__getMonacoInstance:iR},aR={wrapper:{display:"flex",position:"relative",textAlign:"initial"},fullWidth:{width:"100%"},hide:{display:"none"}},Vp=aR,oR={container:{display:"flex",height:"100%",width:"100%",justifyContent:"center",alignItems:"center"}},cR=oR;function lR({children:n}){return Ao.createElement("div",{style:cR.container},n)}var uR=lR,fR=uR;function hR({width:n,height:e,isEditorReady:t,loading:r,_ref:i,className:o,wrapperProps:l}){return Ao.createElement("section",{style:{...Vp.wrapper,width:n,height:e},...l},!t&&Ao.createElement(fR,null,r),Ao.createElement("div",{ref:i,style:{...Vp.fullWidth,...!t&&Vp.hide},className:o}))}var dR=hR,k1=ee.memo(dR);function mR(n){ee.useEffect(n,[])}var T1=mR;function pR(n,e,t=!0){let r=ee.useRef(!0);ee.useEffect(r.current||!t?()=>{r.current=!1}:n,e)}var $n=pR;function Ol(){}function mo(n,e,t,r){return yR(n,r)||gR(n,e,t,r)}function yR(n,e){return n.editor.getModel(O1(n,e))}function gR(n,e,t,r){return n.editor.createModel(e,t,r?O1(n,r):void 0)}function O1(n,e){return n.Uri.parse(e)}function wR({original:n,modified:e,language:t,originalLanguage:r,modifiedLanguage:i,originalModelPath:o,modifiedModelPath:l,keepCurrentOriginalModel:f=!1,keepCurrentModifiedModel:h=!1,theme:m="light",loading:y="Loading...",options:g={},height:b="100%",width:E="100%",className:_,wrapperProps:S={},beforeMount:k=Ol,onMount:M=Ol}){let[x,$]=ee.useState(!1),[L,j]=ee.useState(!0),W=ee.useRef(null),G=ee.useRef(null),H=ee.useRef(null),ie=ee.useRef(M),de=ee.useRef(k),be=ee.useRef(!1);T1(()=>{let Ne=A1.init();return Ne.then(P=>(G.current=P)&&j(!1)).catch(P=>P?.type!=="cancelation"&&console.error("Monaco initialization: error:",P)),()=>W.current?$t():Ne.cancel()}),$n(()=>{if(W.current&&G.current){let Ne=W.current.getOriginalEditor(),P=mo(G.current,n||"",r||t||"text",o||"");P!==Ne.getModel()&&Ne.setModel(P)}},[o],x),$n(()=>{if(W.current&&G.current){let Ne=W.current.getModifiedEditor(),P=mo(G.current,e||"",i||t||"text",l||"");P!==Ne.getModel()&&Ne.setModel(P)}},[l],x),$n(()=>{let Ne=W.current.getModifiedEditor();Ne.getOption(G.current.editor.EditorOption.readOnly)?Ne.setValue(e||""):e!==Ne.getValue()&&(Ne.executeEdits("",[{range:Ne.getModel().getFullModelRange(),text:e||"",forceMoveMarkers:!0}]),Ne.pushUndoStop())},[e],x),$n(()=>{W.current?.getModel()?.original.setValue(n||"")},[n],x),$n(()=>{let{original:Ne,modified:P}=W.current.getModel();G.current.editor.setModelLanguage(Ne,r||t||"text"),G.current.editor.setModelLanguage(P,i||t||"text")},[t,r,i],x),$n(()=>{G.current?.editor.setTheme(m)},[m],x),$n(()=>{W.current?.updateOptions(g)},[g],x);let Ee=ee.useCallback(()=>{if(!G.current)return;de.current(G.current);let Ne=mo(G.current,n||"",r||t||"text",o||""),P=mo(G.current,e||"",i||t||"text",l||"");W.current?.setModel({original:Ne,modified:P})},[t,e,i,n,r,o,l]),Pt=ee.useCallback(()=>{!be.current&&H.current&&(W.current=G.current.editor.createDiffEditor(H.current,{automaticLayout:!0,...g}),Ee(),G.current?.editor.setTheme(m),$(!0),be.current=!0)},[g,m,Ee]);ee.useEffect(()=>{x&&ie.current(W.current,G.current)},[x]),ee.useEffect(()=>{!L&&!x&&Pt()},[L,x,Pt]);function $t(){let Ne=W.current?.getModel();f||Ne?.original?.dispose(),h||Ne?.modified?.dispose(),W.current?.dispose()}return Ao.createElement(k1,{width:E,height:b,isEditorReady:x,loading:y,_ref:H,className:_,wrapperProps:S})}var bR=wR;ee.memo(bR);function vR(n){let e=ee.useRef();return ee.useEffect(()=>{e.current=n},[n]),e.current}var SR=vR,Mf=new Map;function ER({defaultValue:n,defaultLanguage:e,defaultPath:t,value:r,language:i,path:o,theme:l="light",line:f,loading:h="Loading...",options:m={},overrideServices:y={},saveViewState:g=!0,keepCurrentModel:b=!1,width:E="100%",height:_="100%",className:S,wrapperProps:k={},beforeMount:M=Ol,onMount:x=Ol,onChange:$,onValidate:L=Ol}){let[j,W]=ee.useState(!1),[G,H]=ee.useState(!0),ie=ee.useRef(null),de=ee.useRef(null),be=ee.useRef(null),Ee=ee.useRef(x),Pt=ee.useRef(M),$t=ee.useRef(),Ne=ee.useRef(r),P=SR(o),ne=ee.useRef(!1),me=ee.useRef(!1);T1(()=>{let T=A1.init();return T.then(V=>(ie.current=V)&&H(!1)).catch(V=>V?.type!=="cancelation"&&console.error("Monaco initialization: error:",V)),()=>de.current?Pe():T.cancel()}),$n(()=>{let T=mo(ie.current,n||r||"",e||i||"",o||t||"");T!==de.current?.getModel()&&(g&&Mf.set(P,de.current?.saveViewState()),de.current?.setModel(T),g&&de.current?.restoreViewState(Mf.get(o)))},[o],j),$n(()=>{de.current?.updateOptions(m)},[m],j),$n(()=>{!de.current||r===void 0||(de.current.getOption(ie.current.editor.EditorOption.readOnly)?de.current.setValue(r):r!==de.current.getValue()&&(me.current=!0,de.current.executeEdits("",[{range:de.current.getModel().getFullModelRange(),text:r,forceMoveMarkers:!0}]),de.current.pushUndoStop(),me.current=!1))},[r],j),$n(()=>{let T=de.current?.getModel();T&&i&&ie.current?.editor.setModelLanguage(T,i)},[i],j),$n(()=>{f!==void 0&&de.current?.revealLine(f)},[f],j),$n(()=>{ie.current?.editor.setTheme(l)},[l],j);let Be=ee.useCallback(()=>{if(!(!be.current||!ie.current)&&!ne.current){Pt.current(ie.current);let T=o||t,V=mo(ie.current,r||n||"",e||i||"",T||"");de.current=ie.current?.editor.create(be.current,{model:V,automaticLayout:!0,...m},y),g&&de.current.restoreViewState(Mf.get(T)),ie.current.editor.setTheme(l),f!==void 0&&de.current.revealLine(f),W(!0),ne.current=!0}},[n,e,t,r,i,o,m,y,g,l,f]);ee.useEffect(()=>{j&&Ee.current(de.current,ie.current)},[j]),ee.useEffect(()=>{!G&&!j&&Be()},[G,j,Be]),Ne.current=r,ee.useEffect(()=>{j&&$&&($t.current?.dispose(),$t.current=de.current?.onDidChangeModelContent(T=>{me.current||$(de.current.getValue(),T)}))},[j,$]),ee.useEffect(()=>{if(j){let T=ie.current.editor.onDidChangeMarkers(V=>{let Q=de.current.getModel()?.uri;if(Q&&V.find(ae=>ae.path===Q.path)){let ae=ie.current.editor.getModelMarkers({resource:Q});L?.(ae)}});return()=>{T?.dispose()}}return()=>{}},[j,L]);function Pe(){$t.current?.dispose(),b?g&&Mf.set(o,de.current.saveViewState()):de.current.getModel()?.dispose(),de.current.dispose()}return Ao.createElement(k1,{width:E,height:_,isEditorReady:j,loading:h,_ref:be,className:S,wrapperProps:k})}var _R=ER,AR=ee.memo(_R),SH=AR;const $g=Symbol.for("yaml.alias"),Fy=Symbol.for("yaml.document"),oi=Symbol.for("yaml.map"),C1=Symbol.for("yaml.pair"),$r=Symbol.for("yaml.scalar"),Ho=Symbol.for("yaml.seq"),cr=Symbol.for("yaml.node.type"),wi=n=>!!n&&typeof n=="object"&&n[cr]===$g,oa=n=>!!n&&typeof n=="object"&&n[cr]===Fy,qo=n=>!!n&&typeof n=="object"&&n[cr]===oi,dt=n=>!!n&&typeof n=="object"&&n[cr]===C1,tt=n=>!!n&&typeof n=="object"&&n[cr]===$r,Fo=n=>!!n&&typeof n=="object"&&n[cr]===Ho;function yt(n){if(n&&typeof n=="object")switch(n[cr]){case oi:case Ho:return!0}return!1}function gt(n){if(n&&typeof n=="object")switch(n[cr]){case $g:case oi:case $r:case Ho:return!0}return!1}const M1=n=>(tt(n)||yt(n))&&!!n.anchor,Tn=Symbol("break visit"),N1=Symbol("skip children"),Pr=Symbol("remove node");function ca(n,e){const t=R1(e);oa(n)?po(null,n.contents,t,Object.freeze([n]))===Pr&&(n.contents=null):po(null,n,t,Object.freeze([]))}ca.BREAK=Tn;ca.SKIP=N1;ca.REMOVE=Pr;function po(n,e,t,r){const i=D1(n,e,t,r);if(gt(i)||dt(i))return x1(n,r,i),po(n,i,t,r);if(typeof i!="symbol"){if(yt(e)){r=Object.freeze(r.concat(e));for(let o=0;o<e.items.length;++o){const l=po(o,e.items[o],t,r);if(typeof l=="number")o=l-1;else{if(l===Tn)return Tn;l===Pr&&(e.items.splice(o,1),o-=1)}}}else if(dt(e)){r=Object.freeze(r.concat(e));const o=po("key",e.key,t,r);if(o===Tn)return Tn;o===Pr&&(e.key=null);const l=po("value",e.value,t,r);if(l===Tn)return Tn;l===Pr&&(e.value=null)}}return i}async function Fh(n,e){const t=R1(e);oa(n)?await yo(null,n.contents,t,Object.freeze([n]))===Pr&&(n.contents=null):await yo(null,n,t,Object.freeze([]))}Fh.BREAK=Tn;Fh.SKIP=N1;Fh.REMOVE=Pr;async function yo(n,e,t,r){const i=await D1(n,e,t,r);if(gt(i)||dt(i))return x1(n,r,i),yo(n,i,t,r);if(typeof i!="symbol"){if(yt(e)){r=Object.freeze(r.concat(e));for(let o=0;o<e.items.length;++o){const l=await yo(o,e.items[o],t,r);if(typeof l=="number")o=l-1;else{if(l===Tn)return Tn;l===Pr&&(e.items.splice(o,1),o-=1)}}}else if(dt(e)){r=Object.freeze(r.concat(e));const o=await yo("key",e.key,t,r);if(o===Tn)return Tn;o===Pr&&(e.key=null);const l=await yo("value",e.value,t,r);if(l===Tn)return Tn;l===Pr&&(e.value=null)}}return i}function R1(n){return typeof n=="object"&&(n.Collection||n.Node||n.Value)?Object.assign({Alias:n.Node,Map:n.Node,Scalar:n.Node,Seq:n.Node},n.Value&&{Map:n.Value,Scalar:n.Value,Seq:n.Value},n.Collection&&{Map:n.Collection,Seq:n.Collection},n):n}function D1(n,e,t,r){if(typeof t=="function")return t(n,e,r);if(qo(e))return t.Map?.(n,e,r);if(Fo(e))return t.Seq?.(n,e,r);if(dt(e))return t.Pair?.(n,e,r);if(tt(e))return t.Scalar?.(n,e,r);if(wi(e))return t.Alias?.(n,e,r)}function x1(n,e,t){const r=e[e.length-1];if(yt(r))r.items[n]=t;else if(dt(r))n==="key"?r.key=t:r.value=t;else if(oa(r))r.contents=t;else{const i=wi(r)?"alias":"scalar";throw new Error(`Cannot replace node with ${i} parent`)}}const kR={"!":"%21",",":"%2C","[":"%5B","]":"%5D","{":"%7B","}":"%7D"},TR=n=>n.replace(/[!,[\]{}]/g,e=>kR[e]);class mn{constructor(e,t){this.docStart=null,this.docEnd=!1,this.yaml=Object.assign({},mn.defaultYaml,e),this.tags=Object.assign({},mn.defaultTags,t)}clone(){const e=new mn(this.yaml,this.tags);return e.docStart=this.docStart,e}atDocument(){const e=new mn(this.yaml,this.tags);switch(this.yaml.version){case"1.1":this.atNextDocument=!0;break;case"1.2":this.atNextDocument=!1,this.yaml={explicit:mn.defaultYaml.explicit,version:"1.2"},this.tags=Object.assign({},mn.defaultTags);break}return e}add(e,t){this.atNextDocument&&(this.yaml={explicit:mn.defaultYaml.explicit,version:"1.1"},this.tags=Object.assign({},mn.defaultTags),this.atNextDocument=!1);const r=e.trim().split(/[ \t]+/),i=r.shift();switch(i){case"%TAG":{if(r.length!==2&&(t(0,"%TAG directive should contain exactly two parts"),r.length<2))return!1;const[o,l]=r;return this.tags[o]=l,!0}case"%YAML":{if(this.yaml.explicit=!0,r.length!==1)return t(0,"%YAML directive should contain exactly one part"),!1;const[o]=r;if(o==="1.1"||o==="1.2")return this.yaml.version=o,!0;{const l=/^\d+\.\d+$/.test(o);return t(6,`Unsupported YAML version ${o}`,l),!1}}default:return t(0,`Unknown directive ${i}`,!0),!1}}tagName(e,t){if(e==="!")return"!";if(e[0]!=="!")return t(`Not a valid tag: ${e}`),null;if(e[1]==="<"){const l=e.slice(2,-1);return l==="!"||l==="!!"?(t(`Verbatim tags aren't resolved, so ${e} is invalid.`),null):(e[e.length-1]!==">"&&t("Verbatim tags must end with a >"),l)}const[,r,i]=e.match(/^(.*!)([^!]*)$/s);i||t(`The ${e} tag has no suffix`);const o=this.tags[r];if(o)try{return o+decodeURIComponent(i)}catch(l){return t(String(l)),null}return r==="!"?e:(t(`Could not resolve tag: ${e}`),null)}tagString(e){for(const[t,r]of Object.entries(this.tags))if(e.startsWith(r))return t+TR(e.substring(r.length));return e[0]==="!"?e:`!<${e}>`}toString(e){const t=this.yaml.explicit?[`%YAML ${this.yaml.version||"1.2"}`]:[],r=Object.entries(this.tags);let i;if(e&&r.length>0&&gt(e.contents)){const o={};ca(e.contents,(l,f)=>{gt(f)&&f.tag&&(o[f.tag]=!0)}),i=Object.keys(o)}else i=[];for(const[o,l]of r)o==="!!"&&l==="tag:yaml.org,2002:"||(!e||i.some(f=>f.startsWith(l)))&&t.push(`%TAG ${o} ${l}`);return t.join(`
`)}}mn.defaultYaml={explicit:!1,version:"1.2"};mn.defaultTags={"!!":"tag:yaml.org,2002:"};function I1(n){if(/[\x00-\x19\s,[\]{}]/.test(n)){const t=`Anchor must not contain whitespace or control characters: ${JSON.stringify(n)}`;throw new Error(t)}return!0}function U1(n){const e=new Set;return ca(n,{Value(t,r){r.anchor&&e.add(r.anchor)}}),e}function z1(n,e){for(let t=1;;++t){const r=`${n}${t}`;if(!e.has(r))return r}}function OR(n,e){const t=[],r=new Map;let i=null;return{onAnchor:o=>{t.push(o),i??(i=U1(n));const l=z1(e,i);return i.add(l),l},setAnchors:()=>{for(const o of t){const l=r.get(o);if(typeof l=="object"&&l.anchor&&(tt(l.node)||yt(l.node)))l.node.anchor=l.anchor;else{const f=new Error("Failed to resolve repeated object (this should not happen)");throw f.source=o,f}}},sourceObjects:r}}function go(n,e,t,r){if(r&&typeof r=="object")if(Array.isArray(r))for(let i=0,o=r.length;i<o;++i){const l=r[i],f=go(n,r,String(i),l);f===void 0?delete r[i]:f!==l&&(r[i]=f)}else if(r instanceof Map)for(const i of Array.from(r.keys())){const o=r.get(i),l=go(n,r,i,o);l===void 0?r.delete(i):l!==o&&r.set(i,l)}else if(r instanceof Set)for(const i of Array.from(r)){const o=go(n,r,i,i);o===void 0?r.delete(i):o!==i&&(r.delete(i),r.add(o))}else for(const[i,o]of Object.entries(r)){const l=go(n,r,i,o);l===void 0?delete r[i]:l!==o&&(r[i]=l)}return n.call(e,t,r)}function or(n,e,t){if(Array.isArray(n))return n.map((r,i)=>or(r,String(i),t));if(n&&typeof n.toJSON=="function"){if(!t||!M1(n))return n.toJSON(e,t);const r={aliasCount:0,count:1,res:void 0};t.anchors.set(n,r),t.onCreate=o=>{r.res=o,delete t.onCreate};const i=n.toJSON(e,t);return t.onCreate&&t.onCreate(i),i}return typeof n=="bigint"&&!t?.keep?Number(n):n}class Kg{constructor(e){Object.defineProperty(this,cr,{value:e})}clone(){const e=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(this));return this.range&&(e.range=this.range.slice()),e}toJS(e,{mapAsMap:t,maxAliasCount:r,onAnchor:i,reviver:o}={}){if(!oa(e))throw new TypeError("A document argument is required");const l={anchors:new Map,doc:e,keep:!0,mapAsMap:t===!0,mapKeyWarned:!1,maxAliasCount:typeof r=="number"?r:100},f=or(this,"",l);if(typeof i=="function")for(const{count:h,res:m}of l.anchors.values())i(m,h);return typeof o=="function"?go(o,{"":f},"",f):f}}class Vh extends Kg{constructor(e){super($g),this.source=e,Object.defineProperty(this,"tag",{set(){throw new Error("Alias nodes cannot have tags")}})}resolve(e,t){let r;t?.aliasResolveCache?r=t.aliasResolveCache:(r=[],ca(e,{Node:(o,l)=>{(wi(l)||M1(l))&&r.push(l)}}),t&&(t.aliasResolveCache=r));let i;for(const o of r){if(o===this)break;o.anchor===this.source&&(i=o)}return i}toJSON(e,t){if(!t)return{source:this.source};const{anchors:r,doc:i,maxAliasCount:o}=t,l=this.resolve(i,t);if(!l){const h=`Unresolved alias (the anchor must be set before the alias): ${this.source}`;throw new ReferenceError(h)}let f=r.get(l);if(f||(or(l,null,t),f=r.get(l)),f?.res===void 0){const h="This should not happen: Alias anchor was not resolved?";throw new ReferenceError(h)}if(o>=0&&(f.count+=1,f.aliasCount===0&&(f.aliasCount=Wf(i,l,r)),f.count*f.aliasCount>o)){const h="Excessive alias count indicates a resource exhaustion attack";throw new ReferenceError(h)}return f.res}toString(e,t,r){const i=`*${this.source}`;if(e){if(I1(this.source),e.options.verifyAliasOrder&&!e.anchors.has(this.source)){const o=`Unresolved alias (the anchor must be set before the alias): ${this.source}`;throw new Error(o)}if(e.implicitKey)return`${i} `}return i}}function Wf(n,e,t){if(wi(e)){const r=e.resolve(n),i=t&&r&&t.get(r);return i?i.count*i.aliasCount:0}else if(yt(e)){let r=0;for(const i of e.items){const o=Wf(n,i,t);o>r&&(r=o)}return r}else if(dt(e)){const r=Wf(n,e.key,t),i=Wf(n,e.value,t);return Math.max(r,i)}return 1}const L1=n=>!n||typeof n!="function"&&typeof n!="object";class Se extends Kg{constructor(e){super($r),this.value=e}toJSON(e,t){return t?.keep?this.value:or(this.value,e,t)}toString(){return String(this.value)}}Se.BLOCK_FOLDED="BLOCK_FOLDED";Se.BLOCK_LITERAL="BLOCK_LITERAL";Se.PLAIN="PLAIN";Se.QUOTE_DOUBLE="QUOTE_DOUBLE";Se.QUOTE_SINGLE="QUOTE_SINGLE";const CR="tag:yaml.org,2002:";function MR(n,e,t){if(e){const r=t.filter(o=>o.tag===e),i=r.find(o=>!o.format)??r[0];if(!i)throw new Error(`Tag ${e} not found`);return i}return t.find(r=>r.identify?.(n)&&!r.format)}function xl(n,e,t){if(oa(n)&&(n=n.contents),gt(n))return n;if(dt(n)){const g=t.schema[oi].createNode?.(t.schema,null,t);return g.items.push(n),g}(n instanceof String||n instanceof Number||n instanceof Boolean||typeof BigInt<"u"&&n instanceof BigInt)&&(n=n.valueOf());const{aliasDuplicateObjects:r,onAnchor:i,onTagObj:o,schema:l,sourceObjects:f}=t;let h;if(r&&n&&typeof n=="object"){if(h=f.get(n),h)return h.anchor??(h.anchor=i(n)),new Vh(h.anchor);h={anchor:null,node:null},f.set(n,h)}e?.startsWith("!!")&&(e=CR+e.slice(2));let m=MR(n,e,l.tags);if(!m){if(n&&typeof n.toJSON=="function"&&(n=n.toJSON()),!n||typeof n!="object"){const g=new Se(n);return h&&(h.node=g),g}m=n instanceof Map?l[oi]:Symbol.iterator in Object(n)?l[Ho]:l[oi]}o&&(o(m),delete t.onTagObj);const y=m?.createNode?m.createNode(t.schema,n,t):typeof m?.nodeClass?.from=="function"?m.nodeClass.from(t.schema,n,t):new Se(n);return e?y.tag=e:m.default||(y.tag=m.tag),h&&(h.node=y),y}function yh(n,e,t){let r=t;for(let i=e.length-1;i>=0;--i){const o=e[i];if(typeof o=="number"&&Number.isInteger(o)&&o>=0){const l=[];l[o]=r,r=l}else r=new Map([[o,r]])}return xl(r,void 0,{aliasDuplicateObjects:!1,keepUndefined:!1,onAnchor:()=>{throw new Error("This should not happen, please report a bug.")},schema:n,sourceObjects:new Map})}const Sl=n=>n==null||typeof n=="object"&&!!n[Symbol.iterator]().next().done;class B1 extends Kg{constructor(e,t){super(e),Object.defineProperty(this,"schema",{value:t,configurable:!0,enumerable:!1,writable:!0})}clone(e){const t=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(this));return e&&(t.schema=e),t.items=t.items.map(r=>gt(r)||dt(r)?r.clone(e):r),this.range&&(t.range=this.range.slice()),t}addIn(e,t){if(Sl(e))this.add(t);else{const[r,...i]=e,o=this.get(r,!0);if(yt(o))o.addIn(i,t);else if(o===void 0&&this.schema)this.set(r,yh(this.schema,i,t));else throw new Error(`Expected YAML collection at ${r}. Remaining path: ${i}`)}}deleteIn(e){const[t,...r]=e;if(r.length===0)return this.delete(t);const i=this.get(t,!0);if(yt(i))return i.deleteIn(r);throw new Error(`Expected YAML collection at ${t}. Remaining path: ${r}`)}getIn(e,t){const[r,...i]=e,o=this.get(r,!0);return i.length===0?!t&&tt(o)?o.value:o:yt(o)?o.getIn(i,t):void 0}hasAllNullValues(e){return this.items.every(t=>{if(!dt(t))return!1;const r=t.value;return r==null||e&&tt(r)&&r.value==null&&!r.commentBefore&&!r.comment&&!r.tag})}hasIn(e){const[t,...r]=e;if(r.length===0)return this.has(t);const i=this.get(t,!0);return yt(i)?i.hasIn(r):!1}setIn(e,t){const[r,...i]=e;if(i.length===0)this.set(r,t);else{const o=this.get(r,!0);if(yt(o))o.setIn(i,t);else if(o===void 0&&this.schema)this.set(r,yh(this.schema,i,t));else throw new Error(`Expected YAML collection at ${r}. Remaining path: ${i}`)}}}const NR=n=>n.replace(/^(?!$)(?: $)?/gm,"#");function ws(n,e){return/^\n+$/.test(n)?n.substring(1):e?n.replace(/^(?! *$)/gm,e):n}const Wi=(n,e,t)=>n.endsWith(`
`)?ws(t,e):t.includes(`
`)?`
`+ws(t,e):(n.endsWith(" ")?"":" ")+t,P1="flow",Vy="block",Yf="quoted";function Gh(n,e,t="flow",{indentAtStart:r,lineWidth:i=80,minContentWidth:o=20,onFold:l,onOverflow:f}={}){if(!i||i<0)return n;i<o&&(o=0);const h=Math.max(1+o,1+i-e.length);if(n.length<=h)return n;const m=[],y={};let g=i-e.length;typeof r=="number"&&(r>i-Math.max(2,o)?m.push(0):g=i-r);let b,E,_=!1,S=-1,k=-1,M=-1;t===Vy&&(S=s0(n,S,e.length),S!==-1&&(g=S+h));for(let $;$=n[S+=1];){if(t===Yf&&$==="\\"){switch(k=S,n[S+1]){case"x":S+=3;break;case"u":S+=5;break;case"U":S+=9;break;default:S+=1}M=S}if($===`
`)t===Vy&&(S=s0(n,S,e.length)),g=S+e.length+h,b=void 0;else{if($===" "&&E&&E!==" "&&E!==`
`&&E!=="	"){const L=n[S+1];L&&L!==" "&&L!==`
`&&L!=="	"&&(b=S)}if(S>=g)if(b)m.push(b),g=b+h,b=void 0;else if(t===Yf){for(;E===" "||E==="	";)E=$,$=n[S+=1],_=!0;const L=S>M+1?S-2:k-1;if(y[L])return n;m.push(L),y[L]=!0,g=L+h,b=void 0}else _=!0}E=$}if(_&&f&&f(),m.length===0)return n;l&&l();let x=n.slice(0,m[0]);for(let $=0;$<m.length;++$){const L=m[$],j=m[$+1]||n.length;L===0?x=`
${e}${n.slice(0,j)}`:(t===Yf&&y[L]&&(x+=`${n[L]}\\`),x+=`
${e}${n.slice(L+1,j)}`)}return x}function s0(n,e,t){let r=e,i=e+1,o=n[i];for(;o===" "||o==="	";)if(e<i+t)o=n[++e];else{do o=n[++e];while(o&&o!==`
`);r=e,i=e+1,o=n[i]}return r}const Zh=(n,e)=>({indentAtStart:e?n.indent.length:n.indentAtStart,lineWidth:n.options.lineWidth,minContentWidth:n.options.minContentWidth}),Jh=n=>/^(%|---|\.\.\.)/m.test(n);function RR(n,e,t){if(!e||e<0)return!1;const r=e-t,i=n.length;if(i<=r)return!1;for(let o=0,l=0;o<i;++o)if(n[o]===`
`){if(o-l>r)return!0;if(l=o+1,i-l<=r)return!1}return!0}function Cl(n,e){const t=JSON.stringify(n);if(e.options.doubleQuotedAsJSON)return t;const{implicitKey:r}=e,i=e.options.doubleQuotedMinMultiLineLength,o=e.indent||(Jh(n)?"  ":"");let l="",f=0;for(let h=0,m=t[h];m;m=t[++h])if(m===" "&&t[h+1]==="\\"&&t[h+2]==="n"&&(l+=t.slice(f,h)+"\\ ",h+=1,f=h,m="\\"),m==="\\")switch(t[h+1]){case"u":{l+=t.slice(f,h);const y=t.substr(h+2,4);switch(y){case"0000":l+="\\0";break;case"0007":l+="\\a";break;case"000b":l+="\\v";break;case"001b":l+="\\e";break;case"0085":l+="\\N";break;case"00a0":l+="\\_";break;case"2028":l+="\\L";break;case"2029":l+="\\P";break;default:y.substr(0,2)==="00"?l+="\\x"+y.substr(2):l+=t.substr(h,6)}h+=5,f=h+1}break;case"n":if(r||t[h+2]==='"'||t.length<i)h+=1;else{for(l+=t.slice(f,h)+`

`;t[h+2]==="\\"&&t[h+3]==="n"&&t[h+4]!=='"';)l+=`
`,h+=2;l+=o,t[h+2]===" "&&(l+="\\"),h+=1,f=h+1}break;default:h+=1}return l=f?l+t.slice(f):t,r?l:Gh(l,o,Yf,Zh(e,!1))}function Gy(n,e){if(e.options.singleQuote===!1||e.implicitKey&&n.includes(`
`)||/[ \t]\n|\n[ \t]/.test(n))return Cl(n,e);const t=e.indent||(Jh(n)?"  ":""),r="'"+n.replace(/'/g,"''").replace(/\n+/g,`$&
${t}`)+"'";return e.implicitKey?r:Gh(r,t,P1,Zh(e,!1))}function wo(n,e){const{singleQuote:t}=e.options;let r;if(t===!1)r=Cl;else{const i=n.includes('"'),o=n.includes("'");i&&!o?r=Gy:o&&!i?r=Cl:r=t?Gy:Cl}return r(n,e)}let Zy;try{Zy=new RegExp(`(^|(?<!
))
+(?!
|$)`,"g")}catch{Zy=/\n+(?!\n|$)/g}function Qf({comment:n,type:e,value:t},r,i,o){const{blockQuote:l,commentString:f,lineWidth:h}=r.options;if(!l||/\n[\t ]+$/.test(t))return wo(t,r);const m=r.indent||(r.forceBlockIndent||Jh(t)?"  ":""),y=l==="literal"?!0:l==="folded"||e===Se.BLOCK_FOLDED?!1:e===Se.BLOCK_LITERAL?!0:!RR(t,h,m.length);if(!t)return y?`|
`:`>
`;let g,b;for(b=t.length;b>0;--b){const j=t[b-1];if(j!==`
`&&j!=="	"&&j!==" ")break}let E=t.substring(b);const _=E.indexOf(`
`);_===-1?g="-":t===E||_!==E.length-1?(g="+",o&&o()):g="",E&&(t=t.slice(0,-E.length),E[E.length-1]===`
`&&(E=E.slice(0,-1)),E=E.replace(Zy,`$&${m}`));let S=!1,k,M=-1;for(k=0;k<t.length;++k){const j=t[k];if(j===" ")S=!0;else if(j===`
`)M=k;else break}let x=t.substring(0,M<k?M+1:k);x&&(t=t.substring(x.length),x=x.replace(/\n+/g,`$&${m}`));let L=(S?m?"2":"1":"")+g;if(n&&(L+=" "+f(n.replace(/ ?[\r\n]+/g," ")),i&&i()),!y){const j=t.replace(/\n+/g,`
$&`).replace(/(?:^|\n)([\t ].*)(?:([\n\t ]*)\n(?![\n\t ]))?/g,"$1$2").replace(/\n+/g,`$&${m}`);let W=!1;const G=Zh(r,!0);l!=="folded"&&e!==Se.BLOCK_FOLDED&&(G.onOverflow=()=>{W=!0});const H=Gh(`${x}${j}${E}`,m,Vy,G);if(!W)return`>${L}
${m}${H}`}return t=t.replace(/\n+/g,`$&${m}`),`|${L}
${m}${x}${t}${E}`}function DR(n,e,t,r){const{type:i,value:o}=n,{actualString:l,implicitKey:f,indent:h,indentStep:m,inFlow:y}=e;if(f&&o.includes(`
`)||y&&/[[\]{},]/.test(o))return wo(o,e);if(/^[\n\t ,[\]{}#&*!|>'"%@`]|^[?-]$|^[?-][ \t]|[\n:][ \t]|[ \t]\n|[\n\t ]#|[\n\t :]$/.test(o))return f||y||!o.includes(`
`)?wo(o,e):Qf(n,e,t,r);if(!f&&!y&&i!==Se.PLAIN&&o.includes(`
`))return Qf(n,e,t,r);if(Jh(o)){if(h==="")return e.forceBlockIndent=!0,Qf(n,e,t,r);if(f&&h===m)return wo(o,e)}const g=o.replace(/\n+/g,`$&
${h}`);if(l){const b=S=>S.default&&S.tag!=="tag:yaml.org,2002:str"&&S.test?.test(g),{compat:E,tags:_}=e.doc.schema;if(_.some(b)||E?.some(b))return wo(o,e)}return f?g:Gh(g,h,P1,Zh(e,!1))}function Jl(n,e,t,r){const{implicitKey:i,inFlow:o}=e,l=typeof n.value=="string"?n:Object.assign({},n,{value:String(n.value)});let{type:f}=n;f!==Se.QUOTE_DOUBLE&&/[\x00-\x08\x0b-\x1f\x7f-\x9f\u{D800}-\u{DFFF}]/u.test(l.value)&&(f=Se.QUOTE_DOUBLE);const h=y=>{switch(y){case Se.BLOCK_FOLDED:case Se.BLOCK_LITERAL:return i||o?wo(l.value,e):Qf(l,e,t,r);case Se.QUOTE_DOUBLE:return Cl(l.value,e);case Se.QUOTE_SINGLE:return Gy(l.value,e);case Se.PLAIN:return DR(l,e,t,r);default:return null}};let m=h(f);if(m===null){const{defaultKeyType:y,defaultStringType:g}=e.options,b=i&&y||g;if(m=h(b),m===null)throw new Error(`Unsupported default string type ${b}`)}return m}function $1(n,e){const t=Object.assign({blockQuote:!0,commentString:NR,defaultKeyType:null,defaultStringType:"PLAIN",directives:null,doubleQuotedAsJSON:!1,doubleQuotedMinMultiLineLength:40,falseStr:"false",flowCollectionPadding:!0,indentSeq:!0,lineWidth:80,minContentWidth:20,nullStr:"null",simpleKeys:!1,singleQuote:null,trueStr:"true",verifyAliasOrder:!0},n.schema.toStringOptions,e);let r;switch(t.collectionStyle){case"block":r=!1;break;case"flow":r=!0;break;default:r=null}return{anchors:new Set,doc:n,flowCollectionPadding:t.flowCollectionPadding?" ":"",indent:"",indentStep:typeof t.indent=="number"?" ".repeat(t.indent):"  ",inFlow:r,options:t}}function xR(n,e){if(e.tag){const i=n.filter(o=>o.tag===e.tag);if(i.length>0)return i.find(o=>o.format===e.format)??i[0]}let t,r;if(tt(e)){r=e.value;let i=n.filter(o=>o.identify?.(r));if(i.length>1){const o=i.filter(l=>l.test);o.length>0&&(i=o)}t=i.find(o=>o.format===e.format)??i.find(o=>!o.format)}else r=e,t=n.find(i=>i.nodeClass&&r instanceof i.nodeClass);if(!t){const i=r?.constructor?.name??(r===null?"null":typeof r);throw new Error(`Tag not resolved for ${i} value`)}return t}function IR(n,e,{anchors:t,doc:r}){if(!r.directives)return"";const i=[],o=(tt(n)||yt(n))&&n.anchor;o&&I1(o)&&(t.add(o),i.push(`&${o}`));const l=n.tag??(e.default?null:e.tag);return l&&i.push(r.directives.tagString(l)),i.join(" ")}function Do(n,e,t,r){if(dt(n))return n.toString(e,t,r);if(wi(n)){if(e.doc.directives)return n.toString(e);if(e.resolvedAliases?.has(n))throw new TypeError("Cannot stringify circular structure without alias nodes");e.resolvedAliases?e.resolvedAliases.add(n):e.resolvedAliases=new Set([n]),n=n.resolve(e.doc)}let i;const o=gt(n)?n:e.doc.createNode(n,{onTagObj:h=>i=h});i??(i=xR(e.doc.schema.tags,o));const l=IR(o,i,e);l.length>0&&(e.indentAtStart=(e.indentAtStart??0)+l.length+1);const f=typeof i.stringify=="function"?i.stringify(o,e,t,r):tt(o)?Jl(o,e,t,r):o.toString(e,t,r);return l?tt(o)||f[0]==="{"||f[0]==="["?`${l} ${f}`:`${l}
${e.indent}${f}`:f}function UR({key:n,value:e},t,r,i){const{allNullValues:o,doc:l,indent:f,indentStep:h,options:{commentString:m,indentSeq:y,simpleKeys:g}}=t;let b=gt(n)&&n.comment||null;if(g){if(b)throw new Error("With simple keys, key nodes cannot have comments");if(yt(n)||!gt(n)&&typeof n=="object"){const G="With simple keys, collection cannot be used as a key value";throw new Error(G)}}let E=!g&&(!n||b&&e==null&&!t.inFlow||yt(n)||(tt(n)?n.type===Se.BLOCK_FOLDED||n.type===Se.BLOCK_LITERAL:typeof n=="object"));t=Object.assign({},t,{allNullValues:!1,implicitKey:!E&&(g||!o),indent:f+h});let _=!1,S=!1,k=Do(n,t,()=>_=!0,()=>S=!0);if(!E&&!t.inFlow&&k.length>1024){if(g)throw new Error("With simple keys, single line scalar must not span more than 1024 characters");E=!0}if(t.inFlow){if(o||e==null)return _&&r&&r(),k===""?"?":E?`? ${k}`:k}else if(o&&!g||e==null&&E)return k=`? ${k}`,b&&!_?k+=Wi(k,t.indent,m(b)):S&&i&&i(),k;_&&(b=null),E?(b&&(k+=Wi(k,t.indent,m(b))),k=`? ${k}
${f}:`):(k=`${k}:`,b&&(k+=Wi(k,t.indent,m(b))));let M,x,$;gt(e)?(M=!!e.spaceBefore,x=e.commentBefore,$=e.comment):(M=!1,x=null,$=null,e&&typeof e=="object"&&(e=l.createNode(e))),t.implicitKey=!1,!E&&!b&&tt(e)&&(t.indentAtStart=k.length+1),S=!1,!y&&h.length>=2&&!t.inFlow&&!E&&Fo(e)&&!e.flow&&!e.tag&&!e.anchor&&(t.indent=t.indent.substring(2));let L=!1;const j=Do(e,t,()=>L=!0,()=>S=!0);let W=" ";if(b||M||x){if(W=M?`
`:"",x){const G=m(x);W+=`
${ws(G,t.indent)}`}j===""&&!t.inFlow?W===`
`&&$&&(W=`

`):W+=`
${t.indent}`}else if(!E&&yt(e)){const G=j[0],H=j.indexOf(`
`),ie=H!==-1,de=t.inFlow??e.flow??e.items.length===0;if(ie||!de){let be=!1;if(ie&&(G==="&"||G==="!")){let Ee=j.indexOf(" ");G==="&"&&Ee!==-1&&Ee<H&&j[Ee+1]==="!"&&(Ee=j.indexOf(" ",Ee+1)),(Ee===-1||H<Ee)&&(be=!0)}be||(W=`
${t.indent}`)}}else(j===""||j[0]===`
`)&&(W="");return k+=W+j,t.inFlow?L&&r&&r():$&&!L?k+=Wi(k,t.indent,m($)):S&&i&&i(),k}function K1(n,e){(n==="debug"||n==="warn")&&console.warn(e)}const Nf="<<",vs={identify:n=>n===Nf||typeof n=="symbol"&&n.description===Nf,default:"key",tag:"tag:yaml.org,2002:merge",test:/^<<$/,resolve:()=>Object.assign(new Se(Symbol(Nf)),{addToJSMap:j1}),stringify:()=>Nf},zR=(n,e)=>(vs.identify(e)||tt(e)&&(!e.type||e.type===Se.PLAIN)&&vs.identify(e.value))&&n?.doc.schema.tags.some(t=>t.tag===vs.tag&&t.default);function j1(n,e,t){if(t=n&&wi(t)?t.resolve(n.doc):t,Fo(t))for(const r of t.items)Gp(n,e,r);else if(Array.isArray(t))for(const r of t)Gp(n,e,r);else Gp(n,e,t)}function Gp(n,e,t){const r=n&&wi(t)?t.resolve(n.doc):t;if(!qo(r))throw new Error("Merge sources must be maps or map aliases");const i=r.toJSON(null,n,Map);for(const[o,l]of i)e instanceof Map?e.has(o)||e.set(o,l):e instanceof Set?e.add(o):Object.prototype.hasOwnProperty.call(e,o)||Object.defineProperty(e,o,{value:l,writable:!0,enumerable:!0,configurable:!0});return e}function H1(n,e,{key:t,value:r}){if(gt(t)&&t.addToJSMap)t.addToJSMap(n,e,r);else if(zR(n,t))j1(n,e,r);else{const i=or(t,"",n);if(e instanceof Map)e.set(i,or(r,i,n));else if(e instanceof Set)e.add(i);else{const o=LR(t,i,n),l=or(r,o,n);o in e?Object.defineProperty(e,o,{value:l,writable:!0,enumerable:!0,configurable:!0}):e[o]=l}}return e}function LR(n,e,t){if(e===null)return"";if(typeof e!="object")return String(e);if(gt(n)&&t?.doc){const r=$1(t.doc,{});r.anchors=new Set;for(const o of t.anchors.keys())r.anchors.add(o.anchor);r.inFlow=!0,r.inStringifyKey=!0;const i=n.toString(r);if(!t.mapKeyWarned){let o=JSON.stringify(i);o.length>40&&(o=o.substring(0,36)+'..."'),K1(t.doc.options.logLevel,`Keys with collection values will be stringified due to JS Object restrictions: ${o}. Set mapAsMap: true to use object keys.`),t.mapKeyWarned=!0}return i}return JSON.stringify(e)}function jg(n,e,t){const r=xl(n,void 0,t),i=xl(e,void 0,t);return new un(r,i)}class un{constructor(e,t=null){Object.defineProperty(this,cr,{value:C1}),this.key=e,this.value=t}clone(e){let{key:t,value:r}=this;return gt(t)&&(t=t.clone(e)),gt(r)&&(r=r.clone(e)),new un(t,r)}toJSON(e,t){const r=t?.mapAsMap?new Map:{};return H1(t,r,this)}toString(e,t,r){return e?.doc?UR(this,e,t,r):JSON.stringify(this)}}function q1(n,e,t){return(e.inFlow??n.flow?PR:BR)(n,e,t)}function BR({comment:n,items:e},t,{blockItemPrefix:r,flowChars:i,itemIndent:o,onChompKeep:l,onComment:f}){const{indent:h,options:{commentString:m}}=t,y=Object.assign({},t,{indent:o,type:null});let g=!1;const b=[];for(let _=0;_<e.length;++_){const S=e[_];let k=null;if(gt(S))!g&&S.spaceBefore&&b.push(""),gh(t,b,S.commentBefore,g),S.comment&&(k=S.comment);else if(dt(S)){const x=gt(S.key)?S.key:null;x&&(!g&&x.spaceBefore&&b.push(""),gh(t,b,x.commentBefore,g))}g=!1;let M=Do(S,y,()=>k=null,()=>g=!0);k&&(M+=Wi(M,o,m(k))),g&&k&&(g=!1),b.push(r+M)}let E;if(b.length===0)E=i.start+i.end;else{E=b[0];for(let _=1;_<b.length;++_){const S=b[_];E+=S?`
${h}${S}`:`
`}}return n?(E+=`
`+ws(m(n),h),f&&f()):g&&l&&l(),E}function PR({items:n},e,{flowChars:t,itemIndent:r}){const{indent:i,indentStep:o,flowCollectionPadding:l,options:{commentString:f}}=e;r+=o;const h=Object.assign({},e,{indent:r,inFlow:!0,type:null});let m=!1,y=0;const g=[];for(let _=0;_<n.length;++_){const S=n[_];let k=null;if(gt(S))S.spaceBefore&&g.push(""),gh(e,g,S.commentBefore,!1),S.comment&&(k=S.comment);else if(dt(S)){const x=gt(S.key)?S.key:null;x&&(x.spaceBefore&&g.push(""),gh(e,g,x.commentBefore,!1),x.comment&&(m=!0));const $=gt(S.value)?S.value:null;$?($.comment&&(k=$.comment),$.commentBefore&&(m=!0)):S.value==null&&x?.comment&&(k=x.comment)}k&&(m=!0);let M=Do(S,h,()=>k=null);_<n.length-1&&(M+=","),k&&(M+=Wi(M,r,f(k))),!m&&(g.length>y||M.includes(`
`))&&(m=!0),g.push(M),y=g.length}const{start:b,end:E}=t;if(g.length===0)return b+E;if(!m){const _=g.reduce((S,k)=>S+k.length+2,2);m=e.options.lineWidth>0&&_>e.options.lineWidth}if(m){let _=b;for(const S of g)_+=S?`
${o}${i}${S}`:`
`;return`${_}
${i}${E}`}else return`${b}${l}${g.join(" ")}${l}${E}`}function gh({indent:n,options:{commentString:e}},t,r,i){if(r&&i&&(r=r.replace(/^\n+/,"")),r){const o=ws(e(r),n);t.push(o.trimStart())}}function Yi(n,e){const t=tt(e)?e.value:e;for(const r of n)if(dt(r)&&(r.key===e||r.key===t||tt(r.key)&&r.key.value===t))return r}class Kn extends B1{static get tagName(){return"tag:yaml.org,2002:map"}constructor(e){super(oi,e),this.items=[]}static from(e,t,r){const{keepUndefined:i,replacer:o}=r,l=new this(e),f=(h,m)=>{if(typeof o=="function")m=o.call(t,h,m);else if(Array.isArray(o)&&!o.includes(h))return;(m!==void 0||i)&&l.items.push(jg(h,m,r))};if(t instanceof Map)for(const[h,m]of t)f(h,m);else if(t&&typeof t=="object")for(const h of Object.keys(t))f(h,t[h]);return typeof e.sortMapEntries=="function"&&l.items.sort(e.sortMapEntries),l}add(e,t){let r;dt(e)?r=e:!e||typeof e!="object"||!("key"in e)?r=new un(e,e?.value):r=new un(e.key,e.value);const i=Yi(this.items,r.key),o=this.schema?.sortMapEntries;if(i){if(!t)throw new Error(`Key ${r.key} already set`);tt(i.value)&&L1(r.value)?i.value.value=r.value:i.value=r.value}else if(o){const l=this.items.findIndex(f=>o(r,f)<0);l===-1?this.items.push(r):this.items.splice(l,0,r)}else this.items.push(r)}delete(e){const t=Yi(this.items,e);return t?this.items.splice(this.items.indexOf(t),1).length>0:!1}get(e,t){const i=Yi(this.items,e)?.value;return(!t&&tt(i)?i.value:i)??void 0}has(e){return!!Yi(this.items,e)}set(e,t){this.add(new un(e,t),!0)}toJSON(e,t,r){const i=r?new r:t?.mapAsMap?new Map:{};t?.onCreate&&t.onCreate(i);for(const o of this.items)H1(t,i,o);return i}toString(e,t,r){if(!e)return JSON.stringify(this);for(const i of this.items)if(!dt(i))throw new Error(`Map items must all be pairs; found ${JSON.stringify(i)} instead`);return!e.allNullValues&&this.hasAllNullValues(!1)&&(e=Object.assign({},e,{allNullValues:!0})),q1(this,e,{blockItemPrefix:"",flowChars:{start:"{",end:"}"},itemIndent:e.indent||"",onChompKeep:r,onComment:t})}}const Vo={collection:"map",default:!0,nodeClass:Kn,tag:"tag:yaml.org,2002:map",resolve(n,e){return qo(n)||e("Expected a mapping for this tag"),n},createNode:(n,e,t)=>Kn.from(n,e,t)};class li extends B1{static get tagName(){return"tag:yaml.org,2002:seq"}constructor(e){super(Ho,e),this.items=[]}add(e){this.items.push(e)}delete(e){const t=Rf(e);return typeof t!="number"?!1:this.items.splice(t,1).length>0}get(e,t){const r=Rf(e);if(typeof r!="number")return;const i=this.items[r];return!t&&tt(i)?i.value:i}has(e){const t=Rf(e);return typeof t=="number"&&t<this.items.length}set(e,t){const r=Rf(e);if(typeof r!="number")throw new Error(`Expected a valid index, not ${e}.`);const i=this.items[r];tt(i)&&L1(t)?i.value=t:this.items[r]=t}toJSON(e,t){const r=[];t?.onCreate&&t.onCreate(r);let i=0;for(const o of this.items)r.push(or(o,String(i++),t));return r}toString(e,t,r){return e?q1(this,e,{blockItemPrefix:"- ",flowChars:{start:"[",end:"]"},itemIndent:(e.indent||"")+"  ",onChompKeep:r,onComment:t}):JSON.stringify(this)}static from(e,t,r){const{replacer:i}=r,o=new this(e);if(t&&Symbol.iterator in Object(t)){let l=0;for(let f of t){if(typeof i=="function"){const h=t instanceof Set?f:String(l++);f=i.call(t,h,f)}o.items.push(xl(f,void 0,r))}}return o}}function Rf(n){let e=tt(n)?n.value:n;return e&&typeof e=="string"&&(e=Number(e)),typeof e=="number"&&Number.isInteger(e)&&e>=0?e:null}const Go={collection:"seq",default:!0,nodeClass:li,tag:"tag:yaml.org,2002:seq",resolve(n,e){return Fo(n)||e("Expected a sequence for this tag"),n},createNode:(n,e,t)=>li.from(n,e,t)},Wh={identify:n=>typeof n=="string",default:!0,tag:"tag:yaml.org,2002:str",resolve:n=>n,stringify(n,e,t,r){return e=Object.assign({actualString:!0},e),Jl(n,e,t,r)}},Yh={identify:n=>n==null,createNode:()=>new Se(null),default:!0,tag:"tag:yaml.org,2002:null",test:/^(?:~|[Nn]ull|NULL)?$/,resolve:()=>new Se(null),stringify:({source:n},e)=>typeof n=="string"&&Yh.test.test(n)?n:e.options.nullStr},Hg={identify:n=>typeof n=="boolean",default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:[Tt]rue|TRUE|[Ff]alse|FALSE)$/,resolve:n=>new Se(n[0]==="t"||n[0]==="T"),stringify({source:n,value:e},t){if(n&&Hg.test.test(n)){const r=n[0]==="t"||n[0]==="T";if(e===r)return n}return e?t.options.trueStr:t.options.falseStr}};function Tr({format:n,minFractionDigits:e,tag:t,value:r}){if(typeof r=="bigint")return String(r);const i=typeof r=="number"?r:Number(r);if(!isFinite(i))return isNaN(i)?".nan":i<0?"-.inf":".inf";let o=Object.is(r,-0)?"-0":JSON.stringify(r);if(!n&&e&&(!t||t==="tag:yaml.org,2002:float")&&/^\d/.test(o)){let l=o.indexOf(".");l<0&&(l=o.length,o+=".");let f=e-(o.length-l-1);for(;f-- >0;)o+="0"}return o}const F1={identify:n=>typeof n=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^(?:[-+]?\.(?:inf|Inf|INF)|\.nan|\.NaN|\.NAN)$/,resolve:n=>n.slice(-3).toLowerCase()==="nan"?NaN:n[0]==="-"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,stringify:Tr},V1={identify:n=>typeof n=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:\.[0-9]+|[0-9]+(?:\.[0-9]*)?)[eE][-+]?[0-9]+$/,resolve:n=>parseFloat(n),stringify(n){const e=Number(n.value);return isFinite(e)?e.toExponential():Tr(n)}},G1={identify:n=>typeof n=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:\.[0-9]+|[0-9]+\.[0-9]*)$/,resolve(n){const e=new Se(parseFloat(n)),t=n.indexOf(".");return t!==-1&&n[n.length-1]==="0"&&(e.minFractionDigits=n.length-t-1),e},stringify:Tr},Qh=n=>typeof n=="bigint"||Number.isInteger(n),qg=(n,e,t,{intAsBigInt:r})=>r?BigInt(n):parseInt(n.substring(e),t);function Z1(n,e,t){const{value:r}=n;return Qh(r)&&r>=0?t+r.toString(e):Tr(n)}const J1={identify:n=>Qh(n)&&n>=0,default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^0o[0-7]+$/,resolve:(n,e,t)=>qg(n,2,8,t),stringify:n=>Z1(n,8,"0o")},W1={identify:Qh,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9]+$/,resolve:(n,e,t)=>qg(n,0,10,t),stringify:Tr},Y1={identify:n=>Qh(n)&&n>=0,default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^0x[0-9a-fA-F]+$/,resolve:(n,e,t)=>qg(n,2,16,t),stringify:n=>Z1(n,16,"0x")},$R=[Vo,Go,Wh,Yh,Hg,J1,W1,Y1,F1,V1,G1];function i0(n){return typeof n=="bigint"||Number.isInteger(n)}const Df=({value:n})=>JSON.stringify(n),KR=[{identify:n=>typeof n=="string",default:!0,tag:"tag:yaml.org,2002:str",resolve:n=>n,stringify:Df},{identify:n=>n==null,createNode:()=>new Se(null),default:!0,tag:"tag:yaml.org,2002:null",test:/^null$/,resolve:()=>null,stringify:Df},{identify:n=>typeof n=="boolean",default:!0,tag:"tag:yaml.org,2002:bool",test:/^true$|^false$/,resolve:n=>n==="true",stringify:Df},{identify:i0,default:!0,tag:"tag:yaml.org,2002:int",test:/^-?(?:0|[1-9][0-9]*)$/,resolve:(n,e,{intAsBigInt:t})=>t?BigInt(n):parseInt(n,10),stringify:({value:n})=>i0(n)?n.toString():JSON.stringify(n)},{identify:n=>typeof n=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^-?(?:0|[1-9][0-9]*)(?:\.[0-9]*)?(?:[eE][-+]?[0-9]+)?$/,resolve:n=>parseFloat(n),stringify:Df}],jR={default:!0,tag:"",test:/^/,resolve(n,e){return e(`Unresolved plain scalar ${JSON.stringify(n)}`),n}},HR=[Vo,Go].concat(KR,jR),Fg={identify:n=>n instanceof Uint8Array,default:!1,tag:"tag:yaml.org,2002:binary",resolve(n,e){if(typeof atob=="function"){const t=atob(n.replace(/[\n\r]/g,"")),r=new Uint8Array(t.length);for(let i=0;i<t.length;++i)r[i]=t.charCodeAt(i);return r}else return e("This environment does not support reading binary tags; either Buffer or atob is required"),n},stringify({comment:n,type:e,value:t},r,i,o){if(!t)return"";const l=t;let f;if(typeof btoa=="function"){let h="";for(let m=0;m<l.length;++m)h+=String.fromCharCode(l[m]);f=btoa(h)}else throw new Error("This environment does not support writing binary tags; either Buffer or btoa is required");if(e??(e=Se.BLOCK_LITERAL),e!==Se.QUOTE_DOUBLE){const h=Math.max(r.options.lineWidth-r.indent.length,r.options.minContentWidth),m=Math.ceil(f.length/h),y=new Array(m);for(let g=0,b=0;g<m;++g,b+=h)y[g]=f.substr(b,h);f=y.join(e===Se.BLOCK_LITERAL?`
`:" ")}return Jl({comment:n,type:e,value:f},r,i,o)}};function Q1(n,e){if(Fo(n))for(let t=0;t<n.items.length;++t){let r=n.items[t];if(!dt(r)){if(qo(r)){r.items.length>1&&e("Each pair must have its own sequence indicator");const i=r.items[0]||new un(new Se(null));if(r.commentBefore&&(i.key.commentBefore=i.key.commentBefore?`${r.commentBefore}
${i.key.commentBefore}`:r.commentBefore),r.comment){const o=i.value??i.key;o.comment=o.comment?`${r.comment}
${o.comment}`:r.comment}r=i}n.items[t]=dt(r)?r:new un(r)}}else e("Expected a sequence for this tag");return n}function X1(n,e,t){const{replacer:r}=t,i=new li(n);i.tag="tag:yaml.org,2002:pairs";let o=0;if(e&&Symbol.iterator in Object(e))for(let l of e){typeof r=="function"&&(l=r.call(e,String(o++),l));let f,h;if(Array.isArray(l))if(l.length===2)f=l[0],h=l[1];else throw new TypeError(`Expected [key, value] tuple: ${l}`);else if(l&&l instanceof Object){const m=Object.keys(l);if(m.length===1)f=m[0],h=l[f];else throw new TypeError(`Expected tuple with one key, not ${m.length} keys`)}else f=l;i.items.push(jg(f,h,t))}return i}const Vg={collection:"seq",default:!1,tag:"tag:yaml.org,2002:pairs",resolve:Q1,createNode:X1};class ko extends li{constructor(){super(),this.add=Kn.prototype.add.bind(this),this.delete=Kn.prototype.delete.bind(this),this.get=Kn.prototype.get.bind(this),this.has=Kn.prototype.has.bind(this),this.set=Kn.prototype.set.bind(this),this.tag=ko.tag}toJSON(e,t){if(!t)return super.toJSON(e);const r=new Map;t?.onCreate&&t.onCreate(r);for(const i of this.items){let o,l;if(dt(i)?(o=or(i.key,"",t),l=or(i.value,o,t)):o=or(i,"",t),r.has(o))throw new Error("Ordered maps must not include duplicate keys");r.set(o,l)}return r}static from(e,t,r){const i=X1(e,t,r),o=new this;return o.items=i.items,o}}ko.tag="tag:yaml.org,2002:omap";const Gg={collection:"seq",identify:n=>n instanceof Map,nodeClass:ko,default:!1,tag:"tag:yaml.org,2002:omap",resolve(n,e){const t=Q1(n,e),r=[];for(const{key:i}of t.items)tt(i)&&(r.includes(i.value)?e(`Ordered maps must not include duplicate keys: ${i.value}`):r.push(i.value));return Object.assign(new ko,t)},createNode:(n,e,t)=>ko.from(n,e,t)};function eA({value:n,source:e},t){return e&&(n?tA:nA).test.test(e)?e:n?t.options.trueStr:t.options.falseStr}const tA={identify:n=>n===!0,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:Y|y|[Yy]es|YES|[Tt]rue|TRUE|[Oo]n|ON)$/,resolve:()=>new Se(!0),stringify:eA},nA={identify:n=>n===!1,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:N|n|[Nn]o|NO|[Ff]alse|FALSE|[Oo]ff|OFF)$/,resolve:()=>new Se(!1),stringify:eA},qR={identify:n=>typeof n=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^(?:[-+]?\.(?:inf|Inf|INF)|\.nan|\.NaN|\.NAN)$/,resolve:n=>n.slice(-3).toLowerCase()==="nan"?NaN:n[0]==="-"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,stringify:Tr},FR={identify:n=>typeof n=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:[0-9][0-9_]*)?(?:\.[0-9_]*)?[eE][-+]?[0-9]+$/,resolve:n=>parseFloat(n.replace(/_/g,"")),stringify(n){const e=Number(n.value);return isFinite(e)?e.toExponential():Tr(n)}},VR={identify:n=>typeof n=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:[0-9][0-9_]*)?\.[0-9_]*$/,resolve(n){const e=new Se(parseFloat(n.replace(/_/g,""))),t=n.indexOf(".");if(t!==-1){const r=n.substring(t+1).replace(/_/g,"");r[r.length-1]==="0"&&(e.minFractionDigits=r.length)}return e},stringify:Tr},Wl=n=>typeof n=="bigint"||Number.isInteger(n);function Xh(n,e,t,{intAsBigInt:r}){const i=n[0];if((i==="-"||i==="+")&&(e+=1),n=n.substring(e).replace(/_/g,""),r){switch(t){case 2:n=`0b${n}`;break;case 8:n=`0o${n}`;break;case 16:n=`0x${n}`;break}const l=BigInt(n);return i==="-"?BigInt(-1)*l:l}const o=parseInt(n,t);return i==="-"?-1*o:o}function Zg(n,e,t){const{value:r}=n;if(Wl(r)){const i=r.toString(e);return r<0?"-"+t+i.substr(1):t+i}return Tr(n)}const GR={identify:Wl,default:!0,tag:"tag:yaml.org,2002:int",format:"BIN",test:/^[-+]?0b[0-1_]+$/,resolve:(n,e,t)=>Xh(n,2,2,t),stringify:n=>Zg(n,2,"0b")},ZR={identify:Wl,default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^[-+]?0[0-7_]+$/,resolve:(n,e,t)=>Xh(n,1,8,t),stringify:n=>Zg(n,8,"0")},JR={identify:Wl,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9][0-9_]*$/,resolve:(n,e,t)=>Xh(n,0,10,t),stringify:Tr},WR={identify:Wl,default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^[-+]?0x[0-9a-fA-F_]+$/,resolve:(n,e,t)=>Xh(n,2,16,t),stringify:n=>Zg(n,16,"0x")};class To extends Kn{constructor(e){super(e),this.tag=To.tag}add(e){let t;dt(e)?t=e:e&&typeof e=="object"&&"key"in e&&"value"in e&&e.value===null?t=new un(e.key,null):t=new un(e,null),Yi(this.items,t.key)||this.items.push(t)}get(e,t){const r=Yi(this.items,e);return!t&&dt(r)?tt(r.key)?r.key.value:r.key:r}set(e,t){if(typeof t!="boolean")throw new Error(`Expected boolean value for set(key, value) in a YAML set, not ${typeof t}`);const r=Yi(this.items,e);r&&!t?this.items.splice(this.items.indexOf(r),1):!r&&t&&this.items.push(new un(e))}toJSON(e,t){return super.toJSON(e,t,Set)}toString(e,t,r){if(!e)return JSON.stringify(this);if(this.hasAllNullValues(!0))return super.toString(Object.assign({},e,{allNullValues:!0}),t,r);throw new Error("Set items must all have null values")}static from(e,t,r){const{replacer:i}=r,o=new this(e);if(t&&Symbol.iterator in Object(t))for(let l of t)typeof i=="function"&&(l=i.call(t,l,l)),o.items.push(jg(l,null,r));return o}}To.tag="tag:yaml.org,2002:set";const Jg={collection:"map",identify:n=>n instanceof Set,nodeClass:To,default:!1,tag:"tag:yaml.org,2002:set",createNode:(n,e,t)=>To.from(n,e,t),resolve(n,e){if(qo(n)){if(n.hasAllNullValues(!0))return Object.assign(new To,n);e("Set items must all have null values")}else e("Expected a mapping for this tag");return n}};function Wg(n,e){const t=n[0],r=t==="-"||t==="+"?n.substring(1):n,i=l=>e?BigInt(l):Number(l),o=r.replace(/_/g,"").split(":").reduce((l,f)=>l*i(60)+i(f),i(0));return t==="-"?i(-1)*o:o}function rA(n){let{value:e}=n,t=l=>l;if(typeof e=="bigint")t=l=>BigInt(l);else if(isNaN(e)||!isFinite(e))return Tr(n);let r="";e<0&&(r="-",e*=t(-1));const i=t(60),o=[e%i];return e<60?o.unshift(0):(e=(e-o[0])/i,o.unshift(e%i),e>=60&&(e=(e-o[0])/i,o.unshift(e))),r+o.map(l=>String(l).padStart(2,"0")).join(":").replace(/000000\d*$/,"")}const sA={identify:n=>typeof n=="bigint"||Number.isInteger(n),default:!0,tag:"tag:yaml.org,2002:int",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+$/,resolve:(n,e,{intAsBigInt:t})=>Wg(n,t),stringify:rA},iA={identify:n=>typeof n=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+\.[0-9_]*$/,resolve:n=>Wg(n,!1),stringify:rA},ed={identify:n=>n instanceof Date,default:!0,tag:"tag:yaml.org,2002:timestamp",test:RegExp("^([0-9]{4})-([0-9]{1,2})-([0-9]{1,2})(?:(?:t|T|[ \\t]+)([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2}(\\.[0-9]+)?)(?:[ \\t]*(Z|[-+][012]?[0-9](?::[0-9]{2})?))?)?$"),resolve(n){const e=n.match(ed.test);if(!e)throw new Error("!!timestamp expects a date, starting with yyyy-mm-dd");const[,t,r,i,o,l,f]=e.map(Number),h=e[7]?Number((e[7]+"00").substr(1,3)):0;let m=Date.UTC(t,r-1,i,o||0,l||0,f||0,h);const y=e[8];if(y&&y!=="Z"){let g=Wg(y,!1);Math.abs(g)<30&&(g*=60),m-=6e4*g}return new Date(m)},stringify:({value:n})=>n?.toISOString().replace(/(T00:00:00)?\.000Z$/,"")??""},a0=[Vo,Go,Wh,Yh,tA,nA,GR,ZR,JR,WR,qR,FR,VR,Fg,vs,Gg,Vg,Jg,sA,iA,ed],o0=new Map([["core",$R],["failsafe",[Vo,Go,Wh]],["json",HR],["yaml11",a0],["yaml-1.1",a0]]),c0={binary:Fg,bool:Hg,float:G1,floatExp:V1,floatNaN:F1,floatTime:iA,int:W1,intHex:Y1,intOct:J1,intTime:sA,map:Vo,merge:vs,null:Yh,omap:Gg,pairs:Vg,seq:Go,set:Jg,timestamp:ed},YR={"tag:yaml.org,2002:binary":Fg,"tag:yaml.org,2002:merge":vs,"tag:yaml.org,2002:omap":Gg,"tag:yaml.org,2002:pairs":Vg,"tag:yaml.org,2002:set":Jg,"tag:yaml.org,2002:timestamp":ed};function Zp(n,e,t){const r=o0.get(e);if(r&&!n)return t&&!r.includes(vs)?r.concat(vs):r.slice();let i=r;if(!i)if(Array.isArray(n))i=[];else{const o=Array.from(o0.keys()).filter(l=>l!=="yaml11").map(l=>JSON.stringify(l)).join(", ");throw new Error(`Unknown schema "${e}"; use one of ${o} or define customTags array`)}if(Array.isArray(n))for(const o of n)i=i.concat(o);else typeof n=="function"&&(i=n(i.slice()));return t&&(i=i.concat(vs)),i.reduce((o,l)=>{const f=typeof l=="string"?c0[l]:l;if(!f){const h=JSON.stringify(l),m=Object.keys(c0).map(y=>JSON.stringify(y)).join(", ");throw new Error(`Unknown custom tag ${h}; use one of ${m}`)}return o.includes(f)||o.push(f),o},[])}const QR=(n,e)=>n.key<e.key?-1:n.key>e.key?1:0;class td{constructor({compat:e,customTags:t,merge:r,resolveKnownTags:i,schema:o,sortMapEntries:l,toStringDefaults:f}){this.compat=Array.isArray(e)?Zp(e,"compat"):e?Zp(null,e):null,this.name=typeof o=="string"&&o||"core",this.knownTags=i?YR:{},this.tags=Zp(t,this.name,r),this.toStringOptions=f??null,Object.defineProperty(this,oi,{value:Vo}),Object.defineProperty(this,$r,{value:Wh}),Object.defineProperty(this,Ho,{value:Go}),this.sortMapEntries=typeof l=="function"?l:l===!0?QR:null}clone(){const e=Object.create(td.prototype,Object.getOwnPropertyDescriptors(this));return e.tags=this.tags.slice(),e}}function XR(n,e){const t=[];let r=e.directives===!0;if(e.directives!==!1&&n.directives){const h=n.directives.toString(n);h?(t.push(h),r=!0):n.directives.docStart&&(r=!0)}r&&t.push("---");const i=$1(n,e),{commentString:o}=i.options;if(n.commentBefore){t.length!==1&&t.unshift("");const h=o(n.commentBefore);t.unshift(ws(h,""))}let l=!1,f=null;if(n.contents){if(gt(n.contents)){if(n.contents.spaceBefore&&r&&t.push(""),n.contents.commentBefore){const y=o(n.contents.commentBefore);t.push(ws(y,""))}i.forceBlockIndent=!!n.comment,f=n.contents.comment}const h=f?void 0:()=>l=!0;let m=Do(n.contents,i,()=>f=null,h);f&&(m+=Wi(m,"",o(f))),(m[0]==="|"||m[0]===">")&&t[t.length-1]==="---"?t[t.length-1]=`--- ${m}`:t.push(m)}else t.push(Do(n.contents,i));if(n.directives?.docEnd)if(n.comment){const h=o(n.comment);h.includes(`
`)?(t.push("..."),t.push(ws(h,""))):t.push(`... ${h}`)}else t.push("...");else{let h=n.comment;h&&l&&(h=h.replace(/^\n+/,"")),h&&((!l||f)&&t[t.length-1]!==""&&t.push(""),t.push(ws(o(h),"")))}return t.join(`
`)+`
`}class Zo{constructor(e,t,r){this.commentBefore=null,this.comment=null,this.errors=[],this.warnings=[],Object.defineProperty(this,cr,{value:Fy});let i=null;typeof t=="function"||Array.isArray(t)?i=t:r===void 0&&t&&(r=t,t=void 0);const o=Object.assign({intAsBigInt:!1,keepSourceTokens:!1,logLevel:"warn",prettyErrors:!0,strict:!0,stringKeys:!1,uniqueKeys:!0,version:"1.2"},r);this.options=o;let{version:l}=o;r?._directives?(this.directives=r._directives.atDocument(),this.directives.yaml.explicit&&(l=this.directives.yaml.version)):this.directives=new mn({version:l}),this.setSchema(l,r),this.contents=e===void 0?null:this.createNode(e,i,r)}clone(){const e=Object.create(Zo.prototype,{[cr]:{value:Fy}});return e.commentBefore=this.commentBefore,e.comment=this.comment,e.errors=this.errors.slice(),e.warnings=this.warnings.slice(),e.options=Object.assign({},this.options),this.directives&&(e.directives=this.directives.clone()),e.schema=this.schema.clone(),e.contents=gt(this.contents)?this.contents.clone(e.schema):this.contents,this.range&&(e.range=this.range.slice()),e}add(e){so(this.contents)&&this.contents.add(e)}addIn(e,t){so(this.contents)&&this.contents.addIn(e,t)}createAlias(e,t){if(!e.anchor){const r=U1(this);e.anchor=!t||r.has(t)?z1(t||"a",r):t}return new Vh(e.anchor)}createNode(e,t,r){let i;if(typeof t=="function")e=t.call({"":e},"",e),i=t;else if(Array.isArray(t)){const k=x=>typeof x=="number"||x instanceof String||x instanceof Number,M=t.filter(k).map(String);M.length>0&&(t=t.concat(M)),i=t}else r===void 0&&t&&(r=t,t=void 0);const{aliasDuplicateObjects:o,anchorPrefix:l,flow:f,keepUndefined:h,onTagObj:m,tag:y}=r??{},{onAnchor:g,setAnchors:b,sourceObjects:E}=OR(this,l||"a"),_={aliasDuplicateObjects:o??!0,keepUndefined:h??!1,onAnchor:g,onTagObj:m,replacer:i,schema:this.schema,sourceObjects:E},S=xl(e,y,_);return f&&yt(S)&&(S.flow=!0),b(),S}createPair(e,t,r={}){const i=this.createNode(e,null,r),o=this.createNode(t,null,r);return new un(i,o)}delete(e){return so(this.contents)?this.contents.delete(e):!1}deleteIn(e){return Sl(e)?this.contents==null?!1:(this.contents=null,!0):so(this.contents)?this.contents.deleteIn(e):!1}get(e,t){return yt(this.contents)?this.contents.get(e,t):void 0}getIn(e,t){return Sl(e)?!t&&tt(this.contents)?this.contents.value:this.contents:yt(this.contents)?this.contents.getIn(e,t):void 0}has(e){return yt(this.contents)?this.contents.has(e):!1}hasIn(e){return Sl(e)?this.contents!==void 0:yt(this.contents)?this.contents.hasIn(e):!1}set(e,t){this.contents==null?this.contents=yh(this.schema,[e],t):so(this.contents)&&this.contents.set(e,t)}setIn(e,t){Sl(e)?this.contents=t:this.contents==null?this.contents=yh(this.schema,Array.from(e),t):so(this.contents)&&this.contents.setIn(e,t)}setSchema(e,t={}){typeof e=="number"&&(e=String(e));let r;switch(e){case"1.1":this.directives?this.directives.yaml.version="1.1":this.directives=new mn({version:"1.1"}),r={resolveKnownTags:!1,schema:"yaml-1.1"};break;case"1.2":case"next":this.directives?this.directives.yaml.version=e:this.directives=new mn({version:e}),r={resolveKnownTags:!0,schema:"core"};break;case null:this.directives&&delete this.directives,r=null;break;default:{const i=JSON.stringify(e);throw new Error(`Expected '1.1', '1.2' or null as first argument, but found: ${i}`)}}if(t.schema instanceof Object)this.schema=t.schema;else if(r)this.schema=new td(Object.assign(r,t));else throw new Error("With a null YAML version, the { schema: Schema } option is required")}toJS({json:e,jsonArg:t,mapAsMap:r,maxAliasCount:i,onAnchor:o,reviver:l}={}){const f={anchors:new Map,doc:this,keep:!e,mapAsMap:r===!0,mapKeyWarned:!1,maxAliasCount:typeof i=="number"?i:100},h=or(this.contents,t??"",f);if(typeof o=="function")for(const{count:m,res:y}of f.anchors.values())o(y,m);return typeof l=="function"?go(l,{"":h},"",h):h}toJSON(e,t){return this.toJS({json:!0,jsonArg:e,mapAsMap:!1,onAnchor:t})}toString(e={}){if(this.errors.length>0)throw new Error("Document with errors cannot be stringified");if("indent"in e&&(!Number.isInteger(e.indent)||Number(e.indent)<=0)){const t=JSON.stringify(e.indent);throw new Error(`"indent" option must be a positive integer, not ${t}`)}return XR(this,e)}}function so(n){if(yt(n))return!0;throw new Error("Expected a YAML collection as document contents")}class Yg extends Error{constructor(e,t,r,i){super(),this.name=e,this.code=r,this.message=i,this.pos=t}}class Qi extends Yg{constructor(e,t,r){super("YAMLParseError",e,t,r)}}class aA extends Yg{constructor(e,t,r){super("YAMLWarning",e,t,r)}}const wh=(n,e)=>t=>{if(t.pos[0]===-1)return;t.linePos=t.pos.map(f=>e.linePos(f));const{line:r,col:i}=t.linePos[0];t.message+=` at line ${r}, column ${i}`;let o=i-1,l=n.substring(e.lineStarts[r-1],e.lineStarts[r]).replace(/[\n\r]+$/,"");if(o>=60&&l.length>80){const f=Math.min(o-39,l.length-79);l=""+l.substring(f),o-=f-1}if(l.length>80&&(l=l.substring(0,79)+""),r>1&&/^ *$/.test(l.substring(0,o))){let f=n.substring(e.lineStarts[r-2],e.lineStarts[r-1]);f.length>80&&(f=f.substring(0,79)+`
`),l=f+l}if(/[^ ]/.test(l)){let f=1;const h=t.linePos[1];h?.line===r&&h.col>i&&(f=Math.max(1,Math.min(h.col-i,80-o)));const m=" ".repeat(o)+"^".repeat(f);t.message+=`:

${l}
${m}
`}};function xo(n,{flow:e,indicator:t,next:r,offset:i,onError:o,parentIndent:l,startOnNewline:f}){let h=!1,m=f,y=f,g="",b="",E=!1,_=!1,S=null,k=null,M=null,x=null,$=null,L=null,j=null;for(const H of n)switch(_&&(H.type!=="space"&&H.type!=="newline"&&H.type!=="comma"&&o(H.offset,"MISSING_CHAR","Tags and anchors must be separated from the next token by white space"),_=!1),S&&(m&&H.type!=="comment"&&H.type!=="newline"&&o(S,"TAB_AS_INDENT","Tabs are not allowed as indentation"),S=null),H.type){case"space":!e&&(t!=="doc-start"||r?.type!=="flow-collection")&&H.source.includes("	")&&(S=H),y=!0;break;case"comment":{y||o(H,"MISSING_CHAR","Comments must be separated from other tokens by white space characters");const ie=H.source.substring(1)||" ";g?g+=b+ie:g=ie,b="",m=!1;break}case"newline":m?g?g+=H.source:(!L||t!=="seq-item-ind")&&(h=!0):b+=H.source,m=!0,E=!0,(k||M)&&(x=H),y=!0;break;case"anchor":k&&o(H,"MULTIPLE_ANCHORS","A node can have at most one anchor"),H.source.endsWith(":")&&o(H.offset+H.source.length-1,"BAD_ALIAS","Anchor ending in : is ambiguous",!0),k=H,j??(j=H.offset),m=!1,y=!1,_=!0;break;case"tag":{M&&o(H,"MULTIPLE_TAGS","A node can have at most one tag"),M=H,j??(j=H.offset),m=!1,y=!1,_=!0;break}case t:(k||M)&&o(H,"BAD_PROP_ORDER",`Anchors and tags must be after the ${H.source} indicator`),L&&o(H,"UNEXPECTED_TOKEN",`Unexpected ${H.source} in ${e??"collection"}`),L=H,m=t==="seq-item-ind"||t==="explicit-key-ind",y=!1;break;case"comma":if(e){$&&o(H,"UNEXPECTED_TOKEN",`Unexpected , in ${e}`),$=H,m=!1,y=!1;break}default:o(H,"UNEXPECTED_TOKEN",`Unexpected ${H.type} token`),m=!1,y=!1}const W=n[n.length-1],G=W?W.offset+W.source.length:i;return _&&r&&r.type!=="space"&&r.type!=="newline"&&r.type!=="comma"&&(r.type!=="scalar"||r.source!=="")&&o(r.offset,"MISSING_CHAR","Tags and anchors must be separated from the next token by white space"),S&&(m&&S.indent<=l||r?.type==="block-map"||r?.type==="block-seq")&&o(S,"TAB_AS_INDENT","Tabs are not allowed as indentation"),{comma:$,found:L,spaceBefore:h,comment:g,hasNewline:E,anchor:k,tag:M,newlineAfterProp:x,end:G,start:j??G}}function Il(n){if(!n)return null;switch(n.type){case"alias":case"scalar":case"double-quoted-scalar":case"single-quoted-scalar":if(n.source.includes(`
`))return!0;if(n.end){for(const e of n.end)if(e.type==="newline")return!0}return!1;case"flow-collection":for(const e of n.items){for(const t of e.start)if(t.type==="newline")return!0;if(e.sep){for(const t of e.sep)if(t.type==="newline")return!0}if(Il(e.key)||Il(e.value))return!0}return!1;default:return!0}}function Jy(n,e,t){if(e?.type==="flow-collection"){const r=e.end[0];r.indent===n&&(r.source==="]"||r.source==="}")&&Il(e)&&t(r,"BAD_INDENT","Flow end indicator should be more indented than parent",!0)}}function oA(n,e,t){const{uniqueKeys:r}=n.options;if(r===!1)return!1;const i=typeof r=="function"?r:(o,l)=>o===l||tt(o)&&tt(l)&&o.value===l.value;return e.some(o=>i(o.key,t))}const l0="All mapping items must start at the same column";function eD({composeNode:n,composeEmptyNode:e},t,r,i,o){const l=o?.nodeClass??Kn,f=new l(t.schema);t.atRoot&&(t.atRoot=!1);let h=r.offset,m=null;for(const y of r.items){const{start:g,key:b,sep:E,value:_}=y,S=xo(g,{indicator:"explicit-key-ind",next:b??E?.[0],offset:h,onError:i,parentIndent:r.indent,startOnNewline:!0}),k=!S.found;if(k){if(b&&(b.type==="block-seq"?i(h,"BLOCK_AS_IMPLICIT_KEY","A block sequence may not be used as an implicit map key"):"indent"in b&&b.indent!==r.indent&&i(h,"BAD_INDENT",l0)),!S.anchor&&!S.tag&&!E){m=S.end,S.comment&&(f.comment?f.comment+=`
`+S.comment:f.comment=S.comment);continue}(S.newlineAfterProp||Il(b))&&i(b??g[g.length-1],"MULTILINE_IMPLICIT_KEY","Implicit keys need to be on a single line")}else S.found?.indent!==r.indent&&i(h,"BAD_INDENT",l0);t.atKey=!0;const M=S.end,x=b?n(t,b,S,i):e(t,M,g,null,S,i);t.schema.compat&&Jy(r.indent,b,i),t.atKey=!1,oA(t,f.items,x)&&i(M,"DUPLICATE_KEY","Map keys must be unique");const $=xo(E??[],{indicator:"map-value-ind",next:_,offset:x.range[2],onError:i,parentIndent:r.indent,startOnNewline:!b||b.type==="block-scalar"});if(h=$.end,$.found){k&&(_?.type==="block-map"&&!$.hasNewline&&i(h,"BLOCK_AS_IMPLICIT_KEY","Nested mappings are not allowed in compact mappings"),t.options.strict&&S.start<$.found.offset-1024&&i(x.range,"KEY_OVER_1024_CHARS","The : indicator must be at most 1024 chars after the start of an implicit block mapping key"));const L=_?n(t,_,$,i):e(t,h,E,null,$,i);t.schema.compat&&Jy(r.indent,_,i),h=L.range[2];const j=new un(x,L);t.options.keepSourceTokens&&(j.srcToken=y),f.items.push(j)}else{k&&i(x.range,"MISSING_CHAR","Implicit map keys need to be followed by map values"),$.comment&&(x.comment?x.comment+=`
`+$.comment:x.comment=$.comment);const L=new un(x);t.options.keepSourceTokens&&(L.srcToken=y),f.items.push(L)}}return m&&m<h&&i(m,"IMPOSSIBLE","Map comment with trailing content"),f.range=[r.offset,h,m??h],f}function tD({composeNode:n,composeEmptyNode:e},t,r,i,o){const l=o?.nodeClass??li,f=new l(t.schema);t.atRoot&&(t.atRoot=!1),t.atKey&&(t.atKey=!1);let h=r.offset,m=null;for(const{start:y,value:g}of r.items){const b=xo(y,{indicator:"seq-item-ind",next:g,offset:h,onError:i,parentIndent:r.indent,startOnNewline:!0});if(!b.found)if(b.anchor||b.tag||g)g?.type==="block-seq"?i(b.end,"BAD_INDENT","All sequence items must start at the same column"):i(h,"MISSING_CHAR","Sequence item without - indicator");else{m=b.end,b.comment&&(f.comment=b.comment);continue}const E=g?n(t,g,b,i):e(t,b.end,y,null,b,i);t.schema.compat&&Jy(r.indent,g,i),h=E.range[2],f.items.push(E)}return f.range=[r.offset,h,m??h],f}function Yl(n,e,t,r){let i="";if(n){let o=!1,l="";for(const f of n){const{source:h,type:m}=f;switch(m){case"space":o=!0;break;case"comment":{t&&!o&&r(f,"MISSING_CHAR","Comments must be separated from other tokens by white space characters");const y=h.substring(1)||" ";i?i+=l+y:i=y,l="";break}case"newline":i&&(l+=h),o=!0;break;default:r(f,"UNEXPECTED_TOKEN",`Unexpected ${m} at node end`)}e+=h.length}}return{comment:i,offset:e}}const Jp="Block collections are not allowed within flow collections",Wp=n=>n&&(n.type==="block-map"||n.type==="block-seq");function nD({composeNode:n,composeEmptyNode:e},t,r,i,o){const l=r.start.source==="{",f=l?"flow map":"flow sequence",h=o?.nodeClass??(l?Kn:li),m=new h(t.schema);m.flow=!0;const y=t.atRoot;y&&(t.atRoot=!1),t.atKey&&(t.atKey=!1);let g=r.offset+r.start.source.length;for(let k=0;k<r.items.length;++k){const M=r.items[k],{start:x,key:$,sep:L,value:j}=M,W=xo(x,{flow:f,indicator:"explicit-key-ind",next:$??L?.[0],offset:g,onError:i,parentIndent:r.indent,startOnNewline:!1});if(!W.found){if(!W.anchor&&!W.tag&&!L&&!j){k===0&&W.comma?i(W.comma,"UNEXPECTED_TOKEN",`Unexpected , in ${f}`):k<r.items.length-1&&i(W.start,"UNEXPECTED_TOKEN",`Unexpected empty item in ${f}`),W.comment&&(m.comment?m.comment+=`
`+W.comment:m.comment=W.comment),g=W.end;continue}!l&&t.options.strict&&Il($)&&i($,"MULTILINE_IMPLICIT_KEY","Implicit keys of flow sequence pairs need to be on a single line")}if(k===0)W.comma&&i(W.comma,"UNEXPECTED_TOKEN",`Unexpected , in ${f}`);else if(W.comma||i(W.start,"MISSING_CHAR",`Missing , between ${f} items`),W.comment){let G="";e:for(const H of x)switch(H.type){case"comma":case"space":break;case"comment":G=H.source.substring(1);break e;default:break e}if(G){let H=m.items[m.items.length-1];dt(H)&&(H=H.value??H.key),H.comment?H.comment+=`
`+G:H.comment=G,W.comment=W.comment.substring(G.length+1)}}if(!l&&!L&&!W.found){const G=j?n(t,j,W,i):e(t,W.end,L,null,W,i);m.items.push(G),g=G.range[2],Wp(j)&&i(G.range,"BLOCK_IN_FLOW",Jp)}else{t.atKey=!0;const G=W.end,H=$?n(t,$,W,i):e(t,G,x,null,W,i);Wp($)&&i(H.range,"BLOCK_IN_FLOW",Jp),t.atKey=!1;const ie=xo(L??[],{flow:f,indicator:"map-value-ind",next:j,offset:H.range[2],onError:i,parentIndent:r.indent,startOnNewline:!1});if(ie.found){if(!l&&!W.found&&t.options.strict){if(L)for(const Ee of L){if(Ee===ie.found)break;if(Ee.type==="newline"){i(Ee,"MULTILINE_IMPLICIT_KEY","Implicit keys of flow sequence pairs need to be on a single line");break}}W.start<ie.found.offset-1024&&i(ie.found,"KEY_OVER_1024_CHARS","The : indicator must be at most 1024 chars after the start of an implicit flow sequence key")}}else j&&("source"in j&&j.source?.[0]===":"?i(j,"MISSING_CHAR",`Missing space after : in ${f}`):i(ie.start,"MISSING_CHAR",`Missing , or : between ${f} items`));const de=j?n(t,j,ie,i):ie.found?e(t,ie.end,L,null,ie,i):null;de?Wp(j)&&i(de.range,"BLOCK_IN_FLOW",Jp):ie.comment&&(H.comment?H.comment+=`
`+ie.comment:H.comment=ie.comment);const be=new un(H,de);if(t.options.keepSourceTokens&&(be.srcToken=M),l){const Ee=m;oA(t,Ee.items,H)&&i(G,"DUPLICATE_KEY","Map keys must be unique"),Ee.items.push(be)}else{const Ee=new Kn(t.schema);Ee.flow=!0,Ee.items.push(be);const Pt=(de??H).range;Ee.range=[H.range[0],Pt[1],Pt[2]],m.items.push(Ee)}g=de?de.range[2]:ie.end}}const b=l?"}":"]",[E,..._]=r.end;let S=g;if(E?.source===b)S=E.offset+E.source.length;else{const k=f[0].toUpperCase()+f.substring(1),M=y?`${k} must end with a ${b}`:`${k} in block collection must be sufficiently indented and end with a ${b}`;i(g,y?"MISSING_CHAR":"BAD_INDENT",M),E&&E.source.length!==1&&_.unshift(E)}if(_.length>0){const k=Yl(_,S,t.options.strict,i);k.comment&&(m.comment?m.comment+=`
`+k.comment:m.comment=k.comment),m.range=[r.offset,S,k.offset]}else m.range=[r.offset,S,S];return m}function Yp(n,e,t,r,i,o){const l=t.type==="block-map"?eD(n,e,t,r,o):t.type==="block-seq"?tD(n,e,t,r,o):nD(n,e,t,r,o),f=l.constructor;return i==="!"||i===f.tagName?(l.tag=f.tagName,l):(i&&(l.tag=i),l)}function rD(n,e,t,r,i){const o=r.tag,l=o?e.directives.tagName(o.source,b=>i(o,"TAG_RESOLVE_FAILED",b)):null;if(t.type==="block-seq"){const{anchor:b,newlineAfterProp:E}=r,_=b&&o?b.offset>o.offset?b:o:b??o;_&&(!E||E.offset<_.offset)&&i(_,"MISSING_CHAR","Missing newline after block sequence props")}const f=t.type==="block-map"?"map":t.type==="block-seq"?"seq":t.start.source==="{"?"map":"seq";if(!o||!l||l==="!"||l===Kn.tagName&&f==="map"||l===li.tagName&&f==="seq")return Yp(n,e,t,i,l);let h=e.schema.tags.find(b=>b.tag===l&&b.collection===f);if(!h){const b=e.schema.knownTags[l];if(b?.collection===f)e.schema.tags.push(Object.assign({},b,{default:!1})),h=b;else return b?i(o,"BAD_COLLECTION_TYPE",`${b.tag} used for ${f} collection, but expects ${b.collection??"scalar"}`,!0):i(o,"TAG_RESOLVE_FAILED",`Unresolved tag: ${l}`,!0),Yp(n,e,t,i,l)}const m=Yp(n,e,t,i,l,h),y=h.resolve?.(m,b=>i(o,"TAG_RESOLVE_FAILED",b),e.options)??m,g=gt(y)?y:new Se(y);return g.range=m.range,g.tag=l,h?.format&&(g.format=h.format),g}function cA(n,e,t){const r=e.offset,i=sD(e,n.options.strict,t);if(!i)return{value:"",type:null,comment:"",range:[r,r,r]};const o=i.mode===">"?Se.BLOCK_FOLDED:Se.BLOCK_LITERAL,l=e.source?iD(e.source):[];let f=l.length;for(let S=l.length-1;S>=0;--S){const k=l[S][1];if(k===""||k==="\r")f=S;else break}if(f===0){const S=i.chomp==="+"&&l.length>0?`
`.repeat(Math.max(1,l.length-1)):"";let k=r+i.length;return e.source&&(k+=e.source.length),{value:S,type:o,comment:i.comment,range:[r,k,k]}}let h=e.indent+i.indent,m=e.offset+i.length,y=0;for(let S=0;S<f;++S){const[k,M]=l[S];if(M===""||M==="\r")i.indent===0&&k.length>h&&(h=k.length);else{k.length<h&&t(m+k.length,"MISSING_CHAR","Block scalars with more-indented leading empty lines must use an explicit indentation indicator"),i.indent===0&&(h=k.length),y=S,h===0&&!n.atRoot&&t(m,"BAD_INDENT","Block scalar values in collections must be indented");break}m+=k.length+M.length+1}for(let S=l.length-1;S>=f;--S)l[S][0].length>h&&(f=S+1);let g="",b="",E=!1;for(let S=0;S<y;++S)g+=l[S][0].slice(h)+`
`;for(let S=y;S<f;++S){let[k,M]=l[S];m+=k.length+M.length+1;const x=M[M.length-1]==="\r";if(x&&(M=M.slice(0,-1)),M&&k.length<h){const L=`Block scalar lines must not be less indented than their ${i.indent?"explicit indentation indicator":"first line"}`;t(m-M.length-(x?2:1),"BAD_INDENT",L),k=""}o===Se.BLOCK_LITERAL?(g+=b+k.slice(h)+M,b=`
`):k.length>h||M[0]==="	"?(b===" "?b=`
`:!E&&b===`
`&&(b=`

`),g+=b+k.slice(h)+M,b=`
`,E=!0):M===""?b===`
`?g+=`
`:b=`
`:(g+=b+M,b=" ",E=!1)}switch(i.chomp){case"-":break;case"+":for(let S=f;S<l.length;++S)g+=`
`+l[S][0].slice(h);g[g.length-1]!==`
`&&(g+=`
`);break;default:g+=`
`}const _=r+i.length+e.source.length;return{value:g,type:o,comment:i.comment,range:[r,_,_]}}function sD({offset:n,props:e},t,r){if(e[0].type!=="block-scalar-header")return r(e[0],"IMPOSSIBLE","Block scalar header not found"),null;const{source:i}=e[0],o=i[0];let l=0,f="",h=-1;for(let b=1;b<i.length;++b){const E=i[b];if(!f&&(E==="-"||E==="+"))f=E;else{const _=Number(E);!l&&_?l=_:h===-1&&(h=n+b)}}h!==-1&&r(h,"UNEXPECTED_TOKEN",`Block scalar header includes extra characters: ${i}`);let m=!1,y="",g=i.length;for(let b=1;b<e.length;++b){const E=e[b];switch(E.type){case"space":m=!0;case"newline":g+=E.source.length;break;case"comment":t&&!m&&r(E,"MISSING_CHAR","Comments must be separated from other tokens by white space characters"),g+=E.source.length,y=E.source.substring(1);break;case"error":r(E,"UNEXPECTED_TOKEN",E.message),g+=E.source.length;break;default:{const _=`Unexpected token in block scalar header: ${E.type}`;r(E,"UNEXPECTED_TOKEN",_);const S=E.source;S&&typeof S=="string"&&(g+=S.length)}}}return{mode:o,indent:l,chomp:f,comment:y,length:g}}function iD(n){const e=n.split(/\n( *)/),t=e[0],r=t.match(/^( *)/),o=[r?.[1]?[r[1],t.slice(r[1].length)]:["",t]];for(let l=1;l<e.length;l+=2)o.push([e[l],e[l+1]]);return o}function lA(n,e,t){const{offset:r,type:i,source:o,end:l}=n;let f,h;const m=(b,E,_)=>t(r+b,E,_);switch(i){case"scalar":f=Se.PLAIN,h=aD(o,m);break;case"single-quoted-scalar":f=Se.QUOTE_SINGLE,h=oD(o,m);break;case"double-quoted-scalar":f=Se.QUOTE_DOUBLE,h=cD(o,m);break;default:return t(n,"UNEXPECTED_TOKEN",`Expected a flow scalar value, but found: ${i}`),{value:"",type:null,comment:"",range:[r,r+o.length,r+o.length]}}const y=r+o.length,g=Yl(l,y,e,t);return{value:h,type:f,comment:g.comment,range:[r,y,g.offset]}}function aD(n,e){let t="";switch(n[0]){case"	":t="a tab character";break;case",":t="flow indicator character ,";break;case"%":t="directive indicator character %";break;case"|":case">":{t=`block scalar indicator ${n[0]}`;break}case"@":case"`":{t=`reserved character ${n[0]}`;break}}return t&&e(0,"BAD_SCALAR_START",`Plain value cannot start with ${t}`),uA(n)}function oD(n,e){return(n[n.length-1]!=="'"||n.length===1)&&e(n.length,"MISSING_CHAR","Missing closing 'quote"),uA(n.slice(1,-1)).replace(/''/g,"'")}function uA(n){let e,t;try{e=new RegExp(`(.*?)(?<![ 	])[ 	]*\r?
`,"sy"),t=new RegExp(`[ 	]*(.*?)(?:(?<![ 	])[ 	]*)?\r?
`,"sy")}catch{e=/(.*?)[ \t]*\r?\n/sy,t=/[ \t]*(.*?)[ \t]*\r?\n/sy}let r=e.exec(n);if(!r)return n;let i=r[1],o=" ",l=e.lastIndex;for(t.lastIndex=l;r=t.exec(n);)r[1]===""?o===`
`?i+=o:o=`
`:(i+=o+r[1],o=" "),l=t.lastIndex;const f=/[ \t]*(.*)/sy;return f.lastIndex=l,r=f.exec(n),i+o+(r?.[1]??"")}function cD(n,e){let t="";for(let r=1;r<n.length-1;++r){const i=n[r];if(!(i==="\r"&&n[r+1]===`
`))if(i===`
`){const{fold:o,offset:l}=lD(n,r);t+=o,r=l}else if(i==="\\"){let o=n[++r];const l=uD[o];if(l)t+=l;else if(o===`
`)for(o=n[r+1];o===" "||o==="	";)o=n[++r+1];else if(o==="\r"&&n[r+1]===`
`)for(o=n[++r+1];o===" "||o==="	";)o=n[++r+1];else if(o==="x"||o==="u"||o==="U"){const f={x:2,u:4,U:8}[o];t+=fD(n,r+1,f,e),r+=f}else{const f=n.substr(r-1,2);e(r-1,"BAD_DQ_ESCAPE",`Invalid escape sequence ${f}`),t+=f}}else if(i===" "||i==="	"){const o=r;let l=n[r+1];for(;l===" "||l==="	";)l=n[++r+1];l!==`
`&&!(l==="\r"&&n[r+2]===`
`)&&(t+=r>o?n.slice(o,r+1):i)}else t+=i}return(n[n.length-1]!=='"'||n.length===1)&&e(n.length,"MISSING_CHAR",'Missing closing "quote'),t}function lD(n,e){let t="",r=n[e+1];for(;(r===" "||r==="	"||r===`
`||r==="\r")&&!(r==="\r"&&n[e+2]!==`
`);)r===`
`&&(t+=`
`),e+=1,r=n[e+1];return t||(t=" "),{fold:t,offset:e}}const uD={0:"\0",a:"\x07",b:"\b",e:"\x1B",f:"\f",n:`
`,r:"\r",t:"	",v:"\v",N:"",_:"",L:"\u2028",P:"\u2029"," ":" ",'"':'"',"/":"/","\\":"\\","	":"	"};function fD(n,e,t,r){const i=n.substr(e,t),l=i.length===t&&/^[0-9a-fA-F]+$/.test(i)?parseInt(i,16):NaN;if(isNaN(l)){const f=n.substr(e-2,t+2);return r(e-2,"BAD_DQ_ESCAPE",`Invalid escape sequence ${f}`),f}return String.fromCodePoint(l)}function fA(n,e,t,r){const{value:i,type:o,comment:l,range:f}=e.type==="block-scalar"?cA(n,e,r):lA(e,n.options.strict,r),h=t?n.directives.tagName(t.source,g=>r(t,"TAG_RESOLVE_FAILED",g)):null;let m;n.options.stringKeys&&n.atKey?m=n.schema[$r]:h?m=hD(n.schema,i,h,t,r):e.type==="scalar"?m=dD(n,i,e,r):m=n.schema[$r];let y;try{const g=m.resolve(i,b=>r(t??e,"TAG_RESOLVE_FAILED",b),n.options);y=tt(g)?g:new Se(g)}catch(g){const b=g instanceof Error?g.message:String(g);r(t??e,"TAG_RESOLVE_FAILED",b),y=new Se(i)}return y.range=f,y.source=i,o&&(y.type=o),h&&(y.tag=h),m.format&&(y.format=m.format),l&&(y.comment=l),y}function hD(n,e,t,r,i){if(t==="!")return n[$r];const o=[];for(const f of n.tags)if(!f.collection&&f.tag===t)if(f.default&&f.test)o.push(f);else return f;for(const f of o)if(f.test?.test(e))return f;const l=n.knownTags[t];return l&&!l.collection?(n.tags.push(Object.assign({},l,{default:!1,test:void 0})),l):(i(r,"TAG_RESOLVE_FAILED",`Unresolved tag: ${t}`,t!=="tag:yaml.org,2002:str"),n[$r])}function dD({atKey:n,directives:e,schema:t},r,i,o){const l=t.tags.find(f=>(f.default===!0||n&&f.default==="key")&&f.test?.test(r))||t[$r];if(t.compat){const f=t.compat.find(h=>h.default&&h.test?.test(r))??t[$r];if(l.tag!==f.tag){const h=e.tagString(l.tag),m=e.tagString(f.tag),y=`Value may be parsed as either ${h} or ${m}`;o(i,"TAG_RESOLVE_FAILED",y,!0)}}return l}function mD(n,e,t){if(e){t??(t=e.length);for(let r=t-1;r>=0;--r){let i=e[r];switch(i.type){case"space":case"comment":case"newline":n-=i.source.length;continue}for(i=e[++r];i?.type==="space";)n+=i.source.length,i=e[++r];break}}return n}const pD={composeNode:hA,composeEmptyNode:Qg};function hA(n,e,t,r){const i=n.atKey,{spaceBefore:o,comment:l,anchor:f,tag:h}=t;let m,y=!0;switch(e.type){case"alias":m=yD(n,e,r),(f||h)&&r(e,"ALIAS_PROPS","An alias node must not specify any properties");break;case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":case"block-scalar":m=fA(n,e,h,r),f&&(m.anchor=f.source.substring(1));break;case"block-map":case"block-seq":case"flow-collection":m=rD(pD,n,e,t,r),f&&(m.anchor=f.source.substring(1));break;default:{const g=e.type==="error"?e.message:`Unsupported token (type: ${e.type})`;r(e,"UNEXPECTED_TOKEN",g),m=Qg(n,e.offset,void 0,null,t,r),y=!1}}return f&&m.anchor===""&&r(f,"BAD_ALIAS","Anchor cannot be an empty string"),i&&n.options.stringKeys&&(!tt(m)||typeof m.value!="string"||m.tag&&m.tag!=="tag:yaml.org,2002:str")&&r(h??e,"NON_STRING_KEY","With stringKeys, all keys must be strings"),o&&(m.spaceBefore=!0),l&&(e.type==="scalar"&&e.source===""?m.comment=l:m.commentBefore=l),n.options.keepSourceTokens&&y&&(m.srcToken=e),m}function Qg(n,e,t,r,{spaceBefore:i,comment:o,anchor:l,tag:f,end:h},m){const y={type:"scalar",offset:mD(e,t,r),indent:-1,source:""},g=fA(n,y,f,m);return l&&(g.anchor=l.source.substring(1),g.anchor===""&&m(l,"BAD_ALIAS","Anchor cannot be an empty string")),i&&(g.spaceBefore=!0),o&&(g.comment=o,g.range[2]=h),g}function yD({options:n},{offset:e,source:t,end:r},i){const o=new Vh(t.substring(1));o.source===""&&i(e,"BAD_ALIAS","Alias cannot be an empty string"),o.source.endsWith(":")&&i(e+t.length-1,"BAD_ALIAS","Alias ending in : is ambiguous",!0);const l=e+t.length,f=Yl(r,l,n.strict,i);return o.range=[e,l,f.offset],f.comment&&(o.comment=f.comment),o}function gD(n,e,{offset:t,start:r,value:i,end:o},l){const f=Object.assign({_directives:e},n),h=new Zo(void 0,f),m={atKey:!1,atRoot:!0,directives:h.directives,options:h.options,schema:h.schema},y=xo(r,{indicator:"doc-start",next:i??o?.[0],offset:t,onError:l,parentIndent:0,startOnNewline:!0});y.found&&(h.directives.docStart=!0,i&&(i.type==="block-map"||i.type==="block-seq")&&!y.hasNewline&&l(y.end,"MISSING_CHAR","Block collection cannot start on same line with directives-end marker")),h.contents=i?hA(m,i,y,l):Qg(m,y.end,r,null,y,l);const g=h.contents.range[2],b=Yl(o,g,!1,l);return b.comment&&(h.comment=b.comment),h.range=[t,g,b.offset],h}function cl(n){if(typeof n=="number")return[n,n+1];if(Array.isArray(n))return n.length===2?n:[n[0],n[1]];const{offset:e,source:t}=n;return[e,e+(typeof t=="string"?t.length:1)]}function u0(n){let e="",t=!1,r=!1;for(let i=0;i<n.length;++i){const o=n[i];switch(o[0]){case"#":e+=(e===""?"":r?`

`:`
`)+(o.substring(1)||" "),t=!0,r=!1;break;case"%":n[i+1]?.[0]!=="#"&&(i+=1),t=!1;break;default:t||(r=!0),t=!1}}return{comment:e,afterEmptyLine:r}}class Xg{constructor(e={}){this.doc=null,this.atDirectives=!1,this.prelude=[],this.errors=[],this.warnings=[],this.onError=(t,r,i,o)=>{const l=cl(t);o?this.warnings.push(new aA(l,r,i)):this.errors.push(new Qi(l,r,i))},this.directives=new mn({version:e.version||"1.2"}),this.options=e}decorate(e,t){const{comment:r,afterEmptyLine:i}=u0(this.prelude);if(r){const o=e.contents;if(t)e.comment=e.comment?`${e.comment}
${r}`:r;else if(i||e.directives.docStart||!o)e.commentBefore=r;else if(yt(o)&&!o.flow&&o.items.length>0){let l=o.items[0];dt(l)&&(l=l.key);const f=l.commentBefore;l.commentBefore=f?`${r}
${f}`:r}else{const l=o.commentBefore;o.commentBefore=l?`${r}
${l}`:r}}t?(Array.prototype.push.apply(e.errors,this.errors),Array.prototype.push.apply(e.warnings,this.warnings)):(e.errors=this.errors,e.warnings=this.warnings),this.prelude=[],this.errors=[],this.warnings=[]}streamInfo(){return{comment:u0(this.prelude).comment,directives:this.directives,errors:this.errors,warnings:this.warnings}}*compose(e,t=!1,r=-1){for(const i of e)yield*this.next(i);yield*this.end(t,r)}*next(e){switch(e.type){case"directive":this.directives.add(e.source,(t,r,i)=>{const o=cl(e);o[0]+=t,this.onError(o,"BAD_DIRECTIVE",r,i)}),this.prelude.push(e.source),this.atDirectives=!0;break;case"document":{const t=gD(this.options,this.directives,e,this.onError);this.atDirectives&&!t.directives.docStart&&this.onError(e,"MISSING_CHAR","Missing directives-end/doc-start indicator line"),this.decorate(t,!1),this.doc&&(yield this.doc),this.doc=t,this.atDirectives=!1;break}case"byte-order-mark":case"space":break;case"comment":case"newline":this.prelude.push(e.source);break;case"error":{const t=e.source?`${e.message}: ${JSON.stringify(e.source)}`:e.message,r=new Qi(cl(e),"UNEXPECTED_TOKEN",t);this.atDirectives||!this.doc?this.errors.push(r):this.doc.errors.push(r);break}case"doc-end":{if(!this.doc){const r="Unexpected doc-end without preceding document";this.errors.push(new Qi(cl(e),"UNEXPECTED_TOKEN",r));break}this.doc.directives.docEnd=!0;const t=Yl(e.end,e.offset+e.source.length,this.doc.options.strict,this.onError);if(this.decorate(this.doc,!0),t.comment){const r=this.doc.comment;this.doc.comment=r?`${r}
${t.comment}`:t.comment}this.doc.range[2]=t.offset;break}default:this.errors.push(new Qi(cl(e),"UNEXPECTED_TOKEN",`Unsupported token ${e.type}`))}}*end(e=!1,t=-1){if(this.doc)this.decorate(this.doc,!0),yield this.doc,this.doc=null;else if(e){const r=Object.assign({_directives:this.directives},this.options),i=new Zo(void 0,r);this.atDirectives&&this.onError(t,"MISSING_CHAR","Missing directives-end indicator line"),i.range=[0,t,t],this.decorate(i,!1),yield i}}}function wD(n,e=!0,t){if(n){const r=(i,o,l)=>{const f=typeof i=="number"?i:Array.isArray(i)?i[0]:i.offset;if(t)t(f,o,l);else throw new Qi([f,f+1],o,l)};switch(n.type){case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return lA(n,e,r);case"block-scalar":return cA({options:{strict:e}},n,r)}}return null}function bD(n,e){const{implicitKey:t=!1,indent:r,inFlow:i=!1,offset:o=-1,type:l="PLAIN"}=e,f=Jl({type:l,value:n},{implicitKey:t,indent:r>0?" ".repeat(r):"",inFlow:i,options:{blockQuote:!0,lineWidth:-1}}),h=e.end??[{type:"newline",offset:-1,indent:r,source:`
`}];switch(f[0]){case"|":case">":{const m=f.indexOf(`
`),y=f.substring(0,m),g=f.substring(m+1)+`
`,b=[{type:"block-scalar-header",offset:o,indent:r,source:y}];return dA(b,h)||b.push({type:"newline",offset:-1,indent:r,source:`
`}),{type:"block-scalar",offset:o,indent:r,props:b,source:g}}case'"':return{type:"double-quoted-scalar",offset:o,indent:r,source:f,end:h};case"'":return{type:"single-quoted-scalar",offset:o,indent:r,source:f,end:h};default:return{type:"scalar",offset:o,indent:r,source:f,end:h}}}function vD(n,e,t={}){let{afterKey:r=!1,implicitKey:i=!1,inFlow:o=!1,type:l}=t,f="indent"in n?n.indent:null;if(r&&typeof f=="number"&&(f+=2),!l)switch(n.type){case"single-quoted-scalar":l="QUOTE_SINGLE";break;case"double-quoted-scalar":l="QUOTE_DOUBLE";break;case"block-scalar":{const m=n.props[0];if(m.type!=="block-scalar-header")throw new Error("Invalid block scalar header");l=m.source[0]===">"?"BLOCK_FOLDED":"BLOCK_LITERAL";break}default:l="PLAIN"}const h=Jl({type:l,value:e},{implicitKey:i||f===null,indent:f!==null&&f>0?" ".repeat(f):"",inFlow:o,options:{blockQuote:!0,lineWidth:-1}});switch(h[0]){case"|":case">":SD(n,h);break;case'"':Qp(n,h,"double-quoted-scalar");break;case"'":Qp(n,h,"single-quoted-scalar");break;default:Qp(n,h,"scalar")}}function SD(n,e){const t=e.indexOf(`
`),r=e.substring(0,t),i=e.substring(t+1)+`
`;if(n.type==="block-scalar"){const o=n.props[0];if(o.type!=="block-scalar-header")throw new Error("Invalid block scalar header");o.source=r,n.source=i}else{const{offset:o}=n,l="indent"in n?n.indent:-1,f=[{type:"block-scalar-header",offset:o,indent:l,source:r}];dA(f,"end"in n?n.end:void 0)||f.push({type:"newline",offset:-1,indent:l,source:`
`});for(const h of Object.keys(n))h!=="type"&&h!=="offset"&&delete n[h];Object.assign(n,{type:"block-scalar",indent:l,props:f,source:i})}}function dA(n,e){if(e)for(const t of e)switch(t.type){case"space":case"comment":n.push(t);break;case"newline":return n.push(t),!0}return!1}function Qp(n,e,t){switch(n.type){case"scalar":case"double-quoted-scalar":case"single-quoted-scalar":n.type=t,n.source=e;break;case"block-scalar":{const r=n.props.slice(1);let i=e.length;n.props[0].type==="block-scalar-header"&&(i-=n.props[0].source.length);for(const o of r)o.offset+=i;delete n.props,Object.assign(n,{type:t,source:e,end:r});break}case"block-map":case"block-seq":{const i={type:"newline",offset:n.offset+e.length,indent:n.indent,source:`
`};delete n.items,Object.assign(n,{type:t,source:e,end:[i]});break}default:{const r="indent"in n?n.indent:-1,i="end"in n&&Array.isArray(n.end)?n.end.filter(o=>o.type==="space"||o.type==="comment"||o.type==="newline"):[];for(const o of Object.keys(n))o!=="type"&&o!=="offset"&&delete n[o];Object.assign(n,{type:t,indent:r,source:e,end:i})}}}const ED=n=>"type"in n?bh(n):Xf(n);function bh(n){switch(n.type){case"block-scalar":{let e="";for(const t of n.props)e+=bh(t);return e+n.source}case"block-map":case"block-seq":{let e="";for(const t of n.items)e+=Xf(t);return e}case"flow-collection":{let e=n.start.source;for(const t of n.items)e+=Xf(t);for(const t of n.end)e+=t.source;return e}case"document":{let e=Xf(n);if(n.end)for(const t of n.end)e+=t.source;return e}default:{let e=n.source;if("end"in n&&n.end)for(const t of n.end)e+=t.source;return e}}}function Xf({start:n,key:e,sep:t,value:r}){let i="";for(const o of n)i+=o.source;if(e&&(i+=bh(e)),t)for(const o of t)i+=o.source;return r&&(i+=bh(r)),i}const Wy=Symbol("break visit"),_D=Symbol("skip children"),mA=Symbol("remove item");function ra(n,e){"type"in n&&n.type==="document"&&(n={start:n.start,value:n.value}),pA(Object.freeze([]),n,e)}ra.BREAK=Wy;ra.SKIP=_D;ra.REMOVE=mA;ra.itemAtPath=(n,e)=>{let t=n;for(const[r,i]of e){const o=t?.[r];if(o&&"items"in o)t=o.items[i];else return}return t};ra.parentCollection=(n,e)=>{const t=ra.itemAtPath(n,e.slice(0,-1)),r=e[e.length-1][0],i=t?.[r];if(i&&"items"in i)return i;throw new Error("Parent collection not found")};function pA(n,e,t){let r=t(e,n);if(typeof r=="symbol")return r;for(const i of["key","value"]){const o=e[i];if(o&&"items"in o){for(let l=0;l<o.items.length;++l){const f=pA(Object.freeze(n.concat([[i,l]])),o.items[l],t);if(typeof f=="number")l=f-1;else{if(f===Wy)return Wy;f===mA&&(o.items.splice(l,1),l-=1)}}typeof r=="function"&&i==="key"&&(r=r(e,n))}}return typeof r=="function"?r(e,n):r}const nd="\uFEFF",rd="",sd="",Ul="",AD=n=>!!n&&"items"in n,kD=n=>!!n&&(n.type==="scalar"||n.type==="single-quoted-scalar"||n.type==="double-quoted-scalar"||n.type==="block-scalar");function TD(n){switch(n){case nd:return"<BOM>";case rd:return"<DOC>";case sd:return"<FLOW_END>";case Ul:return"<SCALAR>";default:return JSON.stringify(n)}}function yA(n){switch(n){case nd:return"byte-order-mark";case rd:return"doc-mode";case sd:return"flow-error-end";case Ul:return"scalar";case"---":return"doc-start";case"...":return"doc-end";case"":case`
`:case`\r
`:return"newline";case"-":return"seq-item-ind";case"?":return"explicit-key-ind";case":":return"map-value-ind";case"{":return"flow-map-start";case"}":return"flow-map-end";case"[":return"flow-seq-start";case"]":return"flow-seq-end";case",":return"comma"}switch(n[0]){case" ":case"	":return"space";case"#":return"comment";case"%":return"directive-line";case"*":return"alias";case"&":return"anchor";case"!":return"tag";case"'":return"single-quoted-scalar";case'"':return"double-quoted-scalar";case"|":case">":return"block-scalar-header"}return null}const OD=Object.freeze(Object.defineProperty({__proto__:null,BOM:nd,DOCUMENT:rd,FLOW_END:sd,SCALAR:Ul,createScalarToken:bD,isCollection:AD,isScalar:kD,prettyToken:TD,resolveAsScalar:wD,setScalarValue:vD,stringify:ED,tokenType:yA,visit:ra},Symbol.toStringTag,{value:"Module"}));function gr(n){switch(n){case void 0:case" ":case`
`:case"\r":case"	":return!0;default:return!1}}const f0=new Set("0123456789ABCDEFabcdef"),CD=new Set("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-#;/?:@&=+$_.!~*'()"),xf=new Set(",[]{}"),MD=new Set(` ,[]{}
\r	`),Xp=n=>!n||MD.has(n);class gA{constructor(){this.atEnd=!1,this.blockScalarIndent=-1,this.blockScalarKeep=!1,this.buffer="",this.flowKey=!1,this.flowLevel=0,this.indentNext=0,this.indentValue=0,this.lineEndPos=null,this.next=null,this.pos=0}*lex(e,t=!1){if(e){if(typeof e!="string")throw TypeError("source is not a string");this.buffer=this.buffer?this.buffer+e:e,this.lineEndPos=null}this.atEnd=!t;let r=this.next??"stream";for(;r&&(t||this.hasChars(1));)r=yield*this.parseNext(r)}atLineEnd(){let e=this.pos,t=this.buffer[e];for(;t===" "||t==="	";)t=this.buffer[++e];return!t||t==="#"||t===`
`?!0:t==="\r"?this.buffer[e+1]===`
`:!1}charAt(e){return this.buffer[this.pos+e]}continueScalar(e){let t=this.buffer[e];if(this.indentNext>0){let r=0;for(;t===" ";)t=this.buffer[++r+e];if(t==="\r"){const i=this.buffer[r+e+1];if(i===`
`||!i&&!this.atEnd)return e+r+1}return t===`
`||r>=this.indentNext||!t&&!this.atEnd?e+r:-1}if(t==="-"||t==="."){const r=this.buffer.substr(e,3);if((r==="---"||r==="...")&&gr(this.buffer[e+3]))return-1}return e}getLine(){let e=this.lineEndPos;return(typeof e!="number"||e!==-1&&e<this.pos)&&(e=this.buffer.indexOf(`
`,this.pos),this.lineEndPos=e),e===-1?this.atEnd?this.buffer.substring(this.pos):null:(this.buffer[e-1]==="\r"&&(e-=1),this.buffer.substring(this.pos,e))}hasChars(e){return this.pos+e<=this.buffer.length}setNext(e){return this.buffer=this.buffer.substring(this.pos),this.pos=0,this.lineEndPos=null,this.next=e,null}peek(e){return this.buffer.substr(this.pos,e)}*parseNext(e){switch(e){case"stream":return yield*this.parseStream();case"line-start":return yield*this.parseLineStart();case"block-start":return yield*this.parseBlockStart();case"doc":return yield*this.parseDocument();case"flow":return yield*this.parseFlowCollection();case"quoted-scalar":return yield*this.parseQuotedScalar();case"block-scalar":return yield*this.parseBlockScalar();case"plain-scalar":return yield*this.parsePlainScalar()}}*parseStream(){let e=this.getLine();if(e===null)return this.setNext("stream");if(e[0]===nd&&(yield*this.pushCount(1),e=e.substring(1)),e[0]==="%"){let t=e.length,r=e.indexOf("#");for(;r!==-1;){const o=e[r-1];if(o===" "||o==="	"){t=r-1;break}else r=e.indexOf("#",r+1)}for(;;){const o=e[t-1];if(o===" "||o==="	")t-=1;else break}const i=(yield*this.pushCount(t))+(yield*this.pushSpaces(!0));return yield*this.pushCount(e.length-i),this.pushNewline(),"stream"}if(this.atLineEnd()){const t=yield*this.pushSpaces(!0);return yield*this.pushCount(e.length-t),yield*this.pushNewline(),"stream"}return yield rd,yield*this.parseLineStart()}*parseLineStart(){const e=this.charAt(0);if(!e&&!this.atEnd)return this.setNext("line-start");if(e==="-"||e==="."){if(!this.atEnd&&!this.hasChars(4))return this.setNext("line-start");const t=this.peek(3);if((t==="---"||t==="...")&&gr(this.charAt(3)))return yield*this.pushCount(3),this.indentValue=0,this.indentNext=0,t==="---"?"doc":"stream"}return this.indentValue=yield*this.pushSpaces(!1),this.indentNext>this.indentValue&&!gr(this.charAt(1))&&(this.indentNext=this.indentValue),yield*this.parseBlockStart()}*parseBlockStart(){const[e,t]=this.peek(2);if(!t&&!this.atEnd)return this.setNext("block-start");if((e==="-"||e==="?"||e===":")&&gr(t)){const r=(yield*this.pushCount(1))+(yield*this.pushSpaces(!0));return this.indentNext=this.indentValue+1,this.indentValue+=r,yield*this.parseBlockStart()}return"doc"}*parseDocument(){yield*this.pushSpaces(!0);const e=this.getLine();if(e===null)return this.setNext("doc");let t=yield*this.pushIndicators();switch(e[t]){case"#":yield*this.pushCount(e.length-t);case void 0:return yield*this.pushNewline(),yield*this.parseLineStart();case"{":case"[":return yield*this.pushCount(1),this.flowKey=!1,this.flowLevel=1,"flow";case"}":case"]":return yield*this.pushCount(1),"doc";case"*":return yield*this.pushUntil(Xp),"doc";case'"':case"'":return yield*this.parseQuotedScalar();case"|":case">":return t+=yield*this.parseBlockScalarHeader(),t+=yield*this.pushSpaces(!0),yield*this.pushCount(e.length-t),yield*this.pushNewline(),yield*this.parseBlockScalar();default:return yield*this.parsePlainScalar()}}*parseFlowCollection(){let e,t,r=-1;do e=yield*this.pushNewline(),e>0?(t=yield*this.pushSpaces(!1),this.indentValue=r=t):t=0,t+=yield*this.pushSpaces(!0);while(e+t>0);const i=this.getLine();if(i===null)return this.setNext("flow");if((r!==-1&&r<this.indentNext&&i[0]!=="#"||r===0&&(i.startsWith("---")||i.startsWith("..."))&&gr(i[3]))&&!(r===this.indentNext-1&&this.flowLevel===1&&(i[0]==="]"||i[0]==="}")))return this.flowLevel=0,yield sd,yield*this.parseLineStart();let o=0;for(;i[o]===",";)o+=yield*this.pushCount(1),o+=yield*this.pushSpaces(!0),this.flowKey=!1;switch(o+=yield*this.pushIndicators(),i[o]){case void 0:return"flow";case"#":return yield*this.pushCount(i.length-o),"flow";case"{":case"[":return yield*this.pushCount(1),this.flowKey=!1,this.flowLevel+=1,"flow";case"}":case"]":return yield*this.pushCount(1),this.flowKey=!0,this.flowLevel-=1,this.flowLevel?"flow":"doc";case"*":return yield*this.pushUntil(Xp),"flow";case'"':case"'":return this.flowKey=!0,yield*this.parseQuotedScalar();case":":{const l=this.charAt(1);if(this.flowKey||gr(l)||l===",")return this.flowKey=!1,yield*this.pushCount(1),yield*this.pushSpaces(!0),"flow"}default:return this.flowKey=!1,yield*this.parsePlainScalar()}}*parseQuotedScalar(){const e=this.charAt(0);let t=this.buffer.indexOf(e,this.pos+1);if(e==="'")for(;t!==-1&&this.buffer[t+1]==="'";)t=this.buffer.indexOf("'",t+2);else for(;t!==-1;){let o=0;for(;this.buffer[t-1-o]==="\\";)o+=1;if(o%2===0)break;t=this.buffer.indexOf('"',t+1)}const r=this.buffer.substring(0,t);let i=r.indexOf(`
`,this.pos);if(i!==-1){for(;i!==-1;){const o=this.continueScalar(i+1);if(o===-1)break;i=r.indexOf(`
`,o)}i!==-1&&(t=i-(r[i-1]==="\r"?2:1))}if(t===-1){if(!this.atEnd)return this.setNext("quoted-scalar");t=this.buffer.length}return yield*this.pushToIndex(t+1,!1),this.flowLevel?"flow":"doc"}*parseBlockScalarHeader(){this.blockScalarIndent=-1,this.blockScalarKeep=!1;let e=this.pos;for(;;){const t=this.buffer[++e];if(t==="+")this.blockScalarKeep=!0;else if(t>"0"&&t<="9")this.blockScalarIndent=Number(t)-1;else if(t!=="-")break}return yield*this.pushUntil(t=>gr(t)||t==="#")}*parseBlockScalar(){let e=this.pos-1,t=0,r;e:for(let o=this.pos;r=this.buffer[o];++o)switch(r){case" ":t+=1;break;case`
`:e=o,t=0;break;case"\r":{const l=this.buffer[o+1];if(!l&&!this.atEnd)return this.setNext("block-scalar");if(l===`
`)break}default:break e}if(!r&&!this.atEnd)return this.setNext("block-scalar");if(t>=this.indentNext){this.blockScalarIndent===-1?this.indentNext=t:this.indentNext=this.blockScalarIndent+(this.indentNext===0?1:this.indentNext);do{const o=this.continueScalar(e+1);if(o===-1)break;e=this.buffer.indexOf(`
`,o)}while(e!==-1);if(e===-1){if(!this.atEnd)return this.setNext("block-scalar");e=this.buffer.length}}let i=e+1;for(r=this.buffer[i];r===" ";)r=this.buffer[++i];if(r==="	"){for(;r==="	"||r===" "||r==="\r"||r===`
`;)r=this.buffer[++i];e=i-1}else if(!this.blockScalarKeep)do{let o=e-1,l=this.buffer[o];l==="\r"&&(l=this.buffer[--o]);const f=o;for(;l===" ";)l=this.buffer[--o];if(l===`
`&&o>=this.pos&&o+1+t>f)e=o;else break}while(!0);return yield Ul,yield*this.pushToIndex(e+1,!0),yield*this.parseLineStart()}*parsePlainScalar(){const e=this.flowLevel>0;let t=this.pos-1,r=this.pos-1,i;for(;i=this.buffer[++r];)if(i===":"){const o=this.buffer[r+1];if(gr(o)||e&&xf.has(o))break;t=r}else if(gr(i)){let o=this.buffer[r+1];if(i==="\r"&&(o===`
`?(r+=1,i=`
`,o=this.buffer[r+1]):t=r),o==="#"||e&&xf.has(o))break;if(i===`
`){const l=this.continueScalar(r+1);if(l===-1)break;r=Math.max(r,l-2)}}else{if(e&&xf.has(i))break;t=r}return!i&&!this.atEnd?this.setNext("plain-scalar"):(yield Ul,yield*this.pushToIndex(t+1,!0),e?"flow":"doc")}*pushCount(e){return e>0?(yield this.buffer.substr(this.pos,e),this.pos+=e,e):0}*pushToIndex(e,t){const r=this.buffer.slice(this.pos,e);return r?(yield r,this.pos+=r.length,r.length):(t&&(yield""),0)}*pushIndicators(){switch(this.charAt(0)){case"!":return(yield*this.pushTag())+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators());case"&":return(yield*this.pushUntil(Xp))+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators());case"-":case"?":case":":{const e=this.flowLevel>0,t=this.charAt(1);if(gr(t)||e&&xf.has(t))return e?this.flowKey&&(this.flowKey=!1):this.indentNext=this.indentValue+1,(yield*this.pushCount(1))+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators())}}return 0}*pushTag(){if(this.charAt(1)==="<"){let e=this.pos+2,t=this.buffer[e];for(;!gr(t)&&t!==">";)t=this.buffer[++e];return yield*this.pushToIndex(t===">"?e+1:e,!1)}else{let e=this.pos+1,t=this.buffer[e];for(;t;)if(CD.has(t))t=this.buffer[++e];else if(t==="%"&&f0.has(this.buffer[e+1])&&f0.has(this.buffer[e+2]))t=this.buffer[e+=3];else break;return yield*this.pushToIndex(e,!1)}}*pushNewline(){const e=this.buffer[this.pos];return e===`
`?yield*this.pushCount(1):e==="\r"&&this.charAt(1)===`
`?yield*this.pushCount(2):0}*pushSpaces(e){let t=this.pos-1,r;do r=this.buffer[++t];while(r===" "||e&&r==="	");const i=t-this.pos;return i>0&&(yield this.buffer.substr(this.pos,i),this.pos=t),i}*pushUntil(e){let t=this.pos,r=this.buffer[t];for(;!e(r);)r=this.buffer[++t];return yield*this.pushToIndex(t,!1)}}class wA{constructor(){this.lineStarts=[],this.addNewLine=e=>this.lineStarts.push(e),this.linePos=e=>{let t=0,r=this.lineStarts.length;for(;t<r;){const o=t+r>>1;this.lineStarts[o]<e?t=o+1:r=o}if(this.lineStarts[t]===e)return{line:t+1,col:1};if(t===0)return{line:0,col:e};const i=this.lineStarts[t-1];return{line:t,col:e-i+1}}}}function ti(n,e){for(let t=0;t<n.length;++t)if(n[t].type===e)return!0;return!1}function h0(n){for(let e=0;e<n.length;++e)switch(n[e].type){case"space":case"comment":case"newline":break;default:return e}return-1}function bA(n){switch(n?.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":case"flow-collection":return!0;default:return!1}}function If(n){switch(n.type){case"document":return n.start;case"block-map":{const e=n.items[n.items.length-1];return e.sep??e.start}case"block-seq":return n.items[n.items.length-1].start;default:return[]}}function io(n){if(n.length===0)return[];let e=n.length;e:for(;--e>=0;)switch(n[e].type){case"doc-start":case"explicit-key-ind":case"map-value-ind":case"seq-item-ind":case"newline":break e}for(;n[++e]?.type==="space";);return n.splice(e,n.length)}function d0(n){if(n.start.type==="flow-seq-start")for(const e of n.items)e.sep&&!e.value&&!ti(e.start,"explicit-key-ind")&&!ti(e.sep,"map-value-ind")&&(e.key&&(e.value=e.key),delete e.key,bA(e.value)?e.value.end?Array.prototype.push.apply(e.value.end,e.sep):e.value.end=e.sep:Array.prototype.push.apply(e.start,e.sep),delete e.sep)}class ew{constructor(e){this.atNewLine=!0,this.atScalar=!1,this.indent=0,this.offset=0,this.onKeyLine=!1,this.stack=[],this.source="",this.type="",this.lexer=new gA,this.onNewLine=e}*parse(e,t=!1){this.onNewLine&&this.offset===0&&this.onNewLine(0);for(const r of this.lexer.lex(e,t))yield*this.next(r);t||(yield*this.end())}*next(e){if(this.source=e,this.atScalar){this.atScalar=!1,yield*this.step(),this.offset+=e.length;return}const t=yA(e);if(t)if(t==="scalar")this.atNewLine=!1,this.atScalar=!0,this.type="scalar";else{switch(this.type=t,yield*this.step(),t){case"newline":this.atNewLine=!0,this.indent=0,this.onNewLine&&this.onNewLine(this.offset+e.length);break;case"space":this.atNewLine&&e[0]===" "&&(this.indent+=e.length);break;case"explicit-key-ind":case"map-value-ind":case"seq-item-ind":this.atNewLine&&(this.indent+=e.length);break;case"doc-mode":case"flow-error-end":return;default:this.atNewLine=!1}this.offset+=e.length}else{const r=`Not a YAML token: ${e}`;yield*this.pop({type:"error",offset:this.offset,message:r,source:e}),this.offset+=e.length}}*end(){for(;this.stack.length>0;)yield*this.pop()}get sourceToken(){return{type:this.type,offset:this.offset,indent:this.indent,source:this.source}}*step(){const e=this.peek(1);if(this.type==="doc-end"&&e?.type!=="doc-end"){for(;this.stack.length>0;)yield*this.pop();this.stack.push({type:"doc-end",offset:this.offset,source:this.source});return}if(!e)return yield*this.stream();switch(e.type){case"document":return yield*this.document(e);case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return yield*this.scalar(e);case"block-scalar":return yield*this.blockScalar(e);case"block-map":return yield*this.blockMap(e);case"block-seq":return yield*this.blockSequence(e);case"flow-collection":return yield*this.flowCollection(e);case"doc-end":return yield*this.documentEnd(e)}yield*this.pop()}peek(e){return this.stack[this.stack.length-e]}*pop(e){const t=e??this.stack.pop();if(!t)yield{type:"error",offset:this.offset,source:"",message:"Tried to pop an empty stack"};else if(this.stack.length===0)yield t;else{const r=this.peek(1);switch(t.type==="block-scalar"?t.indent="indent"in r?r.indent:0:t.type==="flow-collection"&&r.type==="document"&&(t.indent=0),t.type==="flow-collection"&&d0(t),r.type){case"document":r.value=t;break;case"block-scalar":r.props.push(t);break;case"block-map":{const i=r.items[r.items.length-1];if(i.value){r.items.push({start:[],key:t,sep:[]}),this.onKeyLine=!0;return}else if(i.sep)i.value=t;else{Object.assign(i,{key:t,sep:[]}),this.onKeyLine=!i.explicitKey;return}break}case"block-seq":{const i=r.items[r.items.length-1];i.value?r.items.push({start:[],value:t}):i.value=t;break}case"flow-collection":{const i=r.items[r.items.length-1];!i||i.value?r.items.push({start:[],key:t,sep:[]}):i.sep?i.value=t:Object.assign(i,{key:t,sep:[]});return}default:yield*this.pop(),yield*this.pop(t)}if((r.type==="document"||r.type==="block-map"||r.type==="block-seq")&&(t.type==="block-map"||t.type==="block-seq")){const i=t.items[t.items.length-1];i&&!i.sep&&!i.value&&i.start.length>0&&h0(i.start)===-1&&(t.indent===0||i.start.every(o=>o.type!=="comment"||o.indent<t.indent))&&(r.type==="document"?r.end=i.start:r.items.push({start:i.start}),t.items.splice(-1,1))}}}*stream(){switch(this.type){case"directive-line":yield{type:"directive",offset:this.offset,source:this.source};return;case"byte-order-mark":case"space":case"comment":case"newline":yield this.sourceToken;return;case"doc-mode":case"doc-start":{const e={type:"document",offset:this.offset,start:[]};this.type==="doc-start"&&e.start.push(this.sourceToken),this.stack.push(e);return}}yield{type:"error",offset:this.offset,message:`Unexpected ${this.type} token in YAML stream`,source:this.source}}*document(e){if(e.value)return yield*this.lineEnd(e);switch(this.type){case"doc-start":{h0(e.start)!==-1?(yield*this.pop(),yield*this.step()):e.start.push(this.sourceToken);return}case"anchor":case"tag":case"space":case"comment":case"newline":e.start.push(this.sourceToken);return}const t=this.startBlockValue(e);t?this.stack.push(t):yield{type:"error",offset:this.offset,message:`Unexpected ${this.type} token in YAML document`,source:this.source}}*scalar(e){if(this.type==="map-value-ind"){const t=If(this.peek(2)),r=io(t);let i;e.end?(i=e.end,i.push(this.sourceToken),delete e.end):i=[this.sourceToken];const o={type:"block-map",offset:e.offset,indent:e.indent,items:[{start:r,key:e,sep:i}]};this.onKeyLine=!0,this.stack[this.stack.length-1]=o}else yield*this.lineEnd(e)}*blockScalar(e){switch(this.type){case"space":case"comment":case"newline":e.props.push(this.sourceToken);return;case"scalar":if(e.source=this.source,this.atNewLine=!0,this.indent=0,this.onNewLine){let t=this.source.indexOf(`
`)+1;for(;t!==0;)this.onNewLine(this.offset+t),t=this.source.indexOf(`
`,t)+1}yield*this.pop();break;default:yield*this.pop(),yield*this.step()}}*blockMap(e){const t=e.items[e.items.length-1];switch(this.type){case"newline":if(this.onKeyLine=!1,t.value){const r="end"in t.value?t.value.end:void 0;(Array.isArray(r)?r[r.length-1]:void 0)?.type==="comment"?r?.push(this.sourceToken):e.items.push({start:[this.sourceToken]})}else t.sep?t.sep.push(this.sourceToken):t.start.push(this.sourceToken);return;case"space":case"comment":if(t.value)e.items.push({start:[this.sourceToken]});else if(t.sep)t.sep.push(this.sourceToken);else{if(this.atIndentedComment(t.start,e.indent)){const i=e.items[e.items.length-2]?.value?.end;if(Array.isArray(i)){Array.prototype.push.apply(i,t.start),i.push(this.sourceToken),e.items.pop();return}}t.start.push(this.sourceToken)}return}if(this.indent>=e.indent){const r=!this.onKeyLine&&this.indent===e.indent,i=r&&(t.sep||t.explicitKey)&&this.type!=="seq-item-ind";let o=[];if(i&&t.sep&&!t.value){const l=[];for(let f=0;f<t.sep.length;++f){const h=t.sep[f];switch(h.type){case"newline":l.push(f);break;case"space":break;case"comment":h.indent>e.indent&&(l.length=0);break;default:l.length=0}}l.length>=2&&(o=t.sep.splice(l[1]))}switch(this.type){case"anchor":case"tag":i||t.value?(o.push(this.sourceToken),e.items.push({start:o}),this.onKeyLine=!0):t.sep?t.sep.push(this.sourceToken):t.start.push(this.sourceToken);return;case"explicit-key-ind":!t.sep&&!t.explicitKey?(t.start.push(this.sourceToken),t.explicitKey=!0):i||t.value?(o.push(this.sourceToken),e.items.push({start:o,explicitKey:!0})):this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken],explicitKey:!0}]}),this.onKeyLine=!0;return;case"map-value-ind":if(t.explicitKey)if(t.sep)if(t.value)e.items.push({start:[],key:null,sep:[this.sourceToken]});else if(ti(t.sep,"map-value-ind"))this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:o,key:null,sep:[this.sourceToken]}]});else if(bA(t.key)&&!ti(t.sep,"newline")){const l=io(t.start),f=t.key,h=t.sep;h.push(this.sourceToken),delete t.key,delete t.sep,this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:l,key:f,sep:h}]})}else o.length>0?t.sep=t.sep.concat(o,this.sourceToken):t.sep.push(this.sourceToken);else if(ti(t.start,"newline"))Object.assign(t,{key:null,sep:[this.sourceToken]});else{const l=io(t.start);this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:l,key:null,sep:[this.sourceToken]}]})}else t.sep?t.value||i?e.items.push({start:o,key:null,sep:[this.sourceToken]}):ti(t.sep,"map-value-ind")?this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:[],key:null,sep:[this.sourceToken]}]}):t.sep.push(this.sourceToken):Object.assign(t,{key:null,sep:[this.sourceToken]});this.onKeyLine=!0;return;case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":{const l=this.flowScalar(this.type);i||t.value?(e.items.push({start:o,key:l,sep:[]}),this.onKeyLine=!0):t.sep?this.stack.push(l):(Object.assign(t,{key:l,sep:[]}),this.onKeyLine=!0);return}default:{const l=this.startBlockValue(e);if(l){if(l.type==="block-seq"){if(!t.explicitKey&&t.sep&&!ti(t.sep,"newline")){yield*this.pop({type:"error",offset:this.offset,message:"Unexpected block-seq-ind on same line with key",source:this.source});return}}else r&&e.items.push({start:o});this.stack.push(l);return}}}}yield*this.pop(),yield*this.step()}*blockSequence(e){const t=e.items[e.items.length-1];switch(this.type){case"newline":if(t.value){const r="end"in t.value?t.value.end:void 0;(Array.isArray(r)?r[r.length-1]:void 0)?.type==="comment"?r?.push(this.sourceToken):e.items.push({start:[this.sourceToken]})}else t.start.push(this.sourceToken);return;case"space":case"comment":if(t.value)e.items.push({start:[this.sourceToken]});else{if(this.atIndentedComment(t.start,e.indent)){const i=e.items[e.items.length-2]?.value?.end;if(Array.isArray(i)){Array.prototype.push.apply(i,t.start),i.push(this.sourceToken),e.items.pop();return}}t.start.push(this.sourceToken)}return;case"anchor":case"tag":if(t.value||this.indent<=e.indent)break;t.start.push(this.sourceToken);return;case"seq-item-ind":if(this.indent!==e.indent)break;t.value||ti(t.start,"seq-item-ind")?e.items.push({start:[this.sourceToken]}):t.start.push(this.sourceToken);return}if(this.indent>e.indent){const r=this.startBlockValue(e);if(r){this.stack.push(r);return}}yield*this.pop(),yield*this.step()}*flowCollection(e){const t=e.items[e.items.length-1];if(this.type==="flow-error-end"){let r;do yield*this.pop(),r=this.peek(1);while(r?.type==="flow-collection")}else if(e.end.length===0){switch(this.type){case"comma":case"explicit-key-ind":!t||t.sep?e.items.push({start:[this.sourceToken]}):t.start.push(this.sourceToken);return;case"map-value-ind":!t||t.value?e.items.push({start:[],key:null,sep:[this.sourceToken]}):t.sep?t.sep.push(this.sourceToken):Object.assign(t,{key:null,sep:[this.sourceToken]});return;case"space":case"comment":case"newline":case"anchor":case"tag":!t||t.value?e.items.push({start:[this.sourceToken]}):t.sep?t.sep.push(this.sourceToken):t.start.push(this.sourceToken);return;case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":{const i=this.flowScalar(this.type);!t||t.value?e.items.push({start:[],key:i,sep:[]}):t.sep?this.stack.push(i):Object.assign(t,{key:i,sep:[]});return}case"flow-map-end":case"flow-seq-end":e.end.push(this.sourceToken);return}const r=this.startBlockValue(e);r?this.stack.push(r):(yield*this.pop(),yield*this.step())}else{const r=this.peek(2);if(r.type==="block-map"&&(this.type==="map-value-ind"&&r.indent===e.indent||this.type==="newline"&&!r.items[r.items.length-1].sep))yield*this.pop(),yield*this.step();else if(this.type==="map-value-ind"&&r.type!=="flow-collection"){const i=If(r),o=io(i);d0(e);const l=e.end.splice(1,e.end.length);l.push(this.sourceToken);const f={type:"block-map",offset:e.offset,indent:e.indent,items:[{start:o,key:e,sep:l}]};this.onKeyLine=!0,this.stack[this.stack.length-1]=f}else yield*this.lineEnd(e)}}flowScalar(e){if(this.onNewLine){let t=this.source.indexOf(`
`)+1;for(;t!==0;)this.onNewLine(this.offset+t),t=this.source.indexOf(`
`,t)+1}return{type:e,offset:this.offset,indent:this.indent,source:this.source}}startBlockValue(e){switch(this.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return this.flowScalar(this.type);case"block-scalar-header":return{type:"block-scalar",offset:this.offset,indent:this.indent,props:[this.sourceToken],source:""};case"flow-map-start":case"flow-seq-start":return{type:"flow-collection",offset:this.offset,indent:this.indent,start:this.sourceToken,items:[],end:[]};case"seq-item-ind":return{type:"block-seq",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken]}]};case"explicit-key-ind":{this.onKeyLine=!0;const t=If(e),r=io(t);return r.push(this.sourceToken),{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:r,explicitKey:!0}]}}case"map-value-ind":{this.onKeyLine=!0;const t=If(e),r=io(t);return{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:r,key:null,sep:[this.sourceToken]}]}}}return null}atIndentedComment(e,t){return this.type!=="comment"||this.indent<=t?!1:e.every(r=>r.type==="newline"||r.type==="space")}*documentEnd(e){this.type!=="doc-mode"&&(e.end?e.end.push(this.sourceToken):e.end=[this.sourceToken],this.type==="newline"&&(yield*this.pop()))}*lineEnd(e){switch(this.type){case"comma":case"doc-start":case"doc-end":case"flow-seq-end":case"flow-map-end":case"map-value-ind":yield*this.pop(),yield*this.step();break;case"newline":this.onKeyLine=!1;default:e.end?e.end.push(this.sourceToken):e.end=[this.sourceToken],this.type==="newline"&&(yield*this.pop())}}}function vA(n){const e=n.prettyErrors!==!1;return{lineCounter:n.lineCounter||e&&new wA||null,prettyErrors:e}}function ND(n,e={}){const{lineCounter:t,prettyErrors:r}=vA(e),i=new ew(t?.addNewLine),o=new Xg(e),l=Array.from(o.compose(i.parse(n)));if(r&&t)for(const f of l)f.errors.forEach(wh(n,t)),f.warnings.forEach(wh(n,t));return l.length>0?l:Object.assign([],{empty:!0},o.streamInfo())}function SA(n,e={}){const{lineCounter:t,prettyErrors:r}=vA(e),i=new ew(t?.addNewLine),o=new Xg(e);let l=null;for(const f of o.compose(i.parse(n),!0,n.length))if(!l)l=f;else if(l.options.logLevel!=="silent"){l.errors.push(new Qi(f.range.slice(0,2),"MULTIPLE_DOCS","Source contains multiple documents; please use YAML.parseAllDocuments()"));break}return r&&t&&(l.errors.forEach(wh(n,t)),l.warnings.forEach(wh(n,t))),l}function RD(n,e,t){let r;typeof e=="function"?r=e:t===void 0&&e&&typeof e=="object"&&(t=e);const i=SA(n,t);if(!i)return null;if(i.warnings.forEach(o=>K1(i.options.logLevel,o)),i.errors.length>0){if(i.options.logLevel!=="silent")throw i.errors[0];i.errors=[]}return i.toJS(Object.assign({reviver:r},t))}function DD(n,e,t){let r=null;if(typeof e=="function"||Array.isArray(e)?r=e:t===void 0&&e&&(t=e),typeof t=="string"&&(t=t.length),typeof t=="number"){const i=Math.round(t);t=i<1?void 0:i>8?{indent:8}:{indent:i}}if(n===void 0){const{keepUndefined:i}=t??e??{};if(!i)return}return oa(n)&&!r?n.toString(t):new Zo(n,r,t).toString(t)}const xD=Object.freeze(Object.defineProperty({__proto__:null,Alias:Vh,CST:OD,Composer:Xg,Document:Zo,Lexer:gA,LineCounter:wA,Pair:un,Parser:ew,Scalar:Se,Schema:td,YAMLError:Yg,YAMLMap:Kn,YAMLParseError:Qi,YAMLSeq:li,YAMLWarning:aA,isAlias:wi,isCollection:yt,isDocument:oa,isMap:qo,isNode:gt,isPair:dt,isScalar:tt,isSeq:Fo,parse:RD,parseAllDocuments:ND,parseDocument:SA,stringify:DD,visit:ca,visitAsync:Fh},Symbol.toStringTag,{value:"Module"}));function la(n){const e=n;return e instanceof Promise||!!(e&&e!==null&&typeof e.then=="function"&&typeof e.catch=="function"&&typeof e.finally=="function")}function ID(n,e,t=0){const r=new Uint8Array(n.buffer,n.byteOffset,n.byteLength);let i="  ";t==0&&(t=r.length),t=Math.min(t,r.length);const o=16;for(let l=0;l<t;l+=o){l+o<=t||r.length==t||(l=r.length-r.length%o,t=r.length,i=">>");const f=[l.toString(16).padStart(4,"0"),i];for(let h=0;h<o;h++)l+h<t?f.push(r[l+h].toString(16).padStart(2,"0")):f.push("  "),f.push(" ");for(let h=0;h<o;h++)if(l+h<t){const m=r[l+h];f.push(m>=32&&m<127?String.fromCharCode(m):".")}e(f.join(""))}}function UD(n,e=0){const t=[];return ID(n,r=>{t.push(r)},e),t.join(`
`)}class On{#e;#t=()=>{throw new Error("This Promise is not working as expected.")};#n=()=>{throw new Error("This Promise is not working as expected.")};ctx;constructor(e){this.ctx=e,this.#e=new Promise((t,r)=>{this.#t=t,this.#n=r})}id=Or(()=>Math.random().toString(36).substring(2)+Date.now().toString(36));asPromise(){return this.#e}resolve(e){this.#t(e)}reject(e){this.#n(e)}}class A{static Ok(...e){return e.length>=1?new m0(e[0]):new m0(void 0)}static Err(e){return typeof e=="string"?new ey(new Error(e)):A.Is(e)?e.is_ok()?new ey(new Error("Result Error is Ok")):e:new ey(e)}static Is(e){if(!e)return!1;if(e instanceof A)return!0;const t=e;return!![typeof t.is_ok,typeof t.is_err,typeof t.unwrap,typeof t.unwrap_err].every(r=>r==="function")}static AsyncOk(...e){return Promise.resolve(A.Ok(...e))}static AsyncErr(e){return Promise.resolve(A.Err(e))}isOk(){return this.is_ok()}isErr(){return this.is_err()}Ok(){return this.unwrap()}Err(){return this.unwrap_err()}}class m0 extends A{_t;constructor(e){super(),this._t=e}is_ok(){return!0}is_err(){return!1}unwrap_err(){throw new Error("Result is Ok")}unwrap(){return this._t}}class ey extends A{_error;constructor(e){super(),this._error=e}is_ok(){return!1}is_err(){return!0}unwrap(){throw new Error(`Result is Err: ${this._error}`)}unwrap_err(){return this._error}}function Te(n){try{const e=n();return la(e)?e.then(t=>A.Is(t)?t:A.Ok(t)).catch(t=>A.Err(t)):A.Is(e)?e:A.Ok(e)}catch(e){return A.Err(e)}}class At{static Some(...e){return e.length>=1?new Uf(e[0]):new Uf(void 0)}static None(){return new ty}static Is(e){return e instanceof At}static From(...e){const t=e.length>=1?e[0]:void 0;switch(typeof t){case"undefined":return new ty;case"object":return t===null?new ty:new Uf(t);default:return new Uf(t)}}toValue(){return this.is_some()?this.unwrap():void 0}IsNone(){return this.is_none()}IsSome(){return this.is_some()}Unwrap(){return this.unwrap()}}class Uf extends At{_t;constructor(e){super(),this._t=e}is_none(){return!1}is_some(){return!0}unwrap(){return this._t}}class ty extends At{is_none(){return!0}is_some(){return!1}unwrap(){throw new Error("None.unwrap")}}class Yy{#e;constructor(e={}){this.#e=new tw(e)}setParam(e={}){this.#e.setParam(e)}get size(){return this.#e.size}has(e){return this.#e.has(e)}add(e){this.#e.set(e,e)}delete(e){this.#e.delete(e)}clear(){this.#e.clear()}forEach(e){this.#e.forEach(t=>e(t,t))}entries(){return this.#e.entries()}}function zD(n,e){if(n.maxEntries>0&&e.size>n.maxEntries){const t=[];let r=e.size;for(const i of e.keys())if(r>n.maxEntries)t.push(i),r--;else break;for(const i of t)e.delete(i)}}class tw{_map=new Map;param;stats={gets:0,puts:0,deletes:0};constructor(e={}){this.param={maxEntries:e.maxEntries||100,maxAge:e.maxAge||0,evict:e.evict||((t,r,i)=>t.maxEntries>0&&i.size>=t.maxEntries),refresh:e.refresh||((t,r)=>zD(t,r))}}_onSetFns=new Map;onSet(e){const t=Math.random().toString(36);return this._onSetFns.set(t,e),()=>{this._onSetFns.delete(t)}}_onDeleteFns=new Map;onDelete(e){const t=Math.random().toString(36);return this._onDeleteFns.set(t,e),()=>{this._onDeleteFns.delete(t)}}touch(e){if(!this._map.has(e))throw new Error(`key not found in cache: ${e}`);const t=this._map.get(e);return this._map.delete(e),this._map.set(e,t),t}setParam(e={}){e.evict&&(this.param.evict=e.evict),e.refresh&&(this.param.refresh=e.refresh),typeof e.maxEntries=="number"&&(this.param.maxEntries=e.maxEntries),typeof e.maxAge=="number"&&(this.param.maxAge=e.maxAge),this.param.refresh(this.param,this)}keys(){return this._map.keys()}has(e){return this._map.has(e)}get size(){return this._map.size}async getSet(e,t){const r=this.get(e);if(r)return r;{const i=await t(e);return this.set(e,i),i}}get(e){return this.getItem(e)?.value}getItem(e){if(this._map.has(e))return this.stats.gets++,this.touch(e)}buildItem(e,t){return{...e,value:t}}set(e,t){const r=this._map.has(e);let i=this._map.get(e);if(r){if(i?.value===t)return;this._map.delete(e)}if(i=this.buildItem(i,t),this.param.evict(this.param,t,this)){const o=this._map.keys().next();o.done||this._map.delete(o.value)}this._map.set(e,i),this.stats.puts++,this._onSetFns.forEach(o=>o(e,i?.value,this.buildItemCtx(i,r)))}buildItemCtx(e,t){return{update:t,ref:this,stats:this.stats,item:e}}delete(e){if(this._map.has(e)){const t=this._map.get(e);this._onDeleteFns.forEach(r=>r(e,t?.value,this.buildItemCtx(t,!0))),this._map.delete(e),this.stats.deletes++}}clear(){this._map.forEach((e,t)=>{const r=this.buildItemCtx(e,!0);this._onDeleteFns.forEach(i=>i(t,r.item.value,r)),this.stats.deletes++}),this._map.clear()}forEach(e){let t=0;this._map.forEach((r,i)=>{e(r.value,i,{...this.buildItemCtx(r,!1),idx:t++})})}*entries(){for(const[e,t]of this._map.entries())yield[e,t.value,this.buildItemCtx(t,!0)]}}function Qy(n,e,t=new Set){function r(){if(!t.has(n))return t.add(n),!0}switch(!0){case n==null:return e?.(n,"Null"),n;case n instanceof Date:return e?.(n,"Date"),n.toISOString();case typeof n=="symbol":return e?.(n,"Symbol"),n.toString();case n instanceof Uint8Array:return e?.(n,"Uint8Array"),n;case Array.isArray(n):return e?.(n,"Array"),r()&&n.map(i=>Qy(i,e,t));case typeof n=="function":e?.(n,"Function");return;case typeof n=="object":return r()&&Object.fromEntries(Object.entries(n).sort(([i],[o])=>i.localeCompare(o)).map(([i,o])=>(e?.(i,"Key"),[i,Qy(o,e,t)])));default:switch(typeof n){case"string":e?.(n,"String");break;case"boolean":e?.(n,"Boolean");break;case"bigint":case"number":e?.(n,"Number");break}return n}}function EA(n,e){return Qy(n,e,new Set)}function zl(n,e){return n?Object.entries(EA(n,e)):[]}function Xy(n,e){return n&&Object.fromEntries(zl(n,e))}class LD{opts;#e;constructor(e){this.opts={...e,key2string:e.key2string??(t=>typeof t=="string"?t:typeof t=="number"?t.toString():typeof t=="boolean"?t?"true":"false":JSON.stringify(Xy(t))),ctx:e.ctx??{},resetAfter:e.resetAfter??0},this.#e=new tw(e.lru)}onSet(e){return this.#e.onSet((t,r)=>{e(r)})}onDelete(e){return this.#e.onDelete((t,r)=>{e(r)})}setParam(e){this.#e.setParam(e.lru)}asyncGet(e){return e().then(t=>this.get(t))}has(e){return typeof e=="function"&&(e=e()),this.#e.has(this.opts.key2string(e))}delete(e){this.#e.delete(this.opts.key2string(e))}keys(){return Array.from(this.#e.entries()).map(([e,t])=>t.givenKey)}forEach(e){return this.#e.forEach((t,r,i)=>{e(t,i.idx)})}entries(){let e=0;return Array.from(this.#e.entries()).map(([t,r])=>[r,e++])}getItem(e,t){const r=this.opts.key2string(e);let i=this.#e.get(r);return i||(i={refKey:r,givenKey:e,ctx:t??this.opts.ctx,value:void 0},i.value=this.opts.createValue(i),this.#e.set(r,i)),i}get(e,t){return typeof e=="function"&&(e=e()),this.getItem(e,t).value}values(){return Array.from(this.#e.entries()).map(([e,t])=>t)}}function Vi(n,e=globalThis){const[t,...r]=n.split(".");return["object","function"].includes(typeof e)&&e&&["object","function"].includes(typeof e[t])&&e[t]?r.length<=1?!0:Vi(r.join("."),e[t]):!1}function jn(){const n=globalThis;let e=Vi("navigator.product")&&typeof n.navigator=="object"&&n.navigator.product==="ReactNative",t=!1;Vi("Deno")||(t=Vi("process.versions.node")&&!e);let r=Vi("Deno");const i=Vi("caches.default")&&Vi("WebSocketPair");return i&&(r=!1,t=!1,e=!1),{isNodeIsh:t,isBrowser:!(t||r||i||e),isDeno:r,isReactNative:e,isCFWorker:i}}class BD{ctx;_seqFutures=[];constructor(e){this.ctx=e}reset(){}_flushWaiting=[];flush(){if(this._seqFutures.length>0){const e=new On;return this._flushWaiting?.push(e),e.asPromise()}return Promise.resolve()}async _step(e){if(!e)return this._flushWaiting.forEach(r=>r.resolve()),this._flushWaiting?.splice(0,this._flushWaiting.length),Promise.resolve();let t;try{const r=e.fn(this.ctx??{});la(r)?t=await r:t=r,e.future.resolve(t)}catch(r){e.future.reject(r)}finally{this._seqFutures.shift()}return this._step(this._seqFutures[0])}add(e,t){const r=new On;return this._seqFutures.push({future:r,fn:e,id:t}),this._seqFutures.length===1&&this._step(this._seqFutures[0]),r.asPromise()}}class p0{#e;#t;queueLength=0;#n;#r;constructor(e,t){this.#n=t,this.#r=e}get value(){return this.#e}get error(){return this.#t}get ready(){return this.#n.isProcessed()}resolve(e){if(this.#n.isProcessing()){try{this.#e=e()}catch(t){this.#t=t}finally{this.#n.setProcessed(),this.#r.setProcessed(this.#n)}if(la(this.#e))throw new Error("SyncResolveOnce.once fn returned a promise")}if(this.#t)throw this.#t;return this.#e}}class PD{id=Math.random();#e;#t=At.None();#n;#r;#i;constructor(e,t,r){this.#e=e,this.#r=r,this.#i=t}get value(){return this.#t.IsSome()?this.#t.unwrap():void 0}get error(){return this.#n}#s=[];get queuelength(){return this.#s.length}isDisposable(){return this.#r.isProcessed()&&this.#s.length===0}#a(e){if(e){if(this.#n){e.reject(this.#n);return}this.#t.IsSome()&&e.resolve(this.#t.Unwrap())}}#o(){if(this.#n)return Promise.reject(this.#n);if(this.#t.IsSome())return Promise.resolve(this.#t.Unwrap());throw new Error(`AsyncResolveItem.#promiseResult impossible: ${this.#r.getResolveState()}`)}resolve(e){if(this.#r.isWaiting()){const t=new On;return this.#s.push(t),this.#e.then(r=>{this.#t=At.Some(r)}).catch(r=>{this.#n=r}).finally(()=>{for(this.#r.setProcessed(),this.#i.setProcessed(this.#r);this.#s.length>0;)this.#a(this.#s.shift())}),t.asPromise()}if(this.#r.isProcessed())return this.#o();throw new Error(`AsyncResolveItem.resolve impossible: ${this.#r.getResolveState()}`)}}function $D(n){return n.IsSome()&&n.Unwrap()instanceof _A}class _A{#e;#t;#n;constructor(e,t,r){this.#e=t,this.#n=e,$D(r)?this.#t=[...r.unwrap().#t]:this.#t=[]}#r(){const e=this.#t[this.#t.length-1];if(!e)throw new Error("AsyncResolveOnce.#active impossible");return e}get queueLength(){return this.#t.reduce((e,t)=>e+t.queuelength,this.#t.length)}get value(){if(!this.#e.isInitial())return this.#r().value}get error(){if(!this.#e.isInitial())return this.#r().error}resolve(e){if(this.#e.isProcessing()){this.#e.setWaiting();let t;try{const r=e();la(r)?t=r:t=Promise.resolve(r)}catch(r){t=Promise.reject(r)}this.#t.push(new PD(t,this.#n,this.#e))}return this.#t.slice(0,-1).map((t,r)=>t.isDisposable()?r:void 0).filter(t=>t!==void 0).reverse().forEach(t=>this.#t.splice(t,1)),this.#r().resolve(e)}}class y0{id=Math.random();#e="initial";getResolveState(){return this.#e}isInitial(){return this.#e==="initial"}isProcessed(){return this.#e==="processed"}setProcessed(){this.#e="processed"}isProcessing(){return this.#e==="processing"}setProcessing(){this.#e="processing"}isWaiting(){return this.#e==="waiting"}setWaiting(){this.#e="waiting"}equals(e){return this.id===e.id}}class on{#e=new y0;#t=At.None();#n;resetAfterTimer;_onceArg;constructor(e,t){this.#n={...t??{}},this._onceArg={ctx:e,self:this}}get state(){return this.#e.getResolveState()}setProcessed(e){if(this.resetAfterTimer&&clearTimeout(this.resetAfterTimer),this.#e.equals(e)&&(this.#e.setProcessed(),typeof this.#n.resetAfter=="number"&&this.#n.resetAfter>0&&(this.resetAfterTimer=setTimeout(()=>{this.reset()},this.#n.resetAfter),!this.#n.skipUnref&&this.resetAfterTimer))){const t=jn();switch(!0){case t.isDeno:{let r=this.resetAfterTimer;if(typeof Deno.unrefTimer=="function"){if(typeof this.resetAfterTimer=="number")r=this.resetAfterTimer;else try{const i=Reflect.ownKeys(this.resetAfterTimer).find(o=>o.toString().includes("timerId"));i&&(r=this.resetAfterTimer[i],console.warn("Deno.unrefTimer timerId from struct:",r,"version:",globalThis.Deno?.version))}catch(i){console.warn("Deno.unrefTimer failed to get timerId",i,"id:",this.resetAfterTimer,"version:",globalThis.Deno?.version)}Deno.unrefTimer(r)}}break;case t.isNodeIsh:this.resetAfterTimer.unref();break}}}get ready(){return!this.#e.isInitial()}get value(){if(!this.#e.isInitial())return this.#t.Unwrap().value}get queueLength(){return this.#e.isInitial()?0:this.#t.Unwrap().queueLength}get error(){if(!this.#e.isInitial())return this.#t.Unwrap().error}once(e){let t;if(this.#e.isInitial()){const r=this.#e;try{r.setProcessing();const i=e(this._onceArg);la(i)?this.#t=At.Some(new _A(this,r,this.#t)):this.#t=At.Some(new p0(this,r)),t=()=>i}catch(i){this.#t=At.Some(new p0(this,r)),t=()=>{throw i}}}else t=()=>e(this._onceArg);if(!this.#t)throw new Error(`ResolveOnce.once impossible: state=${this.#e.getResolveState()}`);return this.#t.Unwrap().resolve(t)}reset(e){if(this.#e.isInitial())return e?this.once(e):void 0;if(this.#e.isProcessing()){console.warn("ResolveOnce.reset dropped was called while processing");return}let t;return this.#e=new y0,e&&(t=this.once(e)),t}setResetAfter(e){this.resetAfterTimer&&clearTimeout(this.resetAfterTimer),typeof e=="number"&&e>0?this.#n.resetAfter=e:this.#n.resetAfter=void 0}}class Mt{_keyed;constructor(e={}){this._keyed=new LD({createValue:t=>new on({...t,ctx:e.ctx??t.ctx},{resetAfter:e.resetAfter}),key2string:e.key2string,ctx:e.ctx,lru:e.lru})}keys(){return this._keyed.keys()}values(){return this._keyed.values().filter(e=>e.value.ready).map(e=>({key:e.givenKey,value:e.value.error?A.Err(e.value.error):A.Ok(e.value.value),item:e}))}onSet(e){return this._keyed.onSet(t=>{e(t.givenKey,t.value)})}onDelete(e){return this._keyed.onDelete(t=>{e(t.givenKey,t.value)})}setParam(e){this._keyed.setParam({lru:e.lru})}asyncGet(e){return this._keyed.asyncGet(e)}get(e,t){return typeof e=="function"&&(e=e()),this._keyed.getItem(e,t).value}getItem(e,t){return this._keyed.getItem(e,t)}has(e){return this._keyed.has(e)}delete(e){this._keyed.delete(e)}unget(e){const t=this._keyed.getItem(e);return t.value.reset?.(),this._keyed.delete(t.givenKey)}reset(){for(const e of this._keyed.values())e.value.reset?.()}forEach(e){for(const[t,r]of this._keyed.entries()){const i=t.value,o=t.givenKey;i.ready&&(i.error?e({key:o,value:A.Err(i.error)},r):e({key:o,value:A.Ok(i.value)},r))}}*entries(){for(const[e]of this._keyed.entries()){const t=e.value,r=e.givenKey;t.ready&&(t.error?yield{key:r,value:A.Err(t.error)}:yield{key:r,value:A.Ok(t.value)})}}}class KD{resolveOnce;constructor(e){this.resolveOnce=new on(void 0,e)}call(e){return(...t)=>this.resolveOnce.once(()=>e(...t))}}function Or(n,e){return new KD(e).call(n)}const g0=globalThis;function AA(n){return n instanceof ArrayBuffer?A.Ok(new Uint8Array(n)):ArrayBuffer.isView(n)?A.Ok(new Uint8Array(n.buffer,n.byteOffset,n.byteLength)):n instanceof Blob?A.Err("Blob not supported"):g0.Buffer&&g0.Buffer.isBuffer(n)?A.Ok(new Uint8Array(n.buffer,n.byteOffset,n.byteLength)):n instanceof Uint8Array?A.Ok(n):A.Is(n)?n.isErr()?A.Err(n):AA(n.unwrap()):A.Err("Not a Uint8Array")}class jD{encoder=new TextEncoder;decoder=new TextDecoder;encode(e){return this.encoder.encode(e)}decode(e){if(!e)return"";if(A.Is(e)){if(e.isErr())throw e.Err();const t=e.unwrap();if(typeof t=="string")return this.decode(t)}return typeof e=="string"?e:this.decoder.decode(AA(e).Ok())}async asyncDecode(e){if(!e)return"";let t=await e;return t instanceof Blob&&(t=await t.arrayBuffer()),this.decode(t)}}const Ss=Or(()=>new jD),HD=new RegExp('^\\s*(?:\\{.*\\}|\\[.*\\]|"(?:[^"\\\\]|\\\\.)*"|true|false|null|-?\\d+(?:\\.\\d+)?(?:[eE][+-]?\\d+)?)\\s*$');function w0(n){if(HD.test(n))try{return{isJSON:!0,parsed:JSON.parse(n)}}catch{}return{isJSON:!1}}class qD{type="REQUIRED"}class FD{type="OPTIONAL"}const rn={REQUIRED:new qD,OPTIONAL:new FD},bs=new Set(["http","https","ws","wss"]),gs={WARN:"warn",DEBUG:"debug",INFO:"info",ERROR:"error"};class nn{fn;constructor(e){this.fn=e}value(){try{return this.fn()}catch(e){return`LogValue:${e.message}`}}toJSON(){return this.value()}}const kA=Symbol.for("nodejs.util.inspect.custom"),TA=/^([a-z][a-z0-9_-]*):\/\/[^:]*$/i;function*ui(n){const e=[];n.forEach((t,r)=>{e.push([r,t])});for(const[t,r]of e)yield[t,r]}class sa extends URL{_sysURL;_protocol;_pathname;_hasHostpart;static fromThrow=e=>new sa(e);static from(e){return TA.test(e)?Te(()=>new sa(e)):A.Err(`Invalid URL: ${e}`)}constructor(e){super("defect://does.not.exist");const t=e.split(":");this._hasHostpart=bs.has(t[0]);let r=["http",...t.slice(1)].join(":");if(!this._hasHostpart){const i=r.replace(/http:\/\/[/]*/,"").replace(/[#?].*$/,"");r=r.replace(/http:\/\//,`http://localhost/${i}`)}try{this._sysURL=new URL(r)}catch(i){const o=i;throw o.message=`${o.message} for URL: ${e}`,o}this._protocol=`${t[0]}:`,this._hasHostpart?this._pathname=this._sysURL.pathname:this._pathname=e.replace(new RegExp(`^${this._protocol}//`),"").replace(/[#?].*$/,"")}set origin(e){throw new Error("origin is readonly")}get href(){return this.toString()}set href(e){throw new Error("href is readonly")}get password(){return this._sysURL.password}set password(e){throw new Error("password is readonly")}get username(){return this._sysURL.username}set username(e){throw new Error("username is readonly")}toJSON(){return this.toString()}[kA](){return this.toString()}clone(){return this}get hash(){return this._sysURL.hash}set hash(e){throw new Error("hash is readonly")}get host(){if(!this._hasHostpart)throw new Error(`you can use hostname only if protocol is ${this.toString()} ${JSON.stringify(Array.from(bs.keys()))}`);return this._sysURL.host}set host(e){throw new Error("host is readonly")}get hostname(){if(!this._hasHostpart)throw new Error(`you can use hostname only if protocol is ${JSON.stringify(Array.from(bs.keys()))}`);return this._sysURL.hostname}set hostname(e){throw new Error("hostname is readonly")}get pathname(){return this._pathname}set pathname(e){throw new Error("pathname is readonly")}get port(){if(!this._hasHostpart)throw new Error(`you can use hostname only if protocol is ${JSON.stringify(Array.from(bs.keys()))}`);return this._sysURL.port}set port(e){throw new Error("port is readonly")}get protocol(){return this._protocol}set protocol(e){throw new Error("protocol is readonly")}get search(){let e="";if(this._sysURL.searchParams.size)for(const[t,r]of Array.from(ui(this._sysURL.searchParams)).sort((i,o)=>i[0].localeCompare(o[0])))e+=`${e.length?"&":"?"}${t}=${encodeURIComponent(r)}`;return e}set search(e){throw new Error("search is readonly")}get searchParams(){return this._sysURL.searchParams}set searchParams(e){throw new Error("searchParams is readonly")}toString(){const e=this.search;let t="";return this._hasHostpart&&(t=this._sysURL.hostname,this._sysURL.port&&(t+=`:${this._sysURL.port}`),this._pathname.startsWith("/")||(t+="/")),(this.username||this.password)&&(t=`${this.username}:${this.password}@${t}`),`${this._protocol}//${t}${this._pathname}${e}${this.hash}`}}class Oo extends sa{static fromThrow=e=>new Oo(e);static from(e){return TA.test(e)?Te(()=>new Oo(e)):A.Err(`Invalid URL: ${e}`)}constructor(e){super(e)}toJSON(){return this.toString()}[kA](){return this.toString()}clone(){return new Oo(this.toString())}set origin(e){throw new Error("don't use origin")}get href(){return super.href}set href(e){throw new Error("don't use href")}get password(){return super.password}set password(e){this._sysURL.password=e}get username(){return super.username}set username(e){this._sysURL.username=e}get hash(){return super.hash}set hash(e){this._sysURL.hash=e}get host(){return super.host}set host(e){this._sysURL.host=e}get hostname(){return super.hostname}set hostname(e){if(!this._hasHostpart)throw new Error(`you can use hostname only if protocol is ${JSON.stringify(Array.from(bs.keys()))}`);this._sysURL.hostname=e}get pathname(){return super.pathname}set pathname(e){this._pathname=e}get port(){return super.port}set port(e){if(!this._hasHostpart)throw new Error(`you can use port only if protocol is ${JSON.stringify(Array.from(bs.keys()))}`);this._sysURL.port=e}get protocol(){return super.protocol}set protocol(e){e.endsWith(":")||(e=`${e}:`),this._protocol=e}get search(){return super.search}set search(e){this._sysURL.search=e}get searchParams(){return super.searchParams}set searchParams(e){const t=new Set;for(const[r]of ui(this._sysURL.searchParams))t.add(r);for(const[r,i]of ui(e))this._sysURL.searchParams.set(r,i),t.delete(r);for(const r of t)this._sysURL.searchParams.delete(r)}}function ft(n,e){return El(n,{...e,state:e.state||new Set([Math.random()])})}function El(n,e){switch(e={...e,state:e.state||new Set([Math.random()])},typeof n){case"function":return new nn(n);case"string":{const t=w0(n);if(t.isJSON){const i=t.parsed;if(typeof i=="object"&&i!==null)return El(i,e)}const r=sa.from(n);if(r.isOk())return new nn(()=>r.Ok().toString());if(n.match(/[\n\r]/)){const i=n.split(/[\n\r]+/).map(o=>o.trim());return new nn(()=>i)}return new nn(()=>n.toString())}case"number":return new nn(()=>n);case"boolean":return new nn(()=>n);case"object":{if(n===null)return new nn(()=>"null");if(ArrayBuffer.isView(n)){try{const o=Ss().decode(n);if(w0(o).isJSON){const f=JSON.parse(o);return El(f,e)}}catch{}return El(UD(n,512),e)}if(Array.isArray(n))return new nn(()=>n.map(i=>ft(i,{...e,state:void 0}).value()));if(n instanceof Headers){const i={};return n.forEach((o,l)=>{i[l]=o}),new nn(()=>i)}if(n instanceof ReadableStream)return new nn(()=>">Stream<");if(la(n))return new nn(()=>">Promise<");if(e.state?.has(n))return new nn(()=>"...");e.state?.add(n);try{if(typeof n.toJSON=="function")return new nn(()=>n.toJSON())}catch{}const t={},r=n;for(const i in r){if(e.ignoreAttr.IsSome()&&e.ignoreAttr.unwrap().test(i))continue;const o=r[i];o instanceof nn?t[i]=o:typeof o!="function"&&(t[i]=El(o,e))}return new nn(()=>t)}default:if(!n)return new nn(()=>"--Falsy--");throw new Error(`Invalid type:${typeof n}`)}}function OA(n){return typeof n=="object"&&["Module","EnableLevel","DisableLevel","SetDebug","Str","Error","Warn","Debug","Log","WithLevel","Err","Info","Timestamp","Any","Dur","Uint64"].map(e=>typeof n[e]=="function").reduce((e,t)=>e&&t,!0)}const ht={Slash:1,Root:3,Up:4,Noop:8};class CA{parts;constructor(e=[]){this.parts=e}toString(){return this.parts.map(e=>{if(typeof e=="string")return e;switch(e){case ht.Slash:case ht.Root:return"/";case ht.Up:return"..";default:return e}}).join("")}add(e){if(this.parts.includes(ht.Root)&&e===ht.Root)throw new Error("Cannot add absolute part to absolute path");const t=this.parts[this.parts.length-1];if(!(t&ht.Slash&&e===ht.Slash)){switch(e){case".":this.parts.push(ht.Noop);return;case"..":e=ht.Up}if(t===ht.Noop&&e===ht.Slash){t===ht.Noop&&this.parts.pop();return}this.parts.push(e)}}}function b0(n){const e=new CA;if(n==="")return e;for(let t=0;n.length;t++)if(n.match(/^\/+/))t===0?e.add(ht.Root):e.add(ht.Slash),n=n.replace(/^\/+/,"");else{const r=n.replace(/\/.*$/,"");e.add(r),n=n.replace(/^[^/]+/,"")}return e}function VD(...n){let e="";const t=[];for(let r=0;r<n.length;r++){const i=n[r];i!==""&&(e.endsWith("/")||i.startsWith("/")||e!==""&&t.push("/"),t.push(i),e=i)}return t.join("")}function GD(n,e){const t=b0(e);let r;t.parts[0]===ht.Root?r=e:r=VD(n,e);const i=b0(r),o=[];let l=!1;for(const f of i.parts)switch(f){case ht.Root:o.push(ht.Root);break;case ht.Up:if(o.length&&!l){const h=o.length-1;typeof o[h]=="string"&&o[h-1]==ht.Root||o.pop(),o.pop(),o.length===0&&(l=l||!0,o.push(ht.Up))}else o.push(ht.Up);break;case ht.Slash:o[o.length-1]&ht.Slash||o.push(ht.Slash);break;default:o.push(f);break}return new CA(o).toString()}function v0(n,e){const r=(Array.isArray(n)?n:[n]).map(o=>{if(typeof o=="string"){const l=o.replace(/[-\\[\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\^\\$\\|]/g,"\\$&");return new RegExp(`^${l}$`)}return o});return eh(void 0,r,e,new WeakSet)}function eh(n,e,t,r){if(typeof t!="object"||t===null||r.has(t))return t;if(r.add(t),Array.isArray(t))return t.map(l=>eh(n,e,l,r));const i={...t},o=(l,f)=>{for(const h of e)if(h.test(l)||h.test(f))return!0;return!1};for(const l in i)if(Object.prototype.hasOwnProperty.call(i,l)){let f;if(n?f=[n,l].join("."):f=l,o(l,f)){delete i[l];continue}typeof i[l]=="object"&&(Array.isArray(i[l])?i[l]=i[l].reduce((h,m,y)=>(o(l,`${f}[${y}]`)||h.push(eh(`${f}[${y}]`,e,m,r)),h),[]):i[l]=eh(f,e,i[l],r))}return i}function MA(n,e){const t={score:0,protocol:!1,hostname:!1,port:!1,pathname:!1,pathParts:[],params:{}},r=Fe.from(n),i=Fe.from(e);r.protocol===i.protocol&&(t.score+=1,t.protocol=!0);try{const o=r.hostname,l=r.port;o===i.hostname&&(t.score+=1,t.hostname=!0),l.length&&l===i.port&&(t.score+=1,t.port=!0)}catch{}if(r.pathname.length&&r.pathname!=="/"){const o=r.pathname.split("/").filter(f=>f.length),l=i.pathname.split("/").filter(f=>f.length);for(let f=0;f<o.length&&f<l.length;f++)l[f]===o[f]&&(t.score+=1,t.pathname=!0,t.pathParts.push(o[f]))}for(const[o,l]of r.getParams)i.getParam(o)===l&&(t.score+=1,t.params[o]=l);return t}function NA(n,e){if(typeof n=="object"){const t=Object.keys(n);if(t.length!==1)throw new Error(`Invalid key: ${JSON.stringify(n)}`);return{key:t[0],def:n[t[0]]}}return{key:n,def:e}}function RA(n){const e=new URLSearchParams(n.replace(/^#/,""));return{getParam:t=>{const r=e.get(t);return r===null?void 0:r}}}function Ll(n){return n??void 0}function ZD(n,e,t){if(!n)return t.fromThrow(`${e}//`);if(typeof n=="string")try{return t.fromThrow(n)}catch{return t.fromThrow(`${e}//${n}`)}else return t.fromThrow(n.toString())}function nw(n){return n instanceof URL||!!n&&typeof n.searchParams=="object"&&typeof n.searchParams.sort=="function"&&typeof n.hash=="string"}function eg(n,e,t,r){switch(typeof Ll(e)){case"undefined":return n(r.fromThrow(`${t}///`));case"string":return n(ZD(e,t,r));case"object":if(an.is(e))return n(r.fromThrow(e._url.toString()));if(Fe.is(e))return n(r.fromThrow(e._url.toString()));if(nw(e))return n(r.fromThrow(e.toString()));throw new Error(`unknown object type: ${e}`);default:throw new Error(`Invalid argument: ${typeof e}`)}}function DA(n,e,t=r=>`missing parameter: ${r}`){return e===void 0?A.Err(t(n)):A.Ok(e)}function S0(n,e,t="reset",r=new URLSearchParams("")){let i;t==="reset"?i={}:i=Object.fromEntries(ui(new URLSearchParams(n)));for(const[o,l]of Object.entries({...i,...e}).sort((f,h)=>f[0].localeCompare(h[0])))switch(typeof l){case"string":r.set(o,l);break;case"number":r.set(o,l.toString());break;case"boolean":r.set(o,l?"true":"false");break;default:l instanceof Date?r.set(o,l.toISOString()):console.error(`unsupported type: ${typeof l} ignore key: ${o}`);break}return r.toString()}class an{_url;constructor(e){this._url=e}static is(e){return e instanceof an||!!e&&typeof e.delParam=="function"&&typeof e.setParam=="function"}static from(e,t="file:"){return eg(r=>new an(r),e,t,{fromThrow:Oo.fromThrow})}match(e){return MA(this.URI(),Fe.from(e))}port(e){return this._url.port=e,this}host(e){return this._url.host=e,this}hostname(e){return this._url.hostname=e,this}protocol(e){return e.endsWith(":")||(e=`${e}:`),this._url.protocol=e,this}pathname(e){return this._url.pathname=e,this}hash(e){return this._url.hash=e,this}resolve(e){return e?typeof e=="string"&&!e.match(/^[a-zA-Z0-9]+:/)?e.startsWith("/")?(this.pathname(e),this):this.appendRelative(e):(this._url=Oo.fromThrow(e.toString()),this):this}appendRelative(e){const t=Fe.from(e),r="./"+t.pathname,i=this._url.pathname;this.pathname(GD(i,r));for(const[o,l]of t.getParams)this.setParam(o,l);return this}cleanParams(...e){const t=new Set(e.flat());for(const[r]of Array.from(ui(this._url.searchParams)))(t.size===0||t.has(r))&&this._url.searchParams.delete(r);return this}searchParams(e,t="reset"){return S0(this._url.search,e,t,this._url.searchParams),this}hashParams(e,t="reset"){return this._url.hash=S0(this._url.hash.replace(/^#/,""),e,t),this}delParam(e){return this._url.searchParams.delete(e),this}defParam(e,t){return this._url.searchParams.has(e)||this._url.searchParams.set(e,t),this}setParam(e,t){return this._url.searchParams.set(e,t),this}hasParam(e){return this._url.searchParams.has(e)}get getParams(){return ui(this._url.searchParams)}getParam(e,t){const{key:r,def:i}=NA(e,t);let o=this._url.searchParams.get(r);return!Ll(o)&&i&&(o=i),Ll(o)}getParamResult(e,t){return DA(e,this.getParam(e),t)}getParamsResult(...e){return Bl(e,this)}getHashParams(...e){return Bl(e,RA(this._url.hash))}toString(){return this._url.searchParams.sort(),this._url.toString()}toJSON(){return this.toString()}asURL(){return this.URI().asURL()}asObj(...e){return this.URI().asObj(...e)}clone(){return an.from(this.toString())}get onlyHostAndSchema(){return this.clone().pathname("").cleanParams().hash("").toString()}get withoutHostAndSchema(){return this._url.pathname+this._url.search+this._url.hash}URI(){return Fe.from(this._url)}}function xA(n){return n?!!(nw(n)||Fe.is(n)||an.is(n)||typeof n=="string"):!1}const E0=new Mt({lru:{maxEntries:1e3}});class Fe{static protocolHasHostpart(e){return e=e.replace(/:$/,""),bs.add(e),()=>{bs.delete(e)}}match(e){return MA(this,e)}static merge(e,t,r="file:"){const i=an.from(e,r),o=Fe.from(t,r);i.protocol(o.protocol);const l=o.pathname;l.length===0||l==="/"||l==="./"||i.pathname(o.pathname);for(const[f,h]of o.getParams)i.setParam(f,h);return i.URI()}static is(e){return e instanceof Fe||!!e&&typeof e.asURL=="function"&&typeof e.getParam=="function"&&typeof e.hasParam=="function"}static from(e,t="file:"){return eg(r=>E0.get(r.toString()).once(()=>new Fe(r)),e,t,{fromThrow:sa.fromThrow})}static fromResult(e,t="file:"){return Te(()=>eg(r=>E0.get(r.toString()).once(()=>new Fe(r)),e,t,{fromThrow:sa.fromThrow}))}_url;constructor(e){this._url=e.clone()}build(){return an.from(this._url)}get hostname(){return this._url.hostname}get onlyHostAndSchema(){return this.build().pathname("").cleanParams().hash("").toString()}get withoutHostAndSchema(){return this._url.pathname+this._url.search+this._url.hash}get port(){return this._url.port}get host(){return this._url.host}get search(){return this._url.search}get protocol(){return this._url.protocol}get pathname(){return this._url.pathname}get hash(){return this._url.hash}get getParams(){return ui(this._url.searchParams)}get getHashes(){return ui(new URLSearchParams(this._url.hash.slice(1)))}hasParam(e){return this._url.searchParams.has(e)}getParam(e,t){const{key:r,def:i}=NA(e,t);let o=this._url.searchParams.get(r);return!Ll(o)&&i&&(o=i),Ll(o)}getParamResult(e,t){return DA(e,this.getParam(e),t)}getParamsResult(...e){return Bl(e,this)}getHashParams(...e){return Bl(e,RA(this._url.hash))}clone(){return new Fe(this._url)}asURL(){return this._url.clone()}toString(){return this._url.toString()}toJSON(){return this.toString()}asObj(...e){const t={style:"path",protocol:this.protocol,pathname:this.pathname,searchParams:Object.fromEntries(this.getParams)};return bs.has(this.protocol.replace(/:$/,""))?v0(e,{...t,style:"host",hostname:this.hostname,port:this.port}):v0(e,t)}}class JD{_globalLevels=new Set([gs.INFO,gs.ERROR,gs.WARN]);_modules=new Map;_timer=new Map;ignoreAttr=At.Some(/^_/);isStackExposed=!1;enableLevel(e,...t){if(t.length==0){this._globalLevels.add(e);return}this.forModules(e,r=>{this._modules.set(r,new Set([...this._globalLevels,e]))},...t)}disableLevel(e,...t){if(t.length==0){this._globalLevels.delete(e);return}this.forModules(e,r=>{this._modules.delete(r)},...t)}setExposeStack(e){this.isStackExposed=!!e}setIgnoreAttr(e){this.ignoreAttr=At.From(e)}forModules(e,t,...r){for(const i of r.flat()){if(typeof i!="string")continue;const o=i.split(",").map(l=>l.trim()).filter(l=>l.length);for(const l of o)t(l)}}setDebug(...e){this.forModules(gs.DEBUG,t=>{this._modules.set(t,new Set([...this._globalLevels,gs.DEBUG]))},...e)}isEnabled(e,t){const r=e;if(typeof t=="string"){const o=this._modules.get(t);if(o&&o.has(r))return!0}const i=this._modules.get("*");return i&&typeof r=="string"&&i.has(r)||typeof r!="string"?!0:this._globalLevels.has(r)}timerStart(e){const t=new Date;return this._timer.set(e,t),t}timerEnd(e){const t=new Date,r=this._timer.get(e);if(!r)return{now:t,duration:0};const i=t.getTime()-r.getTime();return this._timer.delete(e),{now:t,duration:i}}}const WD=new JD;function YD(){return WD}const ny={REAL:"real",CONST:"const",STEP:"step"};class rw{TimeSince(e){return this.Now().getTime()-e.getTime()}}let ry;class sw{env=new Map;opts;static new(e){return ry=ry??new sw(e),ry}constructor(e){this.opts=e}get(e){return this.env.get(e)}set(e,t){t&&this.env.set(e,t)}delete(e){this.env.delete(e)}keys(){return Array.from(this.env.keys())}active(){return!0}register(e){const t=Symbol.for(this.opts.symbol||"CP_ENV"),r=globalThis;return r[t]=e,e}}let sy;class iw{#e=globalThis;static new(e){return sy=sy??new iw(e),sy}get _env(){return this.#e.Deno.env}opts;constructor(e){this.opts=e}register(e){for(const t of e.keys())this._env.set(t,e.get(t)||"");return e}active(){return jn().isDeno}keys(){return Object.keys(this._env.toObject())}get(e){return this._env.get(e)}set(e,t){t&&this._env.set(e,t)}delete(e){this._env.delete(e)}}class QD{_envFactory;constructor(e){this._envFactory=e}Env(){return this._envFactory()}Args(){return Deno.args}Stdout(){return Deno.stdout.writable}Stderr(){return Deno.stderr.writable}}let iy;function XD(n={}){const e=n.TxtEnDecoder??Ss();return iy=iy??new Jo({TxtEnDecoder:e}),new Wo(iy,{basicRuntimeService:new QD(ua),...n})}let ay;class aw{#e=globalThis;_env;static new(e){return ay=ay??new aw(e),ay}opts;constructor(e){this.opts=e,this._env=this.active()?this.#e.process.env:{}}register(e){for(const t of e.keys())this._env[t]=e.get(t)||"";return e}active(){return jn().isNodeIsh}keys(){return Object.keys(this._env)}get(e){return this._env[e]}set(e,t){t&&(this._env[e]=t)}delete(e){delete this._env[e]}}class ex{_txtEnDe;_envFactory;_gthis;constructor(e,t){this._txtEnDe=e,this._envFactory=t,this._gthis=globalThis}Env(){return this._envFactory()}Args(){return this._gthis.process.argv}Stdout(){return new WritableStream({write:e=>{this._gthis.process.stdout.write(e)}})}Stderr(){return new WritableStream({write:e=>{this._gthis.process.stderr.write(e)}})}}let oy;function IA(n={}){const e=n.TxtEnDecoder??Ss();return oy=oy??new Jo({TxtEnDecoder:e}),new Wo(oy,{basicRuntimeService:new ex(e,ua),...n})}class tx{_txtEnDe;_envFactory;constructor(e,t){this._txtEnDe=e,this._envFactory=t}Env(){return this._envFactory()}Args(){throw new Error("Args-Method not implemented.")}Stdout(){return _0(e=>{const t=this._txtEnDe.decode(e);return console.log(t.trimEnd()),Promise.resolve()})}Stderr(){return _0(e=>{const t=this._txtEnDe.decode(e);return console.error(t.trimEnd()),Promise.resolve()})}}function UA(n,e){n.read().then(({done:t,value:r})=>{t||e(r).then(()=>{UA(n,e)}).catch(i=>{console.error("consumeReadableStream:writeFn",i)})}).catch(t=>{console.error("consumeReadableStream:read",t)})}function _0(n){const e=new TransformStream;return UA(e.readable.getReader(),n),e.writable}let cy;function nx(n){const e=n?.TxtEnDecoder||Ss();return cy=cy??new Jo({TxtEnDecoder:e}),new Wo(cy,{basicRuntimeService:new tx(e,ua),...n})}let ly;class vh{injectOnRegister={};cfEnv;opts;env;static new(e={}){return ly=ly??new vh(e),ly}static inject(e){const t=vh.new();for(const r in e){const i=e[r];typeof i=="string"&&(t.env?t.env.set(r,i):t.injectOnRegister[r]=i)}}constructor(e){this.cfEnv=new Map(Object.entries(e.presetEnv||{})),this.opts=e}active(){return jn().isCFWorker}register(e){this.env=e;for(const t in this.injectOnRegister)e.set(t,this.injectOnRegister[t]);return e}get(e){return this.cfEnv.get(e)}set(e,t){t&&this.cfEnv.set(e,t)}delete(e){this.cfEnv.delete(e)}keys(){return Array.from(this.cfEnv.keys())}}const rx={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};class sx{#e;importMetaEnv=rx||{};constructor(e){this.#e=e}active(){return this.#e.active()}register(e){return this.#e.register(e)}get(e){const t=this.#e.get(e);return t||this.importMetaEnv?.[e]}set(e,t){this.#e.set(e,t)}delete(e){this.#e.delete(e)}keys(){return Array.from(new Set([...this.#e.keys(),...Object.keys(this.importMetaEnv??{})])).sort()}}function ix(n){return new sx(n)}function Bl(n,e){const t=n.flat().reduce((l,f)=>(typeof f=="string"?l.push({key:f,def:void 0,isOptional:!1}):typeof f=="object"&&l.push(...Object.keys(f).map(h=>({key:h,def:typeof f[h]=="string"?f[h]:void 0,isOptional:f[h]===rn.OPTIONAL}))),l),[]),r=n.find(l=>typeof l=="function")||((...l)=>`missing parameters: ${l.join(",")}`),i=[],o={};for(const l of t){const f=e.getParam(l.key);f===void 0?typeof l.def=="string"?o[l.key]=l.def:l.isOptional||i.push(l.key):o[l.key]=f}return i.length?A.Err(r(...i)):A.Ok(o)}class ax{stream;desiredSize=null;closed;ready;_stream;constructor(e){this.stream=e,this._stream=e,this.ready=Promise.resolve(),this.closed=Promise.resolve()}abort(e){throw new Error("Method not implemented.")}async close(){}releaseLock(){this._stream.locked=!1,this.ready=Promise.resolve(),this.closed=Promise.resolve()}write(e){let t=Ss().decode(e).trimEnd();try{t=JSON.parse(t);const r=t.level||"log",i=[t];switch("msg"in t&&(i.unshift(t.msg),delete t.msg),r){case"error":this._stream.params.error(...i);break;case"warn":this._stream.params.warn(...i);break;default:this._stream.params.log(...i)}}catch{this._stream.params.log(t)}return Promise.resolve()}}class zA{locked=!1;_writer;params;constructor(e={}){this.params={error:(...t)=>(e.error||console.error)(...t),log:(...t)=>(e.log||console.log)(...t),warn:(...t)=>(e.warn||console.warn)(...t)}}abort(e){throw new Error("Method not implemented.")}close(){return Promise.resolve()}getWriter(){if(this.locked)throw new Error("Stream is locked");return this.locked=!0,this._writer||(this._writer=new ax(this)),this._writer}}function _l(n){return{cement:{runtimeFn:jn,WrapperBasicSysAbstraction:Wo,WrapperRuntimeSysAbstraction:wx,TxtEnDecoderSingleton:Ss,ConsoleWriterStream:zA,envFactory:ua,BaseBasicSysAbstraction:Jo,BaseSysAbstraction:yx,NodeBasicSysAbstraction:IA},...n}}const ox=[{id:"cf",fn:n=>vh.new(n)},{id:"node",fn:n=>aw.new(n)},{id:"deno",fn:n=>iw.new(n)},{id:"browser",fn:n=>sw.new(n)}],cx=new Mt;function ua(n={}){const e=_l(n),t=ox.find(i=>i.fn(e).active());if(!t)throw new Error("SysContainer:envFactory: no env available");const r=cx.get(n.id??t.id).once(()=>{const i=ix(t.fn(e)),o=new fx(i,e);return i.register(o),o});return n.testPatchImportMetaEnv&&lx(r._map)&&r._map.importMetaEnv&&Object.assign(r._map.importMetaEnv,n.testPatchImportMetaEnv),r}function lx(n){return!!n.importMetaEnv}function ux(n){return n==null?!1:typeof n[Symbol.iterator]=="function"}class fx{_map;constructor(e,t){this._map=e,this._updatePresets(t.presetEnv)}gets(...e){return Bl(e,{getParam:t=>this.get(t)})}sets(...e){e.forEach(t=>{if(Array.isArray(t)){if(t.length===2){const[r,i]=t;if(typeof r=="string"&&typeof i=="string"){this.set(r,i);return}}for(const r of t)if(Array.isArray(r)&&r.length===2){const[i,o]=r;typeof i=="string"&&typeof o=="string"&&this.set(i,o)}}else if(ux(t))for(const[r,i]of t)typeof r=="string"&&typeof i=="string"&&this.set(r,i);else{const r=t;for(const i in r){const o=r[i];typeof i=="string"&&typeof o=="string"&&this.set(i,o)}}})}_updatePresets(e){if(e)for(const[t,r]of e)this._map.set(t,r)}_applyOnSet(e,t,r){e.forEach(i=>{let o=[];t?o=[t]:o=this._map.keys(),o.filter(l=>!!(i.filter.size===0||i.filter.has(l))).forEach(l=>{let f;!t&&!r?f=this._map.get(l):t&&!r?f=void 0:f=r,i.fn(l,f)})})}_onSet=[];keys(){return this._map.keys()}onSet(e,...t){const r={filter:new Set(t),fn:e};this._onSet.push(r),this._applyOnSet([r])}get(e){return this._map.get(e)}set(e,t){t&&(this._map.set(e,t),this._applyOnSet(this._onSet,e,t))}delete(e){this._map.delete(e),this._applyOnSet(this._onSet,e)}}class hx{_txtEnDe;_envFactory;_stdoutFactory;constructor(e,t,r){this._txtEnDe=e,this._envFactory=t,this._stdoutFactory=r}Env(){return this._envFactory()}Args(){throw new Error("Args-Method not implemented.")}Stdout(){return this._stdoutFactory()}Stderr(){const e=this._txtEnDe;return new WritableStream({write(t){return new Promise(r=>{const i=e.decode(t);console.error(i.trimEnd()),r()})}})}}let uy;function dx(n){const e=n.TxtEnDecoder??Ss();return uy=uy??new Jo({TxtEnDecoder:e}),new Wo(uy,{basicRuntimeService:new hx(e,ua,()=>new zA),...n})}class tg extends rw{Now(){return new Date}Sleep(e){return new Promise(t=>{setTimeout(()=>{t()},e)})}}class LA extends rw{Now(){return new Date(2021,1,1,0,0,0,0)}Sleep(e){return Promise.resolve()}}class mx extends rw{_step;_start;constructor(){super(),this._step=new LA().Now(),this._start=this._step}Now(e=1){for(let t=0;e>0&&t<e;t++)this._step=new Date(this._step.getTime()+1e3);return e<1&&(this._step=new Date(this._start.getTime()+e*-1e3)),this._step}Sleep(e){return this._step=new Date(this._step.getTime()+e),Promise.resolve()}}function px(n){switch(n){case ny.REAL:return new tg;case ny.CONST:return new LA;case ny.STEP:return new mx}return new tg}class Jo{_time=new tg;_idService=ad.create();_randomService=od.create(th.RANDOM);_txtEnDe;constructor(e){this._txtEnDe=e.TxtEnDecoder}}class yx extends Jo{_fileSystem;_systemService;constructor(e){super(e),this._fileSystem=e.FileSystem,this._systemService=e.SystemService}}function gx(n){const e=jn();switch(!0){case e.isBrowser:return dx(_l(n));case e.isDeno:return XD(_l(n));case e.isCFWorker:return nx(_l(n));case e.isNodeIsh:return IA(_l(n));default:throw new Error("Unknown runtime")}}class Wo{_time;_idService;_randomService;_basicRuntimeService;constructor(e,t){this._time=e._time,this._basicRuntimeService=t.basicRuntimeService,this._idService=e._idService,this._randomService=e._randomService,t.TimeMode&&(this._time=px(t.TimeMode)),t.IdMode&&(this._idService=ad.create(t.IdMode)),t.RandomMode&&(this._randomService=od.create(t.RandomMode))}Time(){return this._time}NextId(){return this._idService.NextId()}Random0ToValue(e){return this._randomService.Random0ToValue(e)}Stdout(){return this._basicRuntimeService.Stdout()}Stderr(){return this._basicRuntimeService.Stderr()}Env(){return this._basicRuntimeService.Env()}Args(){return this._basicRuntimeService.Args()}}class wx extends Wo{_systemService;_fileSystem;constructor(e,t){super(e,t),this._systemService=t.systemService??e._systemService,this._fileSystem=t.fileSystem??e._fileSystem}System(){return this._systemService}FileSystem(){return this._fileSystem}}class A0{_out;_toFlush=[];_id;constructor(e){this._out=e,this._id=Math.random()}write(e){const t=async()=>{try{const r=this._out.getWriter();await r.ready,await r.write(e),r.releaseLock()}catch(r){console.error("Chunk error:",r)}};this._toFlush.push(t),this._flush()}_flushIsRunning=!1;_flushDoneFns=[];_flush(e=void 0,t){if(t&&this._flushDoneFns.push(t),this._toFlush.length==0){this._flushIsRunning=!1,this._flushDoneFns.forEach(i=>i()),this._flushDoneFns=[];return}if(!e&&this._toFlush.length==1&&!this._flushIsRunning)this._flushIsRunning=!0;else if(!e)return;this._toFlush.shift()?.().catch(i=>{console.error("Flush error:",i)}).finally(()=>{this._flush(this._toFlush)})}}function bx(n,e){return Array.isArray(n)?ft(()=>n.length,e):typeof n=="string"?ft(()=>n.length,e):typeof n=="object"&&n!==null?typeof n.size=="number"?ft(()=>n.size,e):typeof n.length=="number"?ft(()=>n.length,e):ft(()=>Object.keys(n).length,e):ft(()=>-1,e)}function k0(n){if(n&&typeof n.then=="function")throw new Error("async logValue Not implemented");return n}class ng{_txtEnDe;_space;constructor(e,t){this._txtEnDe=e,this._space=t}format(e){let t;try{t=JSON.stringify(e,null,this._space)}catch(r){t=JSON.stringify({internal:{message:r.message,stack:r.stack}})}return this._txtEnDe.encode(t+`
`)}}class vx{_txtEnDe;_space;constructor(e,t){this._txtEnDe=e,this._space=t}format(e){return this._txtEnDe.encode(`---
`+xD.stringify(e,null,this._space)+`
`)}}function Vt(n){return{ignoreAttr:n.ignoreAttr}}class ow{_sys;_attributes={};_withAttributes;_logWriter;levelHandler;_txtEnDe;_formatter;constructor(e){e||(e={}),e.sys?this._sys=e.sys:this._sys=gx(),e.txtEnDe?this._txtEnDe=e.txtEnDe:this._txtEnDe=Ss(),e.formatter?this._formatter=e.formatter:this._formatter=new ng(this._txtEnDe),e.logWriter?this._logWriter=e.logWriter:e.out?this._logWriter=new A0(e.out):this._logWriter=new A0(this._sys.Stdout()),e.withAttributes?this._withAttributes={...e.withAttributes}:this._withAttributes={},this._attributes={...this._withAttributes},e.levelHandler?this.levelHandler=e.levelHandler:this.levelHandler=YD()}TimerStart(e){const t=this.levelHandler.timerStart(e);return this.coerceKey(e,t.toISOString()),this}TimerEnd(e){const t=this.levelHandler.timerEnd(e);return this.coerceKey(e,`${t.now.toISOString()} - ${t.duration}ms`),this}TxtEnDe(){return this._txtEnDe}Attributes(){return JSON.parse(JSON.stringify(this._attributes,null))}SetExposeStack(e){return this.levelHandler.setExposeStack(e),this}EnableLevel(e,...t){return this.levelHandler.enableLevel(e,...t),this}DisableLevel(e,...t){return this.levelHandler.disableLevel(e,...t),this}Module(e){return this._attributes.module=ft(e,Vt(this.levelHandler)),this._withAttributes.module=ft(e,Vt(this.levelHandler)),this}SetDebug(...e){return this.levelHandler.setDebug(...e),this}SetIgnoreAttribute(e){return this.levelHandler.setIgnoreAttr(e),this}SetFormatter(e){return this._formatter=e,this}Timestamp(){return this._attributes.ts=ft(()=>this._sys.Time().Now().toISOString(),Vt(this.levelHandler)),this}Warn(){return this._attributes.level=ft(gs.WARN,Vt(this.levelHandler)),this}Log(){return this}Debug(){return this._attributes.level=ft(gs.DEBUG,Vt(this.levelHandler)),this}Error(){return this._attributes.level=ft(gs.ERROR,Vt(this.levelHandler)),this}Info(){return this._attributes.level=ft(gs.INFO,Vt(this.levelHandler)),this}Err(e){let t="error";return A.Is(e)&&(e.isOk()?(t="noerror",e=e.Ok()):e=e.Err()),e instanceof Error?(e.cause?this.coerceKey(t,{message:e.message,cause:e.cause}):this._attributes[t]=ft(e.message,Vt(this.levelHandler)),this.levelHandler.isStackExposed&&(this._attributes.stack=ft(e.stack?.split(/[\r\n]+/).map(r=>r.trim()),Vt(this.levelHandler)))):this.Any(t,e),this}WithLevel(e){return this._attributes.level=ft(e,Vt(this.levelHandler)),this}Ref(e,t){return typeof t=="function"?this._attributes[e]=ft(t,Vt(this.levelHandler)):typeof t.toString=="function"?this._attributes[e]=ft(()=>t.toString(),Vt(this.levelHandler)):this._attributes[e]=ft("INVALID REF",Vt(this.levelHandler)),this}Bool(e,t){return this.coerceKey(e,!!t),this}Http(...e){const t=e.find(f=>typeof f=="string");e=e.filter(f=>typeof f!="string");const r=e.filter(f=>A.Is(f)&&f.isErr());if(r.length)return this.Err(r.map(f=>f.Err().message).join(`
`)),this;const i=e.map(f=>A.Is(f)?f.Ok():f).find(f=>typeof f.status!="number"),o=e.map(f=>A.Is(f)?f.Ok():f).find(f=>typeof f.status=="number");let l;return o&&i?l={res:o,req:i}:!o&&!i?l=void 0:o?l=o:i&&(l=i),l&&this.Any(t||"Http",l),this}Pair(e){for(const t of Object.keys(e)){const r=e[t];if(r instanceof nn){this._attributes[t]=r;continue}if(A.Is(r)){this.Result(t,r);continue}this.Any(t,r)}return this}Result(e,t){return t.isOk()?this._attributes[e]=ft(t.Ok(),Vt(this.levelHandler)):this.Err(t.Err()),this}Len(e,t="len"){return this._attributes[t]=bx(e,Vt(this.levelHandler)),this}Hash(e,t="hash"){throw new Error("Not implemented")}Url(e,t="url"){return this.Ref(t,()=>Fe.from(e).toString()),this}coerceKey(e,t){typeof e=="string"?this._attributes[e]=ft(t,Vt(this.levelHandler)):this.Pair(e)}Str(e,t){return this.coerceKey(e,t),this}Any(e,t){return this.coerceKey(e,t),this}Dur(e,t){return this._attributes[e]=ft(`${t}ms`,Vt(this.levelHandler)),this}Uint64(e,t){return this.coerceKey(e,t),this}Int(e,t){return this.Uint64(e,t)}async Flush(){return new Promise(e=>{this._logWriter._flush(void 0,e)})}With(){return new Sx(new ow({logWriter:this._logWriter,sys:this._sys,levelHandler:this.levelHandler,formatter:this._formatter,withAttributes:{module:this._attributes.module,...this._withAttributes}}))}_resetAttributes(e){const t=e();return Object.keys(this._attributes).forEach(r=>{delete this._attributes[r]}),Object.assign(this._attributes,this._withAttributes),t}Msg(...e){const t=this._resetAttributes(()=>{const i=this.levelHandler.isEnabled(k0(this._attributes.level)?.value(),k0(this._attributes.module)?.value());this._attributes.msg=ft(e.join(" "),Vt(this.levelHandler));const o=this._attributes.msg.value();typeof o=="string"&&!o.trim().length&&delete this._attributes.msg;let l=()=>this._formatter.format({...this._attributes});if(i){let f;try{f=l(),this._logWriter.write(f)}catch(h){const m="Logger-Impl:Msg:Write error:";console.error(m,h,this._attributes),f=this._txtEnDe.encode(m+h.message+`
`+h.stack+`
`)}l=()=>f}return l}),r=()=>new Error(this._txtEnDe.decode(t()));return{ResultError:()=>A.Err(r()),AsError:r}}}class Sx{_li;levelHandler;constructor(e){this._li=e,this.levelHandler=e.levelHandler}TimerStart(e){return this._li.TimerStart(e),this}TimerEnd(e){return this._li.TimerEnd(e),this}TxtEnDe(){return this._li.TxtEnDe()}Logger(){return Object.assign(this._li._withAttributes,this._li._attributes),this._li}Attributes(){return{...this._li._attributes}}SetExposeStack(e){return this._li.levelHandler.setExposeStack(e),this}SetIgnoreAttribute(e){return this._li.levelHandler.setIgnoreAttr(e),this}SetFormatter(e){return this._li.SetFormatter(e),this}EnableLevel(e,...t){return this._li.levelHandler.enableLevel(e,...t),this}DisableLevel(e,...t){return this._li.levelHandler.enableLevel(e,...t),this}Module(e){return this._li.Module(e),this}SetDebug(...e){return this._li.SetDebug(...e),this}Http(...e){return this._li.Http(...e),this}Pair(e){return this._li.Pair(e),this}Str(e,t){return this._li.Str(e,t),this}Len(e,t){return this._li.Len(e,t),this}Hash(e,t){return this._li.Hash(e,t),this}Ref(e,t){return this._li.Ref(e,t),this}Bool(e,t){return this._li.Bool(e,t),this}Result(e,t){return this._li.Result(e,t),this}Url(e,t){return this._li.Url(e,t),this}Int(e,t){return this._li.Int(e,t),this}Log(){return this._li.Log(),this}WithLevel(e){return this._li.WithLevel(e),this}Error(){return this._li.Error(),this}Warn(){return this._li.Error(),this}Debug(){return this._li.Debug(),this}Err(e){return this._li.Err(e),this}Info(){return this._li.Info(),this}Timestamp(){return this._li.Timestamp(),this}Any(e,t){return this._li.Any(e,t),this}Dur(e,t){return this._li.Dur(e,t),this}Uint64(e,t){return this._li.Uint64(e,t),this}}function Ex(n){return n instanceof ArrayBuffer||Object.prototype.toString.call(n)==="[object ArrayBuffer]"}function _x(n){return n instanceof Uint8Array||Object.prototype.toString.call(n)==="[object Uint8Array]"}async function BA(n){return n instanceof Blob?new Uint8Array(await n.arrayBuffer()):id(n)}function id(n,e){return typeof n=="string"?(e??Ss()).encode(n):Ex(n)?new Uint8Array(n):_x(n)?n:new Uint8Array(n)}function Ax(n,e){if(n instanceof ArrayBuffer)return n;const t=id(n,e);return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}function kx(n){return e=>{const t=new Uint8Array(e);return e>0&&n.getRandomValues(t),t}}function Tx(n){return e=>n.subtle.digest("SHA-256",Ax(e))}function cw(n={}){let e;return!globalThis.crypto||!globalThis.crypto.subtle?e={getRandomValues:globalThis.crypto.getRandomValues.bind(globalThis.crypto),subtle:{importKey:()=>{throw new Error("crypto.subtle.importKey not available")},exportKey:()=>{throw new Error("crypto.subtle.exportKey not available")},encrypt:()=>{throw new Error("crypto.subtle.encrypt not available")},decrypt:()=>{throw new Error("crypto.subtle.decrypt not available")},digest:()=>{throw new Error("crypto.subtle.digest not available")}}}:e=globalThis.crypto,{importKey:n.importKey||e.subtle.importKey.bind(e.subtle),exportKey:n.exportKey||e.subtle.exportKey.bind(e.subtle),encrypt:n.encrypt||e.subtle.encrypt.bind(e.subtle),decrypt:n.decrypt||e.subtle.decrypt.bind(e.subtle),randomBytes:n.randomBytes||kx(e),digestSHA256:n.digestSHA256||Tx(e)}}class Ox{impl=new Headers;constructor(e){for(const[t,r]of e)this.append(t,r)}forEach(e){this.impl.forEach((t,r)=>{e(t,r,this)})}delete(e){this.impl.delete(e)}get(e){return this.impl.get(e)}getSetCookie(){return this.impl.getSetCookie()}has(e){return this.impl.has(e)}set(e,t){this.impl.set(e,t)}*[Symbol.iterator](){const e=[];this.impl.forEach((t,r)=>{e.push([r,t])});for(const t of e)yield t}entries(){return this[Symbol.iterator]()}*keys(){const e=[];this.impl.forEach((t,r)=>{e.push(r)});for(const t of e)yield t}*values(){for(const e of this.keys()){const t=this.impl.get(e);t&&(yield t)}}append(e,t){if(!(typeof t=="string"||Array.isArray(t)))return this;const r=this.impl.get(e)||"",i=Array.isArray(t)?t:[t],o=r?[...r.split(", ").map(f=>f.trim()),...i]:i,l=[...new Set(o.filter(f=>f!==""))];return this.impl.set(e,l.join(", ")),this}}function Cx(n){return typeof n.forEach=="function"}class ni{_headers=new Map;static coerce(e){if(e instanceof ni)return e;const t=new ni;if(e)switch(!0){case Array.isArray(e):for(const[r,i]of e)i&&t.Add(r,i);break;case Cx(e):e.forEach((r,i)=>{if(r){const o=(typeof r=="string"?[r]:r).map(l=>l.split(",").map(f=>f.trim())).flat().filter(l=>!!l);t.Add(i,o)}});break;default:for(const r in e){const i=e[r];(Array.isArray(i)?i:[i]).forEach(o=>{t.Add(r,o)})}}return t}static from(...e){return e.map(t=>ni.coerce(t)).reduce((t,r)=>t.MergeInplace(r),new ni)}_asStringString(){const e=new Map;for(const[t,r]of this._headers)e.set(t,Array.from(r).join(", "));return e}_key(e){return e.toLowerCase()}Values(e){const t=this._headers.get(this._key(e));return t?Array.from(t):[]}Get(e){const t=this._headers.get(this._key(e));if(!(t===void 0||t.size===0))return t.values().next().value}Set(e,t){const r=new Set((Array.isArray(t)?t:[t]).map(i=>i.trim()).filter(i=>i!==""));return r.size>0?this._headers.set(this._key(e),r):this._headers.delete(this._key(e)),this}Add(e,t){if(typeof t>"u")return this;let r=this._headers.get(this._key(e));return r||(r=new Set,this._headers.set(this._key(e),r)),(Array.isArray(t)?t:[t]).map(i=>i.trim()).filter(i=>i!=="").reduce((i,o)=>(i.add(o),i),r),this}Del(e){return this._headers.delete(this._key(e)),this}Items(){return Array.from(this._headers).filter(([e,t])=>t.size>0).map(([e,t])=>[e,Array.from(t)])}SortItems(){return this.Items().sort(([[e]],[[t]])=>e.localeCompare(t))}Clone(){const e=new ni;for(const[t,r]of this._headers.entries())e._headers.set(t,new Set(r));return e}AsRecordStringStringArray(){const e={};for(const[t,r]of this._headers.entries())e[t]=[...r];return e}AsRecordStringString(){const e={};for(const[t,r]of this._headers.entries())e[t]=Array.from(r).join(", ");return e}AsHeaderInit(){const e={};for(const[t,r]of this._headers.entries()){const i=r.values().next();i.value&&(e[t]=i.value)}return e}AsHeaders(){return new Ox(this._asStringString())}MergeInplace(...e){for(const t of e.map(r=>ni.coerce(r)))for(const[r,i]of t.Items())this.Add(r,i);return this}Merge(...e){return this.Clone().MergeInplace(...e)}}function Mx(n){return fi.is(n)}class fi{ctx=new Map;static is(e){return e instanceof fi&&"ctx"in e&&e.ctx instanceof Map}static merge(...e){const t=new fi;for(const r of e){if(!r)continue;let i=[];Mx(r)?i=Array.from(r.ctx.entries()):typeof r=="object"&&r!==null&&(i=Object.entries(r));for(const[o,l]of i)t.ctx.set(o,l)}return t}set(e,t){return this.ctx.set(e,t),this}get(e){return this.ctx.get(e)}getOrDefault(e,t){const r=this.ctx.get(e);return r===void 0?t:r}getOrThrow(e){const t=this.ctx.get(e);if(t===void 0)throw new Error(`AppContext: Key '${e}' not found`);return t}delete(e){this.ctx.delete(e)}asObj(){return Object.fromEntries(this.ctx.entries())}}async function Nx(n,e){if(n<0)return{state:"sleeped",isOk:!0,isErr:!1,isAborted:!1};if(e?.aborted)return{state:"aborted",reason:new Error("sleep aborted"),isOk:!1,isErr:!1,isAborted:!0};const t=new On,r=setTimeout(()=>{t.resolve({state:"sleeped",isOk:!0,isErr:!1,isAborted:!1})},n),i=new On;function o(){i.resolve({state:"aborted",reason:new Error("sleep aborted"),isOk:!1,isErr:!1,isAborted:!0})}return e?.addEventListener("abort",o,{once:!0}),Promise.race([i.asPromise(),t.asPromise()]).finally(()=>{clearTimeout(r),e?.removeEventListener("abort",o)})}function Rx(n){return Object.assign(n,{isSuccess:()=>Dx(n),isTimeout:()=>xx(n),isAborted:()=>Ix(n),isError:()=>Ux(n)})}function ji(n){return{...Rx(n),...n}}function Dx(n){return n.state==="success"}function xx(n){return n.state==="timeout"}function Ix(n){return n.state==="aborted"}function Ux(n){return n.state==="error"}async function zx(n,e={}){const{timeout:t=3e4,signal:r,controller:i,ctx:o,onTimeout:l,onAbort:f,onError:h}=e,m=i||new AbortController,y=Date.now(),g=[];if(r){let x=function(){m.abort(r?.reason)};g.push(()=>{r?.removeEventListener("abort",x)}),r.addEventListener("abort",x)}function b(x,$=!1){for(const L of g)L();return g.length=0,$||m.abort(new Error("Timeouted Abort Action")),{...x,duration:Date.now()-y,ctx:o}}let E;if(la(n))E=n;else try{E=n(m)}catch(x){return b(ji({state:"error",error:x instanceof Error?x:new Error(x),duration:Date.now()-y,ctx:o}))}const _=new On;function S(){_.resolve(ji({state:"aborted",reason:m.signal.reason,duration:Date.now()-y,ctx:o}))}m.signal.addEventListener("abort",S),g.push(()=>{m.signal.removeEventListener("abort",S)});const k=[E.then(x=>ji({state:"success",value:x,duration:Date.now()-y,ctx:o})).catch(x=>ji({state:"error",error:x,duration:Date.now()-y,ctx:o})),_.asPromise()];t>0&&k.push(Nx(t,m.signal).then(x=>{switch(!0){case x.isOk:return ji({state:"timeout",duration:Date.now()-y,ctx:o});case x.isErr:return ji({state:"error",error:x.error,duration:Date.now()-y,ctx:o});case x.isAborted:return ji({state:"aborted",reason:x.reason,duration:Date.now()-y,ctx:o})}throw new Error("Unreachable code in timeoutAction")}));const M=await Promise.race(k);switch(!0){case M.state==="success":return b(M);case M.state==="aborted":return f?.(M.reason),b(M,!0);case M.state==="error":return h?.(M.error),b(M);case M.state==="timeout":return l?.(),b(M,!0)}throw new Error("Unreachable code in timeoutAction")}const th={CONST:"const",STEP:"step",RANDOM:"random"},ll={UUID:"uuid",CONST:"const",STEP:"step"},Lx=new Mt;class ad{_mode;_step=0;static create(e){return Lx.get(e??ll.UUID).once(()=>new ad(e))}constructor(e){e||(e=ll.UUID),this._mode=e}NextId(){switch(this._mode){case ll.UUID:return crypto.randomUUID();case ll.CONST:return"VeryUniqueID";case ll.STEP:return`STEPId-${this._step++}`;default:throw new Error("Unknown IDMode")}}}const Bx=new Mt;class od{_mode;_step=0;static create(e){return Bx.get(e).once(()=>new od(e))}constructor(e){this._mode=e}Random0ToValue(e){switch(this._mode){case th.CONST:return .5*e;case th.STEP:return this._step+=1e-4,this._step*e;case th.RANDOM:return Math.random()*e;default:throw new Error("Unknown RandomMode")}}}var T0;(function(n){n.Push="push",n.Unshift="unshift",n.Position="position"})(T0||(T0={}));var O0;(function(n){n.WildCard="wildcard",n.Regular="regular",n.Error="error"})(O0||(O0={}));function PA(n,e){if(n===e)return!0;if(n.byteLength!==e.byteLength)return!1;for(let t=0;t<n.byteLength;t++)if(n[t]!==e[t])return!1;return!0}function Ql(n){if(n instanceof Uint8Array&&n.constructor.name==="Uint8Array")return n;if(n instanceof ArrayBuffer)return new Uint8Array(n);if(ArrayBuffer.isView(n))return new Uint8Array(n.buffer,n.byteOffset,n.byteLength);throw new Error("Unknown type, must be binary type")}const Px=85;function $x(n){return Ql(n)}function Kx(n){return Ql(n)}function jx(n,e){if(n.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),r=0;r<t.length;r++)t[r]=255;for(var i=0;i<n.length;i++){var o=n.charAt(i),l=o.charCodeAt(0);if(t[l]!==255)throw new TypeError(o+" is ambiguous");t[l]=i}var f=n.length,h=n.charAt(0),m=Math.log(f)/Math.log(256),y=Math.log(256)/Math.log(f);function g(_){if(_ instanceof Uint8Array||(ArrayBuffer.isView(_)?_=new Uint8Array(_.buffer,_.byteOffset,_.byteLength):Array.isArray(_)&&(_=Uint8Array.from(_))),!(_ instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(_.length===0)return"";for(var S=0,k=0,M=0,x=_.length;M!==x&&_[M]===0;)M++,S++;for(var $=(x-M)*y+1>>>0,L=new Uint8Array($);M!==x;){for(var j=_[M],W=0,G=$-1;(j!==0||W<k)&&G!==-1;G--,W++)j+=256*L[G]>>>0,L[G]=j%f>>>0,j=j/f>>>0;if(j!==0)throw new Error("Non-zero carry");k=W,M++}for(var H=$-k;H!==$&&L[H]===0;)H++;for(var ie=h.repeat(S);H<$;++H)ie+=n.charAt(L[H]);return ie}function b(_){if(typeof _!="string")throw new TypeError("Expected String");if(_.length===0)return new Uint8Array;var S=0;if(_[S]!==" "){for(var k=0,M=0;_[S]===h;)k++,S++;for(var x=(_.length-S)*m+1>>>0,$=new Uint8Array(x);_[S];){var L=t[_.charCodeAt(S)];if(L===255)return;for(var j=0,W=x-1;(L!==0||j<M)&&W!==-1;W--,j++)L+=f*$[W]>>>0,$[W]=L%256>>>0,L=L/256>>>0;if(L!==0)throw new Error("Non-zero carry");M=j,S++}if(_[S]!==" "){for(var G=x-M;G!==x&&$[G]===0;)G++;for(var H=new Uint8Array(k+(x-G)),ie=k;G!==x;)H[ie++]=$[G++];return H}}}function E(_){var S=b(_);if(S)return S;throw new Error(`Non-${e} character`)}return{encode:g,decodeUnsafe:b,decode:E}}var Hx=jx,qx=Hx;class Fx{name;prefix;baseEncode;constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Vx{name;prefix;baseDecode;prefixCodePoint;constructor(e,t,r){this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=r}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return $A(this,e)}}class Gx{decoders;constructor(e){this.decoders=e}or(e){return $A(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r!=null)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}function $A(n,e){return new Gx({...n.decoders??{[n.prefix]:n},...e.decoders??{[e.prefix]:e}})}class Zx{name;prefix;baseEncode;baseDecode;encoder;decoder;constructor(e,t,r,i){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=i,this.encoder=new Fx(e,t,r),this.decoder=new Vx(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}function KA({name:n,prefix:e,encode:t,decode:r}){return new Zx(n,e,t,r)}function cd({name:n,prefix:e,alphabet:t}){const{encode:r,decode:i}=qx(t,n);return KA({prefix:e,name:n,encode:r,decode:o=>Ql(i(o))})}function Jx(n,e,t,r){let i=n.length;for(;n[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let l=0,f=0,h=0;for(let m=0;m<i;++m){const y=e[n[m]];if(y===void 0)throw new SyntaxError(`Non-${r} character`);f=f<<t|y,l+=t,l>=8&&(l-=8,o[h++]=255&f>>l)}if(l>=t||(255&f<<8-l)!==0)throw new SyntaxError("Unexpected end of data");return o}function Wx(n,e,t){const r=e[e.length-1]==="=",i=(1<<t)-1;let o="",l=0,f=0;for(let h=0;h<n.length;++h)for(f=f<<8|n[h],l+=8;l>t;)l-=t,o+=e[i&f>>l];if(l!==0&&(o+=e[i&f<<t-l]),r)for(;(o.length*t&7)!==0;)o+="=";return o}function Yx(n){const e={};for(let t=0;t<n.length;++t)e[n[t]]=t;return e}function qn({name:n,prefix:e,bitsPerChar:t,alphabet:r}){const i=Yx(r);return KA({prefix:e,name:n,encode(o){return Wx(o,r,t)},decode(o){return Jx(o,i,t,n)}})}const nh=qn({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});qn({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});qn({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});qn({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});qn({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});qn({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});qn({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});qn({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});qn({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});const fy=cd({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});cd({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});const st=cd({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});cd({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Qx=jA,C0=128,Xx=-128,eI=Math.pow(2,31);function jA(n,e,t){e=e||[],t=t||0;for(var r=t;n>=eI;)e[t++]=n&255|C0,n/=128;for(;n&Xx;)e[t++]=n&255|C0,n>>>=7;return e[t]=n|0,jA.bytes=t-r+1,e}var tI=rg,nI=128,M0=127;function rg(n,r){var t=0,r=r||0,i=0,o=r,l,f=n.length;do{if(o>=f)throw rg.bytes=0,new RangeError("Could not decode varint");l=n[o++],t+=i<28?(l&M0)<<i:(l&M0)*Math.pow(2,i),i+=7}while(l>=nI);return rg.bytes=o-r,t}var rI=Math.pow(2,7),sI=Math.pow(2,14),iI=Math.pow(2,21),aI=Math.pow(2,28),oI=Math.pow(2,35),cI=Math.pow(2,42),lI=Math.pow(2,49),uI=Math.pow(2,56),fI=Math.pow(2,63),hI=function(n){return n<rI?1:n<sI?2:n<iI?3:n<aI?4:n<oI?5:n<cI?6:n<lI?7:n<uI?8:n<fI?9:10},dI={encode:Qx,decode:tI,encodingLength:hI},Sh=dI;function sg(n,e=0){return[Sh.decode(n,e),Sh.decode.bytes]}function Eh(n,e,t=0){return Sh.encode(n,e,t),e}function _h(n){return Sh.encodingLength(n)}function HA(n,e){const t=e.byteLength,r=_h(n),i=r+_h(t),o=new Uint8Array(i+t);return Eh(n,o,0),Eh(t,o,r),o.set(e,i),new lw(n,t,e,o)}function ig(n){const e=Ql(n),[t,r]=sg(e),[i,o]=sg(e.subarray(r)),l=e.subarray(r+o);if(l.byteLength!==i)throw new Error("Incorrect length");return new lw(t,i,l,e)}function mI(n,e){if(n===e)return!0;{const t=e;return n.code===t.code&&n.size===t.size&&t.bytes instanceof Uint8Array&&PA(n.bytes,t.bytes)}}class lw{code;size;digest;bytes;constructor(e,t,r,i){this.code=e,this.size=t,this.digest=r,this.bytes=i}}function N0(n,e){const{bytes:t,version:r}=n;return r===0?gI(t,ag(n),e??st.encoder):wI(t,ag(n),e??nh.encoder)}function pI(n){return Me.parse(n["/"])}const R0=new WeakMap;function ag(n){const e=R0.get(n);if(e==null){const t=new Map;return R0.set(n,t),t}return e}class Me{code;version;multihash;bytes;"/";constructor(e,t,r,i){this.code=t,this.version=e,this.multihash=r,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==ul)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==bI)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Me.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,r=HA(e,t);return Me.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Me.equals(this,e)}static equals(e,t){const r=t;return r!=null&&e.code===r.code&&e.version===r.version&&mI(e.multihash,r.multihash)}toString(e){return N0(this,e)}toJSON(){return{"/":N0(this)}}link(){return this}[Symbol.toStringTag]="CID";[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Me)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:r,code:i,multihash:o,bytes:l}=t;return new Me(r,i,o,l??D0(r,i,o.bytes))}else if(t[vI]===!0){const{version:r,multihash:i,code:o}=t,l=ig(i);return Me.create(r,o,l)}else return null}static create(e,t,r){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==ul)throw new Error(`Version 0 CID must use dag-pb (code: ${ul}) block encoding`);return new Me(e,t,r,r.bytes)}case 1:{const i=D0(e,t,r.bytes);return new Me(e,t,r,i)}default:throw new Error("Invalid version")}}static createV0(e){return Me.create(0,ul,e)}static createV1(e,t){return Me.create(1,e,t)}static decode(e){const[t,r]=Me.decodeFirst(e);if(r.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Me.inspectBytes(e),r=t.size-t.multihashSize,i=Ql(e.subarray(r,r+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const o=i.subarray(t.multihashSize-t.digestSize),l=new lw(t.multihashCode,t.digestSize,o,i);return[t.version===0?Me.createV0(l):Me.createV1(t.codec,l),e.subarray(t.size)]}static inspectBytes(e){let t=0;const r=()=>{const[g,b]=sg(e.subarray(t));return t+=b,g};let i=r(),o=ul;if(i===18?(i=0,t=0):o=r(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const l=t,f=r(),h=r(),m=t+h,y=m-l;return{version:i,codec:o,multihashCode:f,digestSize:h,multihashSize:y,size:m}}static parse(e,t){const[r,i]=yI(e,t),o=Me.decode(i);if(o.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return ag(o).set(r,e),o}}function yI(n,e){switch(n[0]){case"Q":{const t=e??st;return[st.prefix,t.decode(`${st.prefix}${n}`)]}case st.prefix:{const t=e??st;return[st.prefix,t.decode(n)]}case nh.prefix:{const t=e??nh;return[nh.prefix,t.decode(n)]}case fy.prefix:{const t=e??fy;return[fy.prefix,t.decode(n)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[n[0],e.decode(n)]}}}function gI(n,e,t){const{prefix:r}=t;if(r!==st.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(r);if(i==null){const o=t.encode(n).slice(1);return e.set(r,o),o}else return i}function wI(n,e,t){const{prefix:r}=t,i=e.get(r);if(i==null){const o=t.encode(n);return e.set(r,o),o}else return i}const ul=112,bI=18;function D0(n,e,t){const r=_h(n),i=r+_h(e),o=new Uint8Array(i+t.byteLength);return Eh(n,o,0),Eh(e,o,r),o.set(t,i),o}const vI=Symbol.for("@ipld/js-cid/CID"),SI=20;function qA({name:n,code:e,encode:t,minDigestLength:r,maxDigestLength:i}){return new EI(n,e,t,r,i)}let EI=class{name;code;encode;minDigestLength;maxDigestLength;constructor(e,t,r,i,o){this.name=e,this.code=t,this.encode=r,this.minDigestLength=i??SI,this.maxDigestLength=o}digest(e,t){if(t?.truncate!=null){if(t.truncate<this.minDigestLength)throw new Error(`Invalid truncate option, must be greater than or equal to ${this.minDigestLength}`);if(this.maxDigestLength!=null&&t.truncate>this.maxDigestLength)throw new Error(`Invalid truncate option, must be less than or equal to ${this.maxDigestLength}`)}if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?x0(r,this.code,t?.truncate):r.then(i=>x0(i,this.code,t?.truncate))}else throw Error("Unknown type, must be binary type")}};function x0(n,e,t){if(t!=null&&t!==n.byteLength){if(t>n.byteLength)throw new Error(`Invalid truncate option, must be less than or equal to ${n.byteLength}`);n=n.subarray(0,t)}return HA(e,n)}function _I(n){return async e=>new Uint8Array(await crypto.subtle.digest(n,e))}const Bt=qA({name:"sha2-256",code:18,encode:_I("SHA-256")});async function FA(n){const e=await BA(n),t=$x(e),r=await Bt.digest(t),i=Me.create(1,Px,r);return{cid:i,blocks:[{cid:i,bytes:t}]}}function AI(n){return typeof n.get=="function"}async function VA(n,e,t){return AI(n)?Te(async()=>{const r=await n.get(e),i=Kx(r);return new File([i],"file",{type:t.type,lastModified:t.lastModified||0})}):A.Err(new Error("Invalid block storage"))}class Kr extends Error{code="ENOENT"}function GA(n){return n===!1||n===null||n===void 0}const te={SUFFIX:"suffix",URL_GEN:"urlGen",STORE_KEY:"storekey",STORE:"store",KEY:"key",INDEX:"index",NAME:"name",VERSION:"version",RUNTIME:"runtime",FRAG_SIZE:"fragSize",IV_VERIFY:"ivVerify",IV_HASH:"ivHash",FRAG_FID:"fid",FRAG_OFS:"ofs",FRAG_LEN:"len",FRAG_HEAD:"headerSize",EXTRACTKEY:"extractKey",SELF_REFLECT:"selfReflect",CAR_PARALLEL:"parallel",CAR_CACHE_SIZE:"carCacheSize",CAR_COMPACT_CACHE_SIZE:"carCompactCacheSize",CAR_META_CACHE_SIZE:"carMetaCacheSize",GENESIS_CID:"baembeiarootfireproofgenesisblockaaaafireproofgenesisblocka",LOCAL_NAME:"localName"};function rh(n){if(GA(n))throw new Error("value is Falsy");return n}function kI(n){if(!GA(n))return n}class TI{wal;file;car;meta;baseStores;constructor(e){this.wal=e.wal,this.file=e.file,this.car=e.car,this.meta=e.meta,this.baseStores=[this.file,this.car,this.meta],this.wal&&this.baseStores.push(this.wal)}}function OI(n){return n.modified}function ZA(n={}){return{...n,chunkSize:n.chunkSize&&n.chunkSize>0?n.chunkSize:32}}function ci(n){if(A.Is(n)){if(n.isOk())return!1;n=n.Err()}return n.code==="ENOENT"}function F(n,e,t){function r(f,h){if(f._zod||Object.defineProperty(f,"_zod",{value:{def:h,constr:l,traits:new Set},enumerable:!1}),f._zod.traits.has(n))return;f._zod.traits.add(n),e(f,h);const m=l.prototype,y=Object.keys(m);for(let g=0;g<y.length;g++){const b=y[g];b in f||(f[b]=m[b].bind(f))}}const i=t?.Parent??Object;class o extends i{}Object.defineProperty(o,"name",{value:n});function l(f){var h;const m=t?.Parent?new o:this;r(m,f),(h=m._zod).deferred??(h.deferred=[]);for(const y of m._zod.deferred)y();return m}return Object.defineProperty(l,"init",{value:r}),Object.defineProperty(l,Symbol.hasInstance,{value:f=>t?.Parent&&f instanceof t.Parent?!0:f?._zod?.traits?.has(n)}),Object.defineProperty(l,"name",{value:n}),l}class Co extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}class JA extends Error{constructor(e){super(`Encountered unidirectional transform during encode: ${e}`),this.name="ZodEncodeError"}}const WA={};function hi(n){return WA}function YA(n){const e=Object.values(n).filter(r=>typeof r=="number");return Object.entries(n).filter(([r,i])=>e.indexOf(+r)===-1).map(([r,i])=>i)}function og(n,e){return typeof e=="bigint"?e.toString():e}function ld(n){return{get value(){{const e=n();return Object.defineProperty(this,"value",{value:e}),e}}}}function uw(n){return n==null}function fw(n){const e=n.startsWith("^")?1:0,t=n.endsWith("$")?n.length-1:n.length;return n.slice(e,t)}function CI(n,e){const t=(n.toString().split(".")[1]||"").length,r=e.toString();let i=(r.split(".")[1]||"").length;if(i===0&&/\d?e-\d?/.test(r)){const h=r.match(/\d?e-(\d?)/);h?.[1]&&(i=Number.parseInt(h[1]))}const o=t>i?t:i,l=Number.parseInt(n.toFixed(o).replace(".","")),f=Number.parseInt(e.toFixed(o).replace(".",""));return l%f/10**o}const I0=Symbol("evaluating");function Ve(n,e,t){let r;Object.defineProperty(n,e,{get(){if(r!==I0)return r===void 0&&(r=I0,r=t()),r},set(i){Object.defineProperty(n,e,{value:i})},configurable:!0})}function fa(n,e,t){Object.defineProperty(n,e,{value:t,writable:!0,enumerable:!0,configurable:!0})}function bi(...n){const e={};for(const t of n){const r=Object.getOwnPropertyDescriptors(t);Object.assign(e,r)}return Object.defineProperties({},e)}function U0(n){return JSON.stringify(n)}function MI(n){return n.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,"")}const QA="captureStackTrace"in Error?Error.captureStackTrace:(...n)=>{};function Pl(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}const NI=ld(()=>{if(typeof navigator<"u"&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{const n=Function;return new n(""),!0}catch{return!1}});function Io(n){if(Pl(n)===!1)return!1;const e=n.constructor;if(e===void 0||typeof e!="function")return!0;const t=e.prototype;return!(Pl(t)===!1||Object.prototype.hasOwnProperty.call(t,"isPrototypeOf")===!1)}function XA(n){return Io(n)?{...n}:Array.isArray(n)?[...n]:n}const RI=new Set(["string","number","symbol"]);function Uo(n){return n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function vi(n,e,t){const r=new n._zod.constr(e??n._zod.def);return(!e||t?.parent)&&(r._zod.parent=n),r}function he(n){const e=n;if(!e)return{};if(typeof e=="string")return{error:()=>e};if(e?.message!==void 0){if(e?.error!==void 0)throw new Error("Cannot specify both `message` and `error` params");e.error=e.message}return delete e.message,typeof e.error=="string"?{...e,error:()=>e.error}:e}function DI(n){return Object.keys(n).filter(e=>n[e]._zod.optin==="optional"&&n[e]._zod.optout==="optional")}const xI={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function II(n,e){const t=n._zod.def,r=t.checks;if(r&&r.length>0)throw new Error(".pick() cannot be used on object schemas containing refinements");const o=bi(n._zod.def,{get shape(){const l={};for(const f in e){if(!(f in t.shape))throw new Error(`Unrecognized key: "${f}"`);e[f]&&(l[f]=t.shape[f])}return fa(this,"shape",l),l},checks:[]});return vi(n,o)}function UI(n,e){const t=n._zod.def,r=t.checks;if(r&&r.length>0)throw new Error(".omit() cannot be used on object schemas containing refinements");const o=bi(n._zod.def,{get shape(){const l={...n._zod.def.shape};for(const f in e){if(!(f in t.shape))throw new Error(`Unrecognized key: "${f}"`);e[f]&&delete l[f]}return fa(this,"shape",l),l},checks:[]});return vi(n,o)}function zI(n,e){if(!Io(e))throw new Error("Invalid input to extend: expected a plain object");const t=n._zod.def.checks;if(t&&t.length>0){const o=n._zod.def.shape;for(const l in e)if(Object.getOwnPropertyDescriptor(o,l)!==void 0)throw new Error("Cannot overwrite keys on object schemas containing refinements. Use `.safeExtend()` instead.")}const i=bi(n._zod.def,{get shape(){const o={...n._zod.def.shape,...e};return fa(this,"shape",o),o}});return vi(n,i)}function LI(n,e){if(!Io(e))throw new Error("Invalid input to safeExtend: expected a plain object");const t=bi(n._zod.def,{get shape(){const r={...n._zod.def.shape,...e};return fa(this,"shape",r),r}});return vi(n,t)}function BI(n,e){const t=bi(n._zod.def,{get shape(){const r={...n._zod.def.shape,...e._zod.def.shape};return fa(this,"shape",r),r},get catchall(){return e._zod.def.catchall},checks:[]});return vi(n,t)}function PI(n,e,t){const i=e._zod.def.checks;if(i&&i.length>0)throw new Error(".partial() cannot be used on object schemas containing refinements");const l=bi(e._zod.def,{get shape(){const f=e._zod.def.shape,h={...f};if(t)for(const m in t){if(!(m in f))throw new Error(`Unrecognized key: "${m}"`);t[m]&&(h[m]=n?new n({type:"optional",innerType:f[m]}):f[m])}else for(const m in f)h[m]=n?new n({type:"optional",innerType:f[m]}):f[m];return fa(this,"shape",h),h},checks:[]});return vi(e,l)}function $I(n,e,t){const r=bi(e._zod.def,{get shape(){const i=e._zod.def.shape,o={...i};if(t)for(const l in t){if(!(l in o))throw new Error(`Unrecognized key: "${l}"`);t[l]&&(o[l]=new n({type:"nonoptional",innerType:i[l]}))}else for(const l in i)o[l]=new n({type:"nonoptional",innerType:i[l]});return fa(this,"shape",o),o}});return vi(e,r)}function bo(n,e=0){if(n.aborted===!0)return!0;for(let t=e;t<n.issues.length;t++)if(n.issues[t]?.continue!==!0)return!0;return!1}function vo(n,e){return e.map(t=>{var r;return(r=t).path??(r.path=[]),t.path.unshift(n),t})}function zf(n){return typeof n=="string"?n:n?.message}function di(n,e,t){const r={...n,path:n.path??[]};if(!n.message){const i=zf(n.inst?._zod.def?.error?.(n))??zf(e?.error?.(n))??zf(t.customError?.(n))??zf(t.localeError?.(n))??"Invalid input";r.message=i}return delete r.inst,delete r.continue,e?.reportInput||delete r.input,r}function hw(n){return Array.isArray(n)?"array":typeof n=="string"?"string":"unknown"}function $l(...n){const[e,t,r]=n;return typeof e=="string"?{message:e,code:"custom",input:t,inst:r}:{...e}}const ek=(n,e)=>{n.name="$ZodError",Object.defineProperty(n,"_zod",{value:n._zod,enumerable:!1}),Object.defineProperty(n,"issues",{value:e,enumerable:!1}),n.message=JSON.stringify(e,og,2),Object.defineProperty(n,"toString",{value:()=>n.message,enumerable:!1})},tk=F("$ZodError",ek),nk=F("$ZodError",ek,{Parent:Error});function KI(n,e=t=>t.message){const t={},r=[];for(const i of n.issues)i.path.length>0?(t[i.path[0]]=t[i.path[0]]||[],t[i.path[0]].push(e(i))):r.push(e(i));return{formErrors:r,fieldErrors:t}}function cg(n,e=t=>t.message){const t={_errors:[]},r=i=>{for(const o of i.issues)if(o.code==="invalid_union"&&o.errors.length)o.errors.map(l=>r({issues:l}));else if(o.code==="invalid_key")r({issues:o.issues});else if(o.code==="invalid_element")r({issues:o.issues});else if(o.path.length===0)t._errors.push(e(o));else{let l=t,f=0;for(;f<o.path.length;){const h=o.path[f];f===o.path.length-1?(l[h]=l[h]||{_errors:[]},l[h]._errors.push(e(o))):l[h]=l[h]||{_errors:[]},l=l[h],f++}}};return r(n),t}const dw=n=>(e,t,r,i)=>{const o=r?Object.assign(r,{async:!1}):{async:!1},l=e._zod.run({value:t,issues:[]},o);if(l instanceof Promise)throw new Co;if(l.issues.length){const f=new(i?.Err??n)(l.issues.map(h=>di(h,o,hi())));throw QA(f,i?.callee),f}return l.value},mw=n=>async(e,t,r,i)=>{const o=r?Object.assign(r,{async:!0}):{async:!0};let l=e._zod.run({value:t,issues:[]},o);if(l instanceof Promise&&(l=await l),l.issues.length){const f=new(i?.Err??n)(l.issues.map(h=>di(h,o,hi())));throw QA(f,i?.callee),f}return l.value},ud=n=>(e,t,r)=>{const i=r?{...r,async:!1}:{async:!1},o=e._zod.run({value:t,issues:[]},i);if(o instanceof Promise)throw new Co;return o.issues.length?{success:!1,error:new(n??tk)(o.issues.map(l=>di(l,i,hi())))}:{success:!0,data:o.value}},jI=ud(nk),fd=n=>async(e,t,r)=>{const i=r?Object.assign(r,{async:!0}):{async:!0};let o=e._zod.run({value:t,issues:[]},i);return o instanceof Promise&&(o=await o),o.issues.length?{success:!1,error:new n(o.issues.map(l=>di(l,i,hi())))}:{success:!0,data:o.value}},HI=fd(nk),qI=n=>(e,t,r)=>{const i=r?Object.assign(r,{direction:"backward"}):{direction:"backward"};return dw(n)(e,t,i)},FI=n=>(e,t,r)=>dw(n)(e,t,r),VI=n=>async(e,t,r)=>{const i=r?Object.assign(r,{direction:"backward"}):{direction:"backward"};return mw(n)(e,t,i)},GI=n=>async(e,t,r)=>mw(n)(e,t,r),ZI=n=>(e,t,r)=>{const i=r?Object.assign(r,{direction:"backward"}):{direction:"backward"};return ud(n)(e,t,i)},JI=n=>(e,t,r)=>ud(n)(e,t,r),WI=n=>async(e,t,r)=>{const i=r?Object.assign(r,{direction:"backward"}):{direction:"backward"};return fd(n)(e,t,i)},YI=n=>async(e,t,r)=>fd(n)(e,t,r),QI=/^[cC][^\s-]{8,}$/,XI=/^[0-9a-z]+$/,eU=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,tU=/^[0-9a-vA-V]{20}$/,nU=/^[A-Za-z0-9]{27}$/,rU=/^[a-zA-Z0-9_-]{21}$/,sU=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,iU=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,z0=n=>n?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${n}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/,aU=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,oU="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function cU(){return new RegExp(oU,"u")}const lU=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,uU=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/,fU=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,hU=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,dU=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,rk=/^[A-Za-z0-9_-]*$/,mU=/^\+[1-9]\d{6,14}$/,sk="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",pU=new RegExp(`^${sk}$`);function ik(n){const e="(?:[01]\\d|2[0-3]):[0-5]\\d";return typeof n.precision=="number"?n.precision===-1?`${e}`:n.precision===0?`${e}:[0-5]\\d`:`${e}:[0-5]\\d\\.\\d{${n.precision}}`:`${e}(?::[0-5]\\d(?:\\.\\d+)?)?`}function yU(n){return new RegExp(`^${ik(n)}$`)}function gU(n){const e=ik({precision:n.precision}),t=["Z"];n.local&&t.push(""),n.offset&&t.push("([+-](?:[01]\\d|2[0-3]):[0-5]\\d)");const r=`${e}(?:${t.join("|")})`;return new RegExp(`^${sk}T(?:${r})$`)}const wU=n=>{const e=n?`[\\s\\S]{${n?.minimum??0},${n?.maximum??""}}`:"[\\s\\S]*";return new RegExp(`^${e}$`)},bU=/^-?\d+$/,ak=/^-?\d+(?:\.\d+)?$/,vU=/^(?:true|false)$/i,SU=/^[^A-Z]*$/,EU=/^[^a-z]*$/,Cn=F("$ZodCheck",(n,e)=>{var t;n._zod??(n._zod={}),n._zod.def=e,(t=n._zod).onattach??(t.onattach=[])}),ok={number:"number",bigint:"bigint",object:"date"},ck=F("$ZodCheckLessThan",(n,e)=>{Cn.init(n,e);const t=ok[typeof e.value];n._zod.onattach.push(r=>{const i=r._zod.bag,o=(e.inclusive?i.maximum:i.exclusiveMaximum)??Number.POSITIVE_INFINITY;e.value<o&&(e.inclusive?i.maximum=e.value:i.exclusiveMaximum=e.value)}),n._zod.check=r=>{(e.inclusive?r.value<=e.value:r.value<e.value)||r.issues.push({origin:t,code:"too_big",maximum:typeof e.value=="object"?e.value.getTime():e.value,input:r.value,inclusive:e.inclusive,inst:n,continue:!e.abort})}}),lk=F("$ZodCheckGreaterThan",(n,e)=>{Cn.init(n,e);const t=ok[typeof e.value];n._zod.onattach.push(r=>{const i=r._zod.bag,o=(e.inclusive?i.minimum:i.exclusiveMinimum)??Number.NEGATIVE_INFINITY;e.value>o&&(e.inclusive?i.minimum=e.value:i.exclusiveMinimum=e.value)}),n._zod.check=r=>{(e.inclusive?r.value>=e.value:r.value>e.value)||r.issues.push({origin:t,code:"too_small",minimum:typeof e.value=="object"?e.value.getTime():e.value,input:r.value,inclusive:e.inclusive,inst:n,continue:!e.abort})}}),_U=F("$ZodCheckMultipleOf",(n,e)=>{Cn.init(n,e),n._zod.onattach.push(t=>{var r;(r=t._zod.bag).multipleOf??(r.multipleOf=e.value)}),n._zod.check=t=>{if(typeof t.value!=typeof e.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof t.value=="bigint"?t.value%e.value===BigInt(0):CI(t.value,e.value)===0)||t.issues.push({origin:typeof t.value,code:"not_multiple_of",divisor:e.value,input:t.value,inst:n,continue:!e.abort})}}),AU=F("$ZodCheckNumberFormat",(n,e)=>{Cn.init(n,e),e.format=e.format||"float64";const t=e.format?.includes("int"),r=t?"int":"number",[i,o]=xI[e.format];n._zod.onattach.push(l=>{const f=l._zod.bag;f.format=e.format,f.minimum=i,f.maximum=o,t&&(f.pattern=bU)}),n._zod.check=l=>{const f=l.value;if(t){if(!Number.isInteger(f)){l.issues.push({expected:r,format:e.format,code:"invalid_type",continue:!1,input:f,inst:n});return}if(!Number.isSafeInteger(f)){f>0?l.issues.push({input:f,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:n,origin:r,inclusive:!0,continue:!e.abort}):l.issues.push({input:f,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:n,origin:r,inclusive:!0,continue:!e.abort});return}}f<i&&l.issues.push({origin:"number",input:f,code:"too_small",minimum:i,inclusive:!0,inst:n,continue:!e.abort}),f>o&&l.issues.push({origin:"number",input:f,code:"too_big",maximum:o,inclusive:!0,inst:n,continue:!e.abort})}}),kU=F("$ZodCheckMaxLength",(n,e)=>{var t;Cn.init(n,e),(t=n._zod.def).when??(t.when=r=>{const i=r.value;return!uw(i)&&i.length!==void 0}),n._zod.onattach.push(r=>{const i=r._zod.bag.maximum??Number.POSITIVE_INFINITY;e.maximum<i&&(r._zod.bag.maximum=e.maximum)}),n._zod.check=r=>{const i=r.value;if(i.length<=e.maximum)return;const l=hw(i);r.issues.push({origin:l,code:"too_big",maximum:e.maximum,inclusive:!0,input:i,inst:n,continue:!e.abort})}}),TU=F("$ZodCheckMinLength",(n,e)=>{var t;Cn.init(n,e),(t=n._zod.def).when??(t.when=r=>{const i=r.value;return!uw(i)&&i.length!==void 0}),n._zod.onattach.push(r=>{const i=r._zod.bag.minimum??Number.NEGATIVE_INFINITY;e.minimum>i&&(r._zod.bag.minimum=e.minimum)}),n._zod.check=r=>{const i=r.value;if(i.length>=e.minimum)return;const l=hw(i);r.issues.push({origin:l,code:"too_small",minimum:e.minimum,inclusive:!0,input:i,inst:n,continue:!e.abort})}}),OU=F("$ZodCheckLengthEquals",(n,e)=>{var t;Cn.init(n,e),(t=n._zod.def).when??(t.when=r=>{const i=r.value;return!uw(i)&&i.length!==void 0}),n._zod.onattach.push(r=>{const i=r._zod.bag;i.minimum=e.length,i.maximum=e.length,i.length=e.length}),n._zod.check=r=>{const i=r.value,o=i.length;if(o===e.length)return;const l=hw(i),f=o>e.length;r.issues.push({origin:l,...f?{code:"too_big",maximum:e.length}:{code:"too_small",minimum:e.length},inclusive:!0,exact:!0,input:r.value,inst:n,continue:!e.abort})}}),hd=F("$ZodCheckStringFormat",(n,e)=>{var t,r;Cn.init(n,e),n._zod.onattach.push(i=>{const o=i._zod.bag;o.format=e.format,e.pattern&&(o.patterns??(o.patterns=new Set),o.patterns.add(e.pattern))}),e.pattern?(t=n._zod).check??(t.check=i=>{e.pattern.lastIndex=0,!e.pattern.test(i.value)&&i.issues.push({origin:"string",code:"invalid_format",format:e.format,input:i.value,...e.pattern?{pattern:e.pattern.toString()}:{},inst:n,continue:!e.abort})}):(r=n._zod).check??(r.check=()=>{})}),CU=F("$ZodCheckRegex",(n,e)=>{hd.init(n,e),n._zod.check=t=>{e.pattern.lastIndex=0,!e.pattern.test(t.value)&&t.issues.push({origin:"string",code:"invalid_format",format:"regex",input:t.value,pattern:e.pattern.toString(),inst:n,continue:!e.abort})}}),MU=F("$ZodCheckLowerCase",(n,e)=>{e.pattern??(e.pattern=SU),hd.init(n,e)}),NU=F("$ZodCheckUpperCase",(n,e)=>{e.pattern??(e.pattern=EU),hd.init(n,e)}),RU=F("$ZodCheckIncludes",(n,e)=>{Cn.init(n,e);const t=Uo(e.includes),r=new RegExp(typeof e.position=="number"?`^.{${e.position}}${t}`:t);e.pattern=r,n._zod.onattach.push(i=>{const o=i._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(r)}),n._zod.check=i=>{i.value.includes(e.includes,e.position)||i.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:e.includes,input:i.value,inst:n,continue:!e.abort})}}),DU=F("$ZodCheckStartsWith",(n,e)=>{Cn.init(n,e);const t=new RegExp(`^${Uo(e.prefix)}.*`);e.pattern??(e.pattern=t),n._zod.onattach.push(r=>{const i=r._zod.bag;i.patterns??(i.patterns=new Set),i.patterns.add(t)}),n._zod.check=r=>{r.value.startsWith(e.prefix)||r.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:e.prefix,input:r.value,inst:n,continue:!e.abort})}}),xU=F("$ZodCheckEndsWith",(n,e)=>{Cn.init(n,e);const t=new RegExp(`.*${Uo(e.suffix)}$`);e.pattern??(e.pattern=t),n._zod.onattach.push(r=>{const i=r._zod.bag;i.patterns??(i.patterns=new Set),i.patterns.add(t)}),n._zod.check=r=>{r.value.endsWith(e.suffix)||r.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:e.suffix,input:r.value,inst:n,continue:!e.abort})}}),IU=F("$ZodCheckOverwrite",(n,e)=>{Cn.init(n,e),n._zod.check=t=>{t.value=e.tx(t.value)}});class UU{constructor(e=[]){this.content=[],this.indent=0,this&&(this.args=e)}indented(e){this.indent+=1,e(this),this.indent-=1}write(e){if(typeof e=="function"){e(this,{execution:"sync"}),e(this,{execution:"async"});return}const r=e.split(`
`).filter(l=>l),i=Math.min(...r.map(l=>l.length-l.trimStart().length)),o=r.map(l=>l.slice(i)).map(l=>" ".repeat(this.indent*2)+l);for(const l of o)this.content.push(l)}compile(){const e=Function,t=this?.args,i=[...(this?.content??[""]).map(o=>`  ${o}`)];return new e(...t,i.join(`
`))}}const zU={major:4,minor:3,patch:6},at=F("$ZodType",(n,e)=>{var t;n??(n={}),n._zod.def=e,n._zod.bag=n._zod.bag||{},n._zod.version=zU;const r=[...n._zod.def.checks??[]];n._zod.traits.has("$ZodCheck")&&r.unshift(n);for(const i of r)for(const o of i._zod.onattach)o(n);if(r.length===0)(t=n._zod).deferred??(t.deferred=[]),n._zod.deferred?.push(()=>{n._zod.run=n._zod.parse});else{const i=(l,f,h)=>{let m=bo(l),y;for(const g of f){if(g._zod.def.when){if(!g._zod.def.when(l))continue}else if(m)continue;const b=l.issues.length,E=g._zod.check(l);if(E instanceof Promise&&h?.async===!1)throw new Co;if(y||E instanceof Promise)y=(y??Promise.resolve()).then(async()=>{await E,l.issues.length!==b&&(m||(m=bo(l,b)))});else{if(l.issues.length===b)continue;m||(m=bo(l,b))}}return y?y.then(()=>l):l},o=(l,f,h)=>{if(bo(l))return l.aborted=!0,l;const m=i(f,r,h);if(m instanceof Promise){if(h.async===!1)throw new Co;return m.then(y=>n._zod.parse(y,h))}return n._zod.parse(m,h)};n._zod.run=(l,f)=>{if(f.skipChecks)return n._zod.parse(l,f);if(f.direction==="backward"){const m=n._zod.parse({value:l.value,issues:[]},{...f,skipChecks:!0});return m instanceof Promise?m.then(y=>o(y,l,f)):o(m,l,f)}const h=n._zod.parse(l,f);if(h instanceof Promise){if(f.async===!1)throw new Co;return h.then(m=>i(m,r,f))}return i(h,r,f)}}Ve(n,"~standard",()=>({validate:i=>{try{const o=jI(n,i);return o.success?{value:o.data}:{issues:o.error?.issues}}catch{return HI(n,i).then(l=>l.success?{value:l.data}:{issues:l.error?.issues})}},vendor:"zod",version:1}))}),pw=F("$ZodString",(n,e)=>{at.init(n,e),n._zod.pattern=[...n?._zod.bag?.patterns??[]].pop()??wU(n._zod.bag),n._zod.parse=(t,r)=>{if(e.coerce)try{t.value=String(t.value)}catch{}return typeof t.value=="string"||t.issues.push({expected:"string",code:"invalid_type",input:t.value,inst:n}),t}}),mt=F("$ZodStringFormat",(n,e)=>{hd.init(n,e),pw.init(n,e)}),LU=F("$ZodGUID",(n,e)=>{e.pattern??(e.pattern=iU),mt.init(n,e)}),BU=F("$ZodUUID",(n,e)=>{if(e.version){const r={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[e.version];if(r===void 0)throw new Error(`Invalid UUID version: "${e.version}"`);e.pattern??(e.pattern=z0(r))}else e.pattern??(e.pattern=z0());mt.init(n,e)}),PU=F("$ZodEmail",(n,e)=>{e.pattern??(e.pattern=aU),mt.init(n,e)}),$U=F("$ZodURL",(n,e)=>{mt.init(n,e),n._zod.check=t=>{try{const r=t.value.trim(),i=new URL(r);e.hostname&&(e.hostname.lastIndex=0,e.hostname.test(i.hostname)||t.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:e.hostname.source,input:t.value,inst:n,continue:!e.abort})),e.protocol&&(e.protocol.lastIndex=0,e.protocol.test(i.protocol.endsWith(":")?i.protocol.slice(0,-1):i.protocol)||t.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:e.protocol.source,input:t.value,inst:n,continue:!e.abort})),e.normalize?t.value=i.href:t.value=r;return}catch{t.issues.push({code:"invalid_format",format:"url",input:t.value,inst:n,continue:!e.abort})}}}),KU=F("$ZodEmoji",(n,e)=>{e.pattern??(e.pattern=cU()),mt.init(n,e)}),jU=F("$ZodNanoID",(n,e)=>{e.pattern??(e.pattern=rU),mt.init(n,e)}),HU=F("$ZodCUID",(n,e)=>{e.pattern??(e.pattern=QI),mt.init(n,e)}),qU=F("$ZodCUID2",(n,e)=>{e.pattern??(e.pattern=XI),mt.init(n,e)}),FU=F("$ZodULID",(n,e)=>{e.pattern??(e.pattern=eU),mt.init(n,e)}),VU=F("$ZodXID",(n,e)=>{e.pattern??(e.pattern=tU),mt.init(n,e)}),GU=F("$ZodKSUID",(n,e)=>{e.pattern??(e.pattern=nU),mt.init(n,e)}),ZU=F("$ZodISODateTime",(n,e)=>{e.pattern??(e.pattern=gU(e)),mt.init(n,e)}),JU=F("$ZodISODate",(n,e)=>{e.pattern??(e.pattern=pU),mt.init(n,e)}),WU=F("$ZodISOTime",(n,e)=>{e.pattern??(e.pattern=yU(e)),mt.init(n,e)}),YU=F("$ZodISODuration",(n,e)=>{e.pattern??(e.pattern=sU),mt.init(n,e)}),QU=F("$ZodIPv4",(n,e)=>{e.pattern??(e.pattern=lU),mt.init(n,e),n._zod.bag.format="ipv4"}),XU=F("$ZodIPv6",(n,e)=>{e.pattern??(e.pattern=uU),mt.init(n,e),n._zod.bag.format="ipv6",n._zod.check=t=>{try{new URL(`http://[${t.value}]`)}catch{t.issues.push({code:"invalid_format",format:"ipv6",input:t.value,inst:n,continue:!e.abort})}}}),ez=F("$ZodCIDRv4",(n,e)=>{e.pattern??(e.pattern=fU),mt.init(n,e)}),tz=F("$ZodCIDRv6",(n,e)=>{e.pattern??(e.pattern=hU),mt.init(n,e),n._zod.check=t=>{const r=t.value.split("/");try{if(r.length!==2)throw new Error;const[i,o]=r;if(!o)throw new Error;const l=Number(o);if(`${l}`!==o)throw new Error;if(l<0||l>128)throw new Error;new URL(`http://[${i}]`)}catch{t.issues.push({code:"invalid_format",format:"cidrv6",input:t.value,inst:n,continue:!e.abort})}}});function uk(n){if(n==="")return!0;if(n.length%4!==0)return!1;try{return atob(n),!0}catch{return!1}}const nz=F("$ZodBase64",(n,e)=>{e.pattern??(e.pattern=dU),mt.init(n,e),n._zod.bag.contentEncoding="base64",n._zod.check=t=>{uk(t.value)||t.issues.push({code:"invalid_format",format:"base64",input:t.value,inst:n,continue:!e.abort})}});function rz(n){if(!rk.test(n))return!1;const e=n.replace(/[-_]/g,r=>r==="-"?"+":"/"),t=e.padEnd(Math.ceil(e.length/4)*4,"=");return uk(t)}const sz=F("$ZodBase64URL",(n,e)=>{e.pattern??(e.pattern=rk),mt.init(n,e),n._zod.bag.contentEncoding="base64url",n._zod.check=t=>{rz(t.value)||t.issues.push({code:"invalid_format",format:"base64url",input:t.value,inst:n,continue:!e.abort})}}),iz=F("$ZodE164",(n,e)=>{e.pattern??(e.pattern=mU),mt.init(n,e)});function az(n,e=null){try{const t=n.split(".");if(t.length!==3)return!1;const[r]=t;if(!r)return!1;const i=JSON.parse(atob(r));return!("typ"in i&&i?.typ!=="JWT"||!i.alg||e&&(!("alg"in i)||i.alg!==e))}catch{return!1}}const oz=F("$ZodJWT",(n,e)=>{mt.init(n,e),n._zod.check=t=>{az(t.value,e.alg)||t.issues.push({code:"invalid_format",format:"jwt",input:t.value,inst:n,continue:!e.abort})}}),fk=F("$ZodNumber",(n,e)=>{at.init(n,e),n._zod.pattern=n._zod.bag.pattern??ak,n._zod.parse=(t,r)=>{if(e.coerce)try{t.value=Number(t.value)}catch{}const i=t.value;if(typeof i=="number"&&!Number.isNaN(i)&&Number.isFinite(i))return t;const o=typeof i=="number"?Number.isNaN(i)?"NaN":Number.isFinite(i)?void 0:"Infinity":void 0;return t.issues.push({expected:"number",code:"invalid_type",input:i,inst:n,...o?{received:o}:{}}),t}}),cz=F("$ZodNumberFormat",(n,e)=>{AU.init(n,e),fk.init(n,e)}),lz=F("$ZodBoolean",(n,e)=>{at.init(n,e),n._zod.pattern=vU,n._zod.parse=(t,r)=>{if(e.coerce)try{t.value=!!t.value}catch{}const i=t.value;return typeof i=="boolean"||t.issues.push({expected:"boolean",code:"invalid_type",input:i,inst:n}),t}}),uz=F("$ZodAny",(n,e)=>{at.init(n,e),n._zod.parse=t=>t}),fz=F("$ZodUnknown",(n,e)=>{at.init(n,e),n._zod.parse=t=>t}),hz=F("$ZodNever",(n,e)=>{at.init(n,e),n._zod.parse=(t,r)=>(t.issues.push({expected:"never",code:"invalid_type",input:t.value,inst:n}),t)}),dz=F("$ZodDate",(n,e)=>{at.init(n,e),n._zod.parse=(t,r)=>{if(e.coerce)try{t.value=new Date(t.value)}catch{}const i=t.value,o=i instanceof Date;return o&&!Number.isNaN(i.getTime())||t.issues.push({expected:"date",code:"invalid_type",input:i,...o?{received:"Invalid Date"}:{},inst:n}),t}});function L0(n,e,t){n.issues.length&&e.issues.push(...vo(t,n.issues)),e.value[t]=n.value}const mz=F("$ZodArray",(n,e)=>{at.init(n,e),n._zod.parse=(t,r)=>{const i=t.value;if(!Array.isArray(i))return t.issues.push({expected:"array",code:"invalid_type",input:i,inst:n}),t;t.value=Array(i.length);const o=[];for(let l=0;l<i.length;l++){const f=i[l],h=e.element._zod.run({value:f,issues:[]},r);h instanceof Promise?o.push(h.then(m=>L0(m,t,l))):L0(h,t,l)}return o.length?Promise.all(o).then(()=>t):t}});function Ah(n,e,t,r,i){if(n.issues.length){if(i&&!(t in r))return;e.issues.push(...vo(t,n.issues))}n.value===void 0?t in r&&(e.value[t]=void 0):e.value[t]=n.value}function hk(n){const e=Object.keys(n.shape);for(const r of e)if(!n.shape?.[r]?._zod?.traits?.has("$ZodType"))throw new Error(`Invalid element at key "${r}": expected a Zod schema`);const t=DI(n.shape);return{...n,keys:e,keySet:new Set(e),numKeys:e.length,optionalKeys:new Set(t)}}function dk(n,e,t,r,i,o){const l=[],f=i.keySet,h=i.catchall._zod,m=h.def.type,y=h.optout==="optional";for(const g in e){if(f.has(g))continue;if(m==="never"){l.push(g);continue}const b=h.run({value:e[g],issues:[]},r);b instanceof Promise?n.push(b.then(E=>Ah(E,t,g,e,y))):Ah(b,t,g,e,y)}return l.length&&t.issues.push({code:"unrecognized_keys",keys:l,input:e,inst:o}),n.length?Promise.all(n).then(()=>t):t}const pz=F("$ZodObject",(n,e)=>{if(at.init(n,e),!Object.getOwnPropertyDescriptor(e,"shape")?.get){const f=e.shape;Object.defineProperty(e,"shape",{get:()=>{const h={...f};return Object.defineProperty(e,"shape",{value:h}),h}})}const r=ld(()=>hk(e));Ve(n._zod,"propValues",()=>{const f=e.shape,h={};for(const m in f){const y=f[m]._zod;if(y.values){h[m]??(h[m]=new Set);for(const g of y.values)h[m].add(g)}}return h});const i=Pl,o=e.catchall;let l;n._zod.parse=(f,h)=>{l??(l=r.value);const m=f.value;if(!i(m))return f.issues.push({expected:"object",code:"invalid_type",input:m,inst:n}),f;f.value={};const y=[],g=l.shape;for(const b of l.keys){const E=g[b],_=E._zod.optout==="optional",S=E._zod.run({value:m[b],issues:[]},h);S instanceof Promise?y.push(S.then(k=>Ah(k,f,b,m,_))):Ah(S,f,b,m,_)}return o?dk(y,m,f,h,r.value,n):y.length?Promise.all(y).then(()=>f):f}}),yz=F("$ZodObjectJIT",(n,e)=>{pz.init(n,e);const t=n._zod.parse,r=ld(()=>hk(e)),i=b=>{const E=new UU(["shape","payload","ctx"]),_=r.value,S=$=>{const L=U0($);return`shape[${L}]._zod.run({ value: input[${L}], issues: [] }, ctx)`};E.write("const input = payload.value;");const k=Object.create(null);let M=0;for(const $ of _.keys)k[$]=`key_${M++}`;E.write("const newResult = {};");for(const $ of _.keys){const L=k[$],j=U0($),G=b[$]?._zod?.optout==="optional";E.write(`const ${L} = ${S($)};`),G?E.write(`
        if (${L}.issues.length) {
          if (${j} in input) {
            payload.issues = payload.issues.concat(${L}.issues.map(iss => ({
              ...iss,
              path: iss.path ? [${j}, ...iss.path] : [${j}]
            })));
          }
        }
        
        if (${L}.value === undefined) {
          if (${j} in input) {
            newResult[${j}] = undefined;
          }
        } else {
          newResult[${j}] = ${L}.value;
        }
        
      `):E.write(`
        if (${L}.issues.length) {
          payload.issues = payload.issues.concat(${L}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${j}, ...iss.path] : [${j}]
          })));
        }
        
        if (${L}.value === undefined) {
          if (${j} in input) {
            newResult[${j}] = undefined;
          }
        } else {
          newResult[${j}] = ${L}.value;
        }
        
      `)}E.write("payload.value = newResult;"),E.write("return payload;");const x=E.compile();return($,L)=>x(b,$,L)};let o;const l=Pl,f=!WA.jitless,m=f&&NI.value,y=e.catchall;let g;n._zod.parse=(b,E)=>{g??(g=r.value);const _=b.value;return l(_)?f&&m&&E?.async===!1&&E.jitless!==!0?(o||(o=i(e.shape)),b=o(b,E),y?dk([],_,b,E,g,n):b):t(b,E):(b.issues.push({expected:"object",code:"invalid_type",input:_,inst:n}),b)}});function B0(n,e,t,r){for(const o of n)if(o.issues.length===0)return e.value=o.value,e;const i=n.filter(o=>!bo(o));return i.length===1?(e.value=i[0].value,i[0]):(e.issues.push({code:"invalid_union",input:e.value,inst:t,errors:n.map(o=>o.issues.map(l=>di(l,r,hi())))}),e)}const mk=F("$ZodUnion",(n,e)=>{at.init(n,e),Ve(n._zod,"optin",()=>e.options.some(i=>i._zod.optin==="optional")?"optional":void 0),Ve(n._zod,"optout",()=>e.options.some(i=>i._zod.optout==="optional")?"optional":void 0),Ve(n._zod,"values",()=>{if(e.options.every(i=>i._zod.values))return new Set(e.options.flatMap(i=>Array.from(i._zod.values)))}),Ve(n._zod,"pattern",()=>{if(e.options.every(i=>i._zod.pattern)){const i=e.options.map(o=>o._zod.pattern);return new RegExp(`^(${i.map(o=>fw(o.source)).join("|")})$`)}});const t=e.options.length===1,r=e.options[0]._zod.run;n._zod.parse=(i,o)=>{if(t)return r(i,o);let l=!1;const f=[];for(const h of e.options){const m=h._zod.run({value:i.value,issues:[]},o);if(m instanceof Promise)f.push(m),l=!0;else{if(m.issues.length===0)return m;f.push(m)}}return l?Promise.all(f).then(h=>B0(h,i,n,o)):B0(f,i,n,o)}}),gz=F("$ZodDiscriminatedUnion",(n,e)=>{e.inclusive=!1,mk.init(n,e);const t=n._zod.parse;Ve(n._zod,"propValues",()=>{const i={};for(const o of e.options){const l=o._zod.propValues;if(!l||Object.keys(l).length===0)throw new Error(`Invalid discriminated union option at index "${e.options.indexOf(o)}"`);for(const[f,h]of Object.entries(l)){i[f]||(i[f]=new Set);for(const m of h)i[f].add(m)}}return i});const r=ld(()=>{const i=e.options,o=new Map;for(const l of i){const f=l._zod.propValues?.[e.discriminator];if(!f||f.size===0)throw new Error(`Invalid discriminated union option at index "${e.options.indexOf(l)}"`);for(const h of f){if(o.has(h))throw new Error(`Duplicate discriminator value "${String(h)}"`);o.set(h,l)}}return o});n._zod.parse=(i,o)=>{const l=i.value;if(!Pl(l))return i.issues.push({code:"invalid_type",expected:"object",input:l,inst:n}),i;const f=r.value.get(l?.[e.discriminator]);return f?f._zod.run(i,o):e.unionFallback?t(i,o):(i.issues.push({code:"invalid_union",errors:[],note:"No matching discriminator",discriminator:e.discriminator,input:l,path:[e.discriminator],inst:n}),i)}}),wz=F("$ZodIntersection",(n,e)=>{at.init(n,e),n._zod.parse=(t,r)=>{const i=t.value,o=e.left._zod.run({value:i,issues:[]},r),l=e.right._zod.run({value:i,issues:[]},r);return o instanceof Promise||l instanceof Promise?Promise.all([o,l]).then(([h,m])=>P0(t,h,m)):P0(t,o,l)}});function lg(n,e){if(n===e)return{valid:!0,data:n};if(n instanceof Date&&e instanceof Date&&+n==+e)return{valid:!0,data:n};if(Io(n)&&Io(e)){const t=Object.keys(e),r=Object.keys(n).filter(o=>t.indexOf(o)!==-1),i={...n,...e};for(const o of r){const l=lg(n[o],e[o]);if(!l.valid)return{valid:!1,mergeErrorPath:[o,...l.mergeErrorPath]};i[o]=l.data}return{valid:!0,data:i}}if(Array.isArray(n)&&Array.isArray(e)){if(n.length!==e.length)return{valid:!1,mergeErrorPath:[]};const t=[];for(let r=0;r<n.length;r++){const i=n[r],o=e[r],l=lg(i,o);if(!l.valid)return{valid:!1,mergeErrorPath:[r,...l.mergeErrorPath]};t.push(l.data)}return{valid:!0,data:t}}return{valid:!1,mergeErrorPath:[]}}function P0(n,e,t){const r=new Map;let i;for(const f of e.issues)if(f.code==="unrecognized_keys"){i??(i=f);for(const h of f.keys)r.has(h)||r.set(h,{}),r.get(h).l=!0}else n.issues.push(f);for(const f of t.issues)if(f.code==="unrecognized_keys")for(const h of f.keys)r.has(h)||r.set(h,{}),r.get(h).r=!0;else n.issues.push(f);const o=[...r].filter(([,f])=>f.l&&f.r).map(([f])=>f);if(o.length&&i&&n.issues.push({...i,keys:o}),bo(n))return n;const l=lg(e.value,t.value);if(!l.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(l.mergeErrorPath)}`);return n.value=l.data,n}const bz=F("$ZodRecord",(n,e)=>{at.init(n,e),n._zod.parse=(t,r)=>{const i=t.value;if(!Io(i))return t.issues.push({expected:"record",code:"invalid_type",input:i,inst:n}),t;const o=[],l=e.keyType._zod.values;if(l){t.value={};const f=new Set;for(const m of l)if(typeof m=="string"||typeof m=="number"||typeof m=="symbol"){f.add(typeof m=="number"?m.toString():m);const y=e.valueType._zod.run({value:i[m],issues:[]},r);y instanceof Promise?o.push(y.then(g=>{g.issues.length&&t.issues.push(...vo(m,g.issues)),t.value[m]=g.value})):(y.issues.length&&t.issues.push(...vo(m,y.issues)),t.value[m]=y.value)}let h;for(const m in i)f.has(m)||(h=h??[],h.push(m));h&&h.length>0&&t.issues.push({code:"unrecognized_keys",input:i,inst:n,keys:h})}else{t.value={};for(const f of Reflect.ownKeys(i)){if(f==="__proto__")continue;let h=e.keyType._zod.run({value:f,issues:[]},r);if(h instanceof Promise)throw new Error("Async schemas not supported in object keys currently");if(typeof f=="string"&&ak.test(f)&&h.issues.length){const g=e.keyType._zod.run({value:Number(f),issues:[]},r);if(g instanceof Promise)throw new Error("Async schemas not supported in object keys currently");g.issues.length===0&&(h=g)}if(h.issues.length){e.mode==="loose"?t.value[f]=i[f]:t.issues.push({code:"invalid_key",origin:"record",issues:h.issues.map(g=>di(g,r,hi())),input:f,path:[f],inst:n});continue}const y=e.valueType._zod.run({value:i[f],issues:[]},r);y instanceof Promise?o.push(y.then(g=>{g.issues.length&&t.issues.push(...vo(f,g.issues)),t.value[h.value]=g.value})):(y.issues.length&&t.issues.push(...vo(f,y.issues)),t.value[h.value]=y.value)}}return o.length?Promise.all(o).then(()=>t):t}}),vz=F("$ZodEnum",(n,e)=>{at.init(n,e);const t=YA(e.entries),r=new Set(t);n._zod.values=r,n._zod.pattern=new RegExp(`^(${t.filter(i=>RI.has(typeof i)).map(i=>typeof i=="string"?Uo(i):i.toString()).join("|")})$`),n._zod.parse=(i,o)=>{const l=i.value;return r.has(l)||i.issues.push({code:"invalid_value",values:t,input:l,inst:n}),i}}),Sz=F("$ZodLiteral",(n,e)=>{if(at.init(n,e),e.values.length===0)throw new Error("Cannot create literal schema with no valid values");const t=new Set(e.values);n._zod.values=t,n._zod.pattern=new RegExp(`^(${e.values.map(r=>typeof r=="string"?Uo(r):r?Uo(r.toString()):String(r)).join("|")})$`),n._zod.parse=(r,i)=>{const o=r.value;return t.has(o)||r.issues.push({code:"invalid_value",values:e.values,input:o,inst:n}),r}}),Ez=F("$ZodTransform",(n,e)=>{at.init(n,e),n._zod.parse=(t,r)=>{if(r.direction==="backward")throw new JA(n.constructor.name);const i=e.transform(t.value,t);if(r.async)return(i instanceof Promise?i:Promise.resolve(i)).then(l=>(t.value=l,t));if(i instanceof Promise)throw new Co;return t.value=i,t}});function $0(n,e){return n.issues.length&&e===void 0?{issues:[],value:void 0}:n}const pk=F("$ZodOptional",(n,e)=>{at.init(n,e),n._zod.optin="optional",n._zod.optout="optional",Ve(n._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,void 0]):void 0),Ve(n._zod,"pattern",()=>{const t=e.innerType._zod.pattern;return t?new RegExp(`^(${fw(t.source)})?$`):void 0}),n._zod.parse=(t,r)=>{if(e.innerType._zod.optin==="optional"){const i=e.innerType._zod.run(t,r);return i instanceof Promise?i.then(o=>$0(o,t.value)):$0(i,t.value)}return t.value===void 0?t:e.innerType._zod.run(t,r)}}),_z=F("$ZodExactOptional",(n,e)=>{pk.init(n,e),Ve(n._zod,"values",()=>e.innerType._zod.values),Ve(n._zod,"pattern",()=>e.innerType._zod.pattern),n._zod.parse=(t,r)=>e.innerType._zod.run(t,r)}),Az=F("$ZodNullable",(n,e)=>{at.init(n,e),Ve(n._zod,"optin",()=>e.innerType._zod.optin),Ve(n._zod,"optout",()=>e.innerType._zod.optout),Ve(n._zod,"pattern",()=>{const t=e.innerType._zod.pattern;return t?new RegExp(`^(${fw(t.source)}|null)$`):void 0}),Ve(n._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,null]):void 0),n._zod.parse=(t,r)=>t.value===null?t:e.innerType._zod.run(t,r)}),kz=F("$ZodDefault",(n,e)=>{at.init(n,e),n._zod.optin="optional",Ve(n._zod,"values",()=>e.innerType._zod.values),n._zod.parse=(t,r)=>{if(r.direction==="backward")return e.innerType._zod.run(t,r);if(t.value===void 0)return t.value=e.defaultValue,t;const i=e.innerType._zod.run(t,r);return i instanceof Promise?i.then(o=>K0(o,e)):K0(i,e)}});function K0(n,e){return n.value===void 0&&(n.value=e.defaultValue),n}const Tz=F("$ZodPrefault",(n,e)=>{at.init(n,e),n._zod.optin="optional",Ve(n._zod,"values",()=>e.innerType._zod.values),n._zod.parse=(t,r)=>(r.direction==="backward"||t.value===void 0&&(t.value=e.defaultValue),e.innerType._zod.run(t,r))}),Oz=F("$ZodNonOptional",(n,e)=>{at.init(n,e),Ve(n._zod,"values",()=>{const t=e.innerType._zod.values;return t?new Set([...t].filter(r=>r!==void 0)):void 0}),n._zod.parse=(t,r)=>{const i=e.innerType._zod.run(t,r);return i instanceof Promise?i.then(o=>j0(o,n)):j0(i,n)}});function j0(n,e){return!n.issues.length&&n.value===void 0&&n.issues.push({code:"invalid_type",expected:"nonoptional",input:n.value,inst:e}),n}const Cz=F("$ZodCatch",(n,e)=>{at.init(n,e),Ve(n._zod,"optin",()=>e.innerType._zod.optin),Ve(n._zod,"optout",()=>e.innerType._zod.optout),Ve(n._zod,"values",()=>e.innerType._zod.values),n._zod.parse=(t,r)=>{if(r.direction==="backward")return e.innerType._zod.run(t,r);const i=e.innerType._zod.run(t,r);return i instanceof Promise?i.then(o=>(t.value=o.value,o.issues.length&&(t.value=e.catchValue({...t,error:{issues:o.issues.map(l=>di(l,r,hi()))},input:t.value}),t.issues=[]),t)):(t.value=i.value,i.issues.length&&(t.value=e.catchValue({...t,error:{issues:i.issues.map(o=>di(o,r,hi()))},input:t.value}),t.issues=[]),t)}}),Mz=F("$ZodPipe",(n,e)=>{at.init(n,e),Ve(n._zod,"values",()=>e.in._zod.values),Ve(n._zod,"optin",()=>e.in._zod.optin),Ve(n._zod,"optout",()=>e.out._zod.optout),Ve(n._zod,"propValues",()=>e.in._zod.propValues),n._zod.parse=(t,r)=>{if(r.direction==="backward"){const o=e.out._zod.run(t,r);return o instanceof Promise?o.then(l=>Lf(l,e.in,r)):Lf(o,e.in,r)}const i=e.in._zod.run(t,r);return i instanceof Promise?i.then(o=>Lf(o,e.out,r)):Lf(i,e.out,r)}});function Lf(n,e,t){return n.issues.length?(n.aborted=!0,n):e._zod.run({value:n.value,issues:n.issues},t)}const Nz=F("$ZodReadonly",(n,e)=>{at.init(n,e),Ve(n._zod,"propValues",()=>e.innerType._zod.propValues),Ve(n._zod,"values",()=>e.innerType._zod.values),Ve(n._zod,"optin",()=>e.innerType?._zod?.optin),Ve(n._zod,"optout",()=>e.innerType?._zod?.optout),n._zod.parse=(t,r)=>{if(r.direction==="backward")return e.innerType._zod.run(t,r);const i=e.innerType._zod.run(t,r);return i instanceof Promise?i.then(H0):H0(i)}});function H0(n){return n.value=Object.freeze(n.value),n}const Rz=F("$ZodCustom",(n,e)=>{Cn.init(n,e),at.init(n,e),n._zod.parse=(t,r)=>t,n._zod.check=t=>{const r=t.value,i=e.fn(r);if(i instanceof Promise)return i.then(o=>q0(o,t,r,n));q0(i,t,r,n)}});function q0(n,e,t,r){if(!n){const i={code:"custom",input:t,inst:r,path:[...r._zod.def.path??[]],continue:!r._zod.def.abort};r._zod.def.params&&(i.params=r._zod.def.params),e.issues.push($l(i))}}var F0;class Dz{constructor(){this._map=new WeakMap,this._idmap=new Map}add(e,...t){const r=t[0];return this._map.set(e,r),r&&typeof r=="object"&&"id"in r&&this._idmap.set(r.id,e),this}clear(){return this._map=new WeakMap,this._idmap=new Map,this}remove(e){const t=this._map.get(e);return t&&typeof t=="object"&&"id"in t&&this._idmap.delete(t.id),this._map.delete(e),this}get(e){const t=e._zod.parent;if(t){const r={...this.get(t)??{}};delete r.id;const i={...r,...this._map.get(e)};return Object.keys(i).length?i:void 0}return this._map.get(e)}has(e){return this._map.has(e)}}function xz(){return new Dz}(F0=globalThis).__zod_globalRegistry??(F0.__zod_globalRegistry=xz());const Al=globalThis.__zod_globalRegistry;function Iz(n,e){return new n({type:"string",...he(e)})}function yk(n,e){return new n({type:"string",format:"email",check:"string_format",abort:!1,...he(e)})}function V0(n,e){return new n({type:"string",format:"guid",check:"string_format",abort:!1,...he(e)})}function Uz(n,e){return new n({type:"string",format:"uuid",check:"string_format",abort:!1,...he(e)})}function zz(n,e){return new n({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...he(e)})}function Lz(n,e){return new n({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...he(e)})}function Bz(n,e){return new n({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...he(e)})}function Pz(n,e){return new n({type:"string",format:"url",check:"string_format",abort:!1,...he(e)})}function $z(n,e){return new n({type:"string",format:"emoji",check:"string_format",abort:!1,...he(e)})}function Kz(n,e){return new n({type:"string",format:"nanoid",check:"string_format",abort:!1,...he(e)})}function jz(n,e){return new n({type:"string",format:"cuid",check:"string_format",abort:!1,...he(e)})}function Hz(n,e){return new n({type:"string",format:"cuid2",check:"string_format",abort:!1,...he(e)})}function qz(n,e){return new n({type:"string",format:"ulid",check:"string_format",abort:!1,...he(e)})}function Fz(n,e){return new n({type:"string",format:"xid",check:"string_format",abort:!1,...he(e)})}function Vz(n,e){return new n({type:"string",format:"ksuid",check:"string_format",abort:!1,...he(e)})}function Gz(n,e){return new n({type:"string",format:"ipv4",check:"string_format",abort:!1,...he(e)})}function Zz(n,e){return new n({type:"string",format:"ipv6",check:"string_format",abort:!1,...he(e)})}function Jz(n,e){return new n({type:"string",format:"cidrv4",check:"string_format",abort:!1,...he(e)})}function Wz(n,e){return new n({type:"string",format:"cidrv6",check:"string_format",abort:!1,...he(e)})}function Yz(n,e){return new n({type:"string",format:"base64",check:"string_format",abort:!1,...he(e)})}function Qz(n,e){return new n({type:"string",format:"base64url",check:"string_format",abort:!1,...he(e)})}function Xz(n,e){return new n({type:"string",format:"e164",check:"string_format",abort:!1,...he(e)})}function eL(n,e){return new n({type:"string",format:"jwt",check:"string_format",abort:!1,...he(e)})}function tL(n,e){return new n({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...he(e)})}function nL(n,e){return new n({type:"string",format:"date",check:"string_format",...he(e)})}function rL(n,e){return new n({type:"string",format:"time",check:"string_format",precision:null,...he(e)})}function sL(n,e){return new n({type:"string",format:"duration",check:"string_format",...he(e)})}function iL(n,e){return new n({type:"number",checks:[],...he(e)})}function aL(n,e){return new n({type:"number",check:"number_format",abort:!1,format:"safeint",...he(e)})}function oL(n,e){return new n({type:"boolean",...he(e)})}function cL(n){return new n({type:"any"})}function lL(n){return new n({type:"unknown"})}function uL(n,e){return new n({type:"never",...he(e)})}function fL(n,e){return new n({type:"date",...he(e)})}function hL(n,e){return new n({type:"date",coerce:!0,...he(e)})}function G0(n,e){return new ck({check:"less_than",...he(e),value:n,inclusive:!1})}function sh(n,e){return new ck({check:"less_than",...he(e),value:n,inclusive:!0})}function Z0(n,e){return new lk({check:"greater_than",...he(e),value:n,inclusive:!1})}function ih(n,e){return new lk({check:"greater_than",...he(e),value:n,inclusive:!0})}function J0(n,e){return new _U({check:"multiple_of",...he(e),value:n})}function gk(n,e){return new kU({check:"max_length",...he(e),maximum:n})}function kh(n,e){return new TU({check:"min_length",...he(e),minimum:n})}function wk(n,e){return new OU({check:"length_equals",...he(e),length:n})}function dL(n,e){return new CU({check:"string_format",format:"regex",...he(e),pattern:n})}function mL(n){return new MU({check:"string_format",format:"lowercase",...he(n)})}function pL(n){return new NU({check:"string_format",format:"uppercase",...he(n)})}function yL(n,e){return new RU({check:"string_format",format:"includes",...he(e),includes:n})}function gL(n,e){return new DU({check:"string_format",format:"starts_with",...he(e),prefix:n})}function wL(n,e){return new xU({check:"string_format",format:"ends_with",...he(e),suffix:n})}function Yo(n){return new IU({check:"overwrite",tx:n})}function bL(n){return Yo(e=>e.normalize(n))}function vL(){return Yo(n=>n.trim())}function SL(){return Yo(n=>n.toLowerCase())}function EL(){return Yo(n=>n.toUpperCase())}function _L(){return Yo(n=>MI(n))}function AL(n,e,t){return new n({type:"array",element:e,...he(t)})}function kL(n,e,t){return new n({type:"custom",check:"custom",fn:e,...he(t)})}function TL(n){const e=OL(t=>(t.addIssue=r=>{if(typeof r=="string")t.issues.push($l(r,t.value,e._zod.def));else{const i=r;i.fatal&&(i.continue=!1),i.code??(i.code="custom"),i.input??(i.input=t.value),i.inst??(i.inst=e),i.continue??(i.continue=!e._zod.def.abort),t.issues.push($l(i))}},n(t.value,t)));return e}function OL(n,e){const t=new Cn({check:"custom",...he(e)});return t._zod.check=n,t}function bk(n){let e=n?.target??"draft-2020-12";return e==="draft-4"&&(e="draft-04"),e==="draft-7"&&(e="draft-07"),{processors:n.processors??{},metadataRegistry:n?.metadata??Al,target:e,unrepresentable:n?.unrepresentable??"throw",override:n?.override??(()=>{}),io:n?.io??"output",counter:0,seen:new Map,cycles:n?.cycles??"ref",reused:n?.reused??"inline",external:n?.external??void 0}}function Lt(n,e,t={path:[],schemaPath:[]}){var r;const i=n._zod.def,o=e.seen.get(n);if(o)return o.count++,t.schemaPath.includes(n)&&(o.cycle=t.path),o.schema;const l={schema:{},count:1,cycle:void 0,path:t.path};e.seen.set(n,l);const f=n._zod.toJSONSchema?.();if(f)l.schema=f;else{const y={...t,schemaPath:[...t.schemaPath,n],path:t.path};if(n._zod.processJSONSchema)n._zod.processJSONSchema(e,l.schema,y);else{const b=l.schema,E=e.processors[i.type];if(!E)throw new Error(`[toJSONSchema]: Non-representable type encountered: ${i.type}`);E(n,e,b,y)}const g=n._zod.parent;g&&(l.ref||(l.ref=g),Lt(g,e,y),e.seen.get(g).isParent=!0)}const h=e.metadataRegistry.get(n);return h&&Object.assign(l.schema,h),e.io==="input"&&dn(n)&&(delete l.schema.examples,delete l.schema.default),e.io==="input"&&l.schema._prefault&&((r=l.schema).default??(r.default=l.schema._prefault)),delete l.schema._prefault,e.seen.get(n).schema}function vk(n,e){const t=n.seen.get(e);if(!t)throw new Error("Unprocessed schema. This is a bug in Zod.");const r=new Map;for(const l of n.seen.entries()){const f=n.metadataRegistry.get(l[0])?.id;if(f){const h=r.get(f);if(h&&h!==l[0])throw new Error(`Duplicate schema id "${f}" detected during JSON Schema conversion. Two different schemas cannot share the same id when converted together.`);r.set(f,l[0])}}const i=l=>{const f=n.target==="draft-2020-12"?"$defs":"definitions";if(n.external){const g=n.external.registry.get(l[0])?.id,b=n.external.uri??(_=>_);if(g)return{ref:b(g)};const E=l[1].defId??l[1].schema.id??`schema${n.counter++}`;return l[1].defId=E,{defId:E,ref:`${b("__shared")}#/${f}/${E}`}}if(l[1]===t)return{ref:"#"};const m=`#/${f}/`,y=l[1].schema.id??`__schema${n.counter++}`;return{defId:y,ref:m+y}},o=l=>{if(l[1].schema.$ref)return;const f=l[1],{ref:h,defId:m}=i(l);f.def={...f.schema},m&&(f.defId=m);const y=f.schema;for(const g in y)delete y[g];y.$ref=h};if(n.cycles==="throw")for(const l of n.seen.entries()){const f=l[1];if(f.cycle)throw new Error(`Cycle detected: #/${f.cycle?.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(const l of n.seen.entries()){const f=l[1];if(e===l[0]){o(l);continue}if(n.external){const m=n.external.registry.get(l[0])?.id;if(e!==l[0]&&m){o(l);continue}}if(n.metadataRegistry.get(l[0])?.id){o(l);continue}if(f.cycle){o(l);continue}if(f.count>1&&n.reused==="ref"){o(l);continue}}}function Sk(n,e){const t=n.seen.get(e);if(!t)throw new Error("Unprocessed schema. This is a bug in Zod.");const r=l=>{const f=n.seen.get(l);if(f.ref===null)return;const h=f.def??f.schema,m={...h},y=f.ref;if(f.ref=null,y){r(y);const b=n.seen.get(y),E=b.schema;if(E.$ref&&(n.target==="draft-07"||n.target==="draft-04"||n.target==="openapi-3.0")?(h.allOf=h.allOf??[],h.allOf.push(E)):Object.assign(h,E),Object.assign(h,m),l._zod.parent===y)for(const S in h)S==="$ref"||S==="allOf"||S in m||delete h[S];if(E.$ref&&b.def)for(const S in h)S==="$ref"||S==="allOf"||S in b.def&&JSON.stringify(h[S])===JSON.stringify(b.def[S])&&delete h[S]}const g=l._zod.parent;if(g&&g!==y){r(g);const b=n.seen.get(g);if(b?.schema.$ref&&(h.$ref=b.schema.$ref,b.def))for(const E in h)E==="$ref"||E==="allOf"||E in b.def&&JSON.stringify(h[E])===JSON.stringify(b.def[E])&&delete h[E]}n.override({zodSchema:l,jsonSchema:h,path:f.path??[]})};for(const l of[...n.seen.entries()].reverse())r(l[0]);const i={};if(n.target==="draft-2020-12"?i.$schema="https://json-schema.org/draft/2020-12/schema":n.target==="draft-07"?i.$schema="http://json-schema.org/draft-07/schema#":n.target==="draft-04"?i.$schema="http://json-schema.org/draft-04/schema#":n.target,n.external?.uri){const l=n.external.registry.get(e)?.id;if(!l)throw new Error("Schema is missing an `id` property");i.$id=n.external.uri(l)}Object.assign(i,t.def??t.schema);const o=n.external?.defs??{};for(const l of n.seen.entries()){const f=l[1];f.def&&f.defId&&(o[f.defId]=f.def)}n.external||Object.keys(o).length>0&&(n.target==="draft-2020-12"?i.$defs=o:i.definitions=o);try{const l=JSON.parse(JSON.stringify(i));return Object.defineProperty(l,"~standard",{value:{...e["~standard"],jsonSchema:{input:Th(e,"input",n.processors),output:Th(e,"output",n.processors)}},enumerable:!1,writable:!1}),l}catch{throw new Error("Error converting schema to JSON.")}}function dn(n,e){const t=e??{seen:new Set};if(t.seen.has(n))return!1;t.seen.add(n);const r=n._zod.def;if(r.type==="transform")return!0;if(r.type==="array")return dn(r.element,t);if(r.type==="set")return dn(r.valueType,t);if(r.type==="lazy")return dn(r.getter(),t);if(r.type==="promise"||r.type==="optional"||r.type==="nonoptional"||r.type==="nullable"||r.type==="readonly"||r.type==="default"||r.type==="prefault")return dn(r.innerType,t);if(r.type==="intersection")return dn(r.left,t)||dn(r.right,t);if(r.type==="record"||r.type==="map")return dn(r.keyType,t)||dn(r.valueType,t);if(r.type==="pipe")return dn(r.in,t)||dn(r.out,t);if(r.type==="object"){for(const i in r.shape)if(dn(r.shape[i],t))return!0;return!1}if(r.type==="union"){for(const i of r.options)if(dn(i,t))return!0;return!1}if(r.type==="tuple"){for(const i of r.items)if(dn(i,t))return!0;return!!(r.rest&&dn(r.rest,t))}return!1}const CL=(n,e={})=>t=>{const r=bk({...t,processors:e});return Lt(n,r),vk(r,n),Sk(r,n)},Th=(n,e,t={})=>r=>{const{libraryOptions:i,target:o}=r??{},l=bk({...i??{},target:o,io:e,processors:t});return Lt(n,l),vk(l,n),Sk(l,n)},ML={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},NL=(n,e,t,r)=>{const i=t;i.type="string";const{minimum:o,maximum:l,format:f,patterns:h,contentEncoding:m}=n._zod.bag;if(typeof o=="number"&&(i.minLength=o),typeof l=="number"&&(i.maxLength=l),f&&(i.format=ML[f]??f,i.format===""&&delete i.format,f==="time"&&delete i.format),m&&(i.contentEncoding=m),h&&h.size>0){const y=[...h];y.length===1?i.pattern=y[0].source:y.length>1&&(i.allOf=[...y.map(g=>({...e.target==="draft-07"||e.target==="draft-04"||e.target==="openapi-3.0"?{type:"string"}:{},pattern:g.source}))])}},RL=(n,e,t,r)=>{const i=t,{minimum:o,maximum:l,format:f,multipleOf:h,exclusiveMaximum:m,exclusiveMinimum:y}=n._zod.bag;typeof f=="string"&&f.includes("int")?i.type="integer":i.type="number",typeof y=="number"&&(e.target==="draft-04"||e.target==="openapi-3.0"?(i.minimum=y,i.exclusiveMinimum=!0):i.exclusiveMinimum=y),typeof o=="number"&&(i.minimum=o,typeof y=="number"&&e.target!=="draft-04"&&(y>=o?delete i.minimum:delete i.exclusiveMinimum)),typeof m=="number"&&(e.target==="draft-04"||e.target==="openapi-3.0"?(i.maximum=m,i.exclusiveMaximum=!0):i.exclusiveMaximum=m),typeof l=="number"&&(i.maximum=l,typeof m=="number"&&e.target!=="draft-04"&&(m<=l?delete i.maximum:delete i.exclusiveMaximum)),typeof h=="number"&&(i.multipleOf=h)},DL=(n,e,t,r)=>{t.type="boolean"},xL=(n,e,t,r)=>{t.not={}},IL=(n,e,t,r)=>{},UL=(n,e,t,r)=>{},zL=(n,e,t,r)=>{if(e.unrepresentable==="throw")throw new Error("Date cannot be represented in JSON Schema")},LL=(n,e,t,r)=>{const i=n._zod.def,o=YA(i.entries);o.every(l=>typeof l=="number")&&(t.type="number"),o.every(l=>typeof l=="string")&&(t.type="string"),t.enum=o},BL=(n,e,t,r)=>{const i=n._zod.def,o=[];for(const l of i.values)if(l===void 0){if(e.unrepresentable==="throw")throw new Error("Literal `undefined` cannot be represented in JSON Schema")}else if(typeof l=="bigint"){if(e.unrepresentable==="throw")throw new Error("BigInt literals cannot be represented in JSON Schema");o.push(Number(l))}else o.push(l);if(o.length!==0)if(o.length===1){const l=o[0];t.type=l===null?"null":typeof l,e.target==="draft-04"||e.target==="openapi-3.0"?t.enum=[l]:t.const=l}else o.every(l=>typeof l=="number")&&(t.type="number"),o.every(l=>typeof l=="string")&&(t.type="string"),o.every(l=>typeof l=="boolean")&&(t.type="boolean"),o.every(l=>l===null)&&(t.type="null"),t.enum=o},PL=(n,e,t,r)=>{if(e.unrepresentable==="throw")throw new Error("Custom types cannot be represented in JSON Schema")},$L=(n,e,t,r)=>{if(e.unrepresentable==="throw")throw new Error("Transforms cannot be represented in JSON Schema")},KL=(n,e,t,r)=>{const i=t,o=n._zod.def,{minimum:l,maximum:f}=n._zod.bag;typeof l=="number"&&(i.minItems=l),typeof f=="number"&&(i.maxItems=f),i.type="array",i.items=Lt(o.element,e,{...r,path:[...r.path,"items"]})},jL=(n,e,t,r)=>{const i=t,o=n._zod.def;i.type="object",i.properties={};const l=o.shape;for(const m in l)i.properties[m]=Lt(l[m],e,{...r,path:[...r.path,"properties",m]});const f=new Set(Object.keys(l)),h=new Set([...f].filter(m=>{const y=o.shape[m]._zod;return e.io==="input"?y.optin===void 0:y.optout===void 0}));h.size>0&&(i.required=Array.from(h)),o.catchall?._zod.def.type==="never"?i.additionalProperties=!1:o.catchall?o.catchall&&(i.additionalProperties=Lt(o.catchall,e,{...r,path:[...r.path,"additionalProperties"]})):e.io==="output"&&(i.additionalProperties=!1)},HL=(n,e,t,r)=>{const i=n._zod.def,o=i.inclusive===!1,l=i.options.map((f,h)=>Lt(f,e,{...r,path:[...r.path,o?"oneOf":"anyOf",h]}));o?t.oneOf=l:t.anyOf=l},qL=(n,e,t,r)=>{const i=n._zod.def,o=Lt(i.left,e,{...r,path:[...r.path,"allOf",0]}),l=Lt(i.right,e,{...r,path:[...r.path,"allOf",1]}),f=m=>"allOf"in m&&Object.keys(m).length===1,h=[...f(o)?o.allOf:[o],...f(l)?l.allOf:[l]];t.allOf=h},FL=(n,e,t,r)=>{const i=t,o=n._zod.def;i.type="object";const l=o.keyType,h=l._zod.bag?.patterns;if(o.mode==="loose"&&h&&h.size>0){const y=Lt(o.valueType,e,{...r,path:[...r.path,"patternProperties","*"]});i.patternProperties={};for(const g of h)i.patternProperties[g.source]=y}else(e.target==="draft-07"||e.target==="draft-2020-12")&&(i.propertyNames=Lt(o.keyType,e,{...r,path:[...r.path,"propertyNames"]})),i.additionalProperties=Lt(o.valueType,e,{...r,path:[...r.path,"additionalProperties"]});const m=l._zod.values;if(m){const y=[...m].filter(g=>typeof g=="string"||typeof g=="number");y.length>0&&(i.required=y)}},VL=(n,e,t,r)=>{const i=n._zod.def,o=Lt(i.innerType,e,r),l=e.seen.get(n);e.target==="openapi-3.0"?(l.ref=i.innerType,t.nullable=!0):t.anyOf=[o,{type:"null"}]},GL=(n,e,t,r)=>{const i=n._zod.def;Lt(i.innerType,e,r);const o=e.seen.get(n);o.ref=i.innerType},ZL=(n,e,t,r)=>{const i=n._zod.def;Lt(i.innerType,e,r);const o=e.seen.get(n);o.ref=i.innerType,t.default=JSON.parse(JSON.stringify(i.defaultValue))},JL=(n,e,t,r)=>{const i=n._zod.def;Lt(i.innerType,e,r);const o=e.seen.get(n);o.ref=i.innerType,e.io==="input"&&(t._prefault=JSON.parse(JSON.stringify(i.defaultValue)))},WL=(n,e,t,r)=>{const i=n._zod.def;Lt(i.innerType,e,r);const o=e.seen.get(n);o.ref=i.innerType;let l;try{l=i.catchValue(void 0)}catch{throw new Error("Dynamic catch values are not supported in JSON Schema")}t.default=l},YL=(n,e,t,r)=>{const i=n._zod.def,o=e.io==="input"?i.in._zod.def.type==="transform"?i.out:i.in:i.out;Lt(o,e,r);const l=e.seen.get(n);l.ref=o},QL=(n,e,t,r)=>{const i=n._zod.def;Lt(i.innerType,e,r);const o=e.seen.get(n);o.ref=i.innerType,t.readOnly=!0},Ek=(n,e,t,r)=>{const i=n._zod.def;Lt(i.innerType,e,r);const o=e.seen.get(n);o.ref=i.innerType},XL=F("ZodISODateTime",(n,e)=>{ZU.init(n,e),wt.init(n,e)});function e4(n){return tL(XL,n)}const t4=F("ZodISODate",(n,e)=>{JU.init(n,e),wt.init(n,e)});function n4(n){return nL(t4,n)}const r4=F("ZodISOTime",(n,e)=>{WU.init(n,e),wt.init(n,e)});function s4(n){return rL(r4,n)}const i4=F("ZodISODuration",(n,e)=>{YU.init(n,e),wt.init(n,e)});function a4(n){return sL(i4,n)}const o4=(n,e)=>{tk.init(n,e),n.name="ZodError",Object.defineProperties(n,{format:{value:t=>cg(n,t)},flatten:{value:t=>KI(n,t)},addIssue:{value:t=>{n.issues.push(t),n.message=JSON.stringify(n.issues,og,2)}},addIssues:{value:t=>{n.issues.push(...t),n.message=JSON.stringify(n.issues,og,2)}},isEmpty:{get(){return n.issues.length===0}}})},ur=F("ZodError",o4,{Parent:Error}),c4=dw(ur),l4=mw(ur),u4=ud(ur),f4=fd(ur),h4=qI(ur),d4=FI(ur),m4=VI(ur),p4=GI(ur),y4=ZI(ur),g4=JI(ur),w4=WI(ur),b4=YI(ur),ot=F("ZodType",(n,e)=>(at.init(n,e),Object.assign(n["~standard"],{jsonSchema:{input:Th(n,"input"),output:Th(n,"output")}}),n.toJSONSchema=CL(n,{}),n.def=e,n.type=e.type,Object.defineProperty(n,"_def",{value:e}),n.check=(...t)=>n.clone(bi(e,{checks:[...e.checks??[],...t.map(r=>typeof r=="function"?{_zod:{check:r,def:{check:"custom"},onattach:[]}}:r)]}),{parent:!0}),n.with=n.check,n.clone=(t,r)=>vi(n,t,r),n.brand=()=>n,n.register=((t,r)=>(t.add(n,r),n)),n.parse=(t,r)=>c4(n,t,r,{callee:n.parse}),n.safeParse=(t,r)=>u4(n,t,r),n.parseAsync=async(t,r)=>l4(n,t,r,{callee:n.parseAsync}),n.safeParseAsync=async(t,r)=>f4(n,t,r),n.spa=n.safeParseAsync,n.encode=(t,r)=>h4(n,t,r),n.decode=(t,r)=>d4(n,t,r),n.encodeAsync=async(t,r)=>m4(n,t,r),n.decodeAsync=async(t,r)=>p4(n,t,r),n.safeEncode=(t,r)=>y4(n,t,r),n.safeDecode=(t,r)=>g4(n,t,r),n.safeEncodeAsync=async(t,r)=>w4(n,t,r),n.safeDecodeAsync=async(t,r)=>b4(n,t,r),n.refine=(t,r)=>n.check(hB(t,r)),n.superRefine=t=>n.check(dB(t)),n.overwrite=t=>n.check(Yo(t)),n.optional=()=>Q0(n),n.exactOptional=()=>X4(n),n.nullable=()=>X0(n),n.nullish=()=>Q0(X0(n)),n.nonoptional=t=>iB(n,t),n.array=()=>ke(n),n.or=t=>Xl([n,t]),n.and=t=>Mk(n,t),n.transform=t=>e_(n,Y4(t)),n.default=t=>nB(n,t),n.prefault=t=>sB(n,t),n.catch=t=>oB(n,t),n.pipe=t=>e_(n,t),n.readonly=()=>uB(n),n.describe=t=>{const r=n.clone();return Al.add(r,{description:t}),r},Object.defineProperty(n,"description",{get(){return Al.get(n)?.description},configurable:!0}),n.meta=(...t)=>{if(t.length===0)return Al.get(n);const r=n.clone();return Al.add(r,t[0]),r},n.isOptional=()=>n.safeParse(void 0).success,n.isNullable=()=>n.safeParse(null).success,n.apply=t=>t(n),n)),_k=F("_ZodString",(n,e)=>{pw.init(n,e),ot.init(n,e),n._zod.processJSONSchema=(r,i,o)=>NL(n,r,i);const t=n._zod.bag;n.format=t.format??null,n.minLength=t.minimum??null,n.maxLength=t.maximum??null,n.regex=(...r)=>n.check(dL(...r)),n.includes=(...r)=>n.check(yL(...r)),n.startsWith=(...r)=>n.check(gL(...r)),n.endsWith=(...r)=>n.check(wL(...r)),n.min=(...r)=>n.check(kh(...r)),n.max=(...r)=>n.check(gk(...r)),n.length=(...r)=>n.check(wk(...r)),n.nonempty=(...r)=>n.check(kh(1,...r)),n.lowercase=r=>n.check(mL(r)),n.uppercase=r=>n.check(pL(r)),n.trim=()=>n.check(vL()),n.normalize=(...r)=>n.check(bL(...r)),n.toLowerCase=()=>n.check(SL()),n.toUpperCase=()=>n.check(EL()),n.slugify=()=>n.check(_L())}),v4=F("ZodString",(n,e)=>{pw.init(n,e),_k.init(n,e),n.email=t=>n.check(yk(Ak,t)),n.url=t=>n.check(Pz(S4,t)),n.jwt=t=>n.check(eL(z4,t)),n.emoji=t=>n.check($z(E4,t)),n.guid=t=>n.check(V0(W0,t)),n.uuid=t=>n.check(Uz(Bf,t)),n.uuidv4=t=>n.check(zz(Bf,t)),n.uuidv6=t=>n.check(Lz(Bf,t)),n.uuidv7=t=>n.check(Bz(Bf,t)),n.nanoid=t=>n.check(Kz(_4,t)),n.guid=t=>n.check(V0(W0,t)),n.cuid=t=>n.check(jz(A4,t)),n.cuid2=t=>n.check(Hz(k4,t)),n.ulid=t=>n.check(qz(T4,t)),n.base64=t=>n.check(Yz(x4,t)),n.base64url=t=>n.check(Qz(I4,t)),n.xid=t=>n.check(Fz(O4,t)),n.ksuid=t=>n.check(Vz(C4,t)),n.ipv4=t=>n.check(Gz(M4,t)),n.ipv6=t=>n.check(Zz(N4,t)),n.cidrv4=t=>n.check(Jz(R4,t)),n.cidrv6=t=>n.check(Wz(D4,t)),n.e164=t=>n.check(Xz(U4,t)),n.datetime=t=>n.check(e4(t)),n.date=t=>n.check(n4(t)),n.time=t=>n.check(s4(t)),n.duration=t=>n.check(a4(t))});function I(n){return Iz(v4,n)}const wt=F("ZodStringFormat",(n,e)=>{mt.init(n,e),_k.init(n,e)}),Ak=F("ZodEmail",(n,e)=>{PU.init(n,e),wt.init(n,e)});function kk(n){return yk(Ak,n)}const W0=F("ZodGUID",(n,e)=>{LU.init(n,e),wt.init(n,e)}),Bf=F("ZodUUID",(n,e)=>{BU.init(n,e),wt.init(n,e)}),S4=F("ZodURL",(n,e)=>{$U.init(n,e),wt.init(n,e)}),E4=F("ZodEmoji",(n,e)=>{KU.init(n,e),wt.init(n,e)}),_4=F("ZodNanoID",(n,e)=>{jU.init(n,e),wt.init(n,e)}),A4=F("ZodCUID",(n,e)=>{HU.init(n,e),wt.init(n,e)}),k4=F("ZodCUID2",(n,e)=>{qU.init(n,e),wt.init(n,e)}),T4=F("ZodULID",(n,e)=>{FU.init(n,e),wt.init(n,e)}),O4=F("ZodXID",(n,e)=>{VU.init(n,e),wt.init(n,e)}),C4=F("ZodKSUID",(n,e)=>{GU.init(n,e),wt.init(n,e)}),M4=F("ZodIPv4",(n,e)=>{QU.init(n,e),wt.init(n,e)}),N4=F("ZodIPv6",(n,e)=>{XU.init(n,e),wt.init(n,e)}),R4=F("ZodCIDRv4",(n,e)=>{ez.init(n,e),wt.init(n,e)}),D4=F("ZodCIDRv6",(n,e)=>{tz.init(n,e),wt.init(n,e)}),x4=F("ZodBase64",(n,e)=>{nz.init(n,e),wt.init(n,e)}),I4=F("ZodBase64URL",(n,e)=>{sz.init(n,e),wt.init(n,e)}),U4=F("ZodE164",(n,e)=>{iz.init(n,e),wt.init(n,e)}),z4=F("ZodJWT",(n,e)=>{oz.init(n,e),wt.init(n,e)}),Tk=F("ZodNumber",(n,e)=>{fk.init(n,e),ot.init(n,e),n._zod.processJSONSchema=(r,i,o)=>RL(n,r,i),n.gt=(r,i)=>n.check(Z0(r,i)),n.gte=(r,i)=>n.check(ih(r,i)),n.min=(r,i)=>n.check(ih(r,i)),n.lt=(r,i)=>n.check(G0(r,i)),n.lte=(r,i)=>n.check(sh(r,i)),n.max=(r,i)=>n.check(sh(r,i)),n.int=r=>n.check(Y0(r)),n.safe=r=>n.check(Y0(r)),n.positive=r=>n.check(Z0(0,r)),n.nonnegative=r=>n.check(ih(0,r)),n.negative=r=>n.check(G0(0,r)),n.nonpositive=r=>n.check(sh(0,r)),n.multipleOf=(r,i)=>n.check(J0(r,i)),n.step=(r,i)=>n.check(J0(r,i)),n.finite=()=>n;const t=n._zod.bag;n.minValue=Math.max(t.minimum??Number.NEGATIVE_INFINITY,t.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,n.maxValue=Math.min(t.maximum??Number.POSITIVE_INFINITY,t.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,n.isInt=(t.format??"").includes("int")||Number.isSafeInteger(t.multipleOf??.5),n.isFinite=!0,n.format=t.format??null});function Gt(n){return iL(Tk,n)}const L4=F("ZodNumberFormat",(n,e)=>{cz.init(n,e),Tk.init(n,e)});function Y0(n){return aL(L4,n)}const B4=F("ZodBoolean",(n,e)=>{lz.init(n,e),ot.init(n,e),n._zod.processJSONSchema=(t,r,i)=>DL(n,t,r)});function Er(n){return oL(B4,n)}const P4=F("ZodAny",(n,e)=>{uz.init(n,e),ot.init(n,e),n._zod.processJSONSchema=(t,r,i)=>IL()});function yw(){return cL(P4)}const $4=F("ZodUnknown",(n,e)=>{fz.init(n,e),ot.init(n,e),n._zod.processJSONSchema=(t,r,i)=>UL()});function Kl(){return lL($4)}const K4=F("ZodNever",(n,e)=>{hz.init(n,e),ot.init(n,e),n._zod.processJSONSchema=(t,r,i)=>xL(n,t,r)});function j4(n){return uL(K4,n)}const Ok=F("ZodDate",(n,e)=>{dz.init(n,e),ot.init(n,e),n._zod.processJSONSchema=(r,i,o)=>zL(n,r),n.min=(r,i)=>n.check(ih(r,i)),n.max=(r,i)=>n.check(sh(r,i));const t=n._zod.bag;n.minDate=t.minimum?new Date(t.minimum):null,n.maxDate=t.maximum?new Date(t.maximum):null});function H4(n){return fL(Ok,n)}const q4=F("ZodArray",(n,e)=>{mz.init(n,e),ot.init(n,e),n._zod.processJSONSchema=(t,r,i)=>KL(n,t,r,i),n.element=e.element,n.min=(t,r)=>n.check(kh(t,r)),n.nonempty=t=>n.check(kh(1,t)),n.max=(t,r)=>n.check(gk(t,r)),n.length=(t,r)=>n.check(wk(t,r)),n.unwrap=()=>n.element});function ke(n,e){return AL(q4,n,e)}const F4=F("ZodObject",(n,e)=>{yz.init(n,e),ot.init(n,e),n._zod.processJSONSchema=(t,r,i)=>jL(n,t,r,i),Ve(n,"shape",()=>e.shape),n.keyof=()=>it(Object.keys(n._zod.def.shape)),n.catchall=t=>n.clone({...n._zod.def,catchall:t}),n.passthrough=()=>n.clone({...n._zod.def,catchall:Kl()}),n.loose=()=>n.clone({...n._zod.def,catchall:Kl()}),n.strict=()=>n.clone({...n._zod.def,catchall:j4()}),n.strip=()=>n.clone({...n._zod.def,catchall:void 0}),n.extend=t=>zI(n,t),n.safeExtend=t=>LI(n,t),n.merge=t=>BI(n,t),n.pick=t=>II(n,t),n.omit=t=>UI(n,t),n.partial=(...t)=>PI(Nk,n,t[0]),n.required=(...t)=>$I(Rk,n,t[0])});function re(n,e){const t={type:"object",shape:n??{},...he(e)};return new F4(t)}const Ck=F("ZodUnion",(n,e)=>{mk.init(n,e),ot.init(n,e),n._zod.processJSONSchema=(t,r,i)=>HL(n,t,r,i),n.options=e.options});function Xl(n,e){return new Ck({type:"union",options:n,...he(e)})}const V4=F("ZodDiscriminatedUnion",(n,e)=>{Ck.init(n,e),gz.init(n,e)});function gw(n,e,t){return new V4({type:"union",options:e,discriminator:n,...he(t)})}const G4=F("ZodIntersection",(n,e)=>{wz.init(n,e),ot.init(n,e),n._zod.processJSONSchema=(t,r,i)=>qL(n,t,r,i)});function Mk(n,e){return new G4({type:"intersection",left:n,right:e})}const Z4=F("ZodRecord",(n,e)=>{bz.init(n,e),ot.init(n,e),n._zod.processJSONSchema=(t,r,i)=>FL(n,t,r,i),n.keyType=e.keyType,n.valueType=e.valueType});function Oh(n,e,t){return new Z4({type:"record",keyType:n,valueType:e,...he(t)})}const ug=F("ZodEnum",(n,e)=>{vz.init(n,e),ot.init(n,e),n._zod.processJSONSchema=(r,i,o)=>LL(n,r,i),n.enum=e.entries,n.options=Object.values(e.entries);const t=new Set(Object.keys(e.entries));n.extract=(r,i)=>{const o={};for(const l of r)if(t.has(l))o[l]=e.entries[l];else throw new Error(`Key ${l} not found in enum`);return new ug({...e,checks:[],...he(i),entries:o})},n.exclude=(r,i)=>{const o={...e.entries};for(const l of r)if(t.has(l))delete o[l];else throw new Error(`Key ${l} not found in enum`);return new ug({...e,checks:[],...he(i),entries:o})}});function it(n,e){const t=Array.isArray(n)?Object.fromEntries(n.map(r=>[r,r])):n;return new ug({type:"enum",entries:t,...he(e)})}const J4=F("ZodLiteral",(n,e)=>{Sz.init(n,e),ot.init(n,e),n._zod.processJSONSchema=(t,r,i)=>BL(n,t,r),n.values=new Set(e.values),Object.defineProperty(n,"value",{get(){if(e.values.length>1)throw new Error("This schema contains multiple valid literal values. Use `.values` instead.");return e.values[0]}})});function ge(n,e){return new J4({type:"literal",values:Array.isArray(n)?n:[n],...he(e)})}const W4=F("ZodTransform",(n,e)=>{Ez.init(n,e),ot.init(n,e),n._zod.processJSONSchema=(t,r,i)=>$L(n,t),n._zod.parse=(t,r)=>{if(r.direction==="backward")throw new JA(n.constructor.name);t.addIssue=o=>{if(typeof o=="string")t.issues.push($l(o,t.value,e));else{const l=o;l.fatal&&(l.continue=!1),l.code??(l.code="custom"),l.input??(l.input=t.value),l.inst??(l.inst=n),t.issues.push($l(l))}};const i=e.transform(t.value,t);return i instanceof Promise?i.then(o=>(t.value=o,t)):(t.value=i,t)}});function Y4(n){return new W4({type:"transform",transform:n})}const Nk=F("ZodOptional",(n,e)=>{pk.init(n,e),ot.init(n,e),n._zod.processJSONSchema=(t,r,i)=>Ek(n,t,r,i),n.unwrap=()=>n._zod.def.innerType});function Q0(n){return new Nk({type:"optional",innerType:n})}const Q4=F("ZodExactOptional",(n,e)=>{_z.init(n,e),ot.init(n,e),n._zod.processJSONSchema=(t,r,i)=>Ek(n,t,r,i),n.unwrap=()=>n._zod.def.innerType});function X4(n){return new Q4({type:"optional",innerType:n})}const eB=F("ZodNullable",(n,e)=>{Az.init(n,e),ot.init(n,e),n._zod.processJSONSchema=(t,r,i)=>VL(n,t,r,i),n.unwrap=()=>n._zod.def.innerType});function X0(n){return new eB({type:"nullable",innerType:n})}const tB=F("ZodDefault",(n,e)=>{kz.init(n,e),ot.init(n,e),n._zod.processJSONSchema=(t,r,i)=>ZL(n,t,r,i),n.unwrap=()=>n._zod.def.innerType,n.removeDefault=n.unwrap});function nB(n,e){return new tB({type:"default",innerType:n,get defaultValue(){return typeof e=="function"?e():XA(e)}})}const rB=F("ZodPrefault",(n,e)=>{Tz.init(n,e),ot.init(n,e),n._zod.processJSONSchema=(t,r,i)=>JL(n,t,r,i),n.unwrap=()=>n._zod.def.innerType});function sB(n,e){return new rB({type:"prefault",innerType:n,get defaultValue(){return typeof e=="function"?e():XA(e)}})}const Rk=F("ZodNonOptional",(n,e)=>{Oz.init(n,e),ot.init(n,e),n._zod.processJSONSchema=(t,r,i)=>GL(n,t,r,i),n.unwrap=()=>n._zod.def.innerType});function iB(n,e){return new Rk({type:"nonoptional",innerType:n,...he(e)})}const aB=F("ZodCatch",(n,e)=>{Cz.init(n,e),ot.init(n,e),n._zod.processJSONSchema=(t,r,i)=>WL(n,t,r,i),n.unwrap=()=>n._zod.def.innerType,n.removeCatch=n.unwrap});function oB(n,e){return new aB({type:"catch",innerType:n,catchValue:typeof e=="function"?e:()=>e})}const cB=F("ZodPipe",(n,e)=>{Mz.init(n,e),ot.init(n,e),n._zod.processJSONSchema=(t,r,i)=>YL(n,t,r,i),n.in=e.in,n.out=e.out});function e_(n,e){return new cB({type:"pipe",in:n,out:e})}const lB=F("ZodReadonly",(n,e)=>{Nz.init(n,e),ot.init(n,e),n._zod.processJSONSchema=(t,r,i)=>QL(n,t,r,i),n.unwrap=()=>n._zod.def.innerType});function uB(n){return new lB({type:"readonly",innerType:n})}const fB=F("ZodCustom",(n,e)=>{Rz.init(n,e),ot.init(n,e),n._zod.processJSONSchema=(t,r,i)=>PL(n,t)});function hB(n,e={}){return kL(fB,n,e)}function dB(n){return TL(n)}function mB(n){return hL(Ok,n)}const eu=re({azp:I().optional(),iss:I().optional(),sub:I().optional(),aud:Xl([I(),ke(I())]).optional(),exp:Gt().int().optional(),nbf:Gt().int().optional(),iat:Gt().int().optional(),jti:I().optional()});Mk(eu,Oh(I(),yw()));function pB(n){if(n.alg)return A.Ok(n.alg);switch(n.kty){case"EC":switch(n.crv){case"P-256":return A.Ok("ES256");case"P-384":return A.Ok("ES384");case"P-521":return A.Ok("ES512");case"secp256k1":return A.Ok("ES256K");default:return A.Err(`Unsupported EC curve: ${n.crv}`)}case"RSA":return A.Ok("RS256");case"OKP":switch(n.crv){case"Ed25519":return A.Ok("EdDSA");case"Ed448":return A.Ok("EdDSA");default:return A.Err(`Unsupported OKP curve: ${n.crv}`)}case"oct":return A.Ok("HS256");default:return A.Err(`Unsupported key type: ${n.kty}`)}}const ha=re({kty:it(["RSA","EC","oct","OKP"]),use:it(["sig","enc"]).optional(),key_ops:ke(it(["sign","verify","encrypt","decrypt","wrapKey","unwrapKey","deriveKey","deriveBits"])).optional(),alg:I().optional(),kid:I().optional(),x5u:I().url().optional(),x5c:ke(I()).optional(),x5t:I().optional(),"x5t#S256":I().optional()}).and(gw("kty",[re({kty:ge("RSA"),n:I(),e:I()}),re({kty:ge("EC"),crv:it(["P-256","P-384","P-521","secp256k1"]),x:I(),y:I()}),re({kty:ge("oct"),k:I()}),re({kty:ge("OKP"),crv:it(["Ed25519","Ed448","X25519","X448"]),x:I()})]));re({keys:ke(ha)});const yB=re({nick:I().optional(),email:I(),email_verified:Er(),external_id:I().nullable().optional(),first:I(),image_url:I(),last:I(),name:I().nullable(),public_meta:Kl()}),Dk=re({azp:I().optional(),exp:Gt().int().optional(),iat:Gt().int().optional(),iss:I().optional(),jti:I().optional(),nbf:Gt().int().optional(),params:yB,role:I(),sub:I(),userId:I(),aud:Xl([I(),ke(I())]).optional(),app_metadata:Kl().optional()}),gB=re({payload:Dk,protectedHeader:re({alg:I(),cat:I(),kid:I(),typ:I()}).partial()}),xk=re({type:ge("clerk"),claims:Dk}),fg=re({commonName:I(),countryName:I().length(2).optional(),stateOrProvinceName:I().optional(),locality:I().optional(),organization:I().optional(),organizationalUnitName:I().optional(),emailAddress:I().email().optional(),serialNumber:I().optional(),streetAddress:I().optional(),postalCode:I().optional(),businessCategory:I().optional(),jurisdictionCountryName:I().length(2).optional(),jurisdictionStateOrProvinceName:I().optional(),jurisdictionLocalityName:I().optional()}),Ik=re({subjectAltName:ke(I()).optional(),keyUsage:ke(it(["digitalSignature","nonRepudiation","keyEncipherment","dataEncipherment","keyAgreement","keyCertSign","cRLSign","encipherOnly","decipherOnly"])).optional(),extendedKeyUsage:ke(it(["serverAuth","clientAuth","codeSigning","emailProtection","timeStamping","OCSPSigning","ipsecIKE","msCodeInd","msCodeCom","msCTLSign","msEFS"])).optional(),basicConstraints:re({cA:Er().optional(),pathLenConstraint:Gt().int().min(0).optional()}).optional(),authorityKeyIdentifier:I().optional(),subjectKeyIdentifier:I().optional(),certificatePolicies:ke(re({policyIdentifier:I(),policyQualifiers:ke(I()).optional()})).optional(),crlDistributionPoints:ke(I().url()).optional(),authorityInfoAccess:re({ocsp:ke(I().url()).optional(),caIssuers:ke(I().url()).optional()}).optional(),nameConstraints:re({permitted:ke(I()).optional(),excluded:ke(I()).optional()}).optional()}),wB=eu.extend({creatingUser:xk.optional(),csr:re({subject:fg,publicKey:ha,extensions:Ik.optional()}).strict().readonly()}).strict().readonly(),bB=eu.extend({deviceId:I(),seq:Gt().int().min(0)}).strict().readonly(),vB=re({version:ge("3"),serialNumber:I(),subject:fg,issuer:fg,validity:re({notBefore:I().datetime(),notAfter:I().datetime()}),subjectPublicKeyInfo:ha,signatureAlgorithm:ge("ES256"),keyUsage:ke(it(["digitalSignature","nonRepudiation","keyEncipherment","dataEncipherment","keyAgreement","keyCertSign","cRLSign","encipherOnly","decipherOnly"])),extendedKeyUsage:ke(it(["serverAuth","clientAuth","codeSigning","emailProtection","timeStamping","OCSPSigning","ipsecIKE","msCodeInd","msCodeCom","msCTLSign","msEFS"])),extensions:Ik.optional()}),Ch=re({iss:I(),sub:I(),aud:I().or(ke(I())),iat:Gt().int(),nbf:Gt().int(),exp:Gt().int(),jti:I(),certificate:vB,creatingUser:xk.optional()}).readonly(),jl=re({kty:it(["RSA","EC","oct","OKP"]),use:it(["sig","enc"]).optional(),key_ops:ke(it(["sign","verify","encrypt","decrypt","wrapKey","unwrapKey","deriveKey","deriveBits"])).optional(),alg:I().optional(),kid:I().optional(),x5u:I().url().optional(),x5c:ke(I()).optional(),x5t:I().optional(),"x5t#S256":I().optional()}).and(gw("kty",[re({kty:ge("RSA"),n:I(),e:I(),d:I(),p:I(),q:I(),dp:I(),dq:I(),qi:I()}),re({kty:ge("EC"),crv:it(["P-256","P-384","P-521","secp256k1"]),x:I(),y:I(),d:I()}),re({kty:ge("oct"),k:I()}),re({kty:ge("OKP"),crv:it(["Ed25519","Ed448","X25519","X448"]),x:I(),d:I()})]));re({keys:ke(jl)});const SB=re({certificateJWT:I(),certificatePayload:Ch}).readonly(),EB=re({deviceId:jl,cert:SB.optional()}).readonly(),Uk=re({name:I(),key:I()}).readonly(),_B=re({key:I(),fingerPrint:I(),default:Er().optional()}).readonly(),zk=re({name:I(),keys:Oh(I(),_B)}).readonly(),Lk=re({id:I(),clazz:ge("V2StorageKeyItem"),item:zk}).readonly(),Bk=re({id:I(),clazz:ge("DeviceIdKeyBagItem"),item:EB}).readonly(),Pk=re({id:I(),clazz:ge("JwtKeyBagItem"),item:re({jwtStr:I()})}).readonly(),ww=Lk.or(Bk).or(Pk),AB=ww.or(Uk).or(zk).readonly(),t_=re({meta:I(),car:I(),file:I(),wal:I()}),kB=re({base:I().optional(),data:t_.partial(),idx:t_.partial()}).readonly(),$k=re({env:Oh(I(),I()),ctx:Oh(I(),I()),writeQueue:re({chunkSize:Gt()}),autoCompact:Gt(),compactStrategy:I(),storeUrls:kB.optional(),threshold:Gt()});$k.readonly();re({...$k.partial().shape,name:I(),refId:I()});const TB=new TextEncoder;new TextDecoder;const Kk=512;function jk(n){return TB.encode(JSON.stringify(n))}const ao=0xffffffffn;class zt{value;static from(e){return e instanceof zt?e.clone():e instanceof Qe?new zt(e.toNumber()):new zt(e)}constructor(e=0){this.value=BigInt(e)&ao}clone(){return new zt(this.value)}assign(e){return e instanceof zt?this.value=e.value:this.value=BigInt(e)&ao,this}add(e){return this.value=this.value+e.value&ao,this}subtract(e){return this.value=this.value-e.value&ao,this}multiply(e){return this.value=this.value*e.value&ao,this}xor(e){return this.value=this.value^e.value,this}rotl(e){const t=BigInt(e)&31n;return this.value=(this.value<<t|this.value>>32n-t)&ao,this}shiftRight(e){return this.value=this.value>>BigInt(e),this}fromNumber(e){return this.value=BigInt(e)&0xffffffffn,this}fromBits(e,t){return this.value=BigInt(t&65535)<<16n|BigInt(e&65535),this}toNumber(){return this.value}toString(e){const t=this.value.toString(e||10);return e===16?t.padStart(8,"0"):t}}const Hi=0xffffffffffffffffn;class Qe{value;static from(e){return e instanceof Qe?e.clone():e instanceof zt?new Qe(e.toNumber()):new Qe(e)}constructor(e=0){this.value=BigInt(e)&Hi}clone(){return new Qe(this.value)}assign(e){return e instanceof Qe?this.value=e.value:this.value=BigInt(e)&Hi,this}add(e){return this.value=this.value+e.value&Hi,this}subtract(e){return this.value=this.value-e.value&Hi,this}multiply(e){return this.value=this.value*e.value&Hi,this}xor(e){return this.value=this.value^e.value,this}rotl(e){const t=BigInt(e)&63n;return this.value=(this.value<<t|this.value>>64n-t)&Hi,this}shiftRight(e){return this.value=this.value>>BigInt(e),this}fromNumber(e){return this.value=BigInt(e)&Hi,this}fromBits(e,t,r,i){return this.value=BigInt(i&65535)<<48n|BigInt(r&65535)<<32n|BigInt(t&65535)<<16n|BigInt(e&65535),this}toNumber(){return this.value}toString(e){const t=this.value.toString(e||10);return e===16?t.padStart(16,"0"):t}}function Hk(n){return typeof n=="number"||typeof n=="bigint"||n instanceof zt||n instanceof Qe}const qk=new TextEncoder,ah=new zt("2654435761"),oh=new zt("2246822519"),n_=new zt("3266489917"),OB=new zt("668265263"),r_=new zt("374761393");function Ws(n,e,t){const r=new zt().fromBits(e,t);return n.add(r.multiply(oh)).rotl(13).multiply(ah)}const CB=new Uint8Array(16);class So{seed;v1=new zt;v2=new zt;v3=new zt;v4=new zt;total_len=0;memsize=0;memory=new Uint8Array(16);constructor(e){this.seed=zt.from(e||0),this.#e()}#e(){return this.v1.assign(this.seed).add(ah).add(oh),this.v2.assign(this.seed).add(oh),this.v3.assign(this.seed),this.v4.assign(this.seed).subtract(ah),this.total_len=0,this.memsize=0,this}update(e){let t;typeof e=="string"?t=qk.encode(e):typeof ArrayBuffer<"u"&&e instanceof ArrayBuffer?t=new Uint8Array(e):t=e;let r=0;const i=t.length,o=r+i;if(i===0)return this;if(this.total_len+=i,this.memsize===0&&this.memory.set(CB),this.memsize+i<16)return this.memory.set(t.subarray(0,i),this.memsize),this.memsize+=i,this;if(this.memsize>0){this.memory.set(t.subarray(0,16-this.memsize),this.memsize);let l=0;const f=this.memory;Ws(this.v1,f[l+1]<<8|f[l],f[l+3]<<8|f[l+2]),l+=4,Ws(this.v2,f[l+1]<<8|f[l],f[l+3]<<8|f[l+2]),l+=4,Ws(this.v3,f[l+1]<<8|f[l],f[l+3]<<8|f[l+2]),l+=4,Ws(this.v4,f[l+1]<<8|f[l],f[l+3]<<8|f[l+2]),r+=16-this.memsize,this.memsize=0}if(r<=o-16){const l=o-16;do Ws(this.v1,t[r+1]<<8|t[r],t[r+3]<<8|t[r+2]),r+=4,Ws(this.v2,t[r+1]<<8|t[r],t[r+3]<<8|t[r+2]),r+=4,Ws(this.v3,t[r+1]<<8|t[r],t[r+3]<<8|t[r+2]),r+=4,Ws(this.v4,t[r+1]<<8|t[r],t[r+3]<<8|t[r+2]),r+=4;while(r<=l)}return r<o&&(this.memory.set(t.subarray(r,o),this.memsize),this.memsize=o-r),this}digest(){const e=this.memory;let t=0;const r=this.memsize;let i,o;const l=new zt;for(this.total_len>=16?i=this.v1.clone().rotl(1).add(this.v2.clone().rotl(7).add(this.v3.clone().rotl(12).add(this.v4.clone().rotl(18)))):i=this.seed.clone().add(r_),i.add(l.fromNumber(this.total_len));t<=r-4;)l.fromBits(e[t+1]<<8|e[t],e[t+3]<<8|e[t+2]),i.add(l.clone().multiply(n_)).rotl(17).multiply(OB.clone()),t+=4;for(;t<r;)l.fromBits(e[t++],0),i.add(l.clone().multiply(r_)).rotl(11).multiply(ah);return o=i.clone().shiftRight(15),i.xor(o).multiply(oh),o=i.clone().shiftRight(13),i.xor(o).multiply(n_),o=i.clone().shiftRight(16),i.xor(o),this.#e(),i}toString(e){return this.digest().toString(e)}static h32(e,t=0){return e?Hk(e)?new So(e):new So(t).update(e):new So}static hash(e,t=0){return new So(t).update(e).digest()}}const Et=new Qe("11400714785074694791"),tn=new Qe("14029467366897019727"),s_=new Qe("1609587929392839161"),fl=new Qe("9650029242287828579"),i_=new Qe("2870177450012600261"),MB=new Uint8Array(32);class Eo{seed=new Qe;v1=new Qe;v2=new Qe;v3=new Qe;v4=new Qe;total_len=0;memsize=0;memory=new Uint8Array(32);constructor(e){this.seed=Qe.from(e||0),this.#e()}#e(){return this.v1.assign(this.seed).add(Et).add(tn),this.v2.assign(this.seed).add(tn),this.v3.assign(this.seed),this.v4.assign(this.seed).subtract(Et),this.total_len=0,this.memsize=0,this}update(e){let t;typeof e=="string"?t=qk.encode(e):typeof ArrayBuffer<"u"&&e instanceof ArrayBuffer?t=new Uint8Array(e):t=e;let r=0;const i=t.length,o=r+i;if(i===0)return this;if(this.total_len+=i,this.memsize===0&&this.memory.set(MB),this.memsize+i<32)return this.memory.set(t.subarray(0,i),this.memsize),this.memsize+=i,this;if(this.memsize>0){this.memory.set(t.subarray(0,32-this.memsize),this.memsize);let l=0,f;const h=this.memory;f=new Qe().fromBits(h[l+1]<<8|h[l],h[l+3]<<8|h[l+2],h[l+5]<<8|h[l+4],h[l+7]<<8|h[l+6]),this.v1.add(f.multiply(tn)).rotl(31).multiply(Et),l+=8,f=new Qe().fromBits(h[l+1]<<8|h[l],h[l+3]<<8|h[l+2],h[l+5]<<8|h[l+4],h[l+7]<<8|h[l+6]),this.v2.add(f.multiply(tn)).rotl(31).multiply(Et),l+=8,f=new Qe().fromBits(h[l+1]<<8|h[l],h[l+3]<<8|h[l+2],h[l+5]<<8|h[l+4],h[l+7]<<8|h[l+6]),this.v3.add(f.multiply(tn)).rotl(31).multiply(Et),l+=8,f=new Qe().fromBits(h[l+1]<<8|h[l],h[l+3]<<8|h[l+2],h[l+5]<<8|h[l+4],h[l+7]<<8|h[l+6]),this.v4.add(f.multiply(tn)).rotl(31).multiply(Et),r+=32-this.memsize,this.memsize=0}if(r<=o-32){const l=o-32;do{let f;f=new Qe().fromBits(t[r+1]<<8|t[r],t[r+3]<<8|t[r+2],t[r+5]<<8|t[r+4],t[r+7]<<8|t[r+6]),this.v1.add(f.multiply(tn)).rotl(31).multiply(Et),r+=8,f=new Qe().fromBits(t[r+1]<<8|t[r],t[r+3]<<8|t[r+2],t[r+5]<<8|t[r+4],t[r+7]<<8|t[r+6]),this.v2.add(f.multiply(tn)).rotl(31).multiply(Et),r+=8,f=new Qe().fromBits(t[r+1]<<8|t[r],t[r+3]<<8|t[r+2],t[r+5]<<8|t[r+4],t[r+7]<<8|t[r+6]),this.v3.add(f.multiply(tn)).rotl(31).multiply(Et),r+=8,f=new Qe().fromBits(t[r+1]<<8|t[r],t[r+3]<<8|t[r+2],t[r+5]<<8|t[r+4],t[r+7]<<8|t[r+6]),this.v4.add(f.multiply(tn)).rotl(31).multiply(Et),r+=8}while(r<=l)}return r<o&&(this.memory.set(t.subarray(r,o),this.memsize),this.memsize=o-r),this}digest(){const e=this.memory;let t=0;const r=this.memsize;let i,o;const l=new Qe;for(this.total_len>=32?(i=this.v1.clone().rotl(1),i.add(this.v2.clone().rotl(7)),i.add(this.v3.clone().rotl(12)),i.add(this.v4.clone().rotl(18)),i.xor(this.v1.clone().multiply(tn).rotl(31).multiply(Et)),i.multiply(Et).add(fl),i.xor(this.v2.clone().multiply(tn).rotl(31).multiply(Et)),i.multiply(Et).add(fl),i.xor(this.v3.clone().multiply(tn).rotl(31).multiply(Et)),i.multiply(Et).add(fl),i.xor(this.v4.clone().multiply(tn.clone()).rotl(31).multiply(Et.clone())),i.multiply(Et).add(fl)):i=this.seed.clone().add(i_),i.add(l.fromNumber(this.total_len));t<=r-8;)l.fromBits(e[t+1]<<8|e[t],e[t+3]<<8|e[t+2],e[t+5]<<8|e[t+4],e[t+7]<<8|e[t+6]),l.multiply(tn).rotl(31).multiply(Et),i.xor(l.clone()).rotl(27).multiply(Et).add(fl),t+=8;for(t+4<=r&&(l.fromBits(e[t+1]<<8|e[t],e[t+3]<<8|e[t+2],0,0),i.xor(l.clone().multiply(Et)).rotl(23).multiply(tn).add(s_),t+=4);t<r;)l.fromBits(e[t++],0,0,0),i.xor(l.clone().multiply(i_)).rotl(11).multiply(Et);return o=i.clone().shiftRight(33),i.xor(o).multiply(tn),o=i.clone().shiftRight(29),i.xor(o).multiply(s_),o=i.clone().shiftRight(32),i.xor(o),this.#e(),i}toString(e){return this.digest().toNumber().toString(e||10)}static h64(e,t=0){return e?Hk(e)?new Eo(e):new Eo(t).update(e):new Eo}static hash(e,t=0){return new Eo(t).update(e).digest()}}const NB={h32:So.h32,h64:Eo.h64},RB=new on;function Fk(){return RB.once(()=>new ow)}const DB=new on;class bw{logger;env;pathOps;ctx;txt;crypto;constructor(e){this.logger=e.logger,this.env=e.env,this.crypto=e.crypto,this.pathOps=e.pathOps,this.txt=e.txt,this.ctx=e.ctx}nextId(e=6){const t=this.crypto.randomBytes(e);return{str:st.encode(t),bin:t}}timeOrderedNextId(e){e=typeof e=="number"?e:new Date().getTime();const t=(281474976710656+e).toString(16).replace(/^1/,""),r=this.crypto.randomBytes(10);r[1]=r[1]&240|(r[1]|8&&11);const i=Array.from(r).map(o=>o.toString(16).padStart(2,"0")).join("");return{str:`${t.slice(0,8)}-${t.slice(8)}-7${i.slice(0,3)}-${i.slice(3,7)}-${i.slice(7,19)}`}}start(){return Promise.resolve()}clone(e){return new bw({logger:e.logger||this.logger,env:ua(e.env)||this.env,crypto:e.crypto||this.crypto,pathOps:e.pathOps||this.pathOps,txt:e.txt||this.txt,ctx:fi.merge(this.ctx,e.ctx)})}}function xB(n){let e={};return n instanceof Map?e=Object.fromEntries(n.entries()):typeof n=="object"&&n!==null&&(e=n),new Map([...Array.from(Object.entries({...PB({}),...e}))])}class IB{join(...e){return e.map(t=>t.replace(/\/+$/,"")).join("/")}dirname(e){return e.split("/").slice(0,-1).join("/")}basename(e){return e.split("/").pop()||""}}const UB=new IB,Vk=((n,e)=>({id:()=>"fp-txtOps",encode:t=>n.encode(t),decode:t=>e.decode(my(t).Ok()),base64:{encode:t=>{if(typeof t=="string"){const i=n.encode(t);return btoa(String.fromCharCode(...i))}let r="";for(const i of my(t).Ok())r+=String.fromCharCode(i);return btoa(r)},decodeUint8:t=>{const r=atob(t.replace(/\s+/g,""));return new Uint8Array(r.split("").map(i=>i.charCodeAt(0)))},decode:t=>{const r=atob(t.replace(/\s+/g,"")),i=new Uint8Array(r.split("").map(o=>o.charCodeAt(0)));return e.decode(i)}},base58:{encode:t=>{if(typeof t=="string"){const r=n.encode(t);return st.encode(r)}return st.encode(my(t).Ok())},decodeUint8:t=>st.decode(t.replace(/\s+/g,"")),decode:t=>{const r=st.decode(t.replace(/\s+/g,""));return e.decode(r)}}}))(new TextEncoder,new TextDecoder),zB=new Map;function vw(n){const e=ua({symbol:n?.env?.symbol||"FP_ENV",presetEnv:xB(n?.env?.presetEnv)}),t=new bw({logger:n?.logger||Fk(),env:e,crypto:n?.crypto||cw(),ctx:fi.merge(n?.ctx),pathOps:UB,txt:n?.txt||Vk});return zB.forEach(r=>r(t)),t}function Xe(n,e,t){let r;n&&OA(n.logger)?r=n.logger:r=Fk();const i=r.With().Module(e),o=[];let l=!1;if(t){"debug"in t&&(typeof t.debug=="string"&&t.debug.length>0?o.push(t.debug):o.push(e),delete t.debug),"exposeStack"in t&&(l=!0,delete t.exposeStack),"exposeStack"in t&&(l=!0,delete t.exposeStack),"this"in t&&(i.Str("this",n.nextId(4).str),delete t.this);for(const[h,m]of Object.entries(t))switch(typeof m){case"string":i.Str(h,m);break;case"number":i.Uint64(h,m);break;default:m instanceof Date?i.Str(h,m.toISOString()):nw(m)?i.Str(h,m.toString()):typeof m=="function"?i.Ref(h,m):i.Any(h,m);break}}DB.once(async()=>{n.env.onSet((h,m)=>{switch(h){case"FP_FORMAT":{switch(m){case"jsonice":r.SetFormatter(new ng(r.TxtEnDe(),2));break;case"yaml":r.SetFormatter(new vx(r.TxtEnDe(),2));break;default:r.SetFormatter(new ng(r.TxtEnDe()));break}break}case"FP_DEBUG":r.SetDebug(m||[]);break;case"FP_STACK":r.SetExposeStack(!!m);break}},"FP_FORMAT","FP_DEBUG","FP_STACK")}).finally(()=>{}),o.length>0&&r.SetDebug(o),l&&r.SetExposeStack(!0);const f=i.Logger();return n.env.get("FP_CONSTRUCTOR_DEBUG")&&f.Debug().Msg("constructor"),f}function Gi(n,e,t){const r=n.getParam(te.STORE);let i;switch(r){case"car":case"file":i="data";break;case"wal":case"meta":i=r;break;default:throw e.logger.Error().Url(n).Msg("store not found").AsError()}let o=i;return n.hasParam("index")&&(o=t(n.getParam(te.INDEX)||"idx",o)),{pathPart:i,fromUrl:r,name:o}}function hy(n,e){const t=n.getParam(te.KEY);if(!t)throw e.Error().Str("url",n.toString()).Msg("key not found").AsError();return t}async function Gk(n){return n().catch(e=>A.Err(e))}function LB(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function dy(n,e){const t=[];for(let r=0;r<n.length;r++)e(n[r],r)||t.push(r);for(let r=t.length-1;r>=0;r--)n.splice(t[r],1);return n}function my(n){return n instanceof Uint8Array?A.Ok(n):A.Is(n)?n:A.Err("Not a Uint8Array")}async function Zk(n){if(n instanceof Uint8Array)return A.Ok(n);if(A.Is(n))return n;if(typeof n.then=="function")try{return Zk(await n)}catch(e){return A.Err(e)}return A.Err("Not a Uint8Array")}function BB(n){const e=/\(([^,()]+,\s*[^,()]+|\[[^\]]+\],\s*[^,()]+)\)/g;let t=null;return Array.from(n.matchAll(e),i=>i[1].trim()).length===0&&(t=/=>\s*{?\s*([^{}]+)\s*}?/.exec(n),t&&t[1].includes("return")&&(t=null)),t?t[1]:n}function a_(n){switch(n){case"car":case"file":return"data";case"meta":case"wal":return n;default:throw new Error(`unknown store ${n}`)}}function ir(n,e,t,r,i,o){o=o||{};const l=(t?Fe.from(t):r).build().setParam(te.STORE,i).defParam(te.NAME,e.name);if(e.localURI){const h=e.localURI.getParamsResult({[te.NAME]:rn.OPTIONAL,[te.STORE_KEY]:rn.OPTIONAL}).Ok();h[te.NAME]&&l.defParam(te.LOCAL_NAME,h[te.NAME]),h[te.STORE_KEY]&&l.defParam(te.STORE_KEY,h[te.STORE_KEY])}return o.idx?(l.defParam(te.INDEX,"idx"),l.defParam(te.STORE_KEY,`@${l.getParam(te.NAME)}-${a_(i)}-idx@`)):l.defParam(te.STORE_KEY,`@${l.getParam(te.NAME)}-${a_(i)}@`),i==="car"&&l.defParam(te.SUFFIX,".car"),l.URI()}function PB(n,e="FP_PRESET_ENV"){const t=Symbol.for(e),r=globalThis[t]??{};for(const[i,o]of Object.entries(n))r[i]=o;return globalThis[t]=r,r}class Jk{hasher;ende;constructor(e){this.hasher=NB.h64(),this.ende=e||Vk}update(e){switch(!0){case e instanceof Uint8Array:this.hasher.update(e);break;case typeof e=="string":this.hasher.update(this.ende.encode(e));break;case typeof e=="number":this.hasher.update(this.ende.encode(e.toString()));break;case typeof e=="boolean":this.hasher.update(this.ende.encode(e?"true":"false"));break;default:throw new Error(`unsupported type ${typeof e}`)}return this}digest(e){e!=null&&this.update(e);const t=this.hasher.digest().toString(16),r=new Uint8Array(t.length/2+1);for(let i=0;i<t.length;i+=2)r[i/2]=parseInt(t.slice(i,i+2),16);return st.encode(r)}}async function $B(n){const e=jk(n),t=await Bt.digest(e);return Me.create(1,Kk,t).toString()}function Wk(n){return new Jk().update(n).digest()}function mi(n){const e=new Jk;return EA(n,(t,r)=>{switch(r){case"Null":case"Array":case"Function":break;case"Date":e.update(`D:${t.toISOString()}`);break;case"Symbol":e.update("S:(x as symbol).toString()}");break;case"Key":e.update(`K:${t}`);break;case"String":e.update(`S:${t}`);break;case"Boolean":e.update(`B:${t?"true":"false"}`);break;case"Number":e.update(`N:${t.toString()}`);break;case"Uint8Array":e.update(new Uint8Array([85,58,...t]));break}}),e.digest()}async function KB(n){return(await jB(n)).cid.toString()}async function jB(n){const e=jk(zl(n)),t=await Bt.digest(e);return{cid:Me.create(1,Kk,t),bytes:e,obj:n}}function HB(n){return new Promise(e=>setTimeout(e,n))}function qB(n){return(structuredClone??(e=>JSON.parse(JSON.stringify(e))))(n)}function Yk(n){return OA(n)?n:n.logger}function oo(n,e){Yk(n).Debug().TimerStart(e).Msg("Timing started")}function co(n,e){Yk(n).Debug().TimerEnd(e).Msg("Timing ended")}function Qk(n){if(n){Object.freeze(n);for(const e of Object.values(n))e&&typeof e=="object"&&!Object.isFrozen(e)&&Qk(e);return n}}function FB(n){const e=[],t=n.split(`
`);let r=0,i=-1;for(;r<t.length;){const o=t[r],l=o.match(/^(-{3,})\s*(BEGIN)\s+(.+?)\s*(-{3,})$/i);if(l){const f=l[1].length,h=l[4].length,y=l[3].replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),g=new RegExp(`^-{${f}}\\s*(END)\\s+${y}\\s*-{${h}}$`,"i"),b=[];for(let k=i+1;k<r;k++)b.push(t[k]);r++;const E=[];let _=!1,S="";for(;r<t.length;){if(g.test(t[r])){_=!0,S=t[r];break}E.push(t[r]),r++}if(_){r++;const k=[];for(;r<t.length&&!t[r].match(/^-{3,}\s*BEGIN\s+.+-{3,}$/i);)k.push(t[r]),r++;e.push({preBegin:b.length>0?b.join(`
`):void 0,begin:o,content:E.join(`
`),end:S,postEnd:k.length>0?k.join(`
`):void 0}),i=r-1}else{const k=[...b,o,...E];e.push({begin:void 0,end:void 0,content:k.join(`
`),preBegin:void 0,postEnd:void 0}),i=r-1}}else r++}if(i<t.length-1){const o=[];for(let l=i+1;l<t.length;l++)o.push(t[l]);o.length>0&&e.push({begin:void 0,end:void 0,content:o.join(`
`),preBegin:void 0,postEnd:void 0})}return e}function VB(n){const e=[];for(const t of n)t.isOk()&&e.push(t.Ok());return e}const GB=["string","number","bigint","symbol"],ZB=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function JB(n){if(n===null)return"null";if(n===void 0)return"undefined";if(n===!0||n===!1)return"boolean";const e=typeof n;if(GB.includes(e))return e;if(e==="function")return"Function";if(Array.isArray(n))return"Array";if(WB(n))return"Buffer";const t=YB(n);return t||"Object"}function WB(n){return n&&n.constructor&&n.constructor.isBuffer&&n.constructor.isBuffer.call(null,n)}function YB(n){const e=Object.prototype.toString.call(n).slice(8,-1);if(ZB.includes(e))return e}class R{constructor(e,t,r){this.major=e,this.majorEncoded=e<<5,this.name=t,this.terminal=r}toString(){return`Type[${this.major}].${this.name}`}compare(e){return this.major<e.major?-1:this.major>e.major?1:0}static equals(e,t){return e===t||e.major===t.major&&e.name===t.name}}R.uint=new R(0,"uint",!0);R.negint=new R(1,"negint",!0);R.bytes=new R(2,"bytes",!0);R.string=new R(3,"string",!0);R.array=new R(4,"array",!1);R.map=new R(5,"map",!1);R.tag=new R(6,"tag",!1);R.float=new R(7,"float",!0);R.false=new R(7,"false",!0);R.true=new R(7,"true",!0);R.null=new R(7,"null",!0);R.undefined=new R(7,"undefined",!0);R.break=new R(7,"break",!0);class X{constructor(e,t,r){this.type=e,this.value=t,this.encodedLength=r,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}}const Qo=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&typeof globalThis.Buffer.isBuffer=="function",QB=new TextDecoder,XB=new TextEncoder;function Mh(n){return Qo&&globalThis.Buffer.isBuffer(n)}function Sw(n){return n instanceof Uint8Array?Mh(n)?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):n:Uint8Array.from(n)}const e6=Qo?((n,e,t)=>t-e>64?globalThis.Buffer.from(n.subarray(e,t)).toString("utf8"):c_(n,e,t)):((n,e,t)=>t-e>64?QB.decode(n.subarray(e,t)):c_(n,e,t)),Xk=Qo?(n=>n.length>64?globalThis.Buffer.from(n):o_(n)):(n=>n.length>64?XB.encode(n):o_(n)),ys=n=>Uint8Array.from(n),Ew=Qo?((n,e,t)=>Mh(n)?new Uint8Array(n.subarray(e,t)):n.slice(e,t)):((n,e,t)=>n.slice(e,t)),t6=Qo?((n,e)=>(n=n.map(t=>t instanceof Uint8Array?t:globalThis.Buffer.from(t)),Sw(globalThis.Buffer.concat(n,e)))):((n,e)=>{const t=new Uint8Array(e);let r=0;for(let i of n)r+i.length>t.length&&(i=i.subarray(0,t.length-r)),t.set(i,r),r+=i.length;return t}),n6=Qo?(n=>globalThis.Buffer.allocUnsafe(n)):(n=>new Uint8Array(n));function r6(n,e){if(Mh(n)&&Mh(e))return n.compare(e);for(let t=0;t<n.length;t++)if(n[t]!==e[t])return n[t]<e[t]?-1:1;return 0}function o_(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(i>=55296&&i<=57343&&(i=65533),e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e}function c_(n,e,t){const r=[];for(;e<t;){const i=n[e];let o=null,l=i>239?4:i>223?3:i>191?2:1;if(e+l<=t){let f,h,m,y;switch(l){case 1:i<128&&(o=i);break;case 2:f=n[e+1],(f&192)===128&&(y=(i&31)<<6|f&63,y>127&&(o=y));break;case 3:f=n[e+1],h=n[e+2],(f&192)===128&&(h&192)===128&&(y=(i&15)<<12|(f&63)<<6|h&63,y>2047&&(y<55296||y>57343)&&(o=y));break;case 4:f=n[e+1],h=n[e+2],m=n[e+3],(f&192)===128&&(h&192)===128&&(m&192)===128&&(y=(i&15)<<18|(f&63)<<12|(h&63)<<6|m&63,y>65535&&y<1114112&&(o=y))}}o===null?(o=65533,l=1):o>65535&&(o-=65536,r.push(o>>>10&1023|55296),o=56320|o&1023),r.push(o),e+=l}return eT(r)}const l_=4096;function eT(n){const e=n.length;if(e<=l_)return String.fromCharCode.apply(String,n);let t="",r=0;for(;r<e;)t+=String.fromCharCode.apply(String,n.slice(r,r+=l_));return t}const s6=256;class tT{constructor(e=s6){this.chunkSize=e,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),this._initReuseChunk!==null&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(e){let t=this.chunks[this.chunks.length-1];if(this.cursor+e.length<=this.maxCursor+1){const i=t.length-(this.maxCursor-this.cursor)-1;t.set(e,i)}else{if(t){const i=t.length-(this.maxCursor-this.cursor)-1;i<t.length&&(this.chunks[this.chunks.length-1]=t.subarray(0,i),this.maxCursor=this.cursor-1)}e.length<64&&e.length<this.chunkSize?(t=n6(this.chunkSize),this.chunks.push(t),this.maxCursor+=t.length,this._initReuseChunk===null&&(this._initReuseChunk=t),t.set(e,0)):(this.chunks.push(e),this.maxCursor+=e.length)}this.cursor+=e.length}toBytes(e=!1){let t;if(this.chunks.length===1){const r=this.chunks[0];e&&this.cursor>r.length/2?(t=this.cursor===r.length?r:r.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):t=Ew(r,0,this.cursor)}else t=t6(this.chunks,this.cursor);return e&&this.reset(),t}}const ye="CBOR decode error:",Xi="CBOR encode error:";function Xo(n,e,t){if(n.length-e<t)throw new Error(`${ye} not enough data for type`)}const sn=[24,256,65536,4294967296,BigInt("18446744073709551616")];function da(n,e,t){Xo(n,e,1);const r=n[e];if(t.strict===!0&&r<sn[0])throw new Error(`${ye} integer encoded in more bytes than necessary (strict decode)`);return r}function ma(n,e,t){Xo(n,e,2);const r=n[e]<<8|n[e+1];if(t.strict===!0&&r<sn[1])throw new Error(`${ye} integer encoded in more bytes than necessary (strict decode)`);return r}function pa(n,e,t){Xo(n,e,4);const r=n[e]*16777216+(n[e+1]<<16)+(n[e+2]<<8)+n[e+3];if(t.strict===!0&&r<sn[2])throw new Error(`${ye} integer encoded in more bytes than necessary (strict decode)`);return r}function ya(n,e,t){Xo(n,e,8);const r=n[e]*16777216+(n[e+1]<<16)+(n[e+2]<<8)+n[e+3],i=n[e+4]*16777216+(n[e+5]<<16)+(n[e+6]<<8)+n[e+7],o=(BigInt(r)<<BigInt(32))+BigInt(i);if(t.strict===!0&&o<sn[3])throw new Error(`${ye} integer encoded in more bytes than necessary (strict decode)`);if(o<=Number.MAX_SAFE_INTEGER)return Number(o);if(t.allowBigInt===!0)return o;throw new Error(`${ye} integers outside of the safe integer range are not supported`)}function i6(n,e,t,r){return new X(R.uint,da(n,e+1,r),2)}function a6(n,e,t,r){return new X(R.uint,ma(n,e+1,r),3)}function o6(n,e,t,r){return new X(R.uint,pa(n,e+1,r),5)}function c6(n,e,t,r){return new X(R.uint,ya(n,e+1,r),9)}function ga(n,e){return fr(n,0,e.value)}function fr(n,e,t){if(t<sn[0]){const r=Number(t);n.push([e|r])}else if(t<sn[1]){const r=Number(t);n.push([e|24,r])}else if(t<sn[2]){const r=Number(t);n.push([e|25,r>>>8,r&255])}else if(t<sn[3]){const r=Number(t);n.push([e|26,r>>>24&255,r>>>16&255,r>>>8&255,r&255])}else{const r=BigInt(t);if(r<sn[4]){const i=[e|27,0,0,0,0,0,0,0];let o=Number(r&BigInt(4294967295)),l=Number(r>>BigInt(32)&BigInt(4294967295));i[8]=o&255,o=o>>8,i[7]=o&255,o=o>>8,i[6]=o&255,o=o>>8,i[5]=o&255,i[4]=l&255,l=l>>8,i[3]=l&255,l=l>>8,i[2]=l&255,l=l>>8,i[1]=l&255,n.push(i)}else throw new Error(`${ye} encountered BigInt larger than allowable range`)}}ga.encodedSize=function(e){return fr.encodedSize(e.value)};fr.encodedSize=function(e){return e<sn[0]?1:e<sn[1]?2:e<sn[2]?3:e<sn[3]?5:9};ga.compareTokens=function(e,t){return e.value<t.value?-1:e.value>t.value?1:0};function l6(n,e,t,r){return new X(R.negint,-1-da(n,e+1,r),2)}function u6(n,e,t,r){return new X(R.negint,-1-ma(n,e+1,r),3)}function f6(n,e,t,r){return new X(R.negint,-1-pa(n,e+1,r),5)}const _w=BigInt(-1),nT=BigInt(1);function h6(n,e,t,r){const i=ya(n,e+1,r);if(typeof i!="bigint"){const o=-1-i;if(o>=Number.MIN_SAFE_INTEGER)return new X(R.negint,o,9)}if(r.allowBigInt!==!0)throw new Error(`${ye} integers outside of the safe integer range are not supported`);return new X(R.negint,_w-BigInt(i),9)}function Aw(n,e){const t=e.value,r=typeof t=="bigint"?t*_w-nT:t*-1-1;fr(n,e.type.majorEncoded,r)}Aw.encodedSize=function(e){const t=e.value,r=typeof t=="bigint"?t*_w-nT:t*-1-1;return r<sn[0]?1:r<sn[1]?2:r<sn[2]?3:r<sn[3]?5:9};Aw.compareTokens=function(e,t){return e.value<t.value?1:e.value>t.value?-1:0};function tu(n,e,t,r){Xo(n,e,t+r);const i=Ew(n,e+t,e+t+r);return new X(R.bytes,i,t+r)}function d6(n,e,t,r){return tu(n,e,1,t)}function m6(n,e,t,r){return tu(n,e,2,da(n,e+1,r))}function p6(n,e,t,r){return tu(n,e,3,ma(n,e+1,r))}function y6(n,e,t,r){return tu(n,e,5,pa(n,e+1,r))}function g6(n,e,t,r){const i=ya(n,e+1,r);if(typeof i=="bigint")throw new Error(`${ye} 64-bit integer bytes lengths not supported`);return tu(n,e,9,i)}function Nh(n){return n.encodedBytes===void 0&&(n.encodedBytes=R.equals(n.type,R.string)?Xk(n.value):n.value),n.encodedBytes}function dd(n,e){const t=Nh(e);fr(n,e.type.majorEncoded,t.length),n.push(t)}dd.encodedSize=function(e){const t=Nh(e);return fr.encodedSize(t.length)+t.length};dd.compareTokens=function(e,t){return w6(Nh(e),Nh(t))};function w6(n,e){return n.length<e.length?-1:n.length>e.length?1:r6(n,e)}function nu(n,e,t,r,i){const o=t+r;Xo(n,e,o);const l=new X(R.string,e6(n,e+t,e+o),o);return i.retainStringBytes===!0&&(l.byteValue=Ew(n,e+t,e+o)),l}function b6(n,e,t,r){return nu(n,e,1,t,r)}function v6(n,e,t,r){return nu(n,e,2,da(n,e+1,r),r)}function S6(n,e,t,r){return nu(n,e,3,ma(n,e+1,r),r)}function E6(n,e,t,r){return nu(n,e,5,pa(n,e+1,r),r)}function _6(n,e,t,r){const i=ya(n,e+1,r);if(typeof i=="bigint")throw new Error(`${ye} 64-bit integer string lengths not supported`);return nu(n,e,9,i,r)}const A6=dd;function ec(n,e,t,r){return new X(R.array,r,t)}function k6(n,e,t,r){return ec(n,e,1,t)}function T6(n,e,t,r){return ec(n,e,2,da(n,e+1,r))}function O6(n,e,t,r){return ec(n,e,3,ma(n,e+1,r))}function C6(n,e,t,r){return ec(n,e,5,pa(n,e+1,r))}function M6(n,e,t,r){const i=ya(n,e+1,r);if(typeof i=="bigint")throw new Error(`${ye} 64-bit integer array lengths not supported`);return ec(n,e,9,i)}function N6(n,e,t,r){if(r.allowIndefinite===!1)throw new Error(`${ye} indefinite length items not allowed`);return ec(n,e,1,1/0)}function kw(n,e){fr(n,R.array.majorEncoded,e.value)}kw.compareTokens=ga.compareTokens;kw.encodedSize=function(e){return fr.encodedSize(e.value)};function tc(n,e,t,r){return new X(R.map,r,t)}function R6(n,e,t,r){return tc(n,e,1,t)}function D6(n,e,t,r){return tc(n,e,2,da(n,e+1,r))}function x6(n,e,t,r){return tc(n,e,3,ma(n,e+1,r))}function I6(n,e,t,r){return tc(n,e,5,pa(n,e+1,r))}function U6(n,e,t,r){const i=ya(n,e+1,r);if(typeof i=="bigint")throw new Error(`${ye} 64-bit integer map lengths not supported`);return tc(n,e,9,i)}function z6(n,e,t,r){if(r.allowIndefinite===!1)throw new Error(`${ye} indefinite length items not allowed`);return tc(n,e,1,1/0)}function Tw(n,e){fr(n,R.map.majorEncoded,e.value)}Tw.compareTokens=ga.compareTokens;Tw.encodedSize=function(e){return fr.encodedSize(e.value)};function L6(n,e,t,r){return new X(R.tag,t,1)}function B6(n,e,t,r){return new X(R.tag,da(n,e+1,r),2)}function P6(n,e,t,r){return new X(R.tag,ma(n,e+1,r),3)}function $6(n,e,t,r){return new X(R.tag,pa(n,e+1,r),5)}function K6(n,e,t,r){return new X(R.tag,ya(n,e+1,r),9)}function Ow(n,e){fr(n,R.tag.majorEncoded,e.value)}Ow.compareTokens=ga.compareTokens;Ow.encodedSize=function(e){return fr.encodedSize(e.value)};const j6=20,H6=21,q6=22,F6=23;function V6(n,e,t,r){if(r.allowUndefined===!1)throw new Error(`${ye} undefined values are not supported`);return r.coerceUndefinedToNull===!0?new X(R.null,null,1):new X(R.undefined,void 0,1)}function G6(n,e,t,r){if(r.allowIndefinite===!1)throw new Error(`${ye} indefinite length items not allowed`);return new X(R.break,void 0,1)}function Cw(n,e,t){if(t){if(t.allowNaN===!1&&Number.isNaN(n))throw new Error(`${ye} NaN values are not supported`);if(t.allowInfinity===!1&&(n===1/0||n===-1/0))throw new Error(`${ye} Infinity values are not supported`)}return new X(R.float,n,e)}function Z6(n,e,t,r){return Cw(Nw(n,e+1),3,r)}function J6(n,e,t,r){return Cw(Rw(n,e+1),5,r)}function W6(n,e,t,r){return Cw(aT(n,e+1),9,r)}function Mw(n,e,t){const r=e.value;if(r===!1)n.push([R.float.majorEncoded|j6]);else if(r===!0)n.push([R.float.majorEncoded|H6]);else if(r===null)n.push([R.float.majorEncoded|q6]);else if(r===void 0)n.push([R.float.majorEncoded|F6]);else{let i,o=!1;(!t||t.float64!==!0)&&(sT(r),i=Nw(br,1),r===i||Number.isNaN(r)?(br[0]=249,n.push(br.slice(0,3)),o=!0):(iT(r),i=Rw(br,1),r===i&&(br[0]=250,n.push(br.slice(0,5)),o=!0))),o||(Y6(r),i=aT(br,1),br[0]=251,n.push(br.slice(0,9)))}}Mw.encodedSize=function(e,t){const r=e.value;if(r===!1||r===!0||r===null||r===void 0)return 1;if(!t||t.float64!==!0){sT(r);let i=Nw(br,1);if(r===i||Number.isNaN(r))return 3;if(iT(r),i=Rw(br,1),r===i)return 5}return 9};const rT=new ArrayBuffer(9),sr=new DataView(rT,1),br=new Uint8Array(rT,0);function sT(n){if(n===1/0)sr.setUint16(0,31744,!1);else if(n===-1/0)sr.setUint16(0,64512,!1);else if(Number.isNaN(n))sr.setUint16(0,32256,!1);else{sr.setFloat32(0,n);const e=sr.getUint32(0),t=(e&2139095040)>>23,r=e&8388607;if(t===255)sr.setUint16(0,31744,!1);else if(t===0)sr.setUint16(0,(n&2147483648)>>16|r>>13,!1);else{const i=t-127;i<-24?sr.setUint16(0,0):i<-14?sr.setUint16(0,(e&2147483648)>>16|1<<24+i,!1):sr.setUint16(0,(e&2147483648)>>16|i+15<<10|r>>13,!1)}}}function Nw(n,e){if(n.length-e<2)throw new Error(`${ye} not enough data for float16`);const t=(n[e]<<8)+n[e+1];if(t===31744)return 1/0;if(t===64512)return-1/0;if(t===32256)return NaN;const r=t>>10&31,i=t&1023;let o;return r===0?o=i*2**-24:r!==31?o=(i+1024)*2**(r-25):o=i===0?1/0:NaN,t&32768?-o:o}function iT(n){sr.setFloat32(0,n,!1)}function Rw(n,e){if(n.length-e<4)throw new Error(`${ye} not enough data for float32`);const t=(n.byteOffset||0)+e;return new DataView(n.buffer,t,4).getFloat32(0,!1)}function Y6(n){sr.setFloat64(0,n,!1)}function aT(n,e){if(n.length-e<8)throw new Error(`${ye} not enough data for float64`);const t=(n.byteOffset||0)+e;return new DataView(n.buffer,t,8).getFloat64(0,!1)}Mw.compareTokens=ga.compareTokens;function je(n,e,t){throw new Error(`${ye} encountered invalid minor (${t}) for major ${n[e]>>>5}`)}function md(n){return()=>{throw new Error(`${ye} ${n}`)}}const se=[];for(let n=0;n<=23;n++)se[n]=je;se[24]=i6;se[25]=a6;se[26]=o6;se[27]=c6;se[28]=je;se[29]=je;se[30]=je;se[31]=je;for(let n=32;n<=55;n++)se[n]=je;se[56]=l6;se[57]=u6;se[58]=f6;se[59]=h6;se[60]=je;se[61]=je;se[62]=je;se[63]=je;for(let n=64;n<=87;n++)se[n]=d6;se[88]=m6;se[89]=p6;se[90]=y6;se[91]=g6;se[92]=je;se[93]=je;se[94]=je;se[95]=md("indefinite length bytes/strings are not supported");for(let n=96;n<=119;n++)se[n]=b6;se[120]=v6;se[121]=S6;se[122]=E6;se[123]=_6;se[124]=je;se[125]=je;se[126]=je;se[127]=md("indefinite length bytes/strings are not supported");for(let n=128;n<=151;n++)se[n]=k6;se[152]=T6;se[153]=O6;se[154]=C6;se[155]=M6;se[156]=je;se[157]=je;se[158]=je;se[159]=N6;for(let n=160;n<=183;n++)se[n]=R6;se[184]=D6;se[185]=x6;se[186]=I6;se[187]=U6;se[188]=je;se[189]=je;se[190]=je;se[191]=z6;for(let n=192;n<=215;n++)se[n]=L6;se[216]=B6;se[217]=P6;se[218]=$6;se[219]=K6;se[220]=je;se[221]=je;se[222]=je;se[223]=je;for(let n=224;n<=243;n++)se[n]=md("simple values are not supported");se[244]=je;se[245]=je;se[246]=je;se[247]=V6;se[248]=md("simple values are not supported");se[249]=Z6;se[250]=J6;se[251]=W6;se[252]=je;se[253]=je;se[254]=je;se[255]=G6;const jr=[];for(let n=0;n<24;n++)jr[n]=new X(R.uint,n,1);for(let n=-1;n>=-24;n--)jr[31-n]=new X(R.negint,n,1);jr[64]=new X(R.bytes,new Uint8Array(0),1);jr[96]=new X(R.string,"",1);jr[128]=new X(R.array,0,1);jr[160]=new X(R.map,0,1);jr[244]=new X(R.false,!1,1);jr[245]=new X(R.true,!0,1);jr[246]=new X(R.null,null,1);function oT(n){switch(n.type){case R.false:return ys([244]);case R.true:return ys([245]);case R.null:return ys([246]);case R.bytes:return n.value.length?void 0:ys([64]);case R.string:return n.value===""?ys([96]):void 0;case R.array:return n.value===0?ys([128]):void 0;case R.map:return n.value===0?ys([160]):void 0;case R.uint:return n.value<24?ys([Number(n.value)]):void 0;case R.negint:if(n.value>=-24)return ys([31-Number(n.value)])}}const Q6={float64:!1,mapSorter:e3,quickEncodeToken:oT};function cT(){const n=[];return n[R.uint.major]=ga,n[R.negint.major]=Aw,n[R.bytes.major]=dd,n[R.string.major]=A6,n[R.array.major]=kw,n[R.map.major]=Tw,n[R.tag.major]=Ow,n[R.float.major]=Mw,n}const lT=cT(),py=new tT;class Rh{constructor(e,t){this.obj=e,this.parent=t}includes(e){let t=this;do if(t.obj===e)return!0;while(t=t.parent);return!1}static createCheck(e,t){if(e&&e.includes(t))throw new Error(`${Xi} object contains circular references`);return new Rh(t,e)}}const Ys={null:new X(R.null,null),undefined:new X(R.undefined,void 0),true:new X(R.true,!0),false:new X(R.false,!1),emptyArray:new X(R.array,0),emptyMap:new X(R.map,0)},pi={number(n,e,t,r){return!Number.isInteger(n)||!Number.isSafeInteger(n)?new X(R.float,n):n>=0?new X(R.uint,n):new X(R.negint,n)},bigint(n,e,t,r){return n>=BigInt(0)?new X(R.uint,n):new X(R.negint,n)},Uint8Array(n,e,t,r){return new X(R.bytes,n)},string(n,e,t,r){return new X(R.string,n)},boolean(n,e,t,r){return n?Ys.true:Ys.false},null(n,e,t,r){return Ys.null},undefined(n,e,t,r){return Ys.undefined},ArrayBuffer(n,e,t,r){return new X(R.bytes,new Uint8Array(n))},DataView(n,e,t,r){return new X(R.bytes,new Uint8Array(n.buffer,n.byteOffset,n.byteLength))},Array(n,e,t,r){if(!n.length)return t.addBreakTokens===!0?[Ys.emptyArray,new X(R.break)]:Ys.emptyArray;r=Rh.createCheck(r,n);const i=[];let o=0;for(const l of n)i[o++]=ch(l,t,r);return t.addBreakTokens?[new X(R.array,n.length),i,new X(R.break)]:[new X(R.array,n.length),i]},Object(n,e,t,r){const i=e!=="Object",o=i?n.keys():Object.keys(n),l=i?n.size:o.length;let f;if(l){f=new Array(l),r=Rh.createCheck(r,n);const h=!i&&t.ignoreUndefinedProperties;let m=0;for(const y of o){const g=i?n.get(y):n[y];h&&g===void 0||(f[m++]=[ch(y,t,r),ch(g,t,r)])}m<l&&(f.length=m)}return f?.length?(X6(f,t),t.addBreakTokens?[new X(R.map,f.length),f,new X(R.break)]:[new X(R.map,f.length),f]):t.addBreakTokens===!0?[Ys.emptyMap,new X(R.break)]:Ys.emptyMap}};pi.Map=pi.Object;pi.Buffer=pi.Uint8Array;for(const n of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))pi[`${n}Array`]=pi.DataView;function ch(n,e={},t){const r=JB(n),i=e&&e.typeEncoders&&e.typeEncoders[r]||pi[r];if(typeof i=="function"){const l=i(n,r,e,t);if(l!=null)return l}const o=pi[r];if(!o)throw new Error(`${Xi} unsupported type: ${r}`);return o(n,r,e,t)}function X6(n,e){e.mapSorter&&n.sort(e.mapSorter)}function e3(n,e){const t=Array.isArray(n[0])?n[0][0]:n[0],r=Array.isArray(e[0])?e[0][0]:e[0];if(t.type!==r.type)return t.type.compare(r.type);const i=t.type.major,o=lT[i].compareTokens(t,r);return o===0&&console.warn("WARNING: complex key types used, CBOR key sorting guarantees are gone"),o}function uT(n,e,t,r){if(Array.isArray(e))for(const i of e)uT(n,i,t,r);else t[e.type.major](n,e,r)}function fT(n,e,t){const r=ch(n,t);if(!Array.isArray(r)&&t.quickEncodeToken){const i=t.quickEncodeToken(r);if(i)return i;const o=e[r.type.major];if(o.encodedSize){const l=o.encodedSize(r,t),f=new tT(l);if(o(f,r,t),f.chunks.length!==1)throw new Error(`Unexpected error: pre-calculated length for ${r} was wrong`);return Sw(f.chunks[0])}}return py.reset(),uT(py,r,e,t),py.toBytes(!0)}function hT(n,e){return e=Object.assign({},Q6,e),fT(n,lT,e)}const t3={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0};class n3{constructor(e,t={}){this._pos=0,this.data=e,this.options=t}pos(){return this._pos}done(){return this._pos>=this.data.length}next(){const e=this.data[this._pos];let t=jr[e];if(t===void 0){const r=se[e];if(!r)throw new Error(`${ye} no decoder for major type ${e>>>5} (byte 0x${e.toString(16).padStart(2,"0")})`);const i=e&31;t=r(this.data,this._pos,i,this.options)}return this._pos+=t.encodedLength,t}}const Hl=Symbol.for("DONE"),pd=Symbol.for("BREAK");function r3(n,e,t){const r=[];for(let i=0;i<n.value;i++){const o=ql(e,t);if(o===pd){if(n.value===1/0)break;throw new Error(`${ye} got unexpected break to lengthed array`)}if(o===Hl)throw new Error(`${ye} found array but not enough entries (got ${i}, expected ${n.value})`);r[i]=o}return r}function s3(n,e,t){const r=t.useMaps===!0,i=r?void 0:{},o=r?new Map:void 0;for(let l=0;l<n.value;l++){const f=ql(e,t);if(f===pd){if(n.value===1/0)break;throw new Error(`${ye} got unexpected break to lengthed map`)}if(f===Hl)throw new Error(`${ye} found map but not enough entries (got ${l} [no key], expected ${n.value})`);if(r!==!0&&typeof f!="string")throw new Error(`${ye} non-string keys not supported (got ${typeof f})`);if(t.rejectDuplicateMapKeys===!0&&(r&&o.has(f)||!r&&f in i))throw new Error(`${ye} found repeat map key "${f}"`);const h=ql(e,t);if(h===Hl)throw new Error(`${ye} found map but not enough entries (got ${l} [no value], expected ${n.value})`);r?o.set(f,h):i[f]=h}return r?o:i}function ql(n,e){if(n.done())return Hl;const t=n.next();if(R.equals(t.type,R.break))return pd;if(t.type.terminal)return t.value;if(R.equals(t.type,R.array))return r3(t,n,e);if(R.equals(t.type,R.map))return s3(t,n,e);if(R.equals(t.type,R.tag)){if(e.tags&&typeof e.tags[t.value]=="function"){const r=ql(n,e);return e.tags[t.value](r)}throw new Error(`${ye} tag not supported (${t.value})`)}throw new Error("unsupported")}function i3(n,e){if(!(n instanceof Uint8Array))throw new Error(`${ye} data to decode must be a Uint8Array`);e=Object.assign({},t3,e);const t=e.tokenizer||new n3(n,e),r=ql(t,e);if(r===Hl)throw new Error(`${ye} did not find any content to decode`);if(r===pd)throw new Error(`${ye} got unexpected break`);return[r,n.subarray(t.pos())]}function Dw(n,e){const[t,r]=i3(n,e);if(r.length>0)throw new Error(`${ye} too many terminals, data makes no sense`);return t}const u_={random:{calc:async(n,e,t)=>e.randomBytes(n.ivLength),verify:async(n,e,t,r)=>!0},hash:{calc:async(n,e,t)=>{const r=await Bt.digest(t),i=new Uint8Array(r.bytes),o=new Uint8Array(n.ivLength);for(let l=0;l<i.length;l++)o[l%n.ivLength]^=i[l];return o},verify:async function(n,e,t,r){return n.url.getParam(te.IV_VERIFY)!=="disable"&&LB(t,await this.calc(n,e,r))}}};function f_(n,e){const t=e.ivCalc||n.getParam(te.IV_HASH)||"hash";return u_[t]||u_.hash}class a3{code=24;name="Fireproof@encrypted-block:aes-gcm";ko;iv;opts;constructor(e,t,r){this.ko=e,this.iv=t,this.opts=r||{}}valueToHashBytes(e){return Promise.resolve(e.data)}bytesToHash(e){return Promise.resolve(e)}async encode(e){const t=this.iv||await f_(this.ko.url,this.opts).calc(this.ko,this.ko.crypto,e),{iv:r}=this.ko.algo(t),i=await this.ko.key.get();if(!i)throw this.ko.logger.Error().Msg("default key not found").AsError();const o=st.decode(i?.fingerPrint);return this.ko.logger.Debug().Str("fp",i.fingerPrint).Msg("encode"),hT({iv:r,keyId:o,data:await this.ko._encrypt({iv:r,key:i.key,bytes:e})})}async decode(e){let t;e instanceof Uint8Array?t=e:t=new Uint8Array(e);const{iv:r,keyId:i,data:o}=Dw(t),l=await this.ko.key.get(i);if(!l)throw this.ko.logger.Error().Str("fp",st.encode(i)).Msg("keyId not found").AsError();const f=await this.ko._decrypt({iv:r,key:l.key,bytes:o});if(!this.opts?.noIVVerify&&!await f_(this.ko.url,this.opts).verify(this.ko,this.ko.crypto,r,f))throw this.ko.logger.Error().Msg("iv missmatch").AsError();return{iv:r,keyId:i,data:f}}}class o3{code=24;ivLength=12;logger;crypto;key;isEncrypting=!0;url;constructor(e,t,r,i){this.logger=Xe(i,"cryptoAction"),this.crypto=r,this.key=t,this.url=e}codec(e,t){return new a3(this,e,t)}algo(e){return{name:"AES-GCM",iv:e||this.crypto.randomBytes(this.ivLength),tagLength:128}}async _decrypt(e){return new Uint8Array(await this.crypto.decrypt(this.algo(e.iv),e.key,e.bytes))}async _encrypt(e){const t=this.algo(e.iv);return new Uint8Array(await this.crypto.encrypt(t,e.key,e.bytes))}}class c3{code=24;name="Fireproof@unencrypted-block";empty=new Uint8Array;async encode(e){return e}async decode(e){return{iv:this.empty,keyId:this.empty,data:e}}}class l3{ivLength=0;code=0;name="Fireproof@unencrypted-block";logger;crypto;key;isEncrypting=!1;_fingerPrint="noCrypto:"+Math.random();url;constructor(e,t,r){this.logger=Xe(r,"noCrypto"),this.crypto=t,this.key={id:r.nextId().str,name:"noCrypto",get:()=>{throw this.logger.Error().Msg("noCrypto.get not implemented").AsError()},upsert:()=>{throw this.logger.Error().Msg("noCrypto.upsert not implemented").AsError()},asV2StorageKeyItem:()=>{throw this.logger.Error().Msg("noCrypto.asV2KeysItem not implemented").AsError()}},this.url=e}fingerPrint(){return Promise.resolve(this._fingerPrint)}codec(e){return new c3}algo(e){return{name:"noCrypto",iv:new Uint8Array,tagLength:0}}_decrypt(){throw this.logger.Error().Msg("noCrypto.decrypt not implemented").AsError()}_encrypt(){throw this.logger.Error().Msg("noCrypto.decrypt not implemented").AsError()}}async function u3(n,e,t){const r=n.getParam(te.STORE_KEY);if(r&&r!=="insecure"){const i=await e.getNamedKey(r,!1);if(i.isErr())throw t.logger.Error().Str("keybag",e.rt.id()).Str("name",r).Msg("getNamedKey failed").AsError();return new o3(n,i.Ok(),e.rt.crypto,t)}return new l3(n,e.rt.crypto,t)}function Pf({enumerable:n=!0,configurable:e=!1}={}){return{enumerable:n,configurable:e,writable:!1}}function*f3(n,e){if(e!=null&&typeof e=="object")if(Array.isArray(e))for(const[t,r]of e.entries()){const i=[...n,t],o=Me.asCID(r);o!=null?yield[i.join("/"),o]:typeof r=="object"&&(yield*hg(r,i))}else{const t=Me.asCID(e);t!=null?yield[n.join("/"),t]:yield*hg(e,n)}}function*hg(n,e){if(n==null||n instanceof Uint8Array)return;const t=Me.asCID(n);t!=null&&(yield[e.join("/"),t]);for(const[r,i]of Object.entries(n)){const o=[...e,r];yield*f3(o,i)}}function*h3(n,e){if(Array.isArray(e))for(const[t,r]of e.entries()){const i=[...n,t];yield i.join("/"),typeof r=="object"&&Me.asCID(r)==null&&(yield*dg(r,i))}else yield*dg(e,n)}function*dg(n,e){if(!(n==null||typeof n!="object"))for(const[t,r]of Object.entries(n)){const i=[...e,t];yield i.join("/"),r!=null&&!(r instanceof Uint8Array)&&typeof r=="object"&&Me.asCID(r)==null&&(yield*h3(i,r))}}function d3(n,e){let t=n;for(const[r,i]of e.entries()){if(t=t[i],t==null)throw new Error(`Object has no property at ${e.slice(0,r+1).map(l=>`[${JSON.stringify(l)}]`).join("")}`);const o=Me.asCID(t);if(o!=null)return{value:o,remaining:e.slice(r+1).join("/")}}return{value:t}}let Es=class{cid;bytes;value;asBlock;constructor({cid:e,bytes:t,value:r}){if(e==null||t==null||typeof r>"u")throw new Error("Missing required argument");this.cid=e,this.bytes=t,this.value=r,this.asBlock=this,Object.defineProperties(this,{cid:Pf(),bytes:Pf(),value:Pf(),asBlock:Pf()})}links(){return hg(this.value,[])}tree(){return dg(this.value,[])}get(e="/"){return d3(this.value,e.split("/").filter(Boolean))}};async function xw({value:n,codec:e,hasher:t}){if(typeof n>"u")throw new Error('Missing required argument "value"');if(e==null||t==null)throw new Error("Missing required argument: codec or hasher");const r=e.encode(n),i=await t.digest(r),o=Me.create(1,e.code,i);return new Es({value:n,bytes:r,cid:o})}async function Iw({bytes:n,codec:e,hasher:t}){if(n==null)throw new Error('Missing required argument "bytes"');if(e==null||t==null)throw new Error("Missing required argument: codec or hasher");const r=e.decode(n),i=await t.digest(n),o=Me.create(1,e.code,i);return new Es({value:r,bytes:n,cid:o})}const dT=Es;async function Uw({bytes:n,codec:e,hasher:t}){if(n==null)throw new Error('Missing required argument "bytes"');if(e==null||t==null)throw new Error("Missing required argument: codec or hasher");const r=await Promise.resolve(e.decode(n));let i=n;e.valueToHashBytes&&(i=await Promise.resolve(e.valueToHashBytes(r)));const o=await t.digest(i),l=Me.create(1,e.code,o);return new Es({value:r,bytes:i,cid:l})}async function yd({value:n,codec:e,hasher:t}){if(typeof n>"u")throw new Error('Missing required argument "value"');if(e==null||t==null)throw new Error("Missing required argument: codec or hasher");let r,i;if(e.bytesToHash){const l=await Promise.resolve(e.bytesToHash(n));i=await t.digest(l),r=await Promise.resolve(e.encode(n))}else r=await Promise.resolve(e.encode(n)),i=await t.digest(r);const o=Me.create(1,e.code,i);return new dT({value:n,bytes:r,cid:o})}async function m3({bytes:n,cid:e,hasher:t,codec:r}){if(n==null)throw new Error('Missing required argument "bytes"');if(t==null)throw new Error('Missing required argument "hasher"');const i=await Promise.resolve(r.decode(n)),o=await t.digest(n);if(!PA(e.multihash.bytes,o.bytes))throw new Error("CID hash does not match bytes");return p3({bytes:n,cid:e,value:i,codec:r})}async function p3({bytes:n,cid:e,value:t,codec:r}){const i=await Promise.resolve(t!==void 0?t:r?.decode(n));if(i===void 0)throw new Error('Missing required argument, must either provide "value" or "codec"');return new dT({cid:e,bytes:n,value:i})}const Dh=new TextEncoder,ia=new TextDecoder;function mT(...n){const e=n.reduce((i,{length:o})=>i+o,0),t=new Uint8Array(e);let r=0;for(const i of n)t.set(i,r),r+=i.length;return t}function ea(n){const e=new Uint8Array(n.length);for(let t=0;t<n.length;t++){const r=n.charCodeAt(t);if(r>127)throw new TypeError("non-ASCII string encountered in encode()");e[t]=r}return e}function y3(n){if(Uint8Array.prototype.toBase64)return n.toBase64();const e=32768,t=[];for(let r=0;r<n.length;r+=e)t.push(String.fromCharCode.apply(null,n.subarray(r,r+e)));return btoa(t.join(""))}function pT(n){if(Uint8Array.fromBase64)return Uint8Array.fromBase64(n);const e=atob(n),t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}function ta(n){if(Uint8Array.fromBase64)return Uint8Array.fromBase64(typeof n=="string"?n:ia.decode(n),{alphabet:"base64url"});let e=n;e instanceof Uint8Array&&(e=ia.decode(e)),e=e.replace(/-/g,"+").replace(/_/g,"/");try{return pT(e)}catch{throw new TypeError("The input to be decoded is not correctly encoded.")}}function Ml(n){let e=n;return typeof e=="string"&&(e=Dh.encode(e)),Uint8Array.prototype.toBase64?e.toBase64({alphabet:"base64url",omitPadding:!0}):y3(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}class Si extends Error{static code="ERR_JOSE_GENERIC";code="ERR_JOSE_GENERIC";constructor(e,t){super(e,t),this.name=this.constructor.name,Error.captureStackTrace?.(this,this.constructor)}}class Ir extends Si{static code="ERR_JWT_CLAIM_VALIDATION_FAILED";code="ERR_JWT_CLAIM_VALIDATION_FAILED";claim;reason;payload;constructor(e,t,r="unspecified",i="unspecified"){super(e,{cause:{claim:r,reason:i,payload:t}}),this.claim=r,this.reason=i,this.payload=t}}class h_ extends Si{static code="ERR_JWT_EXPIRED";code="ERR_JWT_EXPIRED";claim;reason;payload;constructor(e,t,r="unspecified",i="unspecified"){super(e,{cause:{claim:r,reason:i,payload:t}}),this.claim=r,this.reason=i,this.payload=t}}class g3 extends Si{static code="ERR_JOSE_ALG_NOT_ALLOWED";code="ERR_JOSE_ALG_NOT_ALLOWED"}class pn extends Si{static code="ERR_JOSE_NOT_SUPPORTED";code="ERR_JOSE_NOT_SUPPORTED"}class _t extends Si{static code="ERR_JWS_INVALID";code="ERR_JWS_INVALID"}class Br extends Si{static code="ERR_JWT_INVALID";code="ERR_JWT_INVALID"}class w3 extends Si{static code="ERR_JWK_INVALID";code="ERR_JWK_INVALID"}class b3 extends Si{static code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";constructor(e="signature verification failed",t){super(e,t)}}const Ur=(n,e="algorithm.name")=>new TypeError(`CryptoKey does not support this operation, its ${e} must be ${n}`),lo=(n,e)=>n.name===e;function yy(n){return parseInt(n.name.slice(4),10)}function v3(n){switch(n){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}}function S3(n,e){if(e&&!n.usages.includes(e))throw new TypeError(`CryptoKey does not support this operation, its usages must include ${e}.`)}function E3(n,e,t){switch(e){case"HS256":case"HS384":case"HS512":{if(!lo(n.algorithm,"HMAC"))throw Ur("HMAC");const r=parseInt(e.slice(2),10);if(yy(n.algorithm.hash)!==r)throw Ur(`SHA-${r}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!lo(n.algorithm,"RSASSA-PKCS1-v1_5"))throw Ur("RSASSA-PKCS1-v1_5");const r=parseInt(e.slice(2),10);if(yy(n.algorithm.hash)!==r)throw Ur(`SHA-${r}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!lo(n.algorithm,"RSA-PSS"))throw Ur("RSA-PSS");const r=parseInt(e.slice(2),10);if(yy(n.algorithm.hash)!==r)throw Ur(`SHA-${r}`,"algorithm.hash");break}case"Ed25519":case"EdDSA":{if(!lo(n.algorithm,"Ed25519"))throw Ur("Ed25519");break}case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":{if(!lo(n.algorithm,e))throw Ur(e);break}case"ES256":case"ES384":case"ES512":{if(!lo(n.algorithm,"ECDSA"))throw Ur("ECDSA");const r=v3(e);if(n.algorithm.namedCurve!==r)throw Ur(r,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}S3(n,t)}function yT(n,e,...t){if(t=t.filter(Boolean),t.length>2){const r=t.pop();n+=`one of type ${t.join(", ")}, or ${r}.`}else t.length===2?n+=`one of type ${t[0]} or ${t[1]}.`:n+=`of type ${t[0]}.`;return e==null?n+=` Received ${e}`:typeof e=="function"&&e.name?n+=` Received function ${e.name}`:typeof e=="object"&&e!=null&&e.constructor?.name&&(n+=` Received an instance of ${e.constructor.name}`),n}const zw=(n,...e)=>yT("Key must be ",n,...e),gT=(n,e,...t)=>yT(`Key for the ${n} algorithm must be `,e,...t),Lw=n=>{if(n?.[Symbol.toStringTag]==="CryptoKey")return!0;try{return n instanceof CryptoKey}catch{return!1}},Bw=n=>n?.[Symbol.toStringTag]==="KeyObject",Pw=n=>Lw(n)||Bw(n);function wT(...n){const e=n.filter(Boolean);if(e.length===0||e.length===1)return!0;let t;for(const r of e){const i=Object.keys(r);if(!t||t.size===0){t=new Set(i);continue}for(const o of i){if(t.has(o))return!1;t.add(o)}}return!0}const _3=n=>typeof n=="object"&&n!==null;function yi(n){if(!_3(n)||Object.prototype.toString.call(n)!=="[object Object]")return!1;if(Object.getPrototypeOf(n)===null)return!0;let e=n;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(n)===e}async function A3(n,e){const t=`SHA-${n.slice(-3)}`;return new Uint8Array(await crypto.subtle.digest(t,e))}function bT(n,e){if(n.startsWith("RS")||n.startsWith("PS")){const{modulusLength:t}=e.algorithm;if(typeof t!="number"||t<2048)throw new TypeError(`${n} requires key modulusLength to be 2048 bits or larger`)}}const gy=(n,e)=>{if(n.byteLength!==e.length)return!1;for(let t=0;t<n.byteLength;t++)if(n[t]!==e[t])return!1;return!0},k3=n=>({data:n,pos:0}),xh=n=>{const e=n.data[n.pos++];if(e&128){const t=e&127;let r=0;for(let i=0;i<t;i++)r=r<<8|n.data[n.pos++];return r}return e},Ih=(n,e,t)=>{if(n.data[n.pos++]!==e)throw new Error(t)},vT=(n,e)=>{const t=n.data.subarray(n.pos,n.pos+e);return n.pos+=e,t},T3=n=>{Ih(n,6,"Expected algorithm OID");const e=xh(n);return vT(n,e)};function O3(n){Ih(n,48,"Invalid SPKI structure"),xh(n),Ih(n,48,"Expected algorithm identifier");const e=xh(n);return{algIdStart:n.pos,algIdLength:e}}const C3=n=>{const e=T3(n);if(gy(e,[43,101,110]))return"X25519";if(!gy(e,[42,134,72,206,61,2,1]))throw new Error("Unsupported key algorithm");Ih(n,6,"Expected curve OID");const t=xh(n),r=vT(n,t);for(const{name:i,oid:o}of[{name:"P-256",oid:[42,134,72,206,61,3,1,7]},{name:"P-384",oid:[43,129,4,0,34]},{name:"P-521",oid:[43,129,4,0,35]}])if(gy(r,o))return i;throw new Error("Unsupported named curve")},M3=async(n,e,t,r)=>{let i,o;const l=()=>["verify"],f=()=>["encrypt","wrapKey"];switch(t){case"PS256":case"PS384":case"PS512":i={name:"RSA-PSS",hash:`SHA-${t.slice(-3)}`},o=l();break;case"RS256":case"RS384":case"RS512":i={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${t.slice(-3)}`},o=l();break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":i={name:"RSA-OAEP",hash:`SHA-${parseInt(t.slice(-3),10)||1}`},o=f();break;case"ES256":case"ES384":case"ES512":{i={name:"ECDSA",namedCurve:{ES256:"P-256",ES384:"P-384",ES512:"P-521"}[t]},o=l();break}case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{try{const h=r.getNamedCurve(e);i=h==="X25519"?{name:"X25519"}:{name:"ECDH",namedCurve:h}}catch{throw new pn("Invalid or unsupported key format")}o=[];break}case"Ed25519":case"EdDSA":i={name:"Ed25519"},o=l();break;case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":i={name:t},o=l();break;default:throw new pn('Invalid or unsupported "alg" (Algorithm) value')}return crypto.subtle.importKey(n,e,i,r?.extractable??!0,o)},N3=(n,e)=>pT(n.replace(e,"")),R3=(n,e,t)=>{const r=N3(n,/(?:-----(?:BEGIN|END) PUBLIC KEY-----|\s)/g);let i=t;return e?.startsWith?.("ECDH-ES")&&(i||={},i.getNamedCurve=o=>{const l=k3(o);return O3(l),C3(l)}),M3("spki",r,e,i)};function D3(n){let e,t;switch(n.kty){case"AKP":{switch(n.alg){case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":e={name:n.alg},t=n.priv?["sign"]:["verify"];break;default:throw new pn('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"RSA":{switch(n.alg){case"PS256":case"PS384":case"PS512":e={name:"RSA-PSS",hash:`SHA-${n.alg.slice(-3)}`},t=n.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":e={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${n.alg.slice(-3)}`},t=n.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":e={name:"RSA-OAEP",hash:`SHA-${parseInt(n.alg.slice(-3),10)||1}`},t=n.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new pn('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"EC":{switch(n.alg){case"ES256":e={name:"ECDSA",namedCurve:"P-256"},t=n.d?["sign"]:["verify"];break;case"ES384":e={name:"ECDSA",namedCurve:"P-384"},t=n.d?["sign"]:["verify"];break;case"ES512":e={name:"ECDSA",namedCurve:"P-521"},t=n.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":e={name:"ECDH",namedCurve:n.crv},t=n.d?["deriveBits"]:[];break;default:throw new pn('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"OKP":{switch(n.alg){case"Ed25519":case"EdDSA":e={name:"Ed25519"},t=n.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":e={name:n.crv},t=n.d?["deriveBits"]:[];break;default:throw new pn('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}default:throw new pn('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:e,keyUsages:t}}async function lh(n){if(!n.alg)throw new TypeError('"alg" argument is required when "jwk.alg" is not present');const{algorithm:e,keyUsages:t}=D3(n),r={...n};return r.kty!=="AKP"&&delete r.alg,delete r.use,crypto.subtle.importKey("jwk",r,e,n.ext??!(n.d||n.priv),n.key_ops??t)}async function x3(n,e,t){if(typeof n!="string"||n.indexOf("-----BEGIN PUBLIC KEY-----")!==0)throw new TypeError('"spki" must be SPKI formatted string');return R3(n,e,t)}async function I3(n,e,t){if(!yi(n))throw new TypeError("JWK must be an object");let r;switch(e??=n.alg,r??=t?.extractable??n.ext,n.kty){case"oct":if(typeof n.k!="string"||!n.k)throw new TypeError('missing "k" (Key Value) Parameter value');return ta(n.k);case"RSA":if("oth"in n&&n.oth!==void 0)throw new pn('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');return lh({...n,alg:e,ext:r});case"AKP":{if(typeof n.alg!="string"||!n.alg)throw new TypeError('missing "alg" (Algorithm) Parameter value');if(e!==void 0&&e!==n.alg)throw new TypeError("JWK alg and alg option value mismatch");return lh({...n,ext:r})}case"EC":case"OKP":return lh({...n,alg:e,ext:r});default:throw new pn('Unsupported "kty" (Key Type) Parameter value')}}function ST(n,e,t,r,i){if(i.crit!==void 0&&r?.crit===void 0)throw new n('"crit" (Critical) Header Parameter MUST be integrity protected');if(!r||r.crit===void 0)return new Set;if(!Array.isArray(r.crit)||r.crit.length===0||r.crit.some(l=>typeof l!="string"||l.length===0))throw new n('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let o;t!==void 0?o=new Map([...Object.entries(t),...e.entries()]):o=e;for(const l of r.crit){if(!o.has(l))throw new pn(`Extension Header Parameter "${l}" is not recognized`);if(i[l]===void 0)throw new n(`Extension Header Parameter "${l}" is missing`);if(o.get(l)&&r[l]===void 0)throw new n(`Extension Header Parameter "${l}" MUST be integrity protected`)}return new Set(r.crit)}function U3(n,e){if(e!==void 0&&(!Array.isArray(e)||e.some(t=>typeof t!="string")))throw new TypeError(`"${n}" option must be an array of strings`);if(e)return new Set(e)}const gd=n=>yi(n)&&typeof n.kty=="string",z3=n=>n.kty!=="oct"&&(n.kty==="AKP"&&typeof n.priv=="string"||typeof n.d=="string"),L3=n=>n.kty!=="oct"&&n.d===void 0&&n.priv===void 0,B3=n=>n.kty==="oct"&&typeof n.k=="string";let Mo;const d_=async(n,e,t,r=!1)=>{Mo||=new WeakMap;let i=Mo.get(n);if(i?.[t])return i[t];const o=await lh({...e,alg:t});return r&&Object.freeze(n),i?i[t]=o:Mo.set(n,{[t]:o}),o},P3=(n,e)=>{Mo||=new WeakMap;let t=Mo.get(n);if(t?.[e])return t[e];const r=n.type==="public",i=!!r;let o;if(n.asymmetricKeyType==="x25519"){switch(e){case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":break;default:throw new TypeError("given KeyObject instance cannot be used for this algorithm")}o=n.toCryptoKey(n.asymmetricKeyType,i,r?[]:["deriveBits"])}if(n.asymmetricKeyType==="ed25519"){if(e!=="EdDSA"&&e!=="Ed25519")throw new TypeError("given KeyObject instance cannot be used for this algorithm");o=n.toCryptoKey(n.asymmetricKeyType,i,[r?"verify":"sign"])}switch(n.asymmetricKeyType){case"ml-dsa-44":case"ml-dsa-65":case"ml-dsa-87":{if(e!==n.asymmetricKeyType.toUpperCase())throw new TypeError("given KeyObject instance cannot be used for this algorithm");o=n.toCryptoKey(n.asymmetricKeyType,i,[r?"verify":"sign"])}}if(n.asymmetricKeyType==="rsa"){let l;switch(e){case"RSA-OAEP":l="SHA-1";break;case"RS256":case"PS256":case"RSA-OAEP-256":l="SHA-256";break;case"RS384":case"PS384":case"RSA-OAEP-384":l="SHA-384";break;case"RS512":case"PS512":case"RSA-OAEP-512":l="SHA-512";break;default:throw new TypeError("given KeyObject instance cannot be used for this algorithm")}if(e.startsWith("RSA-OAEP"))return n.toCryptoKey({name:"RSA-OAEP",hash:l},i,r?["encrypt"]:["decrypt"]);o=n.toCryptoKey({name:e.startsWith("PS")?"RSA-PSS":"RSASSA-PKCS1-v1_5",hash:l},i,[r?"verify":"sign"])}if(n.asymmetricKeyType==="ec"){const f=new Map([["prime256v1","P-256"],["secp384r1","P-384"],["secp521r1","P-521"]]).get(n.asymmetricKeyDetails?.namedCurve);if(!f)throw new TypeError("given KeyObject instance cannot be used for this algorithm");e==="ES256"&&f==="P-256"&&(o=n.toCryptoKey({name:"ECDSA",namedCurve:f},i,[r?"verify":"sign"])),e==="ES384"&&f==="P-384"&&(o=n.toCryptoKey({name:"ECDSA",namedCurve:f},i,[r?"verify":"sign"])),e==="ES512"&&f==="P-521"&&(o=n.toCryptoKey({name:"ECDSA",namedCurve:f},i,[r?"verify":"sign"])),e.startsWith("ECDH-ES")&&(o=n.toCryptoKey({name:"ECDH",namedCurve:f},i,r?[]:["deriveBits"]))}if(!o)throw new TypeError("given KeyObject instance cannot be used for this algorithm");return t?t[e]=o:Mo.set(n,{[e]:o}),o};async function ET(n,e){if(n instanceof Uint8Array||Lw(n))return n;if(Bw(n)){if(n.type==="secret")return n.export();if("toCryptoKey"in n&&typeof n.toCryptoKey=="function")try{return P3(n,e)}catch(r){if(r instanceof TypeError)throw r}let t=n.export({format:"jwk"});return d_(n,t,e)}if(gd(n))return n.k?ta(n.k):d_(n,n,e,!0);throw new Error("unreachable")}const ho=n=>n?.[Symbol.toStringTag],mg=(n,e,t)=>{if(e.use!==void 0){let r;switch(t){case"sign":case"verify":r="sig";break;case"encrypt":case"decrypt":r="enc";break}if(e.use!==r)throw new TypeError(`Invalid key for this operation, its "use" must be "${r}" when present`)}if(e.alg!==void 0&&e.alg!==n)throw new TypeError(`Invalid key for this operation, its "alg" must be "${n}" when present`);if(Array.isArray(e.key_ops)){let r;switch(!0){case(t==="sign"||t==="verify"):case n==="dir":case n.includes("CBC-HS"):r=t;break;case n.startsWith("PBES2"):r="deriveBits";break;case/^A\d{3}(?:GCM)?(?:KW)?$/.test(n):!n.includes("GCM")&&n.endsWith("KW")?r=t==="encrypt"?"wrapKey":"unwrapKey":r=t;break;case(t==="encrypt"&&n.startsWith("RSA")):r="wrapKey";break;case t==="decrypt":r=n.startsWith("RSA")?"unwrapKey":"deriveBits";break}if(r&&e.key_ops?.includes?.(r)===!1)throw new TypeError(`Invalid key for this operation, its "key_ops" must include "${r}" when present`)}return!0},$3=(n,e,t)=>{if(!(e instanceof Uint8Array)){if(gd(e)){if(B3(e)&&mg(n,e,t))return;throw new TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!Pw(e))throw new TypeError(gT(n,e,"CryptoKey","KeyObject","JSON Web Key","Uint8Array"));if(e.type!=="secret")throw new TypeError(`${ho(e)} instances for symmetric algorithms must be of type "secret"`)}},K3=(n,e,t)=>{if(gd(e))switch(t){case"decrypt":case"sign":if(z3(e)&&mg(n,e,t))return;throw new TypeError("JSON Web Key for this operation must be a private JWK");case"encrypt":case"verify":if(L3(e)&&mg(n,e,t))return;throw new TypeError("JSON Web Key for this operation must be a public JWK")}if(!Pw(e))throw new TypeError(gT(n,e,"CryptoKey","KeyObject","JSON Web Key"));if(e.type==="secret")throw new TypeError(`${ho(e)} instances for asymmetric algorithms must not be of type "secret"`);if(e.type==="public")switch(t){case"sign":throw new TypeError(`${ho(e)} instances for asymmetric algorithm signing must be of type "private"`);case"decrypt":throw new TypeError(`${ho(e)} instances for asymmetric algorithm decryption must be of type "private"`)}if(e.type==="private")switch(t){case"verify":throw new TypeError(`${ho(e)} instances for asymmetric algorithm verifying must be of type "public"`);case"encrypt":throw new TypeError(`${ho(e)} instances for asymmetric algorithm encryption must be of type "public"`)}};function _T(n,e,t){switch(n.substring(0,2)){case"A1":case"A2":case"di":case"HS":case"PB":$3(n,e,t);break;default:K3(n,e,t)}}async function j3(n){if(Bw(n))if(n.type==="secret")n=n.export();else return n.export({format:"jwk"});if(n instanceof Uint8Array)return{kty:"oct",k:Ml(n)};if(!Lw(n))throw new TypeError(zw(n,"CryptoKey","KeyObject","Uint8Array"));if(!n.extractable)throw new TypeError("non-extractable CryptoKey cannot be exported as a JWK");const{ext:e,key_ops:t,alg:r,use:i,...o}=await crypto.subtle.exportKey("jwk",n);return o.kty==="AKP"&&(o.alg=r),o}async function Uh(n){return j3(n)}function AT(n,e){const t=`SHA-${n.slice(-3)}`;switch(n){case"HS256":case"HS384":case"HS512":return{hash:t,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:t,name:"RSA-PSS",saltLength:parseInt(n.slice(-3),10)>>3};case"RS256":case"RS384":case"RS512":return{hash:t,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:t,name:"ECDSA",namedCurve:e.namedCurve};case"Ed25519":case"EdDSA":return{name:"Ed25519"};case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":return{name:n};default:throw new pn(`alg ${n} is not supported either by JOSE or your javascript runtime`)}}async function kT(n,e,t){if(e instanceof Uint8Array){if(!n.startsWith("HS"))throw new TypeError(zw(e,"CryptoKey","KeyObject","JSON Web Key"));return crypto.subtle.importKey("raw",e,{hash:`SHA-${n.slice(-3)}`,name:"HMAC"},!1,[t])}return E3(e,n,t),e}async function H3(n,e,t,r){const i=await kT(n,e,"verify");bT(n,i);const o=AT(n,i.algorithm);try{return await crypto.subtle.verify(o,i,t,r)}catch{return!1}}async function q3(n,e,t){if(!yi(n))throw new _t("Flattened JWS must be an object");if(n.protected===void 0&&n.header===void 0)throw new _t('Flattened JWS must have either of the "protected" or "header" members');if(n.protected!==void 0&&typeof n.protected!="string")throw new _t("JWS Protected Header incorrect type");if(n.payload===void 0)throw new _t("JWS Payload missing");if(typeof n.signature!="string")throw new _t("JWS Signature missing or incorrect type");if(n.header!==void 0&&!yi(n.header))throw new _t("JWS Unprotected Header incorrect type");let r={};if(n.protected)try{const k=ta(n.protected);r=JSON.parse(ia.decode(k))}catch{throw new _t("JWS Protected Header is invalid")}if(!wT(r,n.header))throw new _t("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const i={...r,...n.header},o=ST(_t,new Map([["b64",!0]]),t?.crit,r,i);let l=!0;if(o.has("b64")&&(l=r.b64,typeof l!="boolean"))throw new _t('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:f}=i;if(typeof f!="string"||!f)throw new _t('JWS "alg" (Algorithm) Header Parameter missing or invalid');const h=t&&U3("algorithms",t.algorithms);if(h&&!h.has(f))throw new g3('"alg" (Algorithm) Header Parameter value not allowed');if(l){if(typeof n.payload!="string")throw new _t("JWS Payload must be a string")}else if(typeof n.payload!="string"&&!(n.payload instanceof Uint8Array))throw new _t("JWS Payload must be a string or an Uint8Array instance");let m=!1;typeof e=="function"&&(e=await e(r,n),m=!0),_T(f,e,"verify");const y=mT(n.protected!==void 0?ea(n.protected):new Uint8Array,ea("."),typeof n.payload=="string"?l?ea(n.payload):Dh.encode(n.payload):n.payload);let g;try{g=ta(n.signature)}catch{throw new _t("Failed to base64url decode the signature")}const b=await ET(e,f);if(!await H3(f,b,g,y))throw new b3;let _;if(l)try{_=ta(n.payload)}catch{throw new _t("Failed to base64url decode the payload")}else typeof n.payload=="string"?_=Dh.encode(n.payload):_=n.payload;const S={payload:_};return n.protected!==void 0&&(S.protectedHeader=r),n.header!==void 0&&(S.unprotectedHeader=n.header),m?{...S,key:b}:S}async function F3(n,e,t){if(n instanceof Uint8Array&&(n=ia.decode(n)),typeof n!="string")throw new _t("Compact JWS must be a string or Uint8Array");const{0:r,1:i,2:o,length:l}=n.split(".");if(l!==3)throw new _t("Invalid Compact JWS");const f=await q3({payload:i,protected:r,signature:o},e,t),h={payload:f.payload,protectedHeader:f.protectedHeader};return typeof e=="function"?{...h,key:f.key}:h}const Xs=n=>Math.floor(n.getTime()/1e3),TT=60,OT=TT*60,$w=OT*24,V3=$w*7,G3=$w*365.25,Z3=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i;function Nl(n){const e=Z3.exec(n);if(!e||e[4]&&e[1])throw new TypeError("Invalid time period format");const t=parseFloat(e[2]),r=e[3].toLowerCase();let i;switch(r){case"sec":case"secs":case"second":case"seconds":case"s":i=Math.round(t);break;case"minute":case"minutes":case"min":case"mins":case"m":i=Math.round(t*TT);break;case"hour":case"hours":case"hr":case"hrs":case"h":i=Math.round(t*OT);break;case"day":case"days":case"d":i=Math.round(t*$w);break;case"week":case"weeks":case"w":i=Math.round(t*V3);break;default:i=Math.round(t*G3);break}return e[1]==="-"||e[4]==="ago"?-i:i}function qi(n,e){if(!Number.isFinite(e))throw new TypeError(`Invalid ${n} input`);return e}const m_=n=>n.includes("/")?n.toLowerCase():`application/${n.toLowerCase()}`,J3=(n,e)=>typeof n=="string"?e.includes(n):Array.isArray(n)?e.some(Set.prototype.has.bind(new Set(n))):!1;function W3(n,e,t={}){let r;try{r=JSON.parse(ia.decode(e))}catch{}if(!yi(r))throw new Br("JWT Claims Set must be a top-level JSON object");const{typ:i}=t;if(i&&(typeof n.typ!="string"||m_(n.typ)!==m_(i)))throw new Ir('unexpected "typ" JWT header value',r,"typ","check_failed");const{requiredClaims:o=[],issuer:l,subject:f,audience:h,maxTokenAge:m}=t,y=[...o];m!==void 0&&y.push("iat"),h!==void 0&&y.push("aud"),f!==void 0&&y.push("sub"),l!==void 0&&y.push("iss");for(const _ of new Set(y.reverse()))if(!(_ in r))throw new Ir(`missing required "${_}" claim`,r,_,"missing");if(l&&!(Array.isArray(l)?l:[l]).includes(r.iss))throw new Ir('unexpected "iss" claim value',r,"iss","check_failed");if(f&&r.sub!==f)throw new Ir('unexpected "sub" claim value',r,"sub","check_failed");if(h&&!J3(r.aud,typeof h=="string"?[h]:h))throw new Ir('unexpected "aud" claim value',r,"aud","check_failed");let g;switch(typeof t.clockTolerance){case"string":g=Nl(t.clockTolerance);break;case"number":g=t.clockTolerance;break;case"undefined":g=0;break;default:throw new TypeError("Invalid clockTolerance option type")}const{currentDate:b}=t,E=Xs(b||new Date);if((r.iat!==void 0||m)&&typeof r.iat!="number")throw new Ir('"iat" claim must be a number',r,"iat","invalid");if(r.nbf!==void 0){if(typeof r.nbf!="number")throw new Ir('"nbf" claim must be a number',r,"nbf","invalid");if(r.nbf>E+g)throw new Ir('"nbf" claim timestamp check failed',r,"nbf","check_failed")}if(r.exp!==void 0){if(typeof r.exp!="number")throw new Ir('"exp" claim must be a number',r,"exp","invalid");if(r.exp<=E-g)throw new h_('"exp" claim timestamp check failed',r,"exp","check_failed")}if(m){const _=E-r.iat,S=typeof m=="number"?m:Nl(m);if(_-g>S)throw new h_('"iat" claim timestamp check failed (too far in the past)',r,"iat","check_failed");if(_<0-g)throw new Ir('"iat" claim timestamp check failed (it should be in the past)',r,"iat","check_failed")}return r}class Y3{#e;constructor(e){if(!yi(e))throw new TypeError("JWT Claims Set MUST be an object");this.#e=structuredClone(e)}data(){return Dh.encode(JSON.stringify(this.#e))}get iss(){return this.#e.iss}set iss(e){this.#e.iss=e}get sub(){return this.#e.sub}set sub(e){this.#e.sub=e}get aud(){return this.#e.aud}set aud(e){this.#e.aud=e}set jti(e){this.#e.jti=e}set nbf(e){typeof e=="number"?this.#e.nbf=qi("setNotBefore",e):e instanceof Date?this.#e.nbf=qi("setNotBefore",Xs(e)):this.#e.nbf=Xs(new Date)+Nl(e)}set exp(e){typeof e=="number"?this.#e.exp=qi("setExpirationTime",e):e instanceof Date?this.#e.exp=qi("setExpirationTime",Xs(e)):this.#e.exp=Xs(new Date)+Nl(e)}set iat(e){e===void 0?this.#e.iat=Xs(new Date):e instanceof Date?this.#e.iat=qi("setIssuedAt",Xs(e)):typeof e=="string"?this.#e.iat=qi("setIssuedAt",Xs(new Date)+Nl(e)):this.#e.iat=qi("setIssuedAt",e)}}async function nc(n,e,t){const r=await F3(n,e,t);if(r.protectedHeader.crit?.includes("b64")&&r.protectedHeader.b64===!1)throw new Br("JWTs MUST NOT use unencoded payload");const o={payload:W3(r.protectedHeader,r.payload,t),protectedHeader:r.protectedHeader};return typeof e=="function"?{...o,key:r.key}:o}async function Q3(n,e,t){const r=await kT(n,e,"sign");bT(n,r);const i=await crypto.subtle.sign(AT(n,r.algorithm),r,t);return new Uint8Array(i)}class X3{#e;#t;#n;constructor(e){if(!(e instanceof Uint8Array))throw new TypeError("payload must be an instance of Uint8Array");this.#e=e}setProtectedHeader(e){if(this.#t)throw new TypeError("setProtectedHeader can only be called once");return this.#t=e,this}setUnprotectedHeader(e){if(this.#n)throw new TypeError("setUnprotectedHeader can only be called once");return this.#n=e,this}async sign(e,t){if(!this.#t&&!this.#n)throw new _t("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!wT(this.#t,this.#n))throw new _t("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const r={...this.#t,...this.#n},i=ST(_t,new Map([["b64",!0]]),t?.crit,this.#t,r);let o=!0;if(i.has("b64")&&(o=this.#t.b64,typeof o!="boolean"))throw new _t('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:l}=r;if(typeof l!="string"||!l)throw new _t('JWS "alg" (Algorithm) Header Parameter missing or invalid');_T(l,e,"sign");let f,h;o?(f=Ml(this.#e),h=ea(f)):(h=this.#e,f="");let m,y;this.#t?(m=Ml(JSON.stringify(this.#t)),y=ea(m)):(m="",y=new Uint8Array);const g=mT(y,ea("."),h),b=await ET(e,l),E=await Q3(l,b,g),_={signature:Ml(E),payload:f};return this.#n&&(_.header=this.#n),this.#t&&(_.protected=m),_}}class eP{#e;constructor(e){this.#e=new X3(e)}setProtectedHeader(e){return this.#e.setProtectedHeader(e),this}async sign(e,t){const r=await this.#e.sign(e,t);if(r.payload===void 0)throw new TypeError("use the flattened module for creating JWS with b64: false");return`${r.protected}.${r.payload}.${r.signature}`}}class tP{#e;#t;constructor(e={}){this.#t=new Y3(e)}setIssuer(e){return this.#t.iss=e,this}setSubject(e){return this.#t.sub=e,this}setAudience(e){return this.#t.aud=e,this}setJti(e){return this.#t.jti=e,this}setNotBefore(e){return this.#t.nbf=e,this}setExpirationTime(e){return this.#t.exp=e,this}setIssuedAt(e){return this.#t.iat=e,this}setProtectedHeader(e){return this.#e=e,this}async sign(e,t){const r=new eP(this.#t.data());if(r.setProtectedHeader(this.#e),Array.isArray(this.#e?.crit)&&this.#e.crit.includes("b64")&&this.#e.b64===!1)throw new Br("JWTs MUST NOT use unencoded payload");return r.sign(e,t)}}const zr=(n,e)=>{if(typeof n!="string"||!n)throw new w3(`${e} missing or invalid`)};async function pg(n,e){let t;if(gd(n))t=n;else if(Pw(n))t=await Uh(n);else throw new TypeError(zw(n,"CryptoKey","KeyObject","JSON Web Key"));if(e??="sha256",e!=="sha256"&&e!=="sha384"&&e!=="sha512")throw new TypeError('digestAlgorithm must one of "sha256", "sha384", or "sha512"');let r;switch(t.kty){case"AKP":zr(t.alg,'"alg" (Algorithm) Parameter'),zr(t.pub,'"pub" (Public key) Parameter'),r={alg:t.alg,kty:t.kty,pub:t.pub};break;case"EC":zr(t.crv,'"crv" (Curve) Parameter'),zr(t.x,'"x" (X Coordinate) Parameter'),zr(t.y,'"y" (Y Coordinate) Parameter'),r={crv:t.crv,kty:t.kty,x:t.x,y:t.y};break;case"OKP":zr(t.crv,'"crv" (Subtype of Key Pair) Parameter'),zr(t.x,'"x" (Public Key) Parameter'),r={crv:t.crv,kty:t.kty,x:t.x};break;case"RSA":zr(t.e,'"e" (Exponent) Parameter'),zr(t.n,'"n" (Modulus) Parameter'),r={e:t.e,kty:t.kty,n:t.n};break;case"oct":zr(t.k,'"k" (Key Value) Parameter'),r={k:t.k,kty:t.kty};break;default:throw new pn('"kty" (Key Type) Parameter missing or unsupported')}const i=ea(JSON.stringify(r));return Ml(await A3(e,i))}function CT(n){let e;if(typeof n=="string"){const t=n.split(".");(t.length===3||t.length===5)&&([e]=t)}else if(typeof n=="object"&&n)if("protected"in n)e=n.protected;else throw new TypeError("Token does not contain a Protected Header");try{if(typeof e!="string"||!e)throw new Error;const t=JSON.parse(ia.decode(ta(e)));if(!yi(t))throw new Error;return t}catch{throw new TypeError("Invalid Token or Protected Header formatting")}}function wd(n){if(typeof n!="string")throw new Br("JWTs must use Compact JWS serialization, JWT must be a string");const{1:e,length:t}=n.split(".");if(t===5)throw new Br("Only JWTs using Compact JWS serialization can be decoded");if(t!==3)throw new Br("Invalid JWT");if(!e)throw new Br("JWTs must contain a payload");let r;try{r=ta(e)}catch{throw new Br("Failed to base64url decode the payload")}let i;try{i=JSON.parse(ia.decode(r))}catch{throw new Br("Failed to parse the decoded payload as JSON")}if(!yi(i))throw new Br("Invalid JWT Claims Set");return i}function wy(n){const e=n?.modulusLength??2048;if(typeof e!="number"||e<2048)throw new pn("Invalid or unsupported modulusLength option provided, 2048 bits or larger keys must be used");return e}async function nP(n,e){let t,r;switch(n){case"PS256":case"PS384":case"PS512":t={name:"RSA-PSS",hash:`SHA-${n.slice(-3)}`,publicExponent:Uint8Array.of(1,0,1),modulusLength:wy(e)},r=["sign","verify"];break;case"RS256":case"RS384":case"RS512":t={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${n.slice(-3)}`,publicExponent:Uint8Array.of(1,0,1),modulusLength:wy(e)},r=["sign","verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":t={name:"RSA-OAEP",hash:`SHA-${parseInt(n.slice(-3),10)||1}`,publicExponent:Uint8Array.of(1,0,1),modulusLength:wy(e)},r=["decrypt","unwrapKey","encrypt","wrapKey"];break;case"ES256":t={name:"ECDSA",namedCurve:"P-256"},r=["sign","verify"];break;case"ES384":t={name:"ECDSA",namedCurve:"P-384"},r=["sign","verify"];break;case"ES512":t={name:"ECDSA",namedCurve:"P-521"},r=["sign","verify"];break;case"Ed25519":case"EdDSA":{r=["sign","verify"],t={name:"Ed25519"};break}case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":{r=["sign","verify"],t={name:n};break}case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{r=["deriveBits"];const i=e?.crv??"P-256";switch(i){case"P-256":case"P-384":case"P-521":{t={name:"ECDH",namedCurve:i};break}case"X25519":t={name:"X25519"};break;default:throw new pn("Invalid or unsupported crv option provided, supported values are P-256, P-384, P-521, and X25519")}break}default:throw new pn('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}return crypto.subtle.generateKey(t,e?.extractable??!1,r)}async function ru(n,e,t){let r;if(e)r=e;else{const o=pB(n);if(o.isErr())return A.Err(o);r=o.Ok()}const i=await Te(()=>I3(n,r,t));return i.isErr()?A.Err(i):A.Ok({key:i.Ok(),alg:r})}const rP=new Mt({resetAfter:1800*1e3});function p_(n,e){const t=[],r=re({keys:ke(yw())}).safeParse(n);return r.success?t.push(...r.data.keys):t.push(n),t.map(i=>{const o=e.safeParse(i);return o.success?A.Ok(o.data):A.Err(o.error)})}async function sP(n,e,...t){return Promise.all(t.flat().map(async r=>{if(typeof r=="string"){const i=[];for(const{content:o,begin:l,end:f}of FB(r)){if(l&&f){const m=`${l}
${o}
${f}
`,y=await Te(()=>x3(m,"RS256"));if(y.isErr()){i.push(A.Err(y.Err()));continue}const g=y.Ok(),b=await Uh(g),E=e.safeParse({...b,alg:"RS256"});E.success?i.push(A.Ok(E.data)):i.push(A.Err(E.error));continue}let h=At.Some(A.Err("Failed to decode JWK string with any known encoding"));for(const m of[y=>y,y=>n.txt.base64.decode(y),y=>n.txt.base58.decode(y)]){const y=Te(()=>m(o));if(y.isErr())continue;const g=y.Ok(),b=Te(()=>JSON.parse(g));if(!b.isErr()){h=At.None();for(const E of p_(b.Ok(),e))i.push(E)}}h.IsSome()&&i.push(h.Unwrap())}return i}else return p_(r,e)})).then(r=>r.flat())}async function iP(n,...e){return VB(await sP(n,ha,...e))}async function aP(n,e,t,r={}){const i={fetchTimeoutMs:1e3,parseSchema:l=>A.Ok(l),fetch:(...l)=>globalThis.fetch(...l),verifyToken:async(l,f)=>{const h=await ru(f);if(h.isErr())return A.Err(h);const m=await Te(()=>nc(l,h.Ok().key));if(m.isErr())return A.Err(m);const y=m.Ok();return y?A.Ok(y):A.Err("JWT verification failed")},...r,sthis:r.sthis??vw()};for(const l of e){const f=await iP(i.sthis,l);for(const h of f){const m=await y_(n,h,i);if(m.isOk())return m}}const o=[];for(const l of t){const f=await uP([l],i);for(const h of f)switch(!0){case cP(h):case lP(h):o.push(h);continue;case oP(h):for(const m of h.keys){const y=await y_(n,m,i);if(y.isOk())return y;o.push({type:"error",error:y.Err(),url:h.url})}break;default:throw new Error("unreachable")}}return A.Err(`No well-known JWKS URL could verify the token:
${JSON.stringify(o,null,2)}`)}async function y_(n,e,t){const r=await t.verifyToken(n,e);return r.isErr()?A.Err(r):t.parseSchema(r.Ok().payload)}function oP(n){return n.type==="ok"}function cP(n){return n.type==="error"}function lP(n){return n.type==="timeout"}async function uP(n,e){const t={fetchTimeoutMs:1e3,fetch:(...r)=>globalThis.fetch(...r),...e};return Promise.all((Array.isArray(n)?n:[n]).flat().map(r=>{if(!r)return;const i=an.from(r),o=i.URI();return(o.pathname===""||o.pathname==="/")&&i.pathname("/.well-known/jwks.json"),i.toString()}).filter(r=>!!r).map(async r=>{const i=rP.get(r);return i.once(async()=>{const o=await zx(t.fetch(r,{method:"GET"}).then(l=>{if(!l.ok)throw new Error(`Failed to fetch well-known JWKS from ${r}: ${l.status} ${l.statusText}`);return l.json()}),{timeout:t.fetchTimeoutMs||1e3});switch(o.state){case"timeout":return i.reset(),{type:"timeout",url:r};case"error":return i.reset(),{type:"error",error:o.error,url:r};case"success":{const l=re({keys:ha.array()}).safeParse(o.value);return l.success?{type:"ok",keys:l.data.keys,url:r}:{type:"error",error:new Error(`Invalid JWKS format from ${r}: ${l.error.message}`),url:r}}default:throw new Error("unreachable")}})}))}class fP{queue=[];processing=!1;traceFn;constructor({tracer:e}){this.traceFn=e}_waitIdleItems=new Set;waitIdle(){if(this.queue.length===0&&!this.processing)return Promise.resolve();const e=new On;return this._waitIdleItems.add(e),e.asPromise()}async enqueue(e){return new Promise((t,r)=>{const i=async()=>{try{t(await e())}catch(o){r(o)}finally{this.processing=!1,this.processNext()}};this.traceFn({event:"busyFromCommitQueue",queueLen:this.queue.length+1}),this.queue.push(i),this.processing||this.processNext()})}processNext(){if(this.queue.length>0&&!this.processing){this.processing=!0;const e=this.queue.shift();e&&e().finally(()=>{})}if(this.queue.length===0&&!this.processing){this.traceFn({event:"idleFromCommitQueue"});const e=Array.from(this._waitIdleItems);this._waitIdleItems.clear(),e.map(t=>t.resolve())}}}class hP{eventsWeHandled=new Set;queue=[];isProcessing=!1;logger;params;callback;constructor(e,t,r){this.logger=Xe(e,"TaskManager"),this.callback=t,this.params=r}async handleEvent(e,t,r,i){for(const o of t)this.eventsWeHandled.add(o.toString());this.queue.push({cid:e.toString(),dbMeta:r,retries:0,store:i}),this.queue=this.queue.filter(({cid:o})=>!this.eventsWeHandled.has(o)),this.processQueue()}async processQueue(){if(this.isProcessing)return;this.isProcessing=!0;const t=this.queue.filter(({cid:r})=>!this.eventsWeHandled.has(r))[0];if(!t){this.isProcessing=!1;return}try{await this.callback(t.dbMeta,t.store),this.eventsWeHandled.add(t.cid),this.queue=this.queue.filter(({cid:r})=>!this.eventsWeHandled.has(r))}catch(r){t.retries++>3&&(this.logger.Error().Str("cid",t.cid).Msg("failed to process event block after 3 retries"),this.queue=this.queue.filter(({cid:i})=>i!==t.cid)),await new Promise(i=>setTimeout(i,50)),this.logger.Warn().Err(r).Msg("retry to process event block")}finally{this.isProcessing=!1,this.queue.length>0&&this.processQueue()}}}const _o=new Map;function Kw(n){const e=n.name.toLowerCase();return _o.has(e)?()=>{_o.delete(e)}:(_o.set(e,n),()=>{_o.delete(e)})}function dP(n="fireproof"){return Te(()=>MT(n))}function MT(n="fireproof"){const e=n.toLowerCase();if(!_o.has(e))throw new Error(`compactStrategy ${n} not found`);return _o.get(e)}class mP{opts;queue=[];worker;isProcessing=!1;logger;constructor(e,t,r){this.logger=Xe(e,"WriteQueueImpl"),this.worker=t,this.opts=ZA(r)}waitForEmptyQueue;testEmptyQueue(){this.waitForEmptyQueue&&this.queue.length===0&&this.waitForEmptyQueue.resolve()}async process(){if(this.isProcessing||this.queue.length===0){this.testEmptyQueue();return}this.isProcessing=!0;try{this.logger.Debug().Any("opts",this.opts).Len(this.queue).Msg("Processing tasks");const e=this.queue.splice(0,this.opts.chunkSize),r=e.map(i=>i.tasks).filter(i=>i).map(async(i,o)=>{try{const l=await this.worker(i);e[o].resolve(l)}catch(l){e[o].reject(this.logger.Error().Err(l).Msg("Error processing task").AsError())}});await Promise.allSettled(r),this.logger.Debug().Any("opts",this.opts).Len(this.queue).Msg("Processed tasks")}catch(e){this.logger.Error().Err(e).Msg("Error processing tasks")}finally{this.isProcessing=!1,setTimeout(()=>this.process(),0)}}bulk(e){return new Promise((t,r)=>{this.queue.push({tasks:e,resolve:t,reject:r}),this.process()})}push(e){return this.bulk([e])}close(){return this.waitForEmptyQueue=new On,this.testEmptyQueue(),this.waitForEmptyQueue.asPromise()}}function pP(n,e,t){return new mP(n,e,t)}const NT=42;function RT(n){return n instanceof ArrayBuffer?new Uint8Array(n,0,n.byteLength):n}function yP(n){if(n.asCID!==n&&n["/"]!==n.bytes)return null;const e=Me.asCID(n);if(!e)return null;const t=new Uint8Array(e.bytes.byteLength+1);return t.set(e.bytes,1),[new X(R.tag,NT),new X(R.bytes,t)]}function gP(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function wP(n){if(Number.isNaN(n))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(n===1/0||n===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}function bP(n){for(const e of n.keys())if(typeof e!="string"||e.length===0)throw new Error("Non-string Map keys are not supported by the IPLD Data Model and cannot be encoded");return null}const yg={float64:!0,typeEncoders:{Map:bP,Object:yP,undefined:gP,number:wP}},vP={...yg,typeEncoders:{...yg.typeEncoders}};function SP(n){if(n[0]!==0)throw new Error("Invalid CID for CBOR tag 42; expected leading 0x00");return Me.decode(n.subarray(1))}const zh={allowIndefinite:!1,coerceUndefinedToNull:!0,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};zh.tags[NT]=SP;const EP={...zh,tags:zh.tags.slice()},_P="dag-cbor",DT=113,xT=n=>hT(n,yg),IT=n=>Dw(RT(n),zh),Hn=Object.freeze(Object.defineProperty({__proto__:null,code:DT,decode:IT,decodeOptions:EP,encode:xT,encodeOptions:vP,name:_P,toByteView:RT},Symbol.toStringTag,{value:"Module"}));var by={},$f={},g_;function AP(){if(g_)return $f;g_=1,$f.encode=function(t){if(isNaN(t))return"DaN";if(t===0)return"FE  0M0";if(t===1/0)return"FF";if(t===-1/0)return"DD";var r=t.toExponential().split("e"),i=Number(r[1])+500,o=r[0]+(r[0].indexOf(".")===-1?".":"")+"0".repeat(20),l="E"+e(String(i),3)+"M"+String(o);return t>0?"F"+l:"D"+n(l)},$f.decode=function(t){if(t==="DaN")return NaN;if(t==="FF")return 1/0;if(t==="DD")return-1/0;var r=t[0]==="D",i=(r?n(t):t).slice(2).split("M");return+((r?"-":"")+i[1]+"e"+String(Number(i[0])-500))};function n(t){for(var r="",i=0;i<t.length;i++){var o=t[i];isNaN(Number(o))||o===" "?o!=="-"&&(r+=o):r+=String(9-Number(o))}return r}function e(t,r){return" ".repeat(r-t.length).substr(0,r)+t}return $f}var vy={},w_;function kP(){if(w_)return vy;w_=1;var n={"?":"?@","!":"??",'"':"?%"};function e(i){return/[!"]/.test(i)?i.replace(/[\?!"]/g,function(o){return n[o]}):i}var t={"?@":"?","??":"!","?%":'"'};function r(i){return/\?[%\?@]/.test(i)?i.replace(/\?[%\?@]/g,function(o){return t[o]}):i}return vy.factory=function(i){return{encode:o,decode:f};function o(h){if(h===null)return"A";if(!Array.isArray(h))throw new Error("can only encode arrays");var m=h.length;if(m==0)return"K!";for(var y=l(h[0]),g=1;g<m;g++)y+='"'+l(h[g]);return"K"+y+"!"}function l(h){return typeof h=="object"?o(h):e(i.encode(h))}function f(h){if(h==="A")return null;if(h==="K!")return[];for(var m=h.split('"'),y=[[]],g,b=0,E=m.length,_=0;_<E;_++){for(var S=m[_],k=S.length,M=0;S[M]=="K";)M++;for(var x=0;S[k-x-1]=="!";)x++;for(var $=S.slice(M,k-x),j=b+M,L=b;L<j;L++)y[L+1]=[],y[L].push(y[L+1]),b=j,g=y[b];$.length!==0&&g.push(i.decode(r($)));for(var j=b-x,L=j;L<b;L++)y[L+1]=[],b=j,g=y[b]}return y[0][0]}},vy}var b_;function TP(){return b_||(b_=1,(function(n){var e=AP(),t=kP();n.flip=function(i){var o=i.toString(),l="";for(var f in o)l+=o[f]=="."?".":9-+o[f];return l},n.number=e,n.string={encode:function(i){return/\x00|\x01/.test(i)?"J"+i.replace(/\x01/g,"").replace(/\x00/g,""):"J"+i},decode:function(i){if(i[0]==="J")return i.substring(1)}},n.encode=function(i){return n[typeof i].encode(i)},n.decode=function(i){if(i==="")return i;if(!r[i[0]])throw new Error("no decoder for:"+JSON.stringify(i));return r[i[0]](i)},n.object=t.factory(n),n.boolean={encode:function(i){return i?"C":"B"},decode:function(i){return i==="C"}},n.undefined={encode:function(i){return"L"},decode:function(){}};var r={A:n.object.decode,B:n.boolean.decode,C:n.boolean.decode,D:n.number.decode,F:n.number.decode,J:n.string.decode,K:n.object.decode,L:n.undefined.decode};n.buffer=!1,n.type="charwise"})(by)),by}var OP=TP();const zo=Gl(OP),CP=n=>{const e=n.byteLength-4;return(n[e]|n[e+1]<<8|n[e+2]<<16)+n[e+3]*16777216},MP=4294967295,UT=n=>{const e=Math.floor(MP/n);return async t=>{const r=await t.identity();if(typeof r!="number")throw new Error("Identity must be a number");return r<=e}},su=(n,e)=>n===e?0:n>e?1:-1;class Kf{constructor(){this._cids=new Set}add(e){if(!e.address)throw new Error("Cannot add node without address");if(e.address.then){const t=e.address.then(r=>this._cids.add(r.toString()));this._cids.add(t),t.then(()=>this._cids.delete(t))}else this._cids.add(e.address.toString())}async all(){return await Promise.all([...this._cids]),this._cids}}class NP{constructor({key:e,address:t},r={}){this.key=e,this.address=t,this.codec=r.codec,this.hasher=r.hasher}get isEntry(){return!0}}class gg{constructor({entries:e,closed:t}){if(typeof t!="boolean")throw new Error('Missing required argument "closed"');this.entries=e,this.closed=t,this.startKey=e[0].key}find(e,t){const{entries:r}=this;for(let i=r.length-1;i>-1;i--){const o=r[i];if(t(e,o.key)>-1)return[i,o]}return null}findMany(e,t,r=!1,i=!1){const{entries:o}=this,l=new Map;r?e=[...e]:e=e.sort(t);for(let f=o.length-1;f>-1&&e.length;f--){const h=o[f],m=[];for(;e.length;){let y=e[e.length-1];y=y.key?y.key:y;const g=t(y,h.key);if(i)if(g===0)m.push(e.pop());else if(g>0)e.pop();else break;else if(g>-1)m.push(e.pop());else break}m.length&&l.set(f,[h,m])}return l}findRange(e,t,r){const{entries:i}=this;let o,l=0;for(let f=i.length-1;f>-1;f--){const h=i[f];if(r(t,h.key)>0){o=f;break}}for(let f=0;f<i.length;f++){const h=i[f],m=r(e,h.key);if(m===0){l=f;break}else if(m<0)break;l=f}return{first:l,last:o,entries:i.slice(l,o+1)}}}const v_=n=>typeof n=="string"?n:JSON.stringify(n);function RP(n,e){return n.sort(({key:t},{key:r})=>e.compare(t,r))}async function DP(n,e,t){const r=[];for(const i of e){const{key:o,del:l}=i;if(t(o,n)<0)l||r.push(i);else break}return r}async function xP(n,e,{chunker:t,compare:r}){return await Lo.from({entries:n.map(i=>new e.LeafEntryClass(i,e)).sort((i,o)=>r(i.key,o.key)),chunker:t,NodeClass:e.LeafClass,distance:0,opts:e})}async function IP(n,e,t,r){return await Promise.all(e.map(async i=>{const o=await i.encode();return t.blocks.push({block:o,node:i}),n.cache.set(i),new r.BranchEntryClass({key:i.key,address:await i.address},r)}))}async function UP(n,e,t,r){const i=e.root;e.blocks.push({block:await i.encode(),node:i}),n.cache.set(i);const o=r.opts,l=i.distance,f=i.entryList.startKey,h=await DP(f,t,n.compare);if(h.length){const m=await xP(h,o,n),y=await IP(n,m,e,o),b=[new o.BranchEntryClass({key:i.entryList.startKey,address:await i.address},o),...y].sort(({key:S},{key:k})=>o.compare(S,k));let E=await Lo.from({...r,entries:b,chunker:n.chunker,NodeClass:o.BranchClass,distance:l+1}),_=[...E];for(;E.length>1;){const S=await Promise.all(E.map(async k=>new o.BranchEntryClass({key:k.key,address:await k.address},o)));E=await Lo.from({...r,entries:S.sort(({key:k},{key:M})=>o.compare(k,M)),chunker:n.chunker,NodeClass:o.BranchClass,distance:l+1}),_=[..._,...E]}await Promise.all(_.map(async S=>{const k=await S.encode();n.cache.set(S),e.blocks.push({block:k,node:S})})),e.root=E[0],e.nodes=[...e.nodes,..._]}}let Lo=class ei{constructor({entryList:e,chunker:t,distance:r,getNode:i,compare:o,cache:l}){this.entryList=e,this.chunker=t,this.distance=r,this.getNode=i,this.compare=o,this.cache=l}get closed(){return this.entryList.closed}get key(){return this.entryList.startKey}async getEntry(e,t=new Kf){return{result:await this._getEntry(e,t),cids:t}}async _getEntry(e,t){t.add(this);let r=this;for(;!r.isLeaf;){const l=r.entryList.find(e,this.compare);if(l===null)throw new Error("Not found");const[,f]=l;r=await this.getNode(await f.address),t.add(r)}const i=r.entryList.find(e,this.compare);if(i===null||i[1].key.toString()!==e.toString())throw new Error("Not found");const[,o]=i;return o}async getAllEntries(e=new Kf){return{result:await this._getAllEntries(e),cids:e}}_getAllEntries(e){if(e.add(this),this.isLeaf)return this.entryList.entries;{const{entries:t}=this.entryList,r=async i=>this.getNode(await i.address).then(o=>o._getAllEntries(e)).catch(async o=>{throw o});return Promise.all(t.map(r)).then(i=>i.flat())}}async*vis(e=new Set){const t=async o=>o.isLeaf?`Leaf [${o.entryList.entries.map(f=>`[${f.key},${JSON.stringify(f.value).replace(/"/g,"'")}]`).join(", ")}]`:`Branch [${o.entryList.entries.map(f=>`[${f.key}]`).join(", ")}]`,r=o=>o.toString().slice(0,4)+o.toString().slice(-4),i=async function*(o,l,f){const h=await o.address;if(!f.has(h)){f.add(h);const m=await t(o);yield`  node [shape=ellipse fontname="Courier"]; ${r(h)} [label="${m}"];`,yield`  ${r(l)} -> ${r(h)};`;for(const y of o.entryList.entries)if(y.address){const g=await y.address;try{const b=await o.getNode(g);yield*await i(b,h,f)}catch(b){yield`  ${r(h)} -> ${r(g)};`,yield`  node [shape=ellipse fontname="Courier"]; ${r(g)} [label="Error: ${b.message}"];`}}}};yield"digraph tree {",yield'  node [shape=ellipse fontname="Courier"]; rootnode;';for await(const o of i(this,"rootnode",e))yield o;yield"}"}async getEntries(e,t=!1,r=new Kf){return{result:await this._getEntries(e,t,r),cids:r}}async _getEntries(e,t,r){r.add(this),t||(e=e.sort(this.compare));const i=this.entryList.findMany(e,this.compare,!0,this.isLeaf);if(this.isLeaf)return[...i.values()].map(([l])=>l);let o=[];for(const[l,f]of[...i.values()].reverse()){const h=this.getNode(await l.address);o.push(h.then(m=>m._getEntries(f.reverse(),!0,r)))}return o=await Promise.all(o),o.flat()}async getRangeEntries(e,t,r=new Kf){return{result:await this._getRangeEntries(e,t,r),cids:r}}_getRangeEntries(e,t,r){r.add(this);const{entries:i}=this.entryList.findRange(e,t,this.compare);if(this.isLeaf)return i.filter(h=>{const m=this.compare(e,h.key),y=this.compare(t,h.key);return m<=0&&y>=0});if(!i.length)return[];const o=async h=>this.getNode(await h.address).then(m=>m._getRangeEntries(e,t,r)),l=[o(i.shift())];if(!i.length)return l[0];const f=o(i.pop());for(;i.length;){const h=async m=>this.getNode(await m.address).then(async y=>y._getAllEntries(r));l.push(h(i.shift()))}return l.push(f),Promise.all(l).then(h=>h.flat())}async transaction(e,t={}){t={codec:this.codec,hasher:this.hasher,getNode:this.getNode,compare:this.compare,cache:this.cache,...t};const r={chunker:this.chunker,opts:t},i=this.entryList.findMany(e,t.compare,!0,this.isLeaf);return this.isLeaf?await this.transactionLeaf(e,t,r,i):await this.transactionBranch(e,t,r,i)}async transactionLeaf(e,t,r,i){const{LeafClass:o,LeafEntryClass:l}=t,{entries:f,previous:h}=this.processLeafEntries(e,i,l,t),m={...r,entries:f,NodeClass:o,distance:0},y=await ei.from(m);return{nodes:y,previous:h,blocks:await Promise.all(y.map(async g=>{const b=await g.encode();return this.cache.set(g),{block:b,node:g}})),distance:0}}processLeafEntries(e,t,r,i){const o=[];let l=[];const f={},h=new Map;for(const{key:g,del:b,value:E}of e){const _=v_(g);b?typeof f[_]>"u"&&h.set(_,null):(f[_]={key:g,value:E},h.delete(_))}l=[...this.entryList.entries];for(const[g,[b]]of t){o.push(b);const E=v_(b.key);h.has(E)?h.set(E,g):(l[g]=new r(f[E],i),delete f[E])}let m=0;for(const[,g]of h)g!==null&&l.splice(g-m++,1);const y=Object.values(f).map(g=>new r(g,i));return l=l.concat(y).sort(({key:g},{key:b})=>i.compare(g,b)),{entries:l,previous:o}}async transactionBranch(e,t,r,i){const{BranchClass:o,BranchEntryClass:l}=t;let f=0;for(const[_,[S,k]]of i){const M=this.getNode(await S.address).then(x=>x.transaction(k.reverse(),{...t,sorted:!0})).then(x=>({entry:S,keys:k,distance:f,...x}));i.set(_,M)}let h=[...this.entryList.entries];const m={previous:[],blocks:[],nodes:[]};for(const[_,S]of i){const{nodes:k,previous:M,blocks:x,distance:$}=await S;f=$,h[_]=k,M.length&&(m.previous=m.previous.concat(M)),x.length&&(m.blocks=m.blocks.concat(x)),k.length&&(m.nodes=m.nodes.concat(k))}h=h.flat();const y=await this.handlePrepend(h,t,r,m,f);f++;const g=async _=>{if(_.isEntry)return _;const S=await _.encode();return m.blocks.push({block:S,node:_}),this.cache.set(_),new l(_,t)};h=await Promise.all(y.map(g));const b={...r,entries:h,NodeClass:o,distance:f},E=await ei.from(b);return await Promise.all(E.map(async _=>{const S=await _.encode();m.blocks.push({block:S,node:_}),this.cache.set(_)})),m.nodes=E,{...m,distance:f}}async handlePrepend(e,t,r,i,o){const{BranchClass:l,LeafClass:f}=t;let h=[],m=null;for(const y of e)if(m){const g=await this.mergeFirstLeftEntries(y,m,r,i,o);m=null;const b=g[0].address?l:f,E={...r,entries:g.sort(({key:S},{key:k})=>t.compare(S,k)),NodeClass:b,distance:o},_=await ei.from(E);_[_.length-1].closed||(m=_.pop()),_.length&&(h=h.concat(_))}else!y.isEntry&&!y.closed?m=y:h.push(y);return m&&h.push(m),h}async getNodeFirstFromBlocks(e,t){for(const{block:r,node:i}of e)if(await r.cid===t)return i;return await this.getNode(t)}async mergeFirstLeftEntries(e,t,r,i,o){const l=r.opts,{LeafClass:f,BranchClass:h,BranchEntryClass:m}=l;if(e.isEntry){const E=await e.address;e=await this.getNodeFirstFromBlocks(i.blocks,E)}const y=e.entryList.entries;if(!y.length)throw new Error("unreachable no entries");const g=(E,_)=>E.concat(_),b=async(E,_,S)=>await Promise.all(E.map(async k=>(_.blocks.push({block:await k.encode(),node:k}),this.cache.set(k),new m({key:k.key,address:await k.address},S))));if(y[0].constructor.name===t.entryList.entries[0].constructor.name)return await g(t.entryList.entries,y);{const E=y.shift();if(!E)throw new Error("unreachable no left entry");if(!E.address)throw new Error("unreachable existing leaf, no leftEntry.address");const _=await this.mergeFirstLeftEntries(E,t,r,i,o-1),S=y.shift();if(!S)return _;if(!S.address)throw new Error("unreachable existing leaf, no esf.address");const k=await this.getNodeFirstFromBlocks(i.blocks,await S.address);if(k.entryList.entries[0].address){if(_[0].address)return _.concat(k.entryList.entries);{const M=await ei.from({...r,entries:_.sort(({key:j},{key:W})=>l.compare(j,W)),NodeClass:f,distance:o}),x=await b(M,i,l),$=await ei.from({...r,entries:[...k.entryList.entries,...x,...y].sort(({key:j},{key:W})=>l.compare(j,W)),NodeClass:h,distance:o});return await b($,i,l)}}else{const M=await g(_,k.entryList.entries),x=await ei.from({...r,entries:M.sort(({key:L},{key:j})=>l.compare(L,j)),NodeClass:f,distance:o}),$=await b(x,i,l);return await g($,y)}}}async bulk(e,t={},r=!0){const{BranchClass:i}=t;t={codec:this.codec,hasher:this.hasher,getNode:this.getNode,compare:this.compare,cache:this.cache,...t},t.sorted||(e=RP(e,t),t.sorted=!0);const o={chunker:this.chunker,opts:t},l=await this.transaction(e,t);for(;l.nodes.length>1;){const f=l.nodes[0].distance+1,h=await Promise.all(l.nodes.map(async y=>{const g=await y.encode();return l.blocks.push({block:g,node:y}),this.cache.set(y),new t.BranchEntryClass(y,t)})),m=await ei.from({...o,entries:h,NodeClass:i,distance:f});await Promise.all(m.map(async y=>{const g=await y.encode();this.cache.set(y),l.blocks.push({block:g,node:y})})),l.nodes=m}return l.root=l.nodes[0],r&&l.root&&await UP(this,l,e,o),l.blocks=l.blocks.map(({block:f})=>f),l}static async from({entries:e,chunker:t,NodeClass:r,distance:i,opts:o}){if(!e.every(h=>h.constructor.name===e[0].constructor.name))throw new Error("all entries must be of the same type");const l=[];let f=[];for(const h of e)f.push(h),await t(h,i)&&(l.push(new gg({entries:f,closed:!0})),f=[]);return f.length&&l.push(new gg({entries:f,closed:!1})),l.map(h=>new r({entryList:h,chunker:t,distance:i,...o}))}};class zT extends Lo{constructor({codec:e,hasher:t,block:r,...i}){super(i),this.codec=e,this.hasher=t,r?(this.block=r,this.address=r.cid):(this.block=this.encode(),this.address=this.block.then(o=>o.cid))}async get(e){const{result:t,cids:r}=await this.getEntry(e);return{result:t.key,cids:r}}async encode(){if(this.block)return this.block;const e=await this.encodeNode(),t={codec:this.codec,hasher:this.hasher,value:e};return this.block=await xw(t),this.block}}class zP extends zT{async encodeNode(){const{entries:e}=this.entryList,t=async i=>{if(!i.address)throw new Error("entry.address required");return[i.key,await i.address]},r=await Promise.all(e.map(t));return{branch:[this.distance,r],closed:this.closed}}get isBranch(){return!0}}class LP extends zT{async encodeNode(){return{leaf:await Promise.all(this.entryList.entries.map(async t=>await t.encodeNode())),closed:this.closed}}get isLeaf(){return!0}}const BP=async function*(n){let{LeafClass:e,LeafEntryClass:t,BranchClass:r,BranchEntryClass:i,list:o,chunker:l,compare:f,...h}=n;o=o.map(g=>new t(g,h)),h.compare=f;let m=await Lo.from({entries:o,chunker:l,NodeClass:e,distance:0,opts:h});yield*m;let y=1;for(;m.length>1;){const g=async E=>new i({key:E.key,address:await E.address},h),b=await Promise.all(m.map(g));m=await Lo.from({entries:b,chunker:l,NodeClass:r,distance:y,opts:h}),yield*m,y++}};class LT extends NP{async identity(){const e=await this.codec.encode(await this.encodeNode()),t=await this.hasher.encode(e);return CP(t)}}class bd extends LT{constructor(e,t){super(e,t),this.value=e.value}encodeNode(){return[this.key,this.value]}}class vd extends LT{constructor(e,t){if(!e.address)throw new Error("Cannot create MapBranchEntry without address");super(e,t)}async encodeNode(){return[this.key,await this.address]}}const BT=async(n,e)=>{const{result:t,cids:r}=await n.getEntry(e);return{result:t.value,cids:r}},PT=async(n,e)=>{const{result:t,cids:r}=await n.getEntries(e);return{result:t.map(i=>i.value),cids:r}};class Sd extends LP{get(e){return BT(this,e)}getMany(e){return PT(this,e)}bulk(e,t={},r=!0){return super.bulk(e,{...$T,...t},r)}}class Ed extends zP{get(e){return BT(this,e)}getMany(e){return PT(this,e)}bulk(e,t={},r=!0){return super.bulk(e,{...$T,...t},r)}}const $T={LeafClass:Sd,LeafEntryClass:bd,BranchClass:Ed,BranchEntryClass:vd},KT=(n,e,t,r,i,o,l)=>{const f=l.LeafClass||Sd,h=l.LeafEntryClass||bd,m=l.BranchClass||Ed,y=l.BranchEntryClass||vd,g=async E=>e.has(E)?e.get(E):n(E).then(_=>b(_)),b=KP({chunker:t,cache:e,getNode:g,codec:r,hasher:i,compare:o,LeafEntryClass:h,LeafClass:f,BranchEntryClass:y,BranchClass:m});return g},PP=({get:n,cache:e,chunker:t,list:r,codec:i,hasher:o,sorted:l,compare:f,...h})=>{l||(r=r.sort(({key:g},{key:b})=>f(g,b)));const m=KT(n,e,t,i,o,f,h),y={list:r,codec:i,hasher:o,chunker:t,getNode:m,sorted:l,compare:f,cache:e,LeafClass:h.LeafClass||Sd,LeafEntryClass:h.LeafEntryClass||bd,BranchClass:h.BranchClass||Ed,BranchEntryClass:h.BranchEntryClass||vd};return BP(y)},$P=({cid:n,get:e,cache:t,chunker:r,codec:i,hasher:o,compare:l,...f})=>KT(e,t,r,i,o,l,f)(n);function KP({chunker:n,cache:e,getNode:t,codec:r,hasher:i,compare:o,LeafEntryClass:l,LeafClass:f,BranchEntryClass:h,BranchClass:m}){const y={codec:r,hasher:i};return g=>{const{value:b}=g,E={chunker:n,cache:e,block:g,getNode:t,codec:r,hasher:i,compare:o};let _,S;if(b.leaf)_=b.leaf.map(([x,$])=>new l({key:x,value:$},y)),S=f;else if(b.branch){const[x,$]=b.branch;E.distance=x,_=$.map(([L,j])=>new h({key:L,address:j},y)),S=m}else throw new Error("Unknown block data, does not match schema");const k=new gg({entries:_,closed:b.closed}),M=new S({entryList:k,...E});return e.set(M),M}}const jP=(n,e)=>{const[t,r]=n,[i,o]=e,l=su(t,i);return l!==0?l:HP(r,o)},HP=(n,e)=>{if(Number.isNaN(n))return-1;if(Number.isNaN(e))throw new Error("ref may not be Infinity or NaN");return Number.isFinite(n)?su(n,e):1},jT=async(n,e)=>{const t=[e,NaN],r=[e,1/0],{result:i,cids:o}=await n.getRangeEntries(t,r);return{result:i.map(l=>{const[f,h]=l.key;return{id:h,key:f,row:l.value}}),cids:o}},HT=async(n,e,t)=>{e=[e,NaN],t=[t,1/0];const{result:r,cids:i}=await n.getRangeEntries(e,t);return{result:r.map(l=>{const[f,h]=l.key;return{id:h,key:f,row:l.value}}),cids:i}};class qP extends Sd{get(e){return jT(this,e)}range(e,t){return HT(this,e,t)}bulk(e,t={},r=!0){return super.bulk(e,{...jw,...t},r)}}class FP extends Ed{get(e){return jT(this,e)}range(e,t){return HT(this,e,t)}bulk(e,t={},r=!0){return super.bulk(e,{...jw,...t},r)}}const VP=qP,GP=FP,jw={LeafClass:VP,BranchClass:GP,LeafEntryClass:bd,BranchEntryClass:vd},qT={...jw,compare:jP},ZP=n=>(n={...qT,...n},PP(n)),FT=n=>(n={...qT,...n},$P(n)),VT={has:()=>!1,get:()=>{throw new Error("Cannot ask for entries from nocache")},set:()=>{}},Ar={CAR:"car",FILE:"file",META:"meta",WAL:"wal"};function JP(n){return A.Ok({type:Ar.CAR,payload:n})}function WP(n){return A.Ok({type:Ar.FILE,payload:n})}class YP{_logs=[];get length(){return this._logs.length}last(){const e=[...this._logs[this._logs.length-1]];return Object.freeze(e),e}unshift(e){this._logs.unshift(e)}update(e){this._logs.length=0,this._logs.push(...e)}asArray(){const e=[...this._logs.map(t=>{const r=[...t];return Object.freeze(r),r})];return Object.freeze(e),e}}class _d{}class QP extends _d{}class XP extends _d{}class e8 extends _d{}class t8 extends _d{}function wg(n){return n.item.type==="fp"}function uh(n){const e=n;return e.item&&e.item.type==="car"&&e.item.status==="ready"}function uo(n){const e=n;return e.item&&e.item.type==="car"&&e.item.status==="stale"}class n8{value;next;constructor(e){this.value=e}}class r8{#e;#t;#n;constructor(){this.clear()}enqueue(e){const t=new n8(e);this.#e?(this.#t.next=t,this.#t=t):(this.#e=t,this.#t=t),this.#n++}dequeue(){const e=this.#e;if(e)return this.#e=this.#e.next,this.#n--,this.#e||(this.#t=void 0),e.value}peek(){if(this.#e)return this.#e.value}clear(){this.#e=void 0,this.#t=void 0,this.#n=0}get size(){return this.#n}*[Symbol.iterator](){let e=this.#e;for(;e;)yield e.value,e=e.next}*drain(){for(;this.#e;)yield this.dequeue()}}function bg(n){S_(n);const e=new r8;let t=0;const r=()=>{t<n&&e.size>0&&(e.dequeue()(),t++)},i=()=>{t--,r()},o=async(h,m,y)=>{const g=(async()=>h(...y))();m(g);try{await g}catch{}i()},l=(h,m,y)=>{new Promise(g=>{e.enqueue(g)}).then(o.bind(void 0,h,m,y)),(async()=>(await Promise.resolve(),t<n&&r()))()},f=(h,...m)=>new Promise(y=>{l(h,y,m)});return Object.defineProperties(f,{activeCount:{get:()=>t},pendingCount:{get:()=>e.size},clearQueue:{value(){e.clear()}},concurrency:{get:()=>n,set(h){S_(h),n=h,queueMicrotask(()=>{for(;t<n&&e.size>0;)r()})}}}),f}function S_(n){if(!((Number.isInteger(n)||n===Number.POSITIVE_INFINITY)&&n>0))throw new TypeError("Expected `concurrency` to be a number from 1 and up")}var Sy,E_;function s8(){if(E_)return Sy;E_=1,Sy=r;var n=128,e=-128,t=Math.pow(2,31);function r(i,o,l){if(Number.MAX_SAFE_INTEGER&&i>Number.MAX_SAFE_INTEGER)throw r.bytes=0,new RangeError("Could not encode varint");o=o||[],l=l||0;for(var f=l;i>=t;)o[l++]=i&255|n,i/=128;for(;i&e;)o[l++]=i&255|n,i>>>=7;return o[l]=i|0,r.bytes=l-f+1,o}return Sy}var Ey,__;function i8(){if(__)return Ey;__=1,Ey=t;var n=128,e=127;function t(r,l){var o=0,l=l||0,f=0,h=l,m,y=r.length;do{if(h>=y||f>49)throw t.bytes=0,new RangeError("Could not decode varint");m=r[h++],o+=f<28?(m&e)<<f:(m&e)*Math.pow(2,f),f+=7}while(m>=n);return t.bytes=h-l,o}return Ey}var _y,A_;function a8(){if(A_)return _y;A_=1;var n=Math.pow(2,7),e=Math.pow(2,14),t=Math.pow(2,21),r=Math.pow(2,28),i=Math.pow(2,35),o=Math.pow(2,42),l=Math.pow(2,49),f=Math.pow(2,56),h=Math.pow(2,63);return _y=function(m){return m<n?1:m<e?2:m<t?3:m<r?4:m<i?5:m<o?6:m<l?7:m<f?8:m<h?9:10},_y}var Ay,k_;function o8(){return k_||(k_=1,Ay={encode:s8(),decode:i8(),encodingLength:a8()}),Ay}var c8=o8();const _r=Gl(c8),ky={SHA2_256:18,LENGTH:32,DAG_PB:112},l8=40;function Lh(n,e){if(!n.length)throw new Error("Unexpected end of data");const t=_r.decode(n);return e.seek(_r.decode.bytes),t}function u8(n){const e=new DataView(n.buffer,n.byteOffset,n.byteLength);let t=0;return{version:2,characteristics:[e.getBigUint64(t,!0),e.getBigUint64(t+=8,!0)],dataOffset:Number(e.getBigUint64(t+=8,!0)),dataSize:Number(e.getBigUint64(t+=8,!0)),indexOffset:Number(e.getBigUint64(t+=8,!0))}}function f8(n){_r.decode(n);const e=_r.decode.bytes,t=_r.decode(n.subarray(_r.decode.bytes)),r=_r.decode.bytes;return e+r+t}const ri={Null:n=>n===null?n:void 0,Int:n=>Number.isInteger(n)?n:void 0,Float:n=>typeof n=="number"&&Number.isFinite(n)?n:void 0,String:n=>typeof n=="string"?n:void 0,Bool:n=>typeof n=="boolean"?n:void 0,Bytes:n=>n instanceof Uint8Array?n:void 0,Link:n=>n!==null&&typeof n=="object"&&n.asCID===n?n:void 0,List:n=>Array.isArray(n)?n:void 0,Map:n=>n!==null&&typeof n=="object"&&n.asCID!==n&&!Array.isArray(n)&&!(n instanceof Uint8Array)?n:void 0},kl={"CarV1HeaderOrV2Pragma > roots (anon) > valueType (anon)":ri.Link,"CarV1HeaderOrV2Pragma > roots (anon)":n=>{if(ri.List(n)!==void 0){for(let e=0;e<n.length;e++){let t=n[e];if(t=kl["CarV1HeaderOrV2Pragma > roots (anon) > valueType (anon)"](t),t===void 0)return;if(t!==n[e]){const r=n.slice(0,e);for(let i=e;i<n.length;i++){let o=n[i];if(o=kl["CarV1HeaderOrV2Pragma > roots (anon) > valueType (anon)"](o),o===void 0)return;r.push(o)}return r}}return n}},Int:ri.Int,CarV1HeaderOrV2Pragma:n=>{if(ri.Map(n)===void 0)return;const e=Object.entries(n);let t=n,r=1;for(let i=0;i<e.length;i++){const[o,l]=e[i];switch(o){case"roots":{const f=kl["CarV1HeaderOrV2Pragma > roots (anon)"](n[o]);if(f===void 0)return;if(f!==l||t!==n){if(t===n){t={};for(let h=0;h<i;h++)t[e[h][0]]=e[h][1]}t.roots=f}}break;case"version":{r--;const f=kl.Int(n[o]);if(f===void 0)return;if(f!==l||t!==n){if(t===n){t={};for(let h=0;h<i;h++)t[e[h][0]]=e[h][1]}t.version=f}}break;default:return}}if(!(r>0))return t}},Tl={"CarV1HeaderOrV2Pragma > roots (anon) > valueType (anon)":ri.Link,"CarV1HeaderOrV2Pragma > roots (anon)":n=>{if(ri.List(n)!==void 0){for(let e=0;e<n.length;e++){let t=n[e];if(t=Tl["CarV1HeaderOrV2Pragma > roots (anon) > valueType (anon)"](t),t===void 0)return;if(t!==n[e]){const r=n.slice(0,e);for(let i=e;i<n.length;i++){let o=n[i];if(o=Tl["CarV1HeaderOrV2Pragma > roots (anon) > valueType (anon)"](o),o===void 0)return;r.push(o)}return r}}return n}},Int:ri.Int,CarV1HeaderOrV2Pragma:n=>{if(ri.Map(n)===void 0)return;const e=Object.entries(n);let t=n,r=1;for(let i=0;i<e.length;i++){const[o,l]=e[i];switch(o){case"roots":{const f=Tl["CarV1HeaderOrV2Pragma > roots (anon)"](l);if(f===void 0)return;if(f!==l||t!==n){if(t===n){t={};for(let h=0;h<i;h++)t[e[h][0]]=e[h][1]}t.roots=f}}break;case"version":{r--;const f=Tl.Int(l);if(f===void 0)return;if(f!==l||t!==n){if(t===n){t={};for(let h=0;h<i;h++)t[e[h][0]]=e[h][1]}t.version=f}}break;default:return}}if(!(r>0))return t}},h8={toTyped:kl.CarV1HeaderOrV2Pragma,toRepresentation:Tl.CarV1HeaderOrV2Pragma};async function GT(n,e){const t=Lh(await n.upTo(8),n);if(t===0)throw new Error("Invalid CAR header (zero length)");const r=await n.exactly(t,!0),i=IT(r);if(h8.toTyped(i)===void 0)throw new Error("Invalid CAR header format");if(i.version!==1&&i.version!==2||e!==void 0&&i.version!==e)throw new Error(`Invalid CAR version: ${i.version}${e!==void 0?` (expected ${e})`:""}`);if(i.version===1){if(!Array.isArray(i.roots))throw new Error("Invalid CAR header format");return i}if(i.roots!==void 0)throw new Error("Invalid CAR header format");const o=u8(await n.exactly(l8,!0));n.seek(o.dataOffset-n.pos);const l=await GT(n,1);return Object.assign(l,o)}async function d8(n){const e=await n.exactly(2,!1);if(e[0]===ky.SHA2_256&&e[1]===ky.LENGTH){const l=await n.exactly(34,!0),f=ig(l);return Me.create(0,ky.DAG_PB,f)}const t=Lh(await n.upTo(8),n);if(t!==1)throw new Error(`Unexpected CID version (${t})`);const r=Lh(await n.upTo(8),n),i=await n.exactly(f8(await n.upTo(8)),!0),o=ig(i);return Me.create(t,r,o)}async function ZT(n){const e=n.pos;let t=Lh(await n.upTo(8),n);if(t===0)throw new Error("Invalid CAR section (zero length)");t+=n.pos-e;const r=await d8(n),i=t-Number(n.pos-e);return{cid:r,length:t,blockLength:i}}async function m8(n){const{cid:e,blockLength:t}=await ZT(n);return{bytes:await n.exactly(t,!0),cid:e}}async function p8(n){const e=n.pos,{cid:t,length:r,blockLength:i}=await ZT(n),o={cid:t,length:r,blockLength:i,offset:e,blockOffset:n.pos};return n.seek(o.blockLength),o}function y8(n){const e=(async()=>{const t=await GT(n);if(t.version===2){const r=n.pos-t.dataOffset;n=v8(n,t.dataSize-r)}return t})();return{header:()=>e,async*blocks(){for(await e;(await n.upTo(8)).length>0;)yield await m8(n)},async*blocksIndex(){for(await e;(await n.upTo(8)).length>0;)yield await p8(n)}}}function g8(n){let e=0;return{async upTo(t){return n.subarray(e,e+Math.min(t,n.length-e))},async exactly(t,r=!1){if(t>n.length-e)throw new Error("Unexpected end of data");const i=n.subarray(e,e+t);return r&&(e+=t),i},seek(t){e+=t},get pos(){return e}}}function w8(n){let e=0,t=0,r=0,i=new Uint8Array(0);const o=async l=>{t=i.length-r;const f=[i.subarray(r)];for(;t<l;){const m=await n();if(m==null)break;t<0?m.length>t&&f.push(m.subarray(-t)):f.push(m),t+=m.length}i=new Uint8Array(f.reduce((m,y)=>m+y.length,0));let h=0;for(const m of f)i.set(m,h),h+=m.length;r=0};return{async upTo(l){return i.length-r<l&&await o(l),i.subarray(r,r+Math.min(i.length-r,l))},async exactly(l,f=!1){if(i.length-r<l&&await o(l),i.length-r<l)throw new Error("Unexpected end of data");const h=i.subarray(r,r+l);return f&&(e+=l,r+=l),h},seek(l){e+=l,r+=l},get pos(){return e}}}function b8(n){const e=n[Symbol.asyncIterator]();async function t(){const r=await e.next();return r.done?null:r.value}return w8(t)}function v8(n,e){let t=0;return{async upTo(r){let i=await n.upTo(r);return i.length+t>e&&(i=i.subarray(0,e-t)),i},async exactly(r,i=!1){const o=await n.exactly(r,i);if(o.length+t>e)throw new Error("Unexpected end of data");return i&&(t+=r),o},seek(r){t+=r,n.seek(r)},get pos(){return n.pos}}}class JT{constructor(e,t){this._header=e,this._blocks=t,this._keys=t.map(r=>r.cid.toString())}get version(){return this._header.version}async getRoots(){return this._header.roots}async has(e){return this._keys.indexOf(e.toString())>-1}async get(e){const t=this._keys.indexOf(e.toString());return t>-1?this._blocks[t]:void 0}async*blocks(){for(const e of this._blocks)yield e}async*cids(){for(const e of this._blocks)yield e.cid}static async fromBytes(e){if(!(e instanceof Uint8Array))throw new TypeError("fromBytes() requires a Uint8Array");return T_(g8(e))}static async fromIterable(e){if(!e||typeof e[Symbol.asyncIterator]!="function")throw new TypeError("fromIterable() requires an async iterable");return T_(b8(e))}}async function T_(n){const e=y8(n),t=await e.header(),r=[];for await(const i of e.blocks())r.push(i);return new JT(t,r)}function WT(n,e){let t;if(typeof e=="string")t=st.decode(e);else if(e instanceof Uint8Array)t=e;else throw n.logger.Error().Msg("material must be string or Uint8Array").AsError();return{key:t,keyStr:st.encode(t)}}async function YT(n,e,t){const r=await n.subtleKey(e.key),i=st.encode(new Uint8Array(await n.rt.crypto.digestSHA256(e.key)));return A.Ok(new vg({fingerPrint:i,key:r,material:e,default:t}))}function S8(n,e){return e instanceof Uint8Array&&(e=st.encode(e)),e}class vg{default;fingerPrint;key;#e;constructor(e){this.fingerPrint=e.fingerPrint,this.default=e.default,this.key=e.key,this.#e=e.material}setDefault(e){this.default=e}extract(){if(this.key.extractable)return Promise.resolve(this.#e);throw new Error("Key is not extractable")}async asKeysItem(){return{default:this.default,fingerPrint:this.fingerPrint,key:this.#e.keyStr}}}async function E8(n,e){if(!e.name)throw n.logger.Error().Msg("toV2KeysItem: name is missing").AsError();if("key"in e&&e.key&&e.name){const o=(await YT(n.keybag,WT(n.keybag,e.key),!0)).Ok().fingerPrint;return{modified:!0,id:e.name,clazz:"V2StorageKeyItem",item:{name:e.name,keys:{[o]:{key:e.key,fingerPrint:o,default:!0}}}}}let t,r=!1,i;"keys"in e&&e.keys?i={name:e.name,keys:e.keys}:i={name:e.name,keys:{}};for(const o of Object.entries(i.keys))o[0]!==o[1].fingerPrint&&(delete i.keys[o[0]],i.keys[o[1].fingerPrint]=o[1],n.logger.Warn().Str("name",e.name).Msg("fingerPrint mismatch fixed")),t===void 0&&(t=o[1]),!r&&o[1].default?(t=o[1],r=!0):o[1].default=!1;return{id:i.name,clazz:"V2StorageKeyItem",item:i}}async function _8(n,e){if(!e)return;if("clazz"in e)return ww.safeParse(e).success?e:void 0;function t(i){return i?Uk.safeParse(i).success:!1}function r(i){return!!i.keys}if(t(e))return E8(n,e);if(r(e))return{id:e.name,clazz:"V2StorageKeyItem",item:e}}function A8(n){return n.result.isOk()&&OI(n.result.Ok())}class Hw{keybag;name;id;lookup=new Map;logger;async ensureMaterial(e,t){if(!e)return A.Ok(this);const r=await this.upsert(e,t);return r.isErr()?A.Err(r):A.Ok(this)}async toKeysItem(e){return Promise.all(Array.from(Object.values(e.keys)).map(async t=>({keyMaterial:t.key,keyWithFingerPrint:new vg({fingerPrint:t.fingerPrint,key:await this.keybag.subtleKey(t.key),material:{key:st.decode(t.key),keyStr:t.key},default:t.default||!1})})))}async load(e){const t=await this.keybag.getRawObj(this.name);if(t.IsNone()&&e.failIfNotFound)return this.logger.Debug().Msg("failIfNotFound getRawObj").ResultError();if(t.IsSome()&&!t.unwrap().success){const o=t.unwrap();if(!o.success)return this.logger.Error().Any({error:cg(o.error)}).Msg("not LegacyKeyItem").ResultError()}let r,i=!1;if(t.IsSome()){const o=t.unwrap(),l=await _8(this,o.data);if(!l)return this.logger.Error().Any({item:o.data}).Msg("coerce error").ResultError();const f=Lk.safeParse(l);if(!f.success)return this.logger.Error().Any({name:this.name,item:o.data,error:cg(f.error)}).Msg("not V2KeysItems").ResultError();i=!0;const h=await this.toKeysItem(f.data.item).then(m=>m.map(async({keyMaterial:y,keyWithFingerPrint:g},b)=>Promise.resolve({keyMaterial:y,result:await this.upsert(y,{def:g.default,modified:l.modified&&b===m.length-1,doNotWrite:i})}))).then(m=>Promise.all(m)).then(m=>m.filter(y=>A8(y)));if(h.length!==0){const m=h.find(y=>y.result.Ok().kfp.default);m&&(r=m.keyMaterial)}}return this.ensureMaterial(e.materialStrOrUint8??r??this.keybag.rt.crypto.randomBytes(this.keybag.rt.keyLength),{def:!0,doNotWrite:i})}static async from(e){return new Hw(e.keybag,e.name).load(e.opts)}constructor(e,t){this.id=e.rt.sthis.nextId().str,this.logger=Xe(e.rt.sthis,`InternalKeysByFingerprint:${t}:${this.id}`),this.keybag=e,this.name=t}async get(e){e=S8(this.keybag,e)||"*";const t=this.lookup.get(e);return t||this.keybag.logger.Warn().Any({fprs:Array.from(this.lookup.values()).map(r=>r.fingerPrint),fpr:e}).Msg("keysByFingerprint:get: not found"),t}async upsert(e,{def:t,doNotWrite:r,modified:i}={}){const o=await this.upsertNoStore(e,t);return o.isErr()?A.Err(o):(!r&&(o.Ok().modified||i)&&await this.keybag.setRawObj({id:this.name,clazz:"V2StorageKeyItem",item:await this.asV2StorageKeyItem()}),o)}async upsertNoStore(e,t){if(!e)return A.Ok({modified:!1});const r=WT(this.keybag,e);t=!!t;const i=await YT(this.keybag,r,t);if(i.isErr())return A.Err(i);const o=i.Ok(),l=mi(await this.asV2StorageKeyItem());let f=this.lookup.get(o.fingerPrint);if(f){if(f.default===t)return A.Ok({modified:!1,kfp:f})}else f=new vg({default:t,fingerPrint:o.fingerPrint,key:o.key,material:r});this.lookup.set(f.fingerPrint,f);const h=Array.from(this.lookup.values());if(t)for(const y of h)y.default&&y.fingerPrint!==o.fingerPrint&&y.setDefault(!1);(t||h.length===0)&&(f.setDefault(!0),this.lookup.set("*",f));const m=mi(await this.asV2StorageKeyItem());return A.Ok({modified:l!==m,kfp:f})}async asV2StorageKeyItem(){const e=await Promise.all(Array.from(this.lookup.entries()).filter(([t])=>t!=="*").map(([t,r])=>r.asKeysItem()));return Promise.resolve({name:this.name,keys:e.reduce((t,r)=>(t[r.fingerPrint]=r,t),{})})}}class k8{name;keybag;keysByFingerprint=new on;constructor(e,t){this.keybag=e,this.name=t}async getNamedKey(e){return this.keysByFingerprint.once(async()=>Hw.from({keybag:this.keybag,opts:e,name:this.name})).then(t=>t.isErr()?(this.keysByFingerprint.reset(),t):t.Ok().ensureMaterial(e.materialStrOrUint8,{}))}}const jf=new Map;class T8{url;sthis;constructor(e,t){this.url=e,this.sthis=t}key(e){return`${this.url.pathname}/${e}`}del(e){const t=this.key(e);return jf.has(t)&&jf.delete(t),Promise.resolve()}async get(e){const t=jf.get(this.key(e));if(t)try{return JSON.parse(this.sthis.txt.decode(t))}catch{}}async set(e,t){const r=this.sthis.txt.encode(JSON.stringify(t,null,2));jf.set(this.key(e),r)}}const O8="modulepreload",C8=function(n){return"/"+n},O_={},Bo=function(e,t,r){let i=Promise.resolve();if(t&&t.length>0){let h=function(m){return Promise.all(m.map(y=>Promise.resolve(y).then(g=>({status:"fulfilled",value:g}),g=>({status:"rejected",reason:g}))))};document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),f=l?.nonce||l?.getAttribute("nonce");i=h(t.map(m=>{if(m=C8(m),m in O_)return;O_[m]=!0;const y=m.endsWith(".css"),g=y?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${g}`))return;const b=document.createElement("link");if(b.rel=y?"stylesheet":O8,y||(b.as="script"),b.crossOrigin="",b.href=m,f&&b.setAttribute("nonce",f),document.head.appendChild(b),y)return new Promise((E,_)=>{b.addEventListener("load",E),b.addEventListener("error",()=>_(new Error(`Unable to preload CSS for ${m}`)))})}))}function o(l){const f=new Event("vite:preloadError",{cancelable:!0});if(f.payload=l,window.dispatchEvent(f),!f.defaultPrevented)throw l}return i.then(l=>{for(const f of l||[])f.status==="rejected"&&o(f.reason);return e().catch(o)})};function QT(n){const e=jn();switch(!0){case e.isNodeIsh:return Bo(()=>Promise.resolve().then(()=>Vj),void 0).then(t=>t.getSysFileSystem(n));case e.isDeno:return Bo(()=>Promise.resolve().then(()=>Wj),void 0).then(t=>t.getSysFileSystem(n));default:throw new Error(`unsupported runtime:${e}`)}}class M8{async _prepare(e){await this.sthis.start();const t=await QT(this.url),r=this.url.pathname;return await t.mkdir(r,{recursive:!0}),{dirName:r,sysFS:t,fName:this.sthis.pathOps.join(r,`${e.replace(/[^a-zA-Z0-9]/g,"_")}.json`)}}url;logger;sthis;constructor(e,t){this.url=e,this.sthis=t,this.logger=t.logger}async del(e){const t=await this._prepare(e);try{await t.sysFS.unlink(t.fName)}catch(r){if(ci(r))return;throw this.logger.Error().Err(r).Any("file",t).Msg("delete bag failed").AsError()}}async get(e){const t=await this._prepare(e);try{const r=await t.sysFS.readfile(t.fName);return JSON.parse(this.sthis.txt.decode(r))}catch(r){if(ci(r))return;throw this.logger.Error().Err(r).Any("file",t).Msg("read bag failed").AsError()}}async set(e,t){const r=await this._prepare(e),i=this.sthis.txt.encode(JSON.stringify(t,null,2));await r.sysFS.writefile(r.fName,i)}}const Zi="v0.19-file",Bh=async(n,e,t)=>{const r=new rc(n),i=new Map(e.map(l=>[l.toString(),l]));if(i.has(t.toString()))return e;let o=!1;for(const l of e)await C_(r,t,l)&&(i.delete(l.toString()),i.set(t.toString(),t),o=!0);if(o)return[...i.values()];for(const l of e)if(await C_(r,l,t))return e;return e.concat(t)};class Fl extends Es{constructor({cid:e,value:t,bytes:r,prefix:i}){super({cid:e,value:t,bytes:r}),this.prefix=i}static create(e,t){return N8({data:e,parents:t??[]})}}class rc{constructor(e){this._blocks=e}async get(e){const t=await this._blocks.get(e);if(!t)throw new Error(`missing block: ${e}`);return XT(t.bytes)}}const N8=async n=>{if(typeof n.data>"u"||!Array.isArray(n.parents))throw new Error("invalid event block structure");const{data:e}=n,t=[...n.parents].sort((o,l)=>R8(o.bytes,l.bytes)),{cid:r,bytes:i}=await xw({value:{data:e,parents:t},codec:Hn,hasher:Bt});return new Es({cid:r,value:n,bytes:i})},R8=(n,e)=>{for(let t=0;t<n.byteLength;t++){if(n[t]<e[t])return-1;if(n[t]>e[t])return 1}return n.byteLength>e.byteLength?1:n.byteLength<e.byteLength?-1:0},XT=async n=>{const{cid:e,value:t}=await Iw({bytes:n,codec:Hn,hasher:Bt});return new Es({cid:e,value:t,bytes:n})},C_=async(n,e,t)=>{if(e.toString()===t.toString())return!0;const[{value:r},{value:i}]=await Promise.all([n.get(e),n.get(t)]),o=[...r.parents],l=new Set;for(;o.length;){const f=o.shift();if(!f)break;if(f.toString()===t.toString())return!0;if(i.parents.some(m=>f.toString()===m.toString())||l.has(f.toString()))continue;l.add(f.toString());const{value:h}=await n.get(f);o.push(...h.parents)}return!1},eO=async function*(n,e,t={}){const r=t.renderNodeLabel??(h=>D8(h.cid)),i=new rc(n);yield"digraph clock {",yield'  node [shape=point fontname="Courier"]; head;';const o=await Promise.all(e.map(h=>i.get(h))),l=[],f=new Set;for(const h of o){f.add(h.cid.toString()),yield`  node [shape=oval fontname="Courier"]; ${h.cid} [label="${r(h)}"];`,yield`  head -> ${h.cid};`;for(const m of h.value.parents)yield`  ${h.cid} -> ${m};`;l.push(...h.value.parents)}for(;l.length;){const h=l.shift();if(!h)break;if(f.has(h.toString()))continue;f.add(h.toString());const m=await i.get(h);yield`  node [shape=oval]; ${h} [label="${r(m)}" fontname="Courier"];`;for(const y of m.value.parents)yield`  ${h} -> ${y};`;l.push(...m.value.parents)}yield"}"},D8=n=>`${String(n).slice(0,4)}..${String(n).slice(-4)}`,tO=qn({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),nO=qn({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6});qn({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6});qn({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});function x8(n){if(n==null)return!1;const e=n;return e["/"]!=null&&e["/"]===e.bytes||n.asCID===n}function rO(n,e){return Me.parse(n,e)}class I8 extends Array{constructor(){super(),this.inRecursive=[]}prefix(e){const t=this.inRecursive[this.inRecursive.length-1];t&&(R.equals(t.type,R.array)&&(t.elements++,t.elements!==1&&e.push([44])),R.equals(t.type,R.map)&&(t.elements++,t.elements!==1&&(t.elements%2===1?e.push([44]):e.push([58]))))}[R.uint.major](e,t){this.prefix(e);const r=String(t.value),i=[];for(let o=0;o<r.length;o++)i[o]=r.charCodeAt(o);e.push(i)}[R.negint.major](e,t){this[R.uint.major](e,t)}[R.bytes.major](e,t){throw new Error(`${Xi} unsupported type: Uint8Array`)}[R.string.major](e,t){this.prefix(e);const r=Xk(JSON.stringify(t.value));e.push(r.length>32?Sw(r):r)}[R.array.major](e,t){this.prefix(e),this.inRecursive.push({type:R.array,elements:0}),e.push([91])}[R.map.major](e,t){this.prefix(e),this.inRecursive.push({type:R.map,elements:0}),e.push([123])}[R.tag.major](e,t){}[R.float.major](e,t){if(t.type.name==="break"){const l=this.inRecursive.pop();if(l){if(R.equals(l.type,R.array))e.push([93]);else if(R.equals(l.type,R.map))e.push([125]);else throw new Error("Unexpected recursive type; this should not happen!");return}throw new Error("Unexpected break; this should not happen!")}if(t.value===void 0)throw new Error(`${Xi} unsupported type: undefined`);if(this.prefix(e),t.type.name==="true"){e.push([116,114,117,101]);return}else if(t.type.name==="false"){e.push([102,97,108,115,101]);return}else if(t.type.name==="null"){e.push([110,117,108,108]);return}const r=String(t.value),i=[];let o=!1;for(let l=0;l<r.length;l++)i[l]=r.charCodeAt(l),!o&&(i[l]===46||i[l]===101||i[l]===69)&&(o=!0);o||(i.push(46),i.push(48)),e.push(i)}}function U8(n,e){if(Array.isArray(n[0])||Array.isArray(e[0]))throw new Error(`${Xi} complex map keys are not supported`);const t=n[0],r=e[0];if(t.type!==R.string||r.type!==R.string)throw new Error(`${Xi} non-string map keys are not supported`);if(t<r)return-1;if(t>r)return 1;throw new Error(`${Xi} unexpected duplicate map keys, this is not supported`)}const z8={addBreakTokens:!0,mapSorter:U8};function L8(n,e){return e=Object.assign({},z8,e),fT(n,new I8,e)}class sO{constructor(e,t={}){this._pos=0,this.data=e,this.options=t,this.modeStack=["value"],this.lastToken=""}pos(){return this._pos}done(){return this._pos>=this.data.length}ch(){return this.data[this._pos]}currentMode(){return this.modeStack[this.modeStack.length-1]}skipWhitespace(){let e=this.ch();for(;e===32||e===9||e===13||e===10;)e=this.data[++this._pos]}expect(e){if(this.data.length-this._pos<e.length)throw new Error(`${ye} unexpected end of input at position ${this._pos}`);for(let t=0;t<e.length;t++)if(this.data[this._pos++]!==e[t])throw new Error(`${ye} unexpected token at position ${this._pos}, expected to find '${String.fromCharCode(...e)}'`)}parseNumber(){const e=this._pos;let t=!1,r=!1;const i=f=>{for(;!this.done();){const h=this.ch();if(f.includes(h))this._pos++;else break}};if(this.ch()===45&&(t=!0,this._pos++),this.ch()===48)if(this._pos++,this.ch()===46)this._pos++,r=!0;else return new X(R.uint,0,this._pos-e);if(i([48,49,50,51,52,53,54,55,56,57]),t&&this._pos===e+1)throw new Error(`${ye} unexpected token at position ${this._pos}`);if(!this.done()&&this.ch()===46){if(r)throw new Error(`${ye} unexpected token at position ${this._pos}`);r=!0,this._pos++,i([48,49,50,51,52,53,54,55,56,57])}!this.done()&&(this.ch()===101||this.ch()===69)&&(r=!0,this._pos++,!this.done()&&(this.ch()===43||this.ch()===45)&&this._pos++,i([48,49,50,51,52,53,54,55,56,57]));const o=String.fromCharCode.apply(null,this.data.subarray(e,this._pos)),l=parseFloat(o);return r?new X(R.float,l,this._pos-e):this.options.allowBigInt!==!0||Number.isSafeInteger(l)?new X(l>=0?R.uint:R.negint,l,this._pos-e):new X(l>=0?R.uint:R.negint,BigInt(o),this._pos-e)}parseString(){if(this.ch()!==34)throw new Error(`${ye} unexpected character at position ${this._pos}; this shouldn't happen`);this._pos++;for(let o=this._pos,l=0;o<this.data.length&&l<65536;o++,l++){const f=this.data[o];if(f===92||f<32||f>=128)break;if(f===34){const h=String.fromCharCode.apply(null,this.data.subarray(this._pos,o));return this._pos=o+1,new X(R.string,h,l)}}const e=this._pos,t=[],r=()=>{if(this._pos+4>=this.data.length)throw new Error(`${ye} unexpected end of unicode escape sequence at position ${this._pos}`);let o=0;for(let l=0;l<4;l++){let f=this.ch();if(f>=48&&f<=57)f-=48;else if(f>=97&&f<=102)f=f-97+10;else if(f>=65&&f<=70)f=f-65+10;else throw new Error(`${ye} unexpected unicode escape character at position ${this._pos}`);o=o*16+f,this._pos++}return o},i=()=>{const o=this.ch();let l=null,f=o>239?4:o>223?3:o>191?2:1;if(this._pos+f>this.data.length)throw new Error(`${ye} unexpected unicode sequence at position ${this._pos}`);let h,m,y,g;switch(f){case 1:o<128&&(l=o);break;case 2:h=this.data[this._pos+1],(h&192)===128&&(g=(o&31)<<6|h&63,g>127&&(l=g));break;case 3:h=this.data[this._pos+1],m=this.data[this._pos+2],(h&192)===128&&(m&192)===128&&(g=(o&15)<<12|(h&63)<<6|m&63,g>2047&&(g<55296||g>57343)&&(l=g));break;case 4:h=this.data[this._pos+1],m=this.data[this._pos+2],y=this.data[this._pos+3],(h&192)===128&&(m&192)===128&&(y&192)===128&&(g=(o&15)<<18|(h&63)<<12|(m&63)<<6|y&63,g>65535&&g<1114112&&(l=g))}l===null?(l=65533,f=1):l>65535&&(l-=65536,t.push(l>>>10&1023|55296),l=56320|l&1023),t.push(l),this._pos+=f};for(;!this.done();){const o=this.ch();let l;switch(o){case 92:if(this._pos++,this.done())throw new Error(`${ye} unexpected string termination at position ${this._pos}`);switch(l=this.ch(),this._pos++,l){case 34:case 39:case 92:case 47:t.push(l);break;case 98:t.push(8);break;case 116:t.push(9);break;case 110:t.push(10);break;case 102:t.push(12);break;case 114:t.push(13);break;case 117:t.push(r());break;default:throw new Error(`${ye} unexpected string escape character at position ${this._pos}`)}break;case 34:return this._pos++,new X(R.string,eT(t),this._pos-e);default:if(o<32)throw new Error(`${ye} invalid control character at position ${this._pos}`);o<128?(t.push(o),this._pos++):i()}}throw new Error(`${ye} unexpected end of string at position ${this._pos}`)}parseValue(){switch(this.ch()){case 123:return this.modeStack.push("obj-start"),this._pos++,new X(R.map,1/0,1);case 91:return this.modeStack.push("array-start"),this._pos++,new X(R.array,1/0,1);case 34:return this.parseString();case 110:return this.expect([110,117,108,108]),new X(R.null,null,4);case 102:return this.expect([102,97,108,115,101]),new X(R.false,!1,5);case 116:return this.expect([116,114,117,101]),new X(R.true,!0,4);case 45:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.parseNumber();default:throw new Error(`${ye} unexpected character at position ${this._pos}`)}}next(){switch(this.skipWhitespace(),this.currentMode()){case"value":return this.modeStack.pop(),this.parseValue();case"array-value":{if(this.modeStack.pop(),this.ch()===93)return this._pos++,this.skipWhitespace(),new X(R.break,void 0,1);if(this.ch()!==44)throw new Error(`${ye} unexpected character at position ${this._pos}, was expecting array delimiter but found '${String.fromCharCode(this.ch())}'`);return this._pos++,this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue()}case"array-start":return this.modeStack.pop(),this.ch()===93?(this._pos++,this.skipWhitespace(),new X(R.break,void 0,1)):(this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue());case"obj-key":if(this.ch()===125)return this.modeStack.pop(),this._pos++,this.skipWhitespace(),new X(R.break,void 0,1);if(this.ch()!==44)throw new Error(`${ye} unexpected character at position ${this._pos}, was expecting object delimiter but found '${String.fromCharCode(this.ch())}'`);this._pos++,this.skipWhitespace();case"obj-start":{if(this.modeStack.pop(),this.ch()===125)return this._pos++,this.skipWhitespace(),new X(R.break,void 0,1);const e=this.parseString();if(this.skipWhitespace(),this.ch()!==58)throw new Error(`${ye} unexpected character at position ${this._pos}, was expecting key/value delimiter ':' but found '${String.fromCharCode(this.ch())}'`);return this._pos++,this.modeStack.push("obj-value"),e}case"obj-value":return this.modeStack.pop(),this.modeStack.push("obj-key"),this.skipWhitespace(),this.parseValue();default:throw new Error(`${ye} unexpected parse state at position ${this._pos}; this shouldn't happen`)}}}function B8(n,e){return e=Object.assign({tokenizer:new sO(n,e)},e),Dw(n,e)}function P8(n){return n instanceof ArrayBuffer?new Uint8Array(n,0,n.byteLength):n}function $8(n){if(n.asCID!==n&&n["/"]!==n.bytes)return null;const e=Me.asCID(n);if(!e)return null;const t=e.toString();return[new X(R.map,1/0,1),new X(R.string,"/",1),new X(R.string,t,t.length),new X(R.break,void 0,1)]}function Ph(n){const e=tO.encode(n).slice(1);return[new X(R.map,1/0,1),new X(R.string,"/",1),new X(R.map,1/0,1),new X(R.string,"bytes",5),new X(R.string,e,e.length),new X(R.break,void 0,1),new X(R.break,void 0,1)]}function wr(n){return Ph(new Uint8Array(n.buffer,n.byteOffset,n.byteLength))}function K8(n){return Ph(new Uint8Array(n))}function j8(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function H8(n){if(Number.isNaN(n))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(n===1/0||n===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}const q8={typeEncoders:{Object:$8,Buffer:Ph,Uint8Array:Ph,Int8Array:wr,Uint16Array:wr,Int16Array:wr,Uint32Array:wr,Int32Array:wr,Float32Array:wr,Float64Array:wr,Uint8ClampedArray:wr,BigInt64Array:wr,BigUint64Array:wr,DataView:wr,ArrayBuffer:K8,undefined:j8,number:H8}};class F8 extends sO{constructor(e,t){super(e,t),this.tokenBuffer=[]}done(){return this.tokenBuffer.length===0&&super.done()}_next(){return this.tokenBuffer.length>0?this.tokenBuffer.pop():super.next()}next(){const e=this._next();if(R.equals(e.type,R.map)){const t=this._next();if(R.equals(t.type,R.string)&&t.value==="/"){const r=this._next();if(R.equals(r.type,R.string)){const i=this._next();if(!R.equals(i.type,R.break))throw new Error("Invalid encoded CID form");return this.tokenBuffer.push(r),new X(R.tag,42,0)}if(R.equals(r.type,R.map)){const i=this._next();if(R.equals(i.type,R.string)&&i.value==="bytes"){const o=this._next();if(R.equals(o.type,R.string)){for(let f=0;f<2;f++){const h=this._next();if(!R.equals(h.type,R.break))throw new Error("Invalid encoded Bytes form")}const l=tO.decode(`m${o.value}`);return new X(R.bytes,l,o.value.length)}this.tokenBuffer.push(o)}this.tokenBuffer.push(i)}this.tokenBuffer.push(r)}this.tokenBuffer.push(t)}return e}}const Sg={allowIndefinite:!1,allowUndefined:!1,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};Sg.tags[42]=Me.parse;const V8=n=>L8(n,q8),G8=n=>{const e=P8(n),t=Object.assign(Sg,{tokenizer:new F8(e,Sg)});return B8(e,t)},iO=n=>Z8.decode(V8(n)),Z8=new TextDecoder,J8=n=>G8(W8.encode(n)),W8=new TextEncoder;async function aO(n,e){return await Promise.all(e.map(async t=>{const r=await Fl.create({dbMeta:n.txt.encode(iO(t.dbMeta))},t.parents);return{cid:r.cid.toString(),parents:t.parents.map(i=>i.toString()),data:nO.encode(r.bytes)}}))}function Y8(n,e){return{fileOperations:e.fileOperations.map(r=>({cid:r.cid.toString(),public:r.public})),noLoaderOps:e.noLoaderOps.map(r=>({cars:r.cars.map(i=>i.toString())})),operations:e.operations.map(r=>({cars:r.cars.map(i=>i.toString())}))}}const Q8={car:async(n,e)=>A.Ok(e),file:async(n,e)=>A.Ok(e),meta:async(n,e)=>A.Ok(n.txt.encode(JSON.stringify(e))),wal:async(n,e)=>A.Ok(n.txt.encode(JSON.stringify(e)))};async function oO(n,e,t){const r={...Q8,...t};switch(e.type){case Ar.FILE:return r.file(n,e.payload);case Ar.CAR:return r.car(n,e.payload);case Ar.WAL:return r.wal(n,Y8(n,e.payload));case Ar.META:return r.meta(n,await aO(n,e.payload));default:throw n.logger.Error().Str("type",e.type).Msg("unsupported store").AsError()}}async function cO(n,e){if(e.isErr())return A.Err(e.Err());const t=e.unwrap();return Array.isArray(t)?A.Ok(await Promise.all(t.map(async r=>{const i=await XT(nO.decode(r.data)),o=J8(n.txt.decode(i.value.data.dbMeta));return{eventCid:i.cid,parents:r.parents.map(l=>Me.parse(l)),dbMeta:o}}))):n.logger.Debug().Any("metaEntries",t).Msg("No data in MetaEntries").ResultError()}function Ty(n,e){return typeof e=="string"?Me.parse(e):pI(e)}async function X8(n,e){if(e.isErr())return A.Err(e.Err());const t=e.unwrap();return A.Ok({fileOperations:(t.fileOperations||[]).map(r=>({cid:Ty(n,r.cid),public:r.public})),noLoaderOps:(t.noLoaderOps||[]).map(r=>({cars:(r.cars||[]).map(i=>Ty(n,i))})),operations:(t.operations||[]).map(r=>({cars:(r.cars||[]).map(i=>Ty(n,i))}))})}const e5={car:async(n,e)=>A.Ok(e),file:async(n,e)=>A.Ok(e),meta:async(n,e)=>Te(()=>JSON.parse(n.txt.decode(e))),wal:async(n,e)=>Te(()=>JSON.parse(n.txt.decode(e)))};function Hf(n,e){return e.isErr()?A.Err(e.Err()):A.Ok({type:n,payload:e.unwrap()})}async function qw(n,e,t,r){const i=await Zk(t);if(i.isErr())return A.Err(i.Err());const o=i.unwrap(),l={...e5,...r};switch(e.getParam(te.STORE)){case"car":return Hf(Ar.CAR,await l.car(n,o));case"file":return Hf(Ar.FILE,await l.file(n,o));case"wal":return Hf(Ar.WAL,await X8(n,await l.wal(n,o)));case"meta":return Hf(Ar.META,await cO(n,await l.meta(n,o)));default:return n.logger.Error().Str("store",e.getParam(te.STORE)).Msg("unsupported store").ResultError()}}const hl=new Map;function t5(n,e,t,r){return async i=>{const o=await qw(n,e,A.Ok(i),r);if(o.isErr()){n.logger.Error().Err(o).Msg("Failed to deserialize");return}await t(o.Ok())}}function M_(n){return n.build().cleanParams(te.SELF_REFLECT,te.KEY,te.LOCAL_NAME,te.NAME).toString()}class n5{gw;constructor(e){this.gw=e}start({loader:{sthis:e}},t){return this.gw.start(t,e)}async buildUrl({loader:{sthis:e}},t,r){return this.gw.buildUrl(t,r,e)}async close({loader:{sthis:e}},t){return this.gw.close(t,e)}async put({loader:{sthis:e},encoder:t},r,i){const o=await oO(e,i,t);if(o.isErr())return o;const l=this.gw.put(r,o.Ok(),e);if(i.type===Ar.META&&r.hasParam(te.SELF_REFLECT)){const f=M_(r),h=hl.get(f);h&&await Promise.all(Array.from(h.values()).map(m=>m(o.Ok())))}return l}async get({loader:{sthis:e},decoder:t},r){const i=await this.gw.get(r,e);return i.isErr()?A.Err(i.Err()):qw(e,r,i,t)}async subscribe({loader:{sthis:e},decoder:t},r,i){const o=t5(e,r,i,t);let l=A.Ok(()=>{});if(this.gw.subscribe&&(l=await this.gw.subscribe(r,o,e),l.isErr()))return l;if(r.hasParam(te.SELF_REFLECT)){const f=M_(r),h=hl.get(f)??new Map;hl.set(f,h);const m=e.nextId().str;return h.set(m,o),A.Ok(()=>{const y=hl.get(f);y&&(y.delete(m),y.size===0&&hl.delete(f),l.Ok()())})}return l}async delete({loader:{sthis:e}},t){return this.gw.delete(t,e)}async destroy({loader:{sthis:e}},t){return this.gw.destroy(t,e)}async getPlain({loader:{sthis:e}},t,r){return this.gw.getPlain(t,r,e)}}class r5{async buildUrl(e,t,r){const i={url:t,key:r};return A.Ok({op:i})}async start(e,t){const r={url:t};return A.Ok({op:r})}async close(e,t){const r={url:t};return A.Ok({op:r})}async delete(e,t){const r={url:t};return A.Ok({op:r})}async destroy(e,t){const r={url:t};return A.Ok({op:r})}async put(e,t,r){const i={url:t,body:r};return A.Ok({op:i})}async get(e,t){const r={url:t};return A.Ok({op:r})}async subscribe(e,t,r){const i={url:t,callback:r};return A.Ok({op:i})}}const s5=new r5;class i5{innerGW;interceptor;constructor(e,t,r){this.innerGW=t,this.interceptor=r||s5}async buildUrl(e,t,r){const i=await this.interceptor.buildUrl(e,t,r);if(i.isErr())return A.Err(i.Err());const o=i.unwrap();return o.stop&&o.value?o.value:this.innerGW.buildUrl(e,o.op.url,o.op.key)}async destroy(e,t){const r=await this.interceptor.destroy(e,t);if(r.isErr())return A.Err(r.Err());const i=r.unwrap();return i.stop&&i.value?i.value:this.innerGW.destroy(e,i.op.url)}async start(e,t){const r=await this.interceptor.start(e,t);if(r.isErr())return A.Err(r.Err());const i=r.unwrap();return i.stop&&i.value?i.value:await this.innerGW.start(e,i.op.url)}async close(e,t){const r=await this.interceptor.close(e,t);if(r.isErr())return A.Err(r.Err());const i=r.unwrap();return i.stop&&i.value?i.value:await this.innerGW.close(e,i.op.url)}async put(e,t,r){const i=await this.interceptor.put(e,t,r);if(i.isErr())return A.Err(i.Err());const o=i.unwrap();return o.stop&&o.value?o.value:this.innerGW.put(e,o.op.url,o.op.body)}async get(e,t){const r=await this.interceptor.get(e,t);if(r.isErr())return A.Err(r.Err());const i=r.unwrap();return i.stop&&i.value?i.value:this.innerGW.get(e,i.op.url)}async subscribe(e,t,r){if(!this.innerGW.subscribe)return A.Err(e.loader.sthis.logger.Error().Url(t).Msg("subscribe not supported").AsError());const i=await this.interceptor.subscribe(e,t,r);if(i.isErr())return A.Err(i.Err());const o=i.unwrap();return o.stop&&o.value?o.value:this.innerGW.subscribe(e,o.op.url,o.op.callback)}async delete(e,t){const r=await this.interceptor.delete(e,t);if(r.isErr())return A.Err(r.Err());const i=r.unwrap();return i.stop&&i.value?i.value:this.innerGW.delete(e,t)}async getPlain(e,t,r){return this.innerGW.getPlain(e,t,r)}}function Eg(n,e){const t=n.pathname,r=n.getParam("name");return r?e.pathOps.join(t,r):e.pathOps.join(t)}function N_(n,e){const t=n.getParam("key");if(!t)throw e.logger.Error().Url(n).Msg("key not found").AsError();const r=Gi(n,e,(...i)=>i.join("-"));switch(r.fromUrl){case"file":return e.pathOps.join(r.name,t);case"car":return e.pathOps.join(r.name,t+".car");case"wal":case"meta":return e.pathOps.join(r.name,t+".json");default:throw e.logger.Error().Url(n).Msg("unsupported store type").AsError()}}const Fw="v0.19-indexeddb";async function a5(n,e){const t=await n.loader.keyBag();if(!t)return Promise.resolve(A.Err(new Error("missing keybag")));const r=await n.loader.attachedStores.local().active.car.url(),i=r.getParam(te.STORE_KEY);if(!i)n.loader.sthis.logger.Warn().Url(r).Msg("missing store key");else{const o=await t.getNamedKey(i);if(o.isErr())n.loader.sthis.logger.Warn().Str("keyName",i).Msg("did not found a extractable key");else for(const l of e.keys)(await o.Ok().upsert(l,{def:!1})).isErr()&&n.loader.sthis.logger.Warn().Str("keyStr",l).Msg("failed to upsert key")}return Promise.resolve(A.Ok(e.metas))}async function o5(n,e,t){const r=n.loader.attachedStores.local().active.car,i=await n.loader.keyBag();if(!i)return Promise.resolve(A.Err(new Error("missing keybag")));const o=r.url().getParam(te.STORE_KEY)??"",l=await i.getNamedKey(o);if(l.isErr())return Promise.resolve(A.Err(l.Err()));const f=await l.Ok().asV2StorageKeyItem().then(h=>Object.values(h.keys).map(m=>m.key));return Promise.resolve(A.Ok(t(e,f)))}function c5(n,e){return o5(n,e,(t,r)=>({metas:t,keys:r}))}const l5=new Mt;class u5{fs;constructor(e,t){this.fs=t}async getVersionFromFile(e,t){return l5.get(e).once(async()=>{await this.fs.mkdir(e,{recursive:!0});const r=t.pathOps.join(e,"version"),i=await this.fs.stat(r).catch(()=>{});if(i){if(!i.isFile())throw t.logger.Error().Str("file",r).Msg("version file is a directory").AsError()}else return await this.fs.writefile(t.pathOps.join(e,"version"),Zi),Zi;const o=await this.fs.readfile(r),l=t.txt.decode(o);return l!==Zi&&t.logger.Warn().Str("file",r).Str("from",l).Str("expected",Zi).Msg("version mismatch"),l})}start(e,t){return Te(async()=>{await this.fs.start();const r=e.build();r.defParam(te.VERSION,Zi);const i=await this.buildUrl(r.URI(),"dummy"),o=this.getFilePath(i.Ok(),t);await this.fs.mkdir(t.pathOps.dirname(o),{recursive:!0});const l=t.pathOps.dirname(o);return t.logger.Debug().Url(r.URI()).Str("dbroot",l).Msg("start"),r.setParam(te.VERSION,await this.getVersionFromFile(l,t)),r.URI()})}async buildUrl(e,t){return A.Ok(e.build().setParam(te.KEY,t).URI())}async close(){return A.Ok(void 0)}getFilePath(e,t){if(!e.getParam(te.KEY))throw t.logger.Error().Url(e).Msg("key not found").AsError();return t.pathOps.join(Eg(e,t),N_(e,t))}async put(e,t,r){return Te(async()=>{const i=await this.getFilePath(e,r);r.logger.Debug().Str("url",e.toString()).Str("file",i).Msg("put"),await this.fs.writefile(i,t)})}async get(e,t){return Gk(async()=>{const r=this.getFilePath(e,t);try{t.logger.Debug().Url(e).Str("file",r).Msg("get");const i=await this.fs.readfile(r);return A.Ok(i)}catch(i){return ci(i)?A.Err(new Kr(`file not found: ${r}`)):A.Err(i)}})}async delete(e,t){return Te(async()=>{await this.fs.unlink(this.getFilePath(e,t))})}async destroy(e,t){const r=await this.buildUrl(e,"x");if(r.isErr())return r;const i=t.pathOps.dirname(this.getFilePath(r.Ok(),t));let o=[];try{o=await this.fs.readdir(i)}catch(l){if(!ci(l))throw t.logger.Error().Err(l).Str("dir",i).Msg("destroy:readdir").AsError()}for(const l of o){const f=t.pathOps.join(i,l);try{await this.fs.unlink(f)}catch(h){if(!ci(h))throw t.logger.Error().Err(h).Str("file",f).Msg("destroy:unlink").AsError()}}return A.Ok(void 0)}async getPlain(e,t,r){const i=e.build().setParam(te.KEY,t).URI(),o=r.pathOps.join(Eg(i,r),N_(i,r));r.logger.Debug().Url(i).Str("dbFile",o).Msg("get");const l=await this.fs.readfile(o);return r.logger.Debug().Url(i).Str("dbFile",o).Len(l).Msg("got"),A.Ok(l)}}const R_=Wk("FIREProof:deviceId");class f5{seq=new BD;namedItem;constructor(e){this.namedItem=e}}const h5=new Map;class Vw{logger;rt;#e;static async create(e){const t=await $B(e.url.toJSON()),r=h5.get(t)??new Mt;return new Vw(e,r)}constructor(e,t){this.logger=Xe(e.sthis,"KeyBag"),this.rt=e,this.#e=t}hash(){return this.rt.id()}_warnOnce=new on;async subtleKey(e){const t=this.rt.url.getParam(te.EXTRACTKEY)==="_deprecated_internal_api";t&&this._warnOnce.once(()=>{this.logger.Warn().Msg("extractKey is enabled via _deprecated_internal_api --- handle keys safely!!!")});let r;return typeof e=="string"?r=st.decode(e):r=e,await this.rt.crypto.importKey("raw",r,"AES-GCM",t,["encrypt","decrypt"])}async ensureKeyFromUrl(e,t){const r=e.getParam(te.STORE_KEY);if(r==="insecure")return A.Ok(e);if(!r){const i=`@${t()}@`,o=await this.getNamedKey(i);if(o.isErr())return A.Err(o);const l=e.build().setParam(te.STORE_KEY,i);return A.Ok(l.URI())}if(r.startsWith("@")&&r.endsWith("@")){const i=await this.getNamedKey(r);if(i.isErr())return A.Err(i)}return A.Ok(e)}async getDeviceId(){const e=R_;return this.#e.get(e).once(async()=>{const t=await this.provider().then(o=>o.get(e)),r=Bk.safeParse(t);let i;return r.success?{deviceId:At.Some(r.data.item.deviceId),cert:At.From(r.data.item.cert),error:i}:(i=r.error,{deviceId:At.None(),cert:At.None(),error:i})})}async setDeviceId(e,t){const r=R_;return this.#e.unget(r),this.#e.get(r).once(async()=>(await this.provider().then(o=>o.set(r,{id:r,clazz:"DeviceIdKeyBagItem",item:{deviceId:e,cert:t}})),{deviceId:At.Some(e),cert:At.From(t)}))}setJwt(e,t){return this.#e.get(e).once(()=>Te(()=>this.provider().then(r=>{const i={id:e,clazz:"JwtKeyBagItem",item:{jwtStr:t}};return r.set(e,i).then(o=>i)})))}async getJwt(e,t,r){if(this.#e.has(e)){const i=await this.#e.get(e).once(()=>{throw new Error("Should never called")}),o=Pk.safeParse(i.Ok());if(!o.success)return A.Err(o.error);let l;try{t?l=await nc(o.data.item.jwtStr,t,r):l=wd(o.data.item.jwtStr)}catch{}return A.Ok({key:e,jwt:o.data.item.jwtStr,claims:l})}return this.logger.Error().Str("name",e).Msg("not found").ResultError()}async delete(e){return this.#e.has(e)?(await this.provider().then(t=>t.del(e)),this.#e.unget(e),!0):!1}provider=Or(()=>this.rt.getBagProvider());async getNamedKey(e,t=!1,r){const i=await this.#e.get(e).once(()=>new f5(new k8(this,e)));return i.seq.add(()=>i.namedItem.getNamedKey({failIfNotFound:t,materialStrOrUint8:r}))}async getRawObj(e){const t=await this.provider().then(r=>r.get(e));return t?At.Some(AB.safeParse(t)):At.None()}async setRawObj(e){const t=ww.safeParse(e);return t.success?Te(()=>this.provider().then(r=>r.set(t.data.id,t.data).then(i=>t.data))):A.Err(t.error)}}const d5=new Map([{protocol:"file:",factory:async(n,e)=>new M8(n,e)},{protocol:"indexeddb:",factory:async(n,e)=>{const{KeyBagProviderImpl:t}=await Bo(async()=>{const{KeyBagProviderImpl:r}=await Promise.resolve().then(()=>YO);return{KeyBagProviderImpl:r}},void 0);return new t(n,e)}},{protocol:"memory:",factory:async(n,e)=>new T8(n,e)}].map(n=>[n.protocol,n]));function lO(n,e){if(e=e||{},e.keyRuntime)return e.keyRuntime;const t=Xe(n,"KeyBag");let r;if(e.url)r=Fe.from(e.url),t.Debug().Url(r).Msg("from opts");else{let o=n.env.get("FP_KEYBAG_URL");jn().isBrowser?r=Fe.from(o||"indexeddb://fp-keybag"):o?r=Fe.from(o):(o=`${n.env.get("HOME")}/.fireproof/keybag`,r=Fe.from(`file://${o}`)),t.Debug().Url(r).Msg("from env")}const i=d5.get(r.protocol);if(!i)throw t.Error().Url(r).Msg("unsupported protocol").AsError();if(r.hasParam("masterkey"))throw t.Error().Url(r).Msg("masterkey is not supported").AsError();return{url:r,crypto:e.crypto||cw({}),sthis:n,logger:t,keyLength:e.keyLength||16,getBagProvider:()=>i.factory(r,n),id:()=>r.toString()}}const m5=new Mt;async function p5(n,e={}){await n.start();const t=lO(n,e);return m5.get(t.id()).once(()=>Vw.create(t))}class vr{cid;bytes;item;static async fromBlockItem(e){const t=await yd({value:e.value,hasher:Bt,codec:Hn});return new vr(t.cid,t.bytes,e)}static async fromAnyBlock(e,t){const r=await Te(async()=>await Iw({bytes:t,hasher:Bt,codec:Hn}));if(r.isErr())return new uO(e,t);const i=r.Ok();switch(!0){case"doc"in i.value:return vr.fromBlockItem({type:"doc",status:"ready",value:i.value});case"entries"in i.value:return vr.fromBlockItem({type:"entries",status:"ready",value:i.value});case"fp"in i.value:return vr.fromBlockItem({type:"fp",status:"ready",value:i.value});case"data"in i.value:return vr.fromBlockItem({type:"data",status:"ready",value:i.value});case"del"in i.value:return vr.fromBlockItem({type:"del",status:"ready",value:i.value});case"leaf"in i.value:return vr.fromBlockItem({type:"leaf",status:"ready",value:i.value});case"branch"in i.value:return vr.fromBlockItem({type:"branch",status:"ready",value:i.value});default:return vr.fromBlockItem({type:"unknown",status:"ready",value:i.value})}}constructor(e,t,r){this.cid=e,this.bytes=t,this.item=r}}class uO{cid;bytes;get item(){throw new Error("FileFPBlock: item not available")}constructor(e,t){this.cid=e,this.bytes=t}}function y5(n){return new uO(n.cid,n.bytes)}function gi(n){return vr.fromAnyBlock(n.cid,n.bytes)}async function g5(n){const e=await yd({value:n,hasher:Bt,codec:Hn});return gi(e)}async function w5(n){return gi(await yd({value:{fp:n},hasher:Bt,codec:Hn}))}async function D_(n,e){const t=await n.item.value.car.roots,r=n.item.value.car.blocks.find(i=>i.cid.equals(t[0]));if(!r)throw e.Error().Msg("missing header block").AsError();if(!wg(r))throw e.Error().Msg("missing fp").AsError();return r.item.value.fp}class aa{parent;#e=new Map;#t;constructor(e,t={add:!0,noLoader:!1}){t.add&&e.transactions.add(this),this.parent=e}async get(e){const t=await this.superGet(e);return t||await this.parent.get(e)}async superGet(e){return this.#e.get(e.toString())}async put(e){return this.putSync(e)}putSync(e){this.#e.set(e.cid.toString(),e)}unshift(e){if(this.#t)throw new Error("unshift already called");this.#t=e}async*entries(){this.#t&&(yield this.#t);for await(const e of this.#e.values())yield e}}function fO(n,e,t,r){const i=Xe(n,t,r);return{applyMeta:(o,l)=>Promise.resolve(),compactStrategy:MT("no-op"),autoCompact:100,public:!1,threshold:1e3*1e3,...e,logger:i,keyBag:e.keyBag||{},crypto:cw(e.crypto),storeUrls:e.storeUrls,taskManager:{removeAfter:3,retryTimeout:50,...e.taskManager},storeRuntime:$h(n,OO(e.storeEnDeFile))}}class b5{transactions=new Set;ebOpts;sthis;crdtParent;loader;ready(){return Promise.resolve()}async close(){}async destroy(){}async compact(){}logger;constructor(e,t){this.sthis=vw(e),this.crdtParent=t,this.ebOpts=fO(this.sthis,e,"BaseBlockstore"),this.logger=this.ebOpts.logger,this.loader=new Y5(this.sthis,e,this)}async get(e){if(!e)throw this.logger.Error().Msg("required cid").AsError();for(const t of this.transactions){const r=await t.superGet(e);if(r)return r}}async put(e){throw this.logger.Error().Msg("use a transaction to put").AsError()}lastTxMeta;async transaction(e,t){this.logger.Debug().Msg("enter transaction");const r=new aa(this,t);this.logger.Debug().Msg("post CarTransaction");const i=await e(r);return this.logger.Debug().Msg("post fn"),this.lastTxMeta=i,{t:r,meta:i}}openTransaction(e={add:!0,noLoader:!1}){return new aa(this,e)}async commitTransaction(e,t,r){if(!this.loader)throw this.logger.Error().Msg("loader required to commit").AsError();const i=await this.loader.commit(e,t,r);if(this.ebOpts.autoCompact&&this.loader.carLog.length>this.ebOpts.autoCompact&&setTimeout(()=>{this.compact()},10),i)return this.transactions.delete(e),{meta:t,cars:i,t:e};throw this.logger.Error().Msg("failed to commit car files").AsError()}async*entries(){const e=new Set;for(const t of this.transactions)for await(const r of t.entries())e.has(r.cid.toString())||(e.add(r.cid.toString()),yield r)}}class x_ extends b5{ready(){return this.loader.ready()}close(){return this.loader.close()}destroy(){return this.loader.destroy()}compacting=!1;logger;constructor(e,t,r){super(t,r),this.logger=Xe(this.sthis,"EncryptedBlockstore",{this:1})}async get(e){const t=await super.get(e);return t||await this.loader.getBlock(e,this.loader.attachedStores.local())}async transaction(e,t={noLoader:!1}){this.logger.Debug().Msg("enter transaction");const{t:r,meta:i}=await super.transaction(e);this.logger.Debug().Msg("post super.transaction");const o=await this.loader.commit(r,i,t);if(this.logger.Debug().Msg("post this.loader.commit"),this.ebOpts.autoCompact&&this.loader.carLog.length>this.ebOpts.autoCompact&&setTimeout(()=>{this.compact()},10),o)return this.transactions.delete(r),{meta:i,cars:o,t:r};throw this.logger.Error().Msg("failed to commit car files").AsError()}async getFile(e,t){if(await this.ready(),!this.loader)throw this.logger.Error().Msg("loader required to get file, ledger must be named").AsError();const r=await this.loader.loadFileCar(e,this.loader.attachedStores.local());if(!uh(r))throw this.logger.Error().Str("cid",e.toString()).Msg("car not ready").AsError();const i=await r.item.value.car.blocks.find(o=>o.cid.equals(t));if(!i)throw this.logger.Error().Str("cid",t.toString()).Msg("Missing block").AsError();return i.bytes}async compact(){if(await this.ready(),!this.loader)throw this.logger.Error().Msg("loader required to compact").AsError();if(this.loader.carLog.length<2||this.compacting)return;const e=new v5(this);this.compacting=!0;try{const t=await Te(async()=>this.ebOpts.compactStrategy.compact(e));if(t.isErr()){this.logger.Error().Err(t).Any({carLogLen:this.loader.carLog.length,carLogCids:this.loader.carLog.asArray().flat().map(r=>r.toString())}).Msg("compact inner fn threw");return}await this.loader.commit(e.loggedBlocks,t.Ok(),{compact:!0,noLoader:!0})}finally{this.compacting=!1,this.logger.Debug().Uint64("carLogLen_after",this.loader.carLog.length).Msg("compact()  finished")}}async*entries(){for await(const e of this.loader.entries())yield e}}class v5{transactions;clock;lastTxMeta;loader;logger;blockstore;loggedBlocks;constructor(e){this.transactions=e.transactions,this.logger=e.logger,this.loader=e.loader,this.clock=e.crdtParent?.clock,this.blockstore=e,this.loggedBlocks=new aa(e)}async get(e){const t=await this.blockstore.get(e);return t&&this.loggedBlocks.putSync(t),kI(t)}}const S5=cT(),E5={float64:!1,quickEncodeToken:oT};function hO(n,e=S5,t=E5){if(Array.isArray(n)){let r=0;for(const i of n)r+=hO(i,e,t);return r}else{const r=e[n.type.major];if(r.encodedSize===void 0||typeof r.encodedSize!="function")throw new Error(`Encoder for ${n.type.name} does not have an encodedSize()`);return r.encodedSize(n,t)}}class _5{constructor(e,t){this.bytes=e,this.byteOffset=t,this.roots=[],this.headerSize=t}addRoot(e,t){return A5(this,e,t),this}write(e){return k5(this,e),this}close(e){return T5(this,e)}}const A5=(n,e,t={})=>{const{resize:r=!1}=t,{bytes:i,headerSize:o,byteOffset:l,roots:f}=n;n.roots.push(e);const h=Gw(n);if(h>o)if(h-o+l<i.byteLength)if(r)dO(n,h);else throw f.pop(),new RangeError(`Header of size ${o} has no capacity for new root ${e}.
  However there is a space in the buffer and you could call addRoot(root, { resize: root }) to resize header to make a space for this root.`);else throw f.pop(),new RangeError(`Buffer has no capacity for a new root ${e}`)},fh=({cid:n,bytes:e})=>{const t=n.bytes.byteLength+e.byteLength;return _r.encodingLength(t)+t},k5=(n,{cid:e,bytes:t})=>{const r=e.bytes.byteLength+t.byteLength,i=_r.encode(r);if(n.byteOffset+i.length+r>n.bytes.byteLength)throw new RangeError("Buffer has no capacity for this block");Oy(n,i),Oy(n,e.bytes),Oy(n,t)},T5=(n,e={})=>{const{resize:t=!1}=e,{roots:r,bytes:i,byteOffset:o,headerSize:l}=n,f=xT({version:1,roots:r}),h=_r.encode(f.length),m=h.length+f.byteLength;if(l-m===0)return I_(n,h,f),i.subarray(0,o);if(t)return dO(n,m),I_(n,h,f),i.subarray(0,n.byteOffset);throw new RangeError(`Header size was overestimated.
You can use close({ resize: true }) to resize header`)},dO=(n,e)=>{const{bytes:t,headerSize:r}=n;t.set(t.subarray(r,n.byteOffset),e),n.byteOffset+=e-r,n.headerSize=e},Oy=(n,e)=>{n.bytes.set(e,n.byteOffset),n.byteOffset+=e.length},I_=({bytes:n},e,t)=>{n.set(e),n.set(t,e.length)},O5=[new X(R.map,2),new X(R.string,"version"),new X(R.uint,1),new X(R.string,"roots")],C5=new X(R.tag,42),M5=n=>{const e=[...O5];e.push(new X(R.array,n.length));for(const r of n)e.push(C5),e.push(new X(R.bytes,{length:r+1}));const t=hO(e);return _r.encodingLength(t)+t},Gw=({roots:n})=>M5(n.map(e=>e.bytes.byteLength)),N5=(n,e={})=>{const{roots:t=[],byteOffset:r=0,byteLength:i=n.byteLength,headerSize:o=Gw({roots:t})}=e,l=new Uint8Array(n,r,i),f=new _5(l,o);for(const h of t)f.addRoot(h);return f};async function mO(n,e,t){let r=0;const i=Gw({roots:n});r+=i;for await(const{cid:f,bytes:h}of e.entries())r+=fh({cid:f,bytes:h});const o=new Uint8Array(r),l=N5(o.buffer,{headerSize:i});for(const f of n)l.addRoot(f);for await(const{cid:f,bytes:h}of e.entries())l.write({cid:f,bytes:h});return l.close(),await yd({value:l.bytes,hasher:Bt,codec:t})}async function U_(n,e,t){return mO([e],t,n)}async function R5(n,e,t,r){const{files:i}=D5(r),o=[],l=await n.keyedCrypto().then(h=>h.codec()),f=await x5(l,i,t);for(const h of f){const{cid:m,bytes:y}=h;await n.save({cid:m,bytes:y}),await e.enqueueFile(m),o.push(m)}return o}function D5(n){const e=[];for(const[,t]of Object.entries(n.files||{}))typeof t=="object"&&t!==null&&"cid"in t&&e.push(t.cid);return{...n,files:e}}async function x5(n,e,t){return[await mO(e,t,n)]}function I5(n,e,t=!1){return{...t?{cars:[],compact:e.asArray()}:{cars:e.asArray(),compact:[]},meta:n}}async function U5(n){return w5(n)}async function z5(n,e,t,r={noLoader:!1,compact:!1}){const i=I5(t,n.carLog,!!r.compact),o=await U5(i),l=await L5(n.encoder,n.threshold,o,e),f=await Promise.all(l.map(async h=>(await n.writeCar(h),h.cid)));return await Promise.all([n.writeWAL(f),n.writeMeta(f)]),{cgrp:f,header:i}}async function L5(n,e,t,r){const i=[];e=e||16*65536;let o=new aa(r.parent,{add:!1,noLoader:!1});o.putSync(t);let l=fh({cid:t.cid,bytes:t.bytes}),f=t;for await(const h of r.entries())l+=fh({cid:h.cid,bytes:h.bytes}),l>=e?(i.push(await U_(n,f.cid,o)),o=new aa(r.parent,{add:!1,noLoader:!1}),o.putSync(h),f=h,l=fh({cid:h.cid,bytes:h.bytes})):o.putSync(h);return i.push(await U_(n,f.cid,o)),i}class B5{keyed;gatewayUrls;stores;attachCtx;constructor(e,t,r,i){this.keyed=e,this.gatewayUrls=t,this.stores=new TI(r),this.attachCtx={detach:async()=>{},ctx:new fi,...i}}async detach(){const e=[this.stores.car.close(),this.stores.file.close(),this.stores.meta.close()];this.stores.wal&&e.push(this.stores.wal.close()),await Promise.all(e),this.attachCtx.detach()}ctx(){return this.attachCtx.ctx}status(){return"attached"}}class P5 extends XP{ref;active;attached;constructor(e,t,r){super(),this.ref=e,this.active=t,this.attached=r}local(){return this.attached.local()}remotes(){return this.attached.remotes()}}class $5 extends QP{ref;active;attached;constructor(e,t,r){super(),this.ref=e,this.active=t,this.attached=r}local(){return this.attached.local()}remotes(){return[this.active,...this.attached.remotes().filter(e=>e!==this.active)]}}class K5{attached;constructor(e){this.attached=e}local(){return this.attached.local().active.car}remotes(){return this.attached.remotes().map(({active:e})=>e.car)}}class j5{attached;constructor(e){this.attached=e}local(){return this.attached.local().active.file}remotes(){return this.attached.remotes().map(({active:e})=>e.file)}}class H5 extends e8{ref;active;attached;constructor(e,t,r){super(),this.ref=e,this.active=t,this.attached=r}local(){return this.attached.local()}remotes(){return[this.active,...this.attached.remotes().filter(e=>e!==this.active)]}}class q5{attached;constructor(e){this.attached=e}local(){return this.attached.local().active.meta}remotes(){return this.attached.remotes().map(({active:e})=>e.meta)}}class F5 extends t8{ref;active;attached;constructor(e,t,r){super(),this.ref=e,this.active=t,this.attached=r}local(){return this.attached.local()}remotes(){return this.attached.remotes()}}class V5{attached;constructor(e){this.attached=e}local(){return this.attached.local().active.wal}remotes(){return this.attached.remotes().filter(({active:e})=>e.wal).map(({active:e})=>e.wal)}}class z_{active;attached;constructor(e,t){this.active=e,this.attached=t}local(){return this.attached.local()}remotes(){return this.attached.remotes()}baseStores(){const e=[this.active.car,this.active.file,this.active.meta];return this.active.wal&&e.push(this.active.wal),e}carStore(){return new $5(this,this.active.car,new K5(this.attached))}fileStore(){return new P5(this,this.active.file,new j5(this.attached))}metaStore(){return new H5(this,this.active.meta,new q5(this.attached))}walStore(){if(!this.active.wal)throw this.attached.loadable.sthis.logger.Error().Msg("wal store not set").AsError();return new F5(this,this.active.wal,new V5(this.attached))}}function G5(n){return!!n.sthis&&!!n.attachedStores}async function Z5(n,e,t="local"){let r;G5(e)?r=e.attachedStores:r=e;let i;if(!n)throw new Error("urlOrGup is required");if(xA(n)){const l=n;i={car:{url:l},file:{url:l},meta:{url:l},wal:{url:l}}}else i=n;const o=mi(i);return await r.attach({name:t,configHash:()=>o,prepare:async()=>i},l=>Promise.resolve(l))}class J5{_remotes=new Mt;loadable;_local;id;constructor(e){this.loadable=e,this.id=e.sthis.nextId().str}forRemotes(e){return Promise.all(this.remotes().map(t=>e(t))).then(()=>{})}remotes(){return this._remotes.values().filter(({value:e})=>e.isOk()&&!e.Ok().stores.wal).map(({value:e})=>e.Ok().stores).map(e=>this.activate(e))}local(){if(!this._local)throw this.loadable.sthis.logger.Error().Msg("local store not set").AsError();return new z_(this._local.stores,this)}activate(e){if(xA(e)){const t=Fe.from(e);let r=0,i;for(const{value:o}of this._remotes.values())if(!o.isErr())for(const l of o.Ok().stores.baseStores.map(f=>f.url())){const f=l.match(t);f.score>r&&(r=f.score,i=o.Ok().stores)}if(!i)throw this.loadable.sthis.logger.Error().Url(t).Msg("no store found").AsError();e=i}return new z_(e,this)}async detach(){await Promise.all(this._remotes.values().map(async({value:e})=>{e.isOk()&&await e.Ok().detach()}))}_keyedAttachable=new Mt;async attach(e,t){const r=e.configHash(this.loadable.blockstoreParent?.crdtParent?.ledgerParent);return await this._keyedAttachable.get(r).once(async()=>{const o=await e.prepare(this.loadable.blockstoreParent?.crdtParent?.ledgerParent),l={car:{...o.car,url:ir(this.loadable.sthis,{name:e.name,localURI:this._local?.gatewayUrls.car.url},void 0,Fe.from(o.car.url),"car")},file:{...o.file,url:ir(this.loadable.sthis,{name:e.name,localURI:this._local?.gatewayUrls.file.url},void 0,Fe.from(o.file.url),"file",{file:!0})},meta:{...o.meta,url:ir(this.loadable.sthis,{name:e.name,localURI:this._local?.gatewayUrls.meta.url},void 0,Fe.from(o.meta.url),"meta")},wal:o.wal?{...o.wal,url:ir(this.loadable.sthis,{name:e.name,localURI:this._local?.gatewayUrls.wal?.url},void 0,Fe.from(o.wal.url),"wal")}:void 0},f=JSON.stringify(zl({carUrl:l.car.url.toString(),filesUrl:l.file.url.toString(),metaUrl:l.meta.url.toString(),walUrl:l.wal?.url.toString()})),h=await this._remotes.get(f).once(async()=>{const y=$h(this.loadable.sthis),g=new B5(r,l,await y.makeStores({byStore:l,loader:this.loadable}),{detach:async()=>this._remotes.unget(f),ctx:o.ctx});if(g.stores.wal){if(this._local)throw this.loadable.sthis.logger.Error().Any({urls:g.gatewayUrls}).Msg("local store could only set once").AsError();this._local=g}return g});return await t?.(h)})}}function _g(n,e){const t=e.map(r=>r.toString()).sort().join(",");return n.some(r=>t===r.map(i=>i.toString()).sort().join(","))}function L_(n,e=new Yy){const t=new Map;for(const r of n)e.has(r.toString())||t.set(r.toString(),r);return[...t.values()]}class W5{carLog;encoder;threshold;attached;opts;commitQueue;logger;constructor(e,t,r,i,o,l,f){this.logger=e,this.carLog=t,this.commitQueue=r,this.attached=o,this.encoder=i,this.threshold=l,this.opts=f}async writeCar(e){await this.attached.local().active.car.save(e),this.attached.remotes().forEach(t=>{this.commitQueue.enqueue(async()=>(this.logger.Debug().Url(t.active.car.url()).Msg("remote-writeCar"),await t.active.car.save(e),[]))})}async writeMeta(e){const t={cars:e};await this.attached.local().active.meta.save(t),this.attached.remotes().forEach(r=>{this.commitQueue.enqueue(async()=>(this.logger.Debug().Url(r.active.meta.url()).Msg("remote-writeMeta"),await r.active.meta.save(t),[]))})}async writeWAL(e){await this.attached.local().active.wal.enqueue({cars:e},this.opts)}}class Y5{blockstoreParent;ebOpts;logger;commitQueue;isCompacting=!1;cidCache;maxConcurrentCarReader;maxConcurrentWrite=bg(1);seenCompacted;sthis;taskManager;carLog=new YP;attachedStores;async tryToLoadStaleCars(e){const t=[];for(const{value:r}of this.cidCache.values()){if(r.isErr()){this.logger.Error().Err(r).Msg("error loading car");return}const i=r.Ok();if(uo(i)){this.cidCache.unget(i.cid.toString());const o=this.loadCar(i.cid,e).then(l=>(uo(l)&&this.logger.Warn().Any({cid:i.cid.toString(),type:i.item.type}).Msg("is stale"),Promise.resolve(l))).catch(l=>(this.logger.Warn().Err(l).Any({cid:i.cid.toString()}).Msg("error loading car"),Promise.reject(l)));t.push(o)}}await Promise.allSettled(t)}async attach(e){return await this.attachedStores.attach(e,async r=>{if(!r.stores.wal)try{const i=this.attachedStores.activate(r.stores);await this.tryToLoadStaleCars(i);const o=this.currentMeta,l=i.active.meta.stream();await this.waitFirstMeta(l.getReader(),i,{origin:i.active.meta.url()}),o&&await this.ensureAttachedStore(i,o),await this.blockstoreParent.commitTransaction(new aa(this.blockstoreParent),{head:this.blockstoreParent?.crdtParent?.clock.head},{add:!1,noLoader:!1})}catch(i){throw await r.detach(),this.logger.Error().Err(i).Msg("error attaching store").AsError()}return r})}async ensureAttachedStore(e,t){const r=e.local().carStore(),i=(await r.active.keyedCrypto()).codec(),o=new Map,l=new Set(t.map(f=>f.toString()));await Promise.allSettled(t.map(async f=>{const h=await this.storesLoadCar(f,r),m=await Te(async()=>await e.active.car.save({cid:f,bytes:await i.encode(h.bytes)}));if(m.isErr()&&this.logger.Warn().Err(m).Str("cid",f.toString()).Msg("error putting car"),h.item.value){const y=h.item.value.car.blocks.filter(g=>wg(g));for(const g of y){if(!wg(g))continue;g.item.value.fp.cars.forEach(E=>{E.forEach(_=>{const S=_.toString();l.has(S)||o.set(S,_)})})}}})),o.size>0&&await this.ensureAttachedStore(e,Array.from(o.values()))}seenMeta;keyBag(){return p5(this.sthis,this.ebOpts.keyBag)}onceReady=new on;metaStreamReader;async ready(){return this.onceReady.once(async()=>{await Z5({car:{url:this.ebOpts.storeUrls.car,gatewayInterceptor:this.ebOpts.gatewayInterceptor},file:{url:this.ebOpts.storeUrls.file,gatewayInterceptor:this.ebOpts.gatewayInterceptor},meta:{url:this.ebOpts.storeUrls.meta,gatewayInterceptor:this.ebOpts.gatewayInterceptor},wal:{url:this.ebOpts.storeUrls.wal,gatewayInterceptor:this.ebOpts.gatewayInterceptor}},this.attachedStores,this.blockstoreParent?.crdtParent?.ledgerParent?.name);const e=this.attachedStores.local();this.metaStreamReader=e.active.meta.stream().getReader(),await this.waitFirstMeta(this.metaStreamReader,e,{meta:this.ebOpts.meta,origin:e.active.car.url()})})}currentMeta=[];waitFirstMeta(e,t,r){return new Promise(i=>{this.handleMetaStream(e,t,{...r,first:()=>{i(this.currentMeta)},error:o=>{this.logger.Error().Err(o).Msg("error waiting for first meta"),i(this.currentMeta)}})})}handleMetaStream(e,t,r){e.read().then(i=>{const{done:o,value:l}=i;if(o)return;let f;r?.meta?f=this.handleDbMetasFromStore([r?.meta,...l||[]],t):l&&(f=this.handleDbMetasFromStore(l,t)),f?f.then(h=>{h.length&&(this.currentMeta=h)}).catch(h=>{this.logger.Error().Err(h).Msg("error handling meta stream")}).finally(()=>{r?.first(this.currentMeta??[]),this.handleMetaStream(e,t)}):this.handleMetaStream(e,t)}).catch(i=>{r?.error(i)})}async close(){await this.commitQueue.waitIdle(),await this.attachedStores.detach(),await this.metaStreamReader?.cancel("close")}async destroy(){await Promise.all(this.attachedStores.local().baseStores().map(e=>e.destroy()))}id;constructor(e,t,r){this.sthis=e,this.id=e.nextId().str,this.commitQueue=new fP(t),this.blockstoreParent=r,this.ebOpts=fO(e,{...t},"Loader"),this.logger=Xe(e,"Loader"),this.cidCache=new Mt({lru:{maxEntries:parseInt(this.ebOpts.storeUrls.car.getParam(te.CAR_CACHE_SIZE,"1000000"),10)}}),this.seenMeta=new Yy({maxEntries:parseInt(this.ebOpts.storeUrls.meta.getParam(te.CAR_META_CACHE_SIZE,"1000"),10)}),this.seenCompacted=new Yy({maxEntries:parseInt(this.ebOpts.storeUrls.car.getParam(te.CAR_COMPACT_CACHE_SIZE,"1000"),10)}),this.maxConcurrentCarReader=bg(parseInt(this.ebOpts.storeUrls.car.getParam(te.CAR_PARALLEL,"10"),10)),this.taskManager=new hP(e,async(i,o)=>{await this.handleDbMetasFromStore([i],o)},this.ebOpts.taskManager),this.attachedStores=new J5(this)}async handleDbMetasFromStore(e,t){const r=[];for(const i of e)await this.maxConcurrentWrite(async()=>{r.push(...(await this.mergeDbMetaIntoClock(i,t)).flat(2))});return r}async mergeDbMetaIntoClock(e,t){if(this.isCompacting)throw this.logger.Error().Msg("cannot merge while compacting").AsError();try{this.isCompacting=!0;const r=e.cars.map(f=>f.toString()).sort().join(",");if(this.seenMeta.has(r))return[];if(this.seenMeta.add(r),_g(this.carLog.asArray(),e.cars))return[];const i=await this.loadCarHeaderFromMeta(e,t);i.compact.map(f=>f.toString()).forEach(f=>this.seenCompacted.add(f),this.seenCompacted);const o=await this.getMoreReaders(i.cars.flat(),t).then(f=>f.filter(h=>h.isErr()));o.length>0&&this.logger.Warn().Any("warns",o).Msg("error getting more readers");const l=L_([e.cars,...this.carLog.asArray(),...i.cars],this.seenCompacted);return this.carLog.update(l),await this.ebOpts.applyMeta(i.meta),l}finally{this.isCompacting=!1}}async loadCarHeaderFromMeta(e,t){const r=await this.loadCar(e.cars[0],t);if(uo(r))this.logger.Warn().Str("cid",e.cars[0].toString()).Msg("stale loadCarHeaderFromMeta");else if(uh(r))return await D_(r,this.logger);return{cars:[],compact:[],meta:{}}}async commitFiles(e,t){await this.ready();const r=this.attachedStores.local().active.file,i=this.attachedStores.local().active.wal;return this.commitQueue.enqueue(()=>R5(r,i,e,t))}async loadFileCar(e,t){return await this.storesLoadCar(e,t.fileStore())}async commit(e,t,r={noLoader:!1,compact:!1}){await this.ready();const i=this.attachedStores.local().active.car,o=new W5(this.logger,this.carLog,this.commitQueue,await i.keyedCrypto().then(l=>l.codec()),this.attachedStores,this.ebOpts.threshold,r);return this.commitQueue.enqueue(async()=>{await this.cacheTransaction(e);const l=await z5(o,e,t,r);return await this.updateCarLog(l.cgrp,l.header,!!r.compact),l.cgrp})}async updateCarLog(e,t,r){if(r){const i=t.compact[t.compact.length-1];t.compact.map(o=>o.toString()).forEach(this.seenCompacted.add,this.seenCompacted),this.carLog.update(L_([...this.carLog.asArray(),...t.cars,e],this.seenCompacted)),await this.removeCidsForCompact(i[0],this.attachedStores.local()).catch(o=>o)}else this.carLog.unshift(e)}async cacheTransaction(e){for await(const t of e.entries()){const r=t.cid.toString();this.cidCache.get(r).once(()=>t)}}async removeCidsForCompact(e,t){const r=await this.loadCarHeaderFromMeta({cars:[e]},t);for(const i of r.compact)for(const o of i)await this.attachedStores.local().active.car.remove(o)}async*entries(){await this.ready();const e=new Set;for(const t of this.carLog.asArray())for(const r of t){const i=await this.loadCar(r,this.attachedStores.local());if(uo(i)){this.logger.Warn().Any({cid:r.toString(),url:this.attachedStores.local().carStore().active.url()}).Err(i.item.statusCause).Msg("entries-stale car");continue}if(!uh(i))throw this.logger.Error().Any({cid:r.toString(),item:i.item}).Msg("missing car reader").AsError();for(const o of i.item.value.car.blocks){const l=o.cid.toString();e.has(l)||(e.add(l),yield o)}}}async getBlock(e){return await this.ready(),this.cidCache.get(e.toString()).value}async getCompactCarCids(e,t){const r=e.toString(),i=await this.loadCar(e,t);if(uo(i)){this.logger.Warn().Str("cid",r).Err(i.item.statusCause).Msg("stale getCompactCarCids");return}if(!uh(i)){this.logger.Warn().Str("cid",r).Msg("is not ready");return}const l=(await D_(i,this.logger)).compact;(await Promise.allSettled(l.map(h=>h.map(m=>this.loadCar(m,t)).flat()))).filter(h=>h.status==="rejected").forEach(h=>{this.logger.Error().Err(h.reason).Str("cid",r).Msg("error getting compacted block")})}async loadCar(e,t){const r=await this.storesLoadCar(e,t.carStore());return uo(r)&&this.logger.Warn().Any({cid:r.cid.toString(),url:t.carStore().active.url().toString()}).Err(r.item.statusCause).Msg("load-car-stale car"),r}async makeDecoderAndCarReader(e,t){const r=e.toString();let i;const o=t.active;try{this.logger.Debug().Any("cid",r).Msg("loading car"),i=await o.load(e),this.logger.Debug().Bool("loadedCar",i).Msg("loaded")}catch(m){if(!ci(m))throw this.logger.Error().Str("cid",r).Err(m).Msg("loading car")}if(!i)return{cid:e,bytes:new Uint8Array(0),item:{status:"stale",statusCause:new Error("missing car file"),type:"car",origin:await o.id(),value:void 0}};o!==t.local()&&await t.local().save(i);const l=await Uw({bytes:i.bytes,hasher:Bt,codec:(await o.keyedCrypto()).codec()}),f=await JT.fromBytes(l.value.data),h=[];for await(const m of f.blocks()){const y=m.cid.toString(),g=await gi(m);h.push(g),this.cidCache.get(y).once(()=>g)}return{cid:e,bytes:l.value.data,item:{type:"car",status:"ready",origin:await o.id(),value:{car:{blocks:h,roots:await f.getRoots()}}}}}async storesLoadCar(e,t){const r=e.toString();return this.cidCache.get(r).once(async()=>this.maxConcurrentCarReader(()=>this.makeDecoderAndCarReader(e,t)))}async getMoreReaders(e,t){return Promise.all(e.map(async r=>this.loadCar(r,t).then(i=>A.Ok(i)).catch(i=>A.Err(i))))}}const Q5=Object.prototype.toString,X5=n=>Q5.call(n)==="[object Error]",e$=new Set(["network error","Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed","fetch failed","terminated"," A network error occurred.","Network connection lost"]);function t$(n){if(!(n&&X5(n)&&n.name==="TypeError"&&typeof n.message=="string"))return!1;const{message:t,stack:r}=n;return t==="Load failed"?r===void 0||"__sentry_captured__"in n:t.startsWith("error sending request for url")?!0:e$.has(t)}function n$(n){if(typeof n=="number"){if(n<0)throw new TypeError("Expected `retries` to be a non-negative number.");if(Number.isNaN(n))throw new TypeError("Expected `retries` to be a valid number or Infinity, got NaN.")}else if(n!==void 0)throw new TypeError("Expected `retries` to be a number or Infinity.")}function qf(n,e,{min:t=0,allowInfinity:r=!1}={}){if(e!==void 0){if(typeof e!="number"||Number.isNaN(e))throw new TypeError(`Expected \`${n}\` to be a number${r?" or Infinity":""}.`);if(!r&&!Number.isFinite(e))throw new TypeError(`Expected \`${n}\` to be a finite number.`);if(e<t)throw new TypeError(`Expected \`${n}\` to be  ${t}.`)}}class r$ extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}function s$(n,e){const t=Math.max(1,n+1),r=e.randomize?Math.random()+1:1;let i=Math.round(r*e.minTimeout*e.factor**(t-1));return i=Math.min(i,e.maxTimeout),i}function B_(n,e){return Number.isFinite(e)?e-(performance.now()-n):e}async function i$({error:n,attemptNumber:e,retriesConsumed:t,startTime:r,options:i}){const o=n instanceof Error?n:new TypeError(`Non-error was thrown: "${n}". You should only throw errors.`);if(o instanceof r$)throw o.originalError;const l=Number.isFinite(i.retries)?Math.max(0,i.retries-t):i.retries,f=i.maxRetryTime??Number.POSITIVE_INFINITY,h=Object.freeze({error:o,attemptNumber:e,retriesLeft:l,retriesConsumed:t});if(await i.onFailedAttempt(h),B_(r,f)<=0)throw o;const m=await i.shouldConsumeRetry(h),y=B_(r,f);if(y<=0||l<=0)throw o;if(o instanceof TypeError&&!t$(o)){if(m)throw o;return i.signal?.throwIfAborted(),!1}if(!await i.shouldRetry(h))throw o;if(!m)return i.signal?.throwIfAborted(),!1;const g=s$(t,i),b=Math.min(g,y);return i.signal?.throwIfAborted(),b>0&&await new Promise((E,_)=>{const S=()=>{clearTimeout(k),i.signal?.removeEventListener("abort",S),_(i.signal.reason)},k=setTimeout(()=>{i.signal?.removeEventListener("abort",S),E()},b);i.unref&&k.unref?.(),i.signal?.addEventListener("abort",S,{once:!0})}),i.signal?.throwIfAborted(),!0}async function a$(n,e={}){if(e={...e},n$(e.retries),Object.hasOwn(e,"forever"))throw new Error("The `forever` option is no longer supported. For many use-cases, you can set `retries: Infinity` instead.");e.retries??=10,e.factor??=2,e.minTimeout??=1e3,e.maxTimeout??=Number.POSITIVE_INFINITY,e.maxRetryTime??=Number.POSITIVE_INFINITY,e.randomize??=!1,e.onFailedAttempt??=()=>{},e.shouldRetry??=()=>!0,e.shouldConsumeRetry??=()=>!0,qf("factor",e.factor,{min:0,allowInfinity:!1}),qf("minTimeout",e.minTimeout,{min:0,allowInfinity:!1}),qf("maxTimeout",e.maxTimeout,{min:0,allowInfinity:!0}),qf("maxRetryTime",e.maxRetryTime,{min:0,allowInfinity:!0}),e.factor>0||(e.factor=1),e.signal?.throwIfAborted();let t=0,r=0;const i=performance.now();for(;!Number.isFinite(e.retries)||r<=e.retries;){t++;try{e.signal?.throwIfAborted();const o=await n(t);return e.signal?.throwIfAborted(),o}catch(o){await i$({error:o,attemptNumber:t,retriesConsumed:r,startTime:i,options:e})&&r++}}throw new Error("Retry attempts exhausted without throwing an error.")}async function Cy(n,e,{concurrency:t=Number.POSITIVE_INFINITY,stopOnError:r=!0,signal:i}={}){return new Promise((o,l)=>{if(n[Symbol.iterator]===void 0&&n[Symbol.asyncIterator]===void 0)throw new TypeError(`Expected \`input\` to be either an \`Iterable\` or \`AsyncIterable\`, got (${typeof n})`);if(typeof e!="function")throw new TypeError("Mapper function is required");if(!(Number.isSafeInteger(t)&&t>=1||t===Number.POSITIVE_INFINITY))throw new TypeError(`Expected \`concurrency\` to be an integer from 1 and up or \`Infinity\`, got \`${t}\` (${typeof t})`);const f=[],h=[],m=new Map;let y=!1,g=!1,b=!1,E=0,_=0;const S=n[Symbol.iterator]===void 0?n[Symbol.asyncIterator]():n[Symbol.iterator](),k=()=>{$(i.reason)},M=()=>{i?.removeEventListener("abort",k)},x=j=>{o(j),M()},$=j=>{y=!0,g=!0,l(j),M()};i&&(i.aborted&&$(i.reason),i.addEventListener("abort",k,{once:!0}));const L=async()=>{if(g)return;const j=await S.next(),W=_;if(_++,j.done){if(b=!0,E===0&&!g){if(!r&&h.length>0){$(new AggregateError(h));return}if(g=!0,m.size===0){x(f);return}const G=[];for(const[H,ie]of f.entries())m.get(H)!==P_&&G.push(ie);x(G)}return}E++,(async()=>{try{const G=await j.value;if(g)return;const H=await e(G,W);H===P_&&m.set(W,H),f[W]=H,E--,await L()}catch(G){if(r)$(G);else{h.push(G),E--;try{await L()}catch(H){$(H)}}}})()};(async()=>{for(let j=0;j<t;j++){try{await L()}catch(W){$(W);break}if(b||y)break}})()})}const P_=Symbol("skip");function o$(n){return n.hasParam("version")?A.Ok(n):A.Err(`missing version: ${n.toString()}`)}class Zw{_url;logger;sthis;gateway;get realGateway(){return this.gateway.innerGW}opts;loader;myId;constructor(e,t,r,i){if(this.myId=e.nextId().str,this._url=t,this.opts=r,this.loader=r.loader,this.sthis=e,!this._url.getParam(te.NAME))throw i.Error().Url(this._url).Msg("missing name").AsError();this.logger=i.With().Str("this",this.sthis.nextId().str).Ref("url",()=>this._url.toString()).Logger(),this.gateway=r.gateway}url(){return this._url}_id=new on;id(){return this._id.once(()=>Wk(this.url().toString()))}_onStarted=[];onStarted(e){this._onStarted.push(e)}_onClosed=[];onClosed(e){this._onClosed.push(e)}async ready(){}async keyedCrypto(){return u3(this._url,await this.loader.keyBag(),this.sthis)}async start(e){this.logger.Debug().Str("storeType",this.storeType).Msg("starting-gateway-pre"),this._url=this._url.build().setParam(te.STORE,this.storeType).URI();const t=await this.gateway.start({loader:this.loader},this._url);if(t.isErr())return this.logger.Error().Result("gw-start",t).Msg("started-gateway"),t;this._url=t.Ok();const i=await(await this.loader.keyBag()).ensureKeyFromUrl(this._url,()=>this._url.getParam(te.KEY));if(i.isErr())return i;this._url=i.Ok();const o=o$(this._url);if(o.isErr())return this.logger.Error().Result("version",o).Msg("guardVersion"),await this.close(),o;if(this.ready){const l=this.ready.bind(this),f=await Te(l);if(f.isErr())return await this.close(),f}return this._onStarted.forEach(l=>l(e)),this.logger.Debug().Msg("started"),o}}async function c$(n,e,t){return{eventCid:(await Fl.create({dbMeta:n.txt.encode(iO(e))},t)).cid,dbMeta:e,parents:t}}class l$ extends Zw{storeType="meta";subscribers=new Map;parents=[];constructor(e,t,r){super(e,t,{...r},Xe(e,"MetaStoreImpl"))}updateParentsFromDbMetas(e){const t=e.map(l=>l.eventCid),r=e.flatMap(l=>l.parents),i=new Map([...this.parents,...t].map(l=>[l.toString(),l])),o=new Set(r.map(l=>l.toString()));this.parents=Array.from(i.values()).filter(l=>!o.has(l.toString()))}cnt=0;stream(e="main"){let t=A.Ok(()=>{});return new ReadableStream({start:async r=>{this.cnt++,t=await this.gateway.subscribe({loader:this.loader},this.url(),async h=>{const m=h.payload.map(y=>y.dbMeta);r.enqueue(m),this.updateParentsFromDbMetas(h.payload)});const i=await this.gateway.buildUrl({loader:this.loader},this.url(),e);if(i.isErr()){this.logger.Error().Err(i).Msg("buildUrlError");return}const o=await this.gateway.get({loader:this.loader},i.Ok());if(o.isErr()){if(ci(o)){r.enqueue([]);return}r.error(this.logger.Error().Url(i.Ok()).Err(o).Msg("gateway get").AsError()),r.close()}const l=o.Ok().payload,f=l.map(h=>h.dbMeta);r.enqueue(f),this.updateParentsFromDbMetas(l)},cancel:r=>{r!=="close"&&this.logger.Warn().Any({reason:r}).Msg("unexpected meta stream end"),t.isOk()&&t.Ok()()}})}async save(e,t){t=t||"main",this.logger.Debug().Str("branch",t).Any("meta",e).Msg("saving meta");const r=await this.gateway.buildUrl({loader:this.loader},this.url(),t);if(r.isErr())throw this.logger.Error().Err(r.Err()).Str("branch",t).Msg("got error from gateway.buildUrl").AsError();const i=await c$(this.sthis,e,this.parents),o=await this.gateway.put({loader:this.loader},r.Ok(),{type:"meta",payload:[i]});if(o.isErr())throw this.logger.Error().Err(o.Err()).Msg("got error from gateway.put").AsError();return o}async close(){return await this.gateway.close({loader:this.loader},this.url()),this._onClosed.forEach(e=>e()),A.Ok(void 0)}async destroy(){return this.logger.Debug().Msg("destroy"),this.gateway.destroy({loader:this.loader},this.url())}}class pO extends Zw{constructor(e,t,r,i){super(e,t,{...r},i)}async load(e){this.logger.Debug().Any("cid",e).Msg("loading");const t=await this.gateway.buildUrl({loader:this.loader},this.url(),e.toString());if(t.isErr())throw this.logger.Error().Err(t.Err()).Str("cid",e.toString()).Msg("got error from gateway.buildUrl").AsError();const r=await this.gateway.get({loader:this.loader},t.Ok());if(r.isErr())throw r.Err();const i=r.Ok();switch(i.type){case"car":case"file":return{cid:e,bytes:i.payload};default:throw this.logger.Error().Msg("unexpected type").AsError()}}async save(e,t){this.logger.Debug().Any("cid",e.cid.toString()).Msg("saving");const r=await this.gateway.buildUrl({loader:this.loader},this.url(),e.cid.toString());if(r.isErr())throw this.logger.Error().Err(r.Err()).Ref("cid",e.cid).Msg("got error from gateway.buildUrl").AsError();let i;switch(r.Ok().getParam(te.STORE)){case"car":i=JP(e.bytes);break;case"file":i=WP(e.bytes);break;default:throw this.logger.Error().Str("store",r.Ok().getParam(te.STORE)).Msg("unexpected store").AsError()}if(i.isErr())throw this.logger.Error().Err(i).Msg("got error from FPMsg2Car").AsError();const o=await this.gateway.put({loader:this.loader},r.Ok(),i.Ok());if(o.isErr())throw this.logger.Error().Err(o.Err()).Msg("got error from gateway.put").AsError();return o.Ok()}async remove(e){const t=await this.gateway.buildUrl({loader:this.loader},this.url(),e.toString());return t.isErr()?t:this.gateway.delete({loader:this.loader},t.Ok())}async close(){return await this.gateway.close({loader:this.loader},this.url()),this._onClosed.forEach(e=>e()),A.Ok(void 0)}destroy(){return this.logger.Debug().Msg("destroy"),this.gateway.destroy({loader:this.loader},this.url())}}class u$ extends pO{storeType="car";constructor(e,t,r){super(e,t,{...r},Xe(e,"CarStoreImpl"))}}class f$ extends pO{storeType="file";constructor(e,t,r){super(e,t,{...r},Xe(e,"FileStoreImpl"))}}class h$ extends Zw{storeType="wal";_ready=new on;walState={operations:[],noLoaderOps:[],fileOperations:[]};processing;processQueue;constructor(e,t,r){super(e,t,{...r},Xe(e,"WALStoreImpl")),this.processQueue=r.loader.commitQueue}async ready(){return this._ready.once(async()=>{const e=await this.load().catch(t=>{this.logger.Error().Err(t).Msg("error loading wal")});this.walState.operations.splice(0,this.walState.operations.length),this.walState.fileOperations.splice(0,this.walState.fileOperations.length),e&&(this.walState.operations.push(...e.operations),this.walState.fileOperations.push(...e.fileOperations))})}async enqueue(e,t){await this.ready(),t.compact?(this.walState.operations.splice(0,this.walState.operations.length),this.walState.noLoaderOps.splice(0,this.walState.noLoaderOps.length),this.walState.noLoaderOps.push(e)):t.noLoader?this.walState.noLoaderOps.push(e):this.walState.operations.push(e),await this.save(this.walState),t.noLoader||this.process()}async enqueueFile(e,t=!1){await this.ready(),this.walState.fileOperations.push({cid:e,public:t})}async process(){await this.ready(),await this.processQueue.enqueue(async()=>{try{await this._doProcess()}catch(e){this.logger.Error().Any("error",e).Msg("error processing wal")}(this.walState.operations.length||this.walState.fileOperations.length||this.walState.noLoaderOps.length)&&setTimeout(()=>{this.process()},0)})}async _doProcess(){if(!this.loader)return;const e=[...this.walState.operations],t=[...this.walState.noLoaderOps],r=[...this.walState.fileOperations];if(e.length+t.length+r.length===0)return;const i=3,o=(l,f)=>a$(l,{retries:5,onFailedAttempt:h=>{this.logger.Warn().Any("error",h).Any("fn",l.toString()).Msg(`Attempt ${h.attemptNumber} failed for ${f}. There are ${h.retriesLeft} retries left.`)}});try{if(await Cy(t,async l=>{await o(async()=>{for(const f of l.cars)if(!await this.loader.attachedStores.local().active.car.load(f)&&_g(this.loader.carLog.asArray(),l.cars))throw this.logger.Error().Ref("cid",f).Msg("missing local car").AsError();dy(this.walState.noLoaderOps,f=>f!==l)},`noLoaderOp with dbMeta.cars=${l.cars.toString()}`)},{concurrency:i}),await Cy(e,async l=>{await o(async()=>{for(const f of l.cars)if(!await this.loader.attachedStores.local().active.car.load(f)&&_g(this.loader.carLog.asArray(),l.cars))throw this.logger.Error().Ref("cid",f).Msg("missing local car").AsError();dy(this.walState.operations,f=>f!==l)},`operation with dbMeta.cars=${l.cars.toString()}`)},{concurrency:i}),await Cy(r,async({cid:l})=>{await o(async()=>{if(!await this.loader.attachedStores.local().active.file.load(l))throw this.logger.Error().Ref("cid",l).Msg("missing file block").AsError();dy(this.walState.fileOperations,h=>h.cid!==l)},`fileOperation with cid=${l.toString()}`)},{concurrency:i}),e.length){const l=e[e.length-1];await o(async()=>{this.loader},`remoteMetaStore save with dbMeta.cars=${l.cars.toString()}`)}}catch(l){this.logger.Error().Any("error",l).Msg("Processing failed");return}finally{await this.save(this.walState)}}async load(){this.logger.Debug().Msg("loading");const e=await this.gateway.buildUrl({loader:this.loader},this.url(),"main");if(e.isErr())throw this.logger.Error().Err(e.Err()).Url(this.url()).Msg("error building url").AsError();const t=await this.gateway.get({loader:this.loader},e.Ok());if(t.isErr()){if(ci(t))return;throw this.logger.Error().Err(t.Err()).Msg("error get").AsError()}if(t.Ok().type!=="wal")throw this.logger.Error().Str("type",t.Ok().type).Msg("unexpected type").AsError();return t.Ok().payload}async save(e){const t=await this.gateway.buildUrl({loader:this.loader},this.url(),"main");if(t.isErr())throw this.logger.Error().Err(t.Err()).Url(this.url()).Msg("error building url").AsError();const r=await this.gateway.put({loader:this.loader},t.Ok(),{type:"wal",payload:e});if(r.isErr())throw this.logger.Error().Err(r.Err()).Str("filePath",t.Ok().toString()).Msg("error saving").AsError()}async close(){return await this.gateway.close({loader:this.loader},this.url()),this._onClosed.forEach(e=>e()),A.Ok(void 0)}destroy(){return this.logger.Debug().Msg("destroy"),this.gateway.destroy({loader:this.loader},this.url())}}const d$="v0.19-memory";function dl(n){return n.build().cleanParams(te.VERSION,te.NAME,te.STORE_KEY,te.SELF_REFLECT,te.LOCAL_NAME).URI()}class m${memories;sthis;constructor(e,t){this.memories=t,this.sthis=e}buildUrl(e,t){return Promise.resolve(A.Ok(e.build().setParam(te.KEY,t).URI()))}start(e){return Promise.resolve(A.Ok(e.build().setParam(te.VERSION,d$).URI()))}close(e){return Promise.resolve(A.Ok(void 0))}destroy(e){const t=dl(e),r=t.match(t);for(const i of this.memories.keys())t.match(i).score>=r.score&&this.memories.delete(i);return Promise.resolve(A.Ok(void 0))}async put(e,t,r){return e.getParam(te.STORE)==="car"&&Xe(r,"MemoryGatewayCar").Debug().Url(e).Msg("put-car"),e.getParam(te.STORE)==="meta"&&Xe(r,"MemoryGatewayMeta").Debug().Url(e).Msg("put-meta"),this.memories.set(dl(e).toString(),t),A.Ok(void 0)}get(e,t){const r=this.memories.get(dl(e).toString());if(!r)return Promise.resolve(A.Err(new Kr(`not found: ${e.toString()}`)));const i=Xe(t,"MemoryGateway");return e.getParam(te.STORE)==="meta"&&i.Debug().Url(e).Msg("get-meta"),e.getParam(te.STORE)==="car"&&i.Debug().Url(e).Msg("get-car"),Promise.resolve(A.Ok(r))}delete(e){return this.memories.delete(dl(e).toString()),Promise.resolve(A.Ok(void 0))}async getPlain(e,t){const r=this.memories.get(dl(e).build().setParam(te.KEY,t).toString());return r?A.Ok(r):A.Err(new Kr("not found"))}}const yO=it(["admin","owner","member"]),p$=it(["read","write"]),gO=re({id:I(),role:yO}).readonly(),wO=re({id:I(),role:yO,right:p$}).readonly(),Hr=re({appId:I().optional(),tenant:I(),ledger:I()}).readonly(),y$=eu.extend({userId:I(),email:kk(),nickname:I().optional(),provider:it(["github","google"]).optional(),created:mB(),tenants:ke(gO),ledgers:ke(wO),selected:Hr}).readonly(),g$=eu.extend({userId:I(),email:kk(),nickname:I().optional(),provider:it(["github","google"]).optional(),created:Xl([H4(),I().transform(n=>new Date(n)),Gt().transform(n=>new Date(n))]),tenants:ke(gO),ledgers:ke(wO),selected:Hr}).readonly(),wa="FP-MSG-1.0";function ln(n){return n.type==="error"}function My(n){const e=n?.trim();if(e==="meta"||e==="car"||e==="wal"||e==="file")return e;throw new Error(`Invalid FPStoreTypes: ${n}`)}function w$(n,e){return{storeTypes:["meta","file","car","wal"],httpEndpoints:["/fp"],wsEndpoints:["/ws"],encodings:["JSON"],protocolCapabilities:n.protocolCapabilities||["reqRes","stream"],auth:[],requiresAuth:!1,data:n.hasPersistent?{inband:!0,outband:!0}:void 0,meta:n.hasPersistent?{inband:!0,outband:!0}:void 0,wal:n.hasPersistent?{inband:!0,outband:!0}:void 0,reqTypes:["reqOpen","reqGestalt","reqSubscribeMeta","reqPutMeta","reqBindMeta","reqDelMeta","reqPutData","reqGetData","reqDelData","reqPutWAL","reqGetWAL","reqDelWAL","reqUpdateMeta"],resTypes:["resOpen","resGestalt","resSubscribeMeta","resPutMeta","resGetMeta","resDelMeta","resPutData","resGetData","resDelData","resPutWAL","resGetWAL","resDelWAL","updateMeta"],eventTypes:["updateMeta"],...e}}function b$(n,e,t,r){return{tid:n.nextId().str,auth:e,type:"reqGestalt",version:wa,gestalt:t,publish:r}}function $_(n){return n.type==="resGestalt"}function bO(n,e,t){return{tid:n.nextId().str,auth:e,type:"reqOpen",version:wa,conn:{...t,reqId:t.reqId||n.nextId().str}}}function Jw(n){const e=n.conn;return e&&!!e.reqId&&!!e.resId}function v$(n){return Jw(n)&&!!n.auth&&typeof n.auth.type=="string"}function K_(n,e){return Jw(n)&&n.conn.reqId===e.reqId&&n.conn.resId===e.resId}function S$(n){return n.type==="resOpen"}function E$(n,e,t){return{tid:n.nextId().str,auth:e,type:"reqClose",version:wa,conn:t}}function ar(n,e,t,r,i){!i&&n.sthis.env.get("FP_STACK")&&(i=t.stack?.split(`
`));const o={auth:e.auth||{type:"error"},src:e,type:"error",tid:e.tid||"internal",message:t.message,version:wa,body:r,stack:i};return n.logger.Any("ErrorMsg",o),o}function _$(n){if(v$(n)){const e=n.tenant;return!!e&&!!e.tenant&&!!e.ledger}return!1}const A$=re({type:ge("ucan"),params:re({tbd:I()}).readonly()}).readonly(),k$=re({type:ge("fp-cloud-jwk"),params:re({jwk:I()}).readonly()}).readonly(),vO=re({alg:I(),issuer:I(),audience:I(),validFor:Gt()});vO.readonly();const T$=y$.and(vO.partial()).readonly(),O$=re({type:ge("fp-cloud"),params:re({claim:T$,jwk:I()}).readonly()}).readonly(),C$=re({type:ge("error")}).readonly(),M$=re({type:ge("device-id"),params:re({sessionToken:I()}).readonly()}).readonly(),sc=gw("type",[A$,k$,O$,M$,C$]),Zt=re({reqId:I(),resId:I()}),Mn=re({tid:I(),type:I(),version:I(),auth:sc});Mn.readonly();const SO=re({storeTypes:ke(it(["meta","car","wal","file"])),id:I(),protocolCapabilities:ke(it(["reqRes","stream"])),httpEndpoints:ke(I()),wsEndpoints:ke(I()),encodings:ke(it(["JSON","CBOR"])),auth:ke(sc),requiresAuth:Er(),data:re({inband:Er(),outband:Er()}).optional(),meta:re({inband:ge(!0),outband:Er()}).optional(),wal:re({inband:Er(),outband:Er()}).optional(),reqTypes:ke(I()),resTypes:ke(I()),eventTypes:ke(I())}),iu=re({method:it(["GET","PUT","DELETE"]),store:it(["meta","car","wal","file"])}),ic=re({path:I().optional(),key:I(),expires:Gt().optional(),index:I().optional()}),N$=re({methodParam:iu}),R$=re({urlParam:ic});N$.and(R$);Mn.extend({type:ge("reqChat"),conn:Zt,message:I(),targets:ke(Zt)}).readonly();Mn.extend({type:ge("resChat"),conn:Zt,message:I(),targets:ke(Zt)}).readonly();Mn.extend({type:ge("reqGestalt"),gestalt:SO,publish:Er().optional()}).readonly();Mn.extend({type:ge("resGestalt"),gestalt:SO}).readonly();const D$=re({reqId:I(),resId:I().optional()}).readonly();Mn.extend({type:ge("reqOpen"),conn:D$}).readonly();Mn.extend({type:ge("resOpen"),conn:Zt}).readonly();Mn.extend({type:ge("reqClose"),conn:Zt}).readonly();Mn.extend({type:ge("resClose"),conn:Zt}).readonly();re({conn:Zt,auth:sc}).readonly();const x$=re({type:ge("error"),src:Kl(),message:I(),body:I().optional(),stack:ke(I()).optional(),conn:Zt.partial().optional(),tid:I(),version:I(),auth:sc}).readonly(),I$=re({type:ge("error"),src:ge("not-ready"),message:ge("Not Ready"),reason:ge("not-ready"),body:I().optional(),stack:ke(I()).optional(),conn:Zt.partial().optional(),tid:I(),version:I(),auth:sc}).readonly();Xl([x$,I$]);re({connIds:ke(I())}).readonly();re({mime:I(),auth:sc.optional(),hasPersistent:Er().optional(),protocolCapabilities:ke(it(["reqRes","stream"])).optional(),timeout:Gt()}).readonly();re({tid:I().optional(),conn:Zt,tenant:Hr}).readonly();re({tid:I().optional(),conn:Zt.partial(),tenant:Hr}).readonly();re({tid:I().optional(),conn:Zt,tenant:Hr}).readonly();const Nn=Mn.extend({conn:Zt,tenant:Hr,methodParam:iu,urlParam:ic,signedUrl:I()}),U$=Mn.extend({conn:Zt,tenant:Hr,urlParam:ic,methodParam:iu,signedUrl:I().optional()});function z$(n){return n.type==="resGetData"&&_$(n)}function L$(n){return n.type==="resPutData"}function Ag(n){return n.type==="resDelData"}Nn.extend({type:ge("reqGetData")});Nn.extend({type:ge("resGetData")});Nn.extend({type:ge("reqPutData")});Nn.extend({type:ge("resPutData")});Nn.extend({type:ge("reqDelData")});Nn.extend({type:ge("resDelData")});function B$(n,e,t,r,i){return{auth:e,type:"reqPutMeta",...i,tid:i.tid??n.nextId().str,version:wa,methodParam:{method:"PUT",store:"meta"},urlParam:t,meta:r}}function P$(n){return n.type==="resPutMeta"}function $$(n,e,t,r){return{auth:e,...r,tid:r.tid??n.nextId().str,type:"bindGetMeta",version:wa,...t}}function j_(n){return n.type==="eventGetMeta"}function K$(n,e,t,r,i){return{auth:e,tid:n.nextId().str,tenant:r.tenant,conn:r.conn,urlParam:t,meta:i,type:"reqDelMeta",version:wa}}const au=yw();Mn.extend({type:ge("reqPutMeta"),conn:Zt.partial().optional(),tenant:Hr,methodParam:iu,urlParam:ic,meta:au});re({type:ge("resPutMeta"),meta:au});Nn.extend({type:ge("resPutMeta"),meta:au});Mn.extend({type:ge("bindGetMeta"),conn:Zt.partial().optional(),tenant:Hr,methodParam:iu,urlParam:ic});Nn.extend({type:ge("eventGetMeta"),meta:au});Mn.extend({type:ge("reqDelMeta"),conn:Zt.partial().optional(),tenant:Hr,urlParam:ic,meta:au.optional()});U$.extend({type:ge("resDelMeta")});Nn.extend({type:ge("reqGetWAL")});Nn.extend({type:ge("resGetWAL")});Nn.extend({type:ge("reqPutWAL")});Nn.extend({type:ge("resPutWAL")});Nn.extend({type:ge("reqDelWAL")});Nn.extend({type:ge("resDelWAL")});class EO{sthis;exchangedGestalt;constructor(e,t){this.sthis=e,this.exchangedGestalt=t}onErrorFns=new Map;onError(e){const t=this.sthis.nextId().str;return this.onErrorFns.set(t,e),()=>this.onErrorFns.delete(t)}buildErrorMsg(e,t,r){const i=Array.from(this.onErrorFns.values()).reduce((l,f)=>f(l,r),t),o=ar(e,i,r);return e.logger.Error().Err(r).Any("msg",i).Msg("connection error"),o}}class j${waitForTids=new Map;start(e,t,r){let i;typeof r.timeout=="number"&&r.timeout>0&&(i=setTimeout(()=>{this.waitForTids.delete(r.tid),r.future.resolve(ar({logger:t,sthis:e},{tid:r.tid},t.Error().Any({tid:r}).Msg("Timeout").AsError()))},r.timeout)),this.waitForTids.set(r.tid,{opts:r,timeout:i})}stop(e){const t=this.waitForTids.get(e);t&&(t.timeout&&clearTimeout(t.timeout),this.waitForTids.delete(e))}resolve(e){const t=this.waitForTids.get(e.tid);if(t)return t.opts.waitFor(e)&&(t.timeout&&clearTimeout(t.timeout),t.opts.future.resolve(e)),t}}const H$=1e3;class q$ extends EO{logger;msgP;ws;#e=new Map;#t=new Map;waitForTid=new j$;id;isReady=!1;constructor(e,t,r,i){super(e,i),this.id=e.nextId().str,this.logger=Xe(e,"WSConnection"),this.msgP=r,this.ws=t}async start(){const e=new On,t=setTimeout(()=>{const i=this.logger.Error().Dur("timeout",this.msgP.timeout).Msg("Timeout").AsError();this.toMsg(ar(this,{},i)),e.resolve(A.Err(i))},this.msgP.timeout);this.ws.onopen=()=>{this.isReady=!0,e.resolve(A.Ok(void 0))},this.ws.onerror=i=>{const o=this.logger.Error().Err(i).Msg("WS Error").AsError();e.resolve(A.Err(o));const l=this.buildErrorMsg(this,{},o);this.toMsg(l)},this.ws.onmessage=i=>{this.isReady||this.toMsg(ar(this,{},this.logger.Error().Msg("Received message before onOpen").AsError())),this.#n(i)},this.ws.onclose=()=>{this.isReady=!1,this.close().catch(i=>{const o=this.logger.Error().Err(i).Msg("close error").AsError();e.resolve(A.Err(o)),this.toMsg(ar(this,{tid:"internal"},o))})};const r=await e.asPromise().finally(()=>{clearTimeout(t)});return r.isErr()?r:A.Ok(void 0)}#n=async e=>{const t=await Te(async()=>this.msgP.ende.decode(await BA(e.data)));if(t.isErr()){this.logger.Error().Err(t).Any({event:e}).Msg("Invalid message");return}const r=t.Ok();this.waitForTid.resolve(r),Array.from(this.#e.values()).forEach(i=>{i(r)})};async close(){return this.#t.forEach(e=>e()),this.#t.clear(),this.#e.clear(),this.ws.close(),A.Ok(void 0)}toMsg(e){return this.#e.forEach(t=>t(e)),e}send(e){return this.ws.send(this.msgP.ende.encode(e)),Promise.resolve(e)}onMsg(e){const t=this.sthis.nextId().str;return this.#e.set(t,e),()=>this.#e.delete(t)}onClose(e){const t=this.sthis.nextId().str;return this.#t.set(t,e),()=>this.#t.delete(t)}activeBinds=new Map;bind(e,t){const r={id:this.sthis.nextId().str,bind:{msg:e,opts:t},controller:void 0};return this.activeBinds.set(r.id,r),new ReadableStream({cancel:()=>{this.activeBinds.delete(r.id)},start:o=>{r.controller=o,this.onMsg(f=>{try{if(ln(f)){o.enqueue(f);return}t.waitFor?t.waitFor(f)&&o.enqueue(f):o.enqueue(f)}catch(h){this.logger.Error().Err(h).Any({msg:f}).Msg("Error in onMsg callback[ignored]")}}),this.send(e);const l=new On;this.waitForTid.start(this.sthis,this.logger,{tid:e.tid,future:l,waitFor:t.waitFor}),l.asPromise().then(f=>{ln(f)&&(o.enqueue(f),o.close())})}})}async request(e,t){const r=new On;return this.waitForTid.start(this.sthis,this.logger,{tid:e.tid,future:r,waitFor:t.waitFor,timeout:t.timeout??H$}),await this.send(e),r.asPromise()}}function _O(n){return n[Math.floor(Math.random()*n.length)]}function F$(n,e){return new Promise((t,r)=>{const i=setTimeout(()=>{r(new Error(`TIMEOUT after ${n}ms`))},n);e.then(t).catch(r).finally(()=>clearTimeout(i))})}function AO(n){return{encode:e=>n.txt.encode(JSON.stringify(e)),decode:e=>JSON.parse(n.txt.decode(e))}}function Ny(n,e){return{mime:"application/json",ende:AO(n),timeout:3e3,protocolCapabilities:["reqRes","stream"],...e}}async function No(n,e){const t=Fe.from(e),r=t.getParam("authJWK");return r?A.Ok({type:"fp-cloud-jwk",params:{jwk:r}}):n.Error().Url(t).Msg("authJWK is required").ResultError()}function V$(n){let e=Fe.from(n);return["","/"].includes(e.pathname)&&(e=e.build().appendRelative("/fp").URI()),e}class G${static connect(e,t,r){const i=new J$(e,{curl:t,conn:r.conn,openWSorHttp:r.mowh,msgerParams:r.msgerParam??{}});return Promise.resolve(A.Ok(i))}constructor(){}}class Z${async openHttp(e,t,r,i){return A.Ok(new Y$(e,t,r,i))}async openWS(e,t,r,i){t=t.build().defParam("random",e.nextId().str).URI();const o=kO(t,"ws");let l;if(jn().isNodeIsh){const{WebSocket:h}=await Bo(async()=>{const{WebSocket:m}=await Promise.resolve().then(()=>pH);return{WebSocket:m}},void 0);l=()=>new h(o)}else l=()=>new WebSocket(o);const f=new q$(e,l(),r,i);return A.Ok(f)}}class J${sthis;opts;mowh;logger;id;exchangedGestalt;realConn;retries=[];virtualConn;constructor(e,t){this.sthis=e,this.id=e.nextId().str,this.logger=Xe(e,"VirtualConnected"),this.opts={...t,openWSorHttp:t.openWSorHttp||new Z$,retryCount:t.retryCount||3,retryDelay:t.retryDelay||500,conn:{reqId:e.nextId().str,...t.conn}},this.mowh=this.opts.openWSorHttp}get conn(){if(!this.virtualConn)throw new Error("conn is not set");return this.virtualConn}activeBinds=new Map;async handleBindRealConn(e,t,r){const i={...this.conn,...t.conn},l=e.bind({...r.bind.msg,auth:t.auth,conn:i},r.bind.opts).getReader();for(;;){const{done:f,value:h}=await l.read();if(f)return;try{(K_(h,this.conn)||K_(h,i))&&r.controller?.enqueue(h)}catch(m){this.sthis.logger.Error().Err(m).Any({msg:h}).Msg("Error in handleBindRealConn callback[ignored]")}}}ensureOpts(e){return{...e,timeout:e.timeout??this.opts.msgerParams.timeout??3e3}}bind(e,t){const r=this.ensureOpts(t),i=this.sthis.nextId().str;return new ReadableStream({cancel:o=>{this.sthis.logger.Debug().Msg("vc-bind-cancel",i,o),this.activeBinds.delete(i)},start:o=>{this.getRealConn(e,r,async l=>{const f={id:i,bind:{msg:e,opts:r},controller:o};return this.activeBinds.set(i,f),this.handleBindRealConn(l,e,f),A.Ok(void 0)}).catch(l=>{o.error({type:"error",src:"VirtualConnection:bind",message:l.message,tid:e.tid,version:e.version,auth:e.auth,stack:[]})})}})}request(e,t){const r=this.ensureOpts(t),i=o=>o.request({...e,conn:{...this.virtualConn,...e.conn}},r);return r.rawConn?i(r.rawConn):this.getRealConn(e,r,i)}send(e){return this.getRealConn(e,{waitFor:()=>!0},async t=>{const r={...e,conn:{...this.conn,...e.conn}};return await t.send(r)})}close(e){return this.getRealConn(e,{waitFor:()=>!0,noRetry:!0},t=>t.close(e))}onMsg(e){throw new Error("Method not implemented.")}async connect(e,t,r={}){const i=Ny(this.sthis,{...r,mime:"application/json",ende:AO(this.sthis)}),o=V$(t),l=w$(Ny(this.sthis,r),{id:"FP-Universal-Client"}),f=await this.mowh.openHttp(this.sthis,[o],i,{my:l,remote:l});if(f.isErr())return f;const h=f.Ok(),m=await h.request(b$(this.sthis,e,l),{waitFor:$_,noConn:!0});if(!$_(m))return this.logger.Error().Any({resGestalt:m}).Msg("should be ResGestalt").ResultError();await h.close(m);const y={my:l,remote:m.gestalt},g=Ny(this.sthis,r);this.exchangedGestalt=y;let b;if(y.remote.protocolCapabilities.includes("reqRes")&&!y.remote.protocolCapabilities.includes("stream"))b=await this.mowh.openHttp(this.sthis,y.remote.httpEndpoints.map(S=>an.from(t).resolve(S).URI()),g,y);else{const S=an.from(o).resolve(_O(y.remote.wsEndpoints)).URI();b=await this.mowh.openWS(this.sthis,S,g,y)}if(b.isErr())return b;const _=await b.Ok().start();return _.isErr()?A.Err(_):b}async getQSIdWithSideEffect(e,t,r){const i=await this.request(bO(this.sthis,t.auth,r),{waitFor:S$,noConn:!0,rawConn:e});return ln(i)||(this.virtualConn=i.conn),i}mutex=bg(1);async getRealConn(e,t,r){const i=this.ensureOpts(t),o=await this.mutex(async()=>{if(this.realConn){if(!this.realConn.isReady)return await this.realConn.close(e),this.realConn=void 0,this.retries=[],{whatToDo:"recurse"};if(!i.noConn&&!this.virtualConn){const l=Jw(e)?{conn:e.conn}:{};return{whatToDo:"return",value:{type:"error",src:e,message:"virtualConn is not set",tid:e.tid,...l,version:e.version,auth:e.auth,stack:[]}}}return{whatToDo:"action"}}else{if(this.retries.length>=this.opts.retryCount)return{whatToDo:"return",value:{type:"error",src:"VirtualConnection:getRealConn",message:"retry count exceeded",tid:e.tid,version:e.version,auth:e.auth,stack:[]}};const l=await this.connect(e.auth,this.opts.curl,this.opts.msgerParams);if(l.isErr())return this.retries.push({retryCount:this.retries.length+1}),await HB(this.opts.retryDelay*this.retries.length),{whatToDo:"recurse"};this.realConn=l.Ok();const f=await this.getQSIdWithSideEffect(this.realConn,e,{reqId:this.sthis.nextId().str,...this.virtualConn,...this.opts.conn});if(ln(f))return{whatToDo:"return",value:{...f,tid:e.tid}};for(const h of this.activeBinds.values())this.handleBindRealConn(this.realConn,e,h);return{whatToDo:"recurse"}}});switch(o.whatToDo){case"recurse":return this.getRealConn(e,i,r);case"return":return o.value;case"action":if(!this.realConn)throw new Error("realConn is not set, this should not happen");return r(this.realConn);default:throw new Error(`Unknown action: ${o.whatToDo} for msg: ${e.type} with id: ${this.id}`)}}}function W$(n){const e=(n.getParam("protocol")??n.protocol).replace(/:$/,""),t=n.build();switch(e){case"ws":case"http":t.protocol("http");break;default:t.protocol("https");break}return t.URI()}function kO(n,e){const t=n.pathname.replace(/\/$/,"").replace(/^\//,""),r=n.build();return t===""&&r.appendRelative(e),r.toString()}class Y$ extends EO{logger;msgP;baseURIs;#e=new Map;isReady=!0;constructor(e,t,r,i){super(e,i),this.logger=Xe(e,"HttpConnection"),this.baseURIs=t.map(o=>({in:o,cleaned:W$(o)})),this.msgP=r}send(e){throw new Error("Method not implemented.")}async start(){return A.Ok(void 0)}async close(){return await Promise.all(Array.from(this.activeBinds.values()).map(e=>e.controller?.close())),this.#e.clear(),A.Ok(void 0)}toMsg(e){return this.#e.forEach(t=>t(e)),e}onMsg(e){const t=this.sthis.nextId().str;return this.#e.set(t,e),()=>this.#e.delete(t)}#t(e){this.request(e.bind.msg,e.bind.opts).then(t=>{try{e.controller?.enqueue(t),ln(t)?e.controller?.close():e.timeout=setTimeout(()=>this.#t(e),e.bind.opts.pollInterval??1e3)}catch(r){e.controller?.error(r),e.controller?.close()}}).catch(t=>{e.controller?.error(t)})}activeBinds=new Map;bind(e,t){const r={id:this.sthis.nextId().str,bind:{msg:e,opts:t}};return this.activeBinds.set(r.id,r),new ReadableStream({cancel:()=>{clearTimeout(r.timeout),this.activeBinds.delete(r.id)},start:i=>{r.controller=i,this.#t(r)}})}async request(e,t){const r=ni.from();r.Set("Content-Type",this.msgP.mime),r.Set("Accept",this.msgP.mime);const i=Te(()=>this.msgP.ende.encode(e));if(i.isErr())return this.toMsg(ar(this,e,this.logger.Error().Err(i.Err()).Any("req",e).Msg("encode error").AsError()));r.Set("Content-Length",i.Ok().byteLength.toString());const o=_O(this.baseURIs);this.logger.Debug().Any(o).Any("body",e).Msg("request");const l=await Te(()=>F$(this.msgP.timeout,fetch(kO(o.cleaned,"fp"),{method:"PUT",headers:r.AsHeaderInit(),body:i.Ok()})));if(this.logger.Debug().Any(o).Any("body",l).Msg("response"),l.isErr())return this.toMsg(ar(this,e,this.logger.Error().Err(l).Any(o).Msg("fetch error").AsError()));const f=l.Ok();if(!f.ok){const y=new Uint8Array(await f.arrayBuffer()),g=await Te(async()=>this.msgP.ende.decode(y));return g.isErr()||!ln(g.Ok())?this.toMsg(ar(this,e,this.logger.Error().Any(o).Str("status",f.status.toString()).Str("statusText",f.statusText).Msg("HTTP Error").AsError(),await f.text().catch(()=>"no body"))):this.toMsg(g.Ok())}const h=new Uint8Array(await f.arrayBuffer()),m=await Te(async()=>this.msgP.ende.decode(h));return m.isErr()?this.toMsg(ar(this,e,this.logger.Error().Err(m.Err()).Msg("decode error").AsError(),this.sthis.txt.decode(h))):this.toMsg(m.Ok())}}const TO="v0.1-fp-cloud";class Ww{logger;sthis;constructor(e,t){this.sthis=e,this.logger=Xe(e,t)}async buildReqSignedUrl(e,t,r,i,o){const l=i.getParamsResult({key:rn.REQUIRED,store:rn.REQUIRED,path:rn.OPTIONAL,tenant:rn.REQUIRED,ledger:rn.REQUIRED,name:rn.REQUIRED,index:rn.OPTIONAL});if(l.isErr())return ar(this,{},l.Err());const f=l.Ok();if(r!==f.store)return ar(this,{},new Error("store mismatch"));const h=await No(this.logger,i);return h.isErr()?ar(this,{},h.Err()):{tid:this.sthis.nextId().str,auth:h.Ok(),type:e,conn:{...o.conn.Ok().opts.conn},tenant:{tenant:f.tenant,ledger:f.ledger},methodParam:{method:t,store:r},urlParam:{...f,key:f.key},version:TO}}async getReqSignedUrl(e,t,r,i,o,l){const f=await this.buildReqSignedUrl(e,t,r,o,l);return ln(f)?f:l.conn.Ok().request(f,{waitFor:i})}async putObject(e,t,r,i){this.logger.Debug().Any("url",{uploadUrl:t,uri:e}).Msg("put-fetch-url");const o=await Te(async()=>fetch(t,{method:"PUT",body:r}));return o.isErr()?this.logger.Error().Url(t,"uploadUrl").Err(o).Msg("Expection in put fetch").ResultError():o.Ok().ok?(await o.Ok().arrayBuffer(),e.getParam("testMode")&&i.citem.trackPuts.add(e.toString()),A.Ok(void 0)):this.logger.Error().Url(t,"uploadUrl").Http(o.Ok()).Msg("Status in put fetch").ResultError()}async getObject(e,t,r){this.logger.Debug().Any("url",{downloadUrl:t,uri:e}).Msg("get-fetch-url");const i=await Te(async()=>fetch(t.toString(),{method:"GET"}));if(i.isErr())return this.logger.Error().Url(t,"downloadUrl").Err(i).Msg("Error in get downloadUrl").ResultError();const o=i.Ok();return o.ok?A.Ok(id(await o.arrayBuffer())):o.status===404?A.Err(new Kr("Not found")):this.logger.Error().Url(t,"downloadUrl").Err(i).Msg("Error in get fetch").ResultError()}async delObject(e,t,r){this.logger.Debug().Any("url",{deleteUrl:t,uri:e}).Msg("get-fetch-url");const i=await Te(async()=>fetch(t.toString(),{method:"DELETE"}));if(i.isErr())return this.logger.Error().Url(t,"deleteUrl").Err(i).Msg("Error in get deleteURL").ResultError();const o=i.Ok();return o.ok?A.Ok(void 0):o.status===404?A.Err(new Kr("Not found")):this.logger.Error().Url(t,"deleteUrl").Err(i).Msg("Error in del fetch").ResultError()}}class Q$ extends Ww{constructor(e){super(e,"Cloud-DataGateway")}async get(e,t){const r=My(t.getParam("store")),i=await this.getReqSignedUrl("reqGetData","GET",r,z$,t,e.conn);if(ln(i))return this.logger.Error().Err(i).Msg("Error in buildResSignedUrl").ResultError();const{signedUrl:o}=i;return await qw(this.sthis,t,this.getObject(t,o,e.conn))}async put(e,t,r){const i=My(t.getParam("store")),o=await this.getReqSignedUrl("reqPutData","PUT",i,L$,t,e.conn);if(ln(o))return this.logger.Error().Err(o).Msg("Error in buildResSignedUrl").ResultError();const{signedUrl:l}=o,f=await oO(e.loader.sthis,r);return f.isErr()?f:await this.putObject(t,l,f.Ok(),e.conn)}async delete(e,t){const r=My(t.getParam("store")),i=await this.getReqSignedUrl("reqDelData","DELETE",r,Ag,t,e.conn);if(ln(i))return this.logger.Error().Err(i).Msg("Error in buildResSignedUrl").ResultError();const{signedUrl:o}=i;return this.delObject(t,o,e.conn)}}function Ry(n,e){const t=e.getParamsResult({tid:rn.OPTIONAL,tenant:rn.REQUIRED,ledger:rn.REQUIRED});if(t.isErr())return A.Err(t);const r=t.Ok();return A.Ok({tid:r.tid,conn:n,tenant:{tenant:r.tenant,ledger:r.ledger}})}class X${boundGetMeta=new Mt;currentMeta=new Mt;valueReady=new On;value;subscriptions;constructor(e){this.subscriptions=e}async get(e,t,r,i){const o=mi(e.conn.conn.Ok());return this.boundGetMeta.get(o).once(async()=>{const h=e.conn.conn.Ok().bind($$(e.loader.sthis,t,r,i),{waitFor:j_}).getReader();for(;;){const{done:m,value:y}=await h.read();if(m)break;if(ln(y)){e.loader.logger.Error().Err(y).Msg("Error in bindGetMeta"),this.valueReady.resolve(),this.valueReady=new On,this.currentMeta.get(o).reset();return}if(j_(y)){const g=await a5(e,y.meta),b=await cO(e.loader.sthis,g);let E;if(b.isErr()?E=A.Err(b):E=A.Ok({type:"meta",payload:b.Ok()}),this.value=E,this.valueReady.resolve(),this.valueReady=new On,this.currentMeta.get(o).reset(),E.isOk())for(const _ of this.subscriptions.values())await _(E.Ok())}}e.loader.logger.Error().Msg("Error bind should not end")}).catch(f=>{e.loader.logger.Error().Err(f).Msg("Error in bindGetMeta")}),this.currentMeta.get(o).once(async()=>{this.value||await this.valueReady.asPromise();const f=this.value;return f||e.loader.logger.Error().Msg("No value").ResultError()})}}class eK extends Ww{subscriptions=new Map;currentMeta=new X$(this.subscriptions);constructor(e){super(e,"Cloud-MetaGateway")}async subscribe(e,t,r){const i=e.loader.sthis.nextId().str,o=()=>{this.subscriptions.delete(i)};return this.subscriptions.set(i,r),A.Ok(o)}async get(e,t){const r=await this.buildReqSignedUrl("bindGetMeta","GET","meta",t,e.conn);if(ln(r))return this.logger.Error().Err(r).Msg("Error in buildReqSignedUrl").ResultError();const i=Ry(e.conn.conn.Ok().opts.conn,t);if(i.isErr())return A.Err(i);const o=await No(this.logger,t);if(o.isErr())return A.Err(o);const l=await this.currentMeta.get(e,o.Ok(),r,i.Ok());return l.isErr()?A.Err(l):A.Ok(l.Ok())}async put(e,t,r){const i=r,o=await this.buildReqSignedUrl("reqPutMeta","PUT","meta",t,e.conn);if(ln(o))return this.logger.Error().Err(o).Msg("Error in buildReqSignedUrl").ResultError();const l=Ry(e.conn.conn.Ok().opts.conn,t);if(l.isErr())return A.Err(l);const f=await No(this.logger,t);if(f.isErr())return A.Err(f);const h=await aO(e.loader.sthis,i.payload),m=await c5(e,h);if(m.isErr())return m;const y=B$(e.loader.sthis,f.Ok(),o.urlParam,m.Ok(),l.Ok()),g=await e.conn.conn.Ok().request(y,{waitFor:P$});return ln(g)?this.logger.Error().Err(g).Msg("Error in buildResSignedUrl").ResultError():A.Ok(void 0)}async delete(e,t){const r=await this.getReqSignedUrl("reqDelMeta","DELETE","meta",Ag,t,e.conn);if(ln(r))return this.logger.Error().Err(r).Msg("Error in buildReqSignedUrl").ResultError();const i=Ry(e.conn.conn.Ok().opts.conn,t);if(i.isErr())return A.Err(i);const o=await No(this.logger,t);if(o.isErr())return A.Err(o);const l=K$(e.loader.sthis,o.Ok(),r.urlParam,i.Ok()),f=await e.conn.conn.Ok().request(l,{waitFor:Ag});return ln(f)?this.logger.Error().Err(f).Msg("Error in buildResSignedUrl").ResultError():A.Ok(void 0)}}class tK extends Ww{wals=new Map;constructor(e){super(e,"Cloud-WALGateway")}getWalKeyFromUri(e){const t=e.getParamsResult({key:0,name:0});if(t.isErr())return A.Err(t.Err());const{name:r,key:i}=t.Ok();return A.Ok(`${r}:${i}`)}async get(e,t){const r=this.getWalKeyFromUri(t);if(r.isErr())return A.Err(r.Err());const i=this.wals.get(r.Ok());return i?A.Ok(i):A.Err(new Kr("Not found"))}async put(e,t,r){const i=this.getWalKeyFromUri(t);return i.isErr()?A.Err(i.Err()):(this.wals.set(i.Ok(),r),A.Ok(void 0))}async delete(e,t){const r=this.getWalKeyFromUri(t);return r.isErr()?A.Err(r.Err()):(this.wals.delete(r.Ok()),A.Ok(void 0))}}const Dy=new Mt;function Ff(n,e){const t=e.getParam("store");switch(t){case"file":case"car":return Dy.get(t).once(()=>new Q$(n));case"meta":return Dy.get(t).once(()=>new eK(n));case"wal":return Dy.get(t).once(()=>new tK(n));default:throw Xe(n,"getStoreTypeGateway").Error().Str("store",t).Msg("Invalid store type").ResultError()}}const nK=new Map;class rK{logger;sthis;#e=new Mt;constructor(e){this.sthis=e,this.logger=Xe(e,"CloudGateway",{this:!0})}async buildUrl(e,t,r){return A.Ok(t.build().setParam("key",r).URI())}async start(e,t){await this.sthis.start();const r=t.build().defParam("version",TO);r.defParam("protocol","wss");const i=r.URI();return this.registerConnectionURI(i,()=>({connection:new on,trackPuts:new Set})),A.Ok(i)}async get(e,t){const r=await this.getCloudConnectionItem(e.loader.logger,t);return r.conn.isErr()?A.Err(r.conn):await Ff(e.loader.sthis,t).get({...e,conn:r},t)}async put(e,t,r){const i=await this.getCloudConnectionItem(e.loader.logger,t);if(i.conn.isErr())return i.conn;const o=await Ff(e.loader.sthis,t).put({...e,conn:i},t,r);return o.isOk()&&t.getParam("testMode")&&i.citem.trackPuts.add(t.toString()),o}async delete(e,t){const r=await this.getCloudConnectionItem(e.loader.logger,t);return r.conn.isErr()?r.conn:(r.citem.trackPuts.delete(t.toString()),Ff(e.loader.sthis,t).delete({...e,conn:r},t))}async close(e,t){const r=t.toString();for(const f of Array.from(nK.values()))for(const h of f)h.uri.toString()===r&&h.unsub();const i=await this.getCloudConnectionItem(e.loader.logger,t);if(i.conn.isErr())return this.logger.Error().Err(i).Msg("Error in getCloudConnection").ResultError();const o=i.conn.Ok(),l=await No(this.logger,t);return l.isErr()?this.logger.Error().Err(l).Msg("Error in authTypeFromUri").ResultError():await o.close(E$(this.sthis,l.Ok(),o.conn)),this.#e.unget(this.matchURI(t)()),A.Ok(void 0)}matchURI(e){let t=e.getParam("protocol","https");switch(t){case"wss":t="https";break;case"ws":t="http";break;case"http":break;default:t="https";break}const r=an.from(e).cleanParams().protocol(t).URI().toString();return()=>r}registerConnectionURI(e,t){this.#e.get(this.matchURI(e)).once(t)}async getCloudConnectionItem(e,t){const r=this.#e.get(this.matchURI(t)),i=r.value;return!r.ready||!i?{conn:e.Error().Url(t).Msg("Connection not ready").ResultError(),citem:{}}:{conn:await i.connection.once(async()=>{const l=t.getParamsResult({protocol:"https"});if(l.isErr())return this.logger.Error().Url(t).Err(l).Msg("getCloudConnection:err").ResultError();const f=l.Ok(),h=await No(this.logger,t);if(h.isErr())return A.Err(h);const m=bO(this.sthis,h.Ok(),{}),y=t.build().protocol(f.protocol).cleanParams().URI();return G$.connect(this.sthis,y,m)}),citem:i}}async subscribe(e,t,r){return Ff(e.loader.sthis,t).subscribe(e,t,r)}async destroy(e,t){const r=await this.getCloudConnectionItem(e.loader.logger,t);return r.conn.isErr()?r.conn:(await Promise.all(Array.from(r.citem.trackPuts).map(async i=>this.delete(e,Fe.from(i)))),A.Ok(void 0))}async getPlain(){return A.Err(new Error("Not implemented"))}}class sK{tc;constructor(e){let t;try{const r=wd(e),i=g$.safeParse(r);if(i.success)t=i.data;else throw i.error}catch{t={userId:"test",email:"test@test.de",created:new Date,tenants:[{id:"test",role:"admin"}],ledgers:[{id:"test",role:"admin",right:"write"}],selected:{tenant:"test",ledger:"test"}}}this.tc={token:e,claims:t}}hash=Or(()=>mi(this.tc.token));stop(){}open(){}async tryToken(){return this.tc}async waitForToken(){return this.tc}}new sK("");new Mt;class iK{once=new on;item;constructor(e){this.item=e}get protocol(){return this.item.protocol}get isDefault(){return this.item.isDefault??!1}set isDefault(e){this.item.isDefault=e}defaultURI(e){return this.item.defaultURI(e)}async serdegateway(e){return this.once.once(()=>this.item.serdegateway(e))}}const Rl=new Map;function aK(n,e){const t=Array.from(Rl.values()).find(r=>r.isDefault);if(!t)throw n.logger.Error().Msg("no default found").AsError();return t.defaultURI(n)}function Ad(n){let e=n.protocol;if(e.endsWith(":")||(e+=":"),!n.serdegateway&&!n.gateway)throw new Error("registerStoreProtocol needs a gateway or serdegateway");let t;return n.gateway?t=async r=>{const i=await n.gateway(r);return new n5(i)}:t=n.serdegateway,n.isDefault&&Array.from(Rl.values()).forEach(r=>{r.isDefault=!1}),Rl.set(e,new iK({...n,serdegateway:t})),()=>{Rl.delete(e)}}function oK(n){return Rl.get(n)}function H_(n){const e=jn();return an.from("file://").pathname(`${n.env.get("HOME")}/.fireproof/${Zi.replace(/-.*$/,"")}`).setParam(te.VERSION,Zi).setParam(te.URL_GEN,"default").setParam(te.RUNTIME,e.isNodeIsh?"node":e.isDeno?"deno":"unknown").URI()}(jn().isNodeIsh||jn().isDeno)&&Ad({protocol:"file:",isDefault:!0,defaultURI:H_,gateway:async n=>new u5(n,await QT(H_(n)))});jn().isBrowser&&Ad({protocol:"indexeddb:",isDefault:!0,defaultURI:()=>an.from("indexeddb://").pathname("fp").setParam(te.VERSION,Fw).setParam(te.RUNTIME,"browser").URI(),gateway:async()=>{const{GatewayImpl:n}=await Bo(async()=>{const{GatewayImpl:e}=await Promise.resolve().then(()=>YO);return{GatewayImpl:e}},void 0);return new n}});const cK=new Map;Ad({protocol:"memory:",isDefault:!1,defaultURI:()=>an.from("memory://").pathname("ram").URI(),gateway:async n=>new m$(n,cK)});Fe.protocolHasHostpart("fpcloud");Ad({protocol:"fpcloud",defaultURI(){return Fe.from("fpcloud://fireproof.cloud/")},serdegateway:async n=>new rK(n)});async function kd(n,e,t){const r=oK(e.protocol);return r?A.Ok(new i5(n.loader.sthis,await r.serdegateway(n.loader.sthis),t.gatewayInterceptor)):A.Err(n.loader.sthis.logger.Warn().Url(e).Msg("unsupported protocol").AsError())}async function lK(n,e){const t=e.url.build().setParam(te.STORE,"car").URI(),r=await kd(n,t,e);if(r.isErr())throw n.loader.sthis.logger.Error().Result("err",r).Url(e.url).Msg("notfound").AsError();const i=r.Ok();return new u$(n.loader.sthis,e.url,{gateway:i,loader:n.loader})}async function uK(n,e){const t=e.url.build().setParam(te.STORE,"file").URI(),r=await kd(n,t,e);if(r.isErr())throw n.loader.sthis.logger.Error().Result("err",r).Url(e.url).Msg("notfound").AsError();const i=r.Ok();return new f$(n.loader.sthis,e.url,{gateway:i,loader:n.loader})}async function fK(n,e){const t=e.url.build().setParam(te.STORE,"meta").URI(),r=await kd(n,t,e);if(r.isErr())throw n.loader.sthis.logger.Error().Result("err",r).Url(e.url).Msg("notfound").AsError();const i=r.Ok();return new l$(n.loader.sthis,e.url,{gateway:i,loader:n.loader})}async function hK(n,e){const t=e.url.build().setParam(te.STORE,"wal").URI(),r=await kd(n,t,e);if(r.isErr())throw n.loader.sthis.logger.Error().Result("err",r).Url(e.url).Msg("notfound").AsError();const i=r.Ok();return new h$(n.loader.sthis,e.url,{gateway:i,loader:n.loader})}async function Vf(n,e){const t=await n.start(e);if(t.isErr())throw n.logger.Error().Result("start",t).Msg("start failed").AsError();return n}function OO(n){return n=n||{},{encodeFile:n.encodeFile||FA,decodeFile:n.decodeFile||VA}}function $h(n,e={}){return{makeStores:async t=>{const r={loader:t.loader},i={};return i.meta=await fK(r,t.byStore.meta),i.car=await lK(r,t.byStore.car),i.file=await uK(r,t.byStore.file),t.byStore.wal&&(i.wal=await hK(r,t.byStore.wal)),await Vf(i.meta,i),await Vf(i.car,i),await Vf(i.file,i),i.wal&&await Vf(i.wal,i),i},...OO(e)}}function dK(n,e){if(Number.isNaN(n))return-1;if(Number.isNaN(e))throw new Error("ref may not be Infinity or NaN");return n===1/0?1:su(n,e)}function mK(n,e){const[t,r]=n,[i,o]=e,l=su(t,i);return l!==0?l:dK(r,o)}const q_={cache:VT,chunker:UT(30),codec:Hn,hasher:Bt,compare:mK},F_={cache:VT,chunker:UT(30),codec:Hn,hasher:Bt,compare:su};function pK(n,e){const t=[];return n.forEach(({id:r,value:i,del:o})=>{if(o||!i)return;let l=!1;const f=e({...i,_id:r},(h,m)=>{l=!0,!(typeof h>"u")&&t.push({key:[zo.encode(h),r],value:m||null})});!l&&typeof f<"u"&&t.push({key:[zo.encode(f),r],value:null})}),t}function kg(n){return async e=>{const t=await n.get(e);if(!t)throw new Error(`Missing block ${e.toString()}`);const{cid:r,bytes:i}=t;return m3({cid:r,bytes:i,hasher:Bt,codec:Hn})}}async function V_(n,e,t,r,i){if(n.Debug().Msg("enter bulkIndex"),!r.length)return t;if(!t.root)if(t.cid)t.root=await FT({cid:t.cid,get:kg(e),...i});else{let f,h;for await(const m of await ZP({get:kg(e),list:r,...i})){const y=await m.block;await e.put(await gi(y)),f=y,h=m}if(!h||!f)throw new Error("failed to create index");return n.Debug().Msg("exit !root bulkIndex"),{root:h,cid:f.cid}}n.Debug().Msg("pre bulk bulkIndex");const{root:o,blocks:l}=await t.root.bulk(r);if(o){n.Debug().Msg("pre root put bulkIndex");for await(const f of l)await e.put(await gi(f));return{root:o,cid:(await o.block).cid}}else return n.Debug().Msg("pre !root bulkIndex"),{root:void 0,cid:void 0}}async function G_(n,e,t){return await FT({cid:e,get:kg(n),...t})}async function fo(n,e,t){t.descending&&(e.result=e.result.reverse()),t.limit&&(e.result=e.result.slice(0,t.limit)),(typeof t.includeDocs!="boolean"||t.includeDocs)&&(e.result=await Promise.all(e.result.map(async l=>{const f=await n.get(l.id),h=f?{...f.doc,_id:l.id}:void 0;return{...l,doc:h}})));const i=e.result.map(({key:l,...f})=>{const h=zo.decode(l),m=f;if("row"in m&&!("value"in m)){const y={};return Object.keys(m).forEach(g=>{g==="row"?y.value=m[g]:y[g]=m[g]}),{key:h,...y}}return{key:h,...f}}),o=i.filter(l=>!!l.doc);return{rows:i,docs:o}}function Z_(n){return[zo.encode(n[0]),zo.encode(n[1])]}function J_(n){return zo.encode(n)}function yK(n){return!!n.ledger}function Tg(n,e,t,r){const i=yK(n)?n.ledger.crdt:n.crdt;if(t&&r)throw n.logger.Error().Msg("cannot provide both mapFn and meta").AsError();if(t&&t.constructor.name!=="Function")throw n.logger.Error().Msg("mapFn must be a function").AsError();if(i.indexers.has(e))i.indexers.get(e).applyMapFn(e,t,r);else{const o=new gK(n.sthis,i,e,t,r);i.indexers.set(e,o)}return i.indexers.get(e)}class gK{blockstore;crdt;name;mapFn;mapFnString="";byKey={};byId={};indexHead;initError;ready(){return Promise.all([this.blockstore.ready(),this.crdt.ready()]).then(()=>{})}logger;constructor(e,t,r,i,o){if(this.logger=Xe(e,"Index"),!t.indexBlockstore)throw e.logger.Error().Msg("indexBlockstore not set").AsError();if(this.blockstore=t.indexBlockstore,this.crdt=t,this.applyMapFn(r,i,o),this.name=r,!(this.mapFnString||this.initError))throw this.logger.Error().Msg("missing mapFnString").AsError()}applyMapFn(e,t,r){if(t&&r)throw this.logger.Error().Msg("cannot provide both mapFn and meta").AsError();if(this.name&&this.name!==e)throw this.logger.Error().Msg("cannot change name").AsError();try{let i=!1;if(r){if(this.indexHead&&this.indexHead.map(o=>o.toString()).join()!==r.head.map(o=>o.toString()).join())throw this.logger.Error().Msg("cannot apply different head meta").AsError();this.mapFnString?(this.mapFnString!==r.map&&(this.mapFnString=r.map,i=!0),this.byId.cid=r.byId,this.byKey.cid=r.byKey,this.indexHead=r.head):(this.mapFnString=r.map,this.byId.cid=r.byId,this.byKey.cid=r.byKey,this.indexHead=r.head)}else this.mapFn?t&&this.mapFn.toString()!==t.toString()&&(this.mapFn=t,this.mapFnString=t.toString(),i=!0):(t||(t=(o=>o[e]??void 0)),this.mapFnString?this.mapFnString!==t.toString()&&(i=!0):this.mapFnString=t.toString(),this.mapFn=t);i&&this._resetIndex()}catch(i){this.initError=i}}async query(e={}){if(await this.ready(),await this._updateIndex(),await this._hydrateIndex(),!this.byKey.root)return await fo(this.crdt,{result:[]},e);if(e.range){const r=Z_(e.range);return await fo(this.crdt,await rh(this.byKey.root).range(r[0],r[1]),e)}if(typeof e.key=="boolean"||e.key){const r=J_(e.key);return await fo(this.crdt,await rh(this.byKey.root).get(r),e)}if(Array.isArray(e.keys)){const r={...e};delete r.limit;let o=(await Promise.all(e.keys.map(async h=>{const m=J_(h);return(await fo(this.crdt,await rh(this.byKey.root).get(m),r)).rows}))).flat();e&&(o=o.slice(0,e.limit));const l=typeof e.includeDocs=="boolean"?e.includeDocs:!0;let f={};return l&&(f={docs:o.map(h=>h.doc).filter(h=>!!h)}),{rows:o,...f}}if(e.prefix){let r=[];Array.isArray(e.prefix)?r=e.prefix:r=[e.prefix];const i=[...r,NaN],o=[...r,1/0],l=Z_([i,o]);return await fo(this.crdt,await this.byKey.root.range(...l),{...e})}const t=await this.byKey.root.getAllEntries();return await fo(this.crdt,{result:t.result.map(({key:[r,i],value:o})=>({key:r,id:i,value:o}))},e)}_resetIndex(){this.byId={},this.byKey={},this.indexHead=void 0}async _hydrateIndex(){this.byId.root&&this.byKey.root||!this.byId.cid||!this.byKey.cid||(this.byId.root=await G_(this.blockstore,this.byId.cid,F_),this.byKey.root=await G_(this.blockstore,this.byKey.cid,q_))}async _updateIndex(){if(await this.ready(),this.logger.Debug().Msg("enter _updateIndex"),this.initError)throw this.initError;if(!this.mapFn)throw this.logger.Error().Msg("No map function defined").AsError();let e,t;!this.indexHead||this.indexHead.length===0?({result:e,head:t}=await this.crdt.allDocs(),this.logger.Debug().Msg("enter crdt.allDocs")):({result:e,head:t}=await this.crdt.changes(this.indexHead),this.logger.Debug().Msg("enter crdt.changes")),e.length===0&&(this.indexHead=t);let r=[],i=[];if(this.byId.root){const m=e.map(({id:g})=>g),{result:y}=await this.byId.root.getMany(m);r=y.map(g=>({key:g,del:!0})),i=y.map(g=>({key:g[1],del:!0}))}const o=pK(e,this.mapFn),l=o.map(({key:m})=>({key:m[1],value:m})),f={indexes:new Map};for(const[m,y]of this.crdt.indexers)y.indexHead&&f.indexes?.set(m,{byId:y.byId.cid,byKey:y.byKey.cid,head:y.indexHead,map:y.mapFnString,name:y.name});if(e.length===0)return f;this.logger.Debug().Msg("pre this.blockstore.transaction");const{meta:h}=await this.blockstore.transaction(async m=>{if(this.byId=await V_(this.logger,m,this.byId,i.concat(l),F_),this.byKey=await V_(this.logger,m,this.byKey,r.concat(o),q_),this.indexHead=t,this.byId.cid&&this.byKey.cid){const y={byId:this.byId.cid,byKey:this.byKey.cid,head:t,map:this.mapFnString,name:this.name};f.indexes?.set(this.name,y)}return this.logger.Debug().Any("indexerMeta",new Array(f.indexes?.entries())).Msg("exit this.blockstore.transaction fn"),f});return this.logger.Debug().Msg("post this.blockstore.transaction"),h}}class wK{onClosed(e){this.ledger.onClosed(e)}close(){return this.ledger.close()}destroy(){return this.ledger.destroy()}ready(){return this.ledger.ready()}ledger;logger;sthis;constructor(e){this.sthis=e.sthis,this.ledger=e,this.logger=Xe(this.sthis,"Database")}attach(e){return this.ledger.attach(e)}get name(){return this.ledger.name}async get(e){if(!e)throw this.logger.Error().Str("db",this.name).Msg("Doc id is required").AsError();await this.ready(),this.logger.Debug().Str("id",e).Msg("get");try{const t=await this.ledger.crdt.get(e);if(!t)throw new Kr(`Not found: ${e}`);const{doc:r}=t;return{...r,_id:e}}catch(t){throw new Kr(`Not found: ${e} - ${t instanceof Error?t.message:String(t)}`)}}async put(e){await this.ready(),this.logger.Debug().Str("id",e._id).Msg("put");const{_id:t,...r}=e,i=t||this.sthis.timeOrderedNextId().str,o=await this.ledger.writeQueue.push({id:i,value:{...r,_id:i}});return{id:i,clock:o?.head,name:this.name}}async bulk(e){await this.ready();const t=e.map(i=>{const o=i._id||this.sthis.timeOrderedNextId().str;return{id:o,value:{...i,_id:o}}}),r=await this.ledger.writeQueue.bulk(t);return{ids:t.map(i=>i.id),clock:r.head,name:this.name}}async del(e){await this.ready(),this.logger.Debug().Str("id",e).Msg("del");const t=await this.ledger.writeQueue.push({id:e,del:!0});return{id:e,clock:t?.head,name:this.name}}async remove(e){return this.del(e)}async changes(e=[],t={}){await this.ready(),this.logger.Debug().Any("since",e).Any("opts",t).Msg("changes");const{result:r,head:i}=await this.ledger.crdt.changes(e,t);return{rows:r.map(({id:l,value:f,del:h,clock:m})=>({key:l,value:h?{_id:l,_deleted:!0}:{_id:l,...f},clock:m})),clock:i,name:this.name}}async allDocs(e={}){await this.ready(),this.logger.Debug().Msg("allDocs");const{result:t,head:r}=await this.ledger.crdt.allDocs();let i=t.map(({id:o,value:l,del:f})=>({key:o,value:f?{_id:o,_deleted:!0}:{_id:o,...l}}));return e.includeDeleted||(i=i.filter(o=>!o.value._deleted)),typeof e.limit=="number"&&e.limit>=0&&(i=i.slice(0,e.limit)),{rows:i,clock:r,name:this.name}}async allDocuments(){return this.allDocs()}subscribe(e,t){return this.ledger.subscribe(e,t)}async query(e,t){let r;t?r=t:r={},await this.ready(),this.logger.Debug().Any("field",e).Any("opts",r).Msg("query");const o=await(typeof e=="string"?Tg(this,e):Tg(this,BB(e.toString()),e)).query(r);return(typeof r.includeDocs=="boolean"?r.includeDocs:!0)?{rows:o.rows,docs:o.rows.map(f=>f.doc).filter(f=>!!f)}:{rows:o.rows}}async compact(){await this.ready(),await this.ledger.crdt.compact()}}const Yw="ascii",bK=4096;class Td extends Es{constructor({cid:e,value:t,bytes:r}){super({cid:e,value:t,bytes:r})}static create(e){return ii(CO(e))}}const CO=n=>({entries:[],...Po(n)}),Po=n=>({version:1,keyChars:n?.keyChars??Yw,maxKeySize:n?.maxKeySize??bK,prefix:n?.prefix??""}),si=(n,e)=>({...CO(e),entries:n}),MO=new WeakMap,ii=async n=>{const{cid:e,bytes:t}=await xw({value:n,codec:Hn,hasher:Bt}),r=new Td({cid:e,value:n,bytes:t});return MO.set(r.bytes,r),r},vK=async n=>{const e=MO.get(n);if(e)return e;const{cid:t,value:r}=await Iw({bytes:n,codec:Hn,hasher:Bt});if(!SK(r))throw new Error(`invalid shard: ${t}`);return new Td({cid:t,value:r,bytes:n})},SK=n=>n!=null&&typeof n=="object"&&Array.isArray(n.entries)&&n.version===1&&typeof n.maxKeySize=="number"&&typeof n.keyChars=="string"&&typeof n.prefix=="string",NO=n=>x8(n)&&n.code===DT;class ba{constructor(e){this._blocks=e}async get(e){const t=await this._blocks.get(e);if(!t)throw new Error(`missing block: ${e}`);return vK(t.bytes)}}const Ro=(n,e)=>{const t=[];for(const[r,i]of n.entries()){const[o,l]=i;if(e[0]===o){Array.isArray(e[1])?Array.isArray(l)&&l[1]!=null&&e[1][1]==null?t.push([o,[e[1][0],l[1]]]):t.push(e):Array.isArray(l)?t.push([o,[l[0],e[1]]]):t.push(e);for(let f=r+1;f<n.length;f++)t.push(n[f]);return t}if(r===0&&e[0]<o){t.push(e);for(let f=r;f<n.length;f++)t.push(n[f]);return t}if(r>0&&e[0]>n[r-1][0]&&e[0]<o){t.push(e);for(let f=r;f<n.length;f++)t.push(n[f]);return t}t.push(i)}return t.push(e),t},RO=n=>/^[\x20-\x7E]*$/.test(n),hh=async(n,e,t,r)=>{const i=new ba(n),o=await i.get(e);if(o.value.keyChars!==Yw)throw new Error(`unsupported key character set: ${o.value.keyChars}`);if(!RO(t))throw new Error("key contains non-ASCII characters");if(new TextEncoder().encode(t).length>o.value.maxKeySize)throw new Error(`UTF-8 encoded key exceeds max size of ${o.value.maxKeySize} bytes`);const l=await Od(i,o,t),f=l[l.length-1],h=t.slice(f.value.prefix.length);let m=[h,r];const y=[...f.value.entries],g=[];for(const[_,S]of y.entries()){const[k,M]=S;if(k===h)break;const x=k.length<h.length?k:h,$=x===k?h:k;let L="";for(const j of x){const W=L+j;if(!$.startsWith(W))break;L=W}if(L.length){let j=[];L!==h&&(j=Ro(j,[h.slice(L.length),r])),L!==k&&(j=Ro(j,[k.slice(L.length),M]));let W=await ii(si(j,{...f.value,prefix:f.value.prefix+L}));g.push(W);const G=[...L];for(let H=G.length-1;H>0;H--){const ie={...f.value,prefix:f.value.prefix+G.slice(0,H).join("")};let de;if(H===G.length-1&&L===k){if(Array.isArray(M))throw new Error("found a shard link when expecting a value");de=[W.cid,M]}else H===G.length-1&&L===h?de=[W.cid,r]:de=[W.cid];const be=await ii(si([[G[H],de]],ie));g.push(be),W=be}if(y.splice(_,1),G.length===1&&L===k){if(Array.isArray(M))throw new Error("found a shard link when expecting a value");m=[G[0],[W.cid,M]]}else G.length===1&&L===h?m=[G[0],[W.cid,r]]:m=[G[0],[W.cid]];break}}const b=si(Ro(y,m),f.value);let E=await ii(b);if(E.cid.toString()===f.cid.toString())return{root:e,additions:[],removals:[]};g.push(E);for(let _=l.length-2;_>=0;_--){const S=l[_],k=E.value.prefix.slice(S.value.prefix.length),M=si(S.value.entries.map(x=>{const[$,L]=x;if($!==k)return x;if(!Array.isArray(L))throw new Error(`"${k}" is not a shard link in: ${S.cid}`);return L[1]==null?[$,[E.cid]]:[$,[E.cid,L[1]]]}),S.value);E=await ii(M),g.push(E)}return{root:g[g.length-1].cid,additions:g,removals:l}},EK=async(n,e,t)=>{const r=new ba(n),i=await r.get(e),o=await Od(r,i,t),l=o[o.length-1],f=t.slice(l.value.prefix.length),h=l.value.entries.find(([m])=>m===f);if(h)return Array.isArray(h[1])?h[1][1]:h[1]},DO=async(n,e,t)=>{const r=new ba(n),i=await r.get(e),o=await Od(r,i,t),l=o[o.length-1],f=t.slice(l.value.prefix.length),h=l.value.entries.findIndex(([_])=>_===f);if(h===-1)return{root:e,additions:[],removals:[]};const m=l.value.entries[h];if(Array.isArray(m[1])&&m[1][1]==null)return{root:e,additions:[],removals:[]};const y=[],g=[...o];let b=si([...l.value.entries],l.value);if(Array.isArray(m[1]))b.entries[h]=[m[0],[m[1][0]]];else for(b.entries.splice(h,1);!b.entries.length;){const _=o[o.length-1],S=o[o.length-2];if(!S)break;o.pop(),b=si(S.value.entries.filter(k=>Array.isArray(k[1])?k[1][0].toString()!==_.cid.toString():!0),S.value)}let E=await ii(b);y.push(E);for(let _=o.length-2;_>=0;_--){const S=o[_],k=E.value.prefix.slice(S.value.prefix.length),M=si(S.value.entries.map(x=>{const[$,L]=x;if($!==k)return x;if(!Array.isArray(L))throw new Error(`"${k}" is not a shard link in: ${S.cid}`);return L[1]==null?[$,[E.cid]]:[$,[E.cid,L[1]]]}),S.value);E=await ii(M),y.push(E)}return{root:y[y.length-1].cid,additions:y,removals:g}},_K=n=>{const e={};return"prefix"in e&&!!e.prefix},AK=n=>{const e={};return"gt"in e&&!!e.gt||"gte"in e&&!!e.gte||"lt"in e&&!!e.lt||"lte"in e&&!!e.lte},kK=n=>"gt"in n&&!!n.gt||"gte"in n&&!!n.gte,TK=n=>"gte"in n&&!!n.gte,OK=n=>"gt"in n&&!!n.gt,CK=n=>"lt"in n&&!!n.lt||"lte"in n&&!!n.lte,MK=n=>"lte"in n&&!!n.lte,NK=n=>"lt"in n&&!!n.lt,RK=async function*(n,e,t){const r=_K(),i=AK(),o=i&&kK(t),l=o&&TK(t),f=o&&OK(t),h=i&&CK(t),m=h&&MK(t),y=h&&NK(t),g=o&&h,b=new ba(n),E=await b.get(e);yield*(async function*_(S){for(const k of S.value.entries){const M=S.value.prefix+k[0];if(Array.isArray(k[1])){if(k[1][1]&&(r&&M.startsWith(t.prefix)||g&&(f&&M>t.gt||l&&M>=t.gte)&&(y&&M<t.lt||m&&M<=t.lte)||f&&M>t.gt||l&&M>=t.gte||y&&M<t.lt||m&&M<=t.lte||!r&&!i)&&(yield[M,k[1][1]]),r){if(t.prefix.length<=M.length&&!M.startsWith(t.prefix)||t.prefix.length>M.length&&!t.prefix.startsWith(M))continue}else if(f&&Qs(M,Math.min(M.length,t.gt.length))<Qs(t.gt,Math.min(M.length,t.gt.length))||l&&Qs(M,Math.min(M.length,t.gte.length))<Qs(t.gte,Math.min(M.length,t.gte.length))||y&&Qs(M,Math.min(M.length,t.lt.length))>Qs(t.lt,Math.min(M.length,t.lt.length))||m&&Qs(M,Math.min(M.length,t.lte.length))>Qs(t.lte,Math.min(M.length,t.lte.length)))continue;yield*_(await b.get(k[1][0]))}else(r&&M.startsWith(t.prefix)||i&&g&&(f&&M>t.gt||l&&M>=t.gte)&&(y&&M<t.lt||m&&M<=t.lte)||i&&!g&&(f&&M>t.gt||l&&M>=t.gte||y&&M<t.lt||m&&M<=t.lte)||!r&&!i)&&(yield[M,k[1]])}})(E)},Qs=(n,e)=>n.length<=e?n:n.slice(0,e),Od=async(n,e,t)=>{for(const[r,i]of e.value.entries){if(t===r)return[e];if(t.startsWith(r)&&Array.isArray(i)){const o=await Od(n,await n.get(i[0]),t.slice(r.length));return[e,...o]}}return[e]};class $o{#e=new Map;constructor(e){e&&(this.#e=new Map(e.map(t=>[t.cid.toString(),t.bytes])))}async get(e){const t=this.#e.get(e.toString());if(t)return{cid:e,bytes:t}}async put(e,t){this.#e.set(e.toString(),t)}putSync(e,t){this.#e.set(e.toString(),t)}async delete(e){this.#e.delete(e.toString())}deleteSync(e){this.#e.delete(e.toString())}*entries(){for(const[e,t]of this.#e)yield{cid:rO(e),bytes:t}}}class Ko{#e;constructor(...e){this.#e=e}async get(e){for(const t of this.#e){const r=await t.get(e);if(r)return r}}}const Og=n=>({base:n?.base,entries:[...n?.entries??[]],...Po(n)});let DK=class xO{#e=!1;constructor({blocks:e,entries:t,prefix:r,version:i,keyChars:o,maxKeySize:l,base:f}){this.blocks=e,this.prefix=r,this.entries=[...t],this.base=f,this.version=i,this.keyChars=o,this.maxKeySize=l}async put(e,t){if(this.#e)throw new jo;return IO(this.blocks,this,e,t)}async commit(){if(this.#e)throw new jo;return this.#e=!0,Qw(this)}static async create({blocks:e,link:t}){const i=await new ba(e).get(t);return new xO({blocks:e,base:i,...i.value})}};const IO=async(n,e,t,r)=>{if(e.keyChars!==Yw)throw new Error(`unsupported key character set: ${e.keyChars}`);if(!RO(t))throw new Error("key contains non-ASCII characters");if(new TextEncoder().encode(t).length>e.maxKeySize)throw new Error(`UTF-8 encoded key exceeds max size of ${e.maxKeySize} bytes`);const i=new ba(n),o=await Cg(i,e,t);o.shard!==e&&(e=o.shard,t=o.key);let l=[o.key,r];const f=[...o.shard.entries];for(const[h,m]of f.entries()){const[y,g]=m;if(y===o.key)break;const b=y.length<o.key.length?y:o.key,E=b===y?o.key:y;let _="";for(const S of b){const k=_+S;if(!E.startsWith(k))break;_=k}if(_.length){let S=[];_!==o.key&&(S=Ro(S,[o.key.slice(_.length),r])),_!==y&&(S=Ro(S,Mg([y.slice(_.length),g])));let k=Og({...Po(o.shard),prefix:o.shard.prefix+_,entries:S});const M=[..._];for(let x=M.length-1;x>0;x--){let $;if(x===M.length-1&&_===y){if(Array.isArray(g))throw new Error("found a shard link when expecting a value");$=[k,g]}else x===M.length-1&&_===o.key?$=[k,r]:$=[k];k=Og({...Po(o.shard),prefix:o.shard.prefix+M.slice(0,x).join(""),entries:[[M[x],$]]})}if(f.splice(h,1),M.length===1&&_===y){if(Array.isArray(g))throw new Error("found a shard link when expecting a value");l=[M[0],[k,g]]}else M.length===1&&_===o.key?l=[M[0],[k,r]]:l=[M[0],[k]];break}}e.entries=Ro(xK(f),Mg(l))},Cg=async(n,e,t)=>{for(let r=0;r<e.entries.length;r++){const[i,o]=e.entries[r];if(t<=i)break;if(t.startsWith(i)&&Array.isArray(o)){if(NO(o[0])){const l=await n.get(o[0]),f=Og({base:l,...l.value});return e.entries[r]=[i,o[1]==null?[f]:[f,o[1]]],Cg(n,f,t.slice(i.length))}return Cg(n,o[0],t.slice(i.length))}}return{shard:e,key:t}},Qw=async n=>{const e=[],t=[],r=[];for(const o of n.entries)if(Array.isArray(o[1])&&!NO(o[1][0])){const l=await Qw(o[1][0]);r.push([o[0],o[1][1]==null?[l.root]:[l.root,o[1][1]]]),e.push(...l.additions),t.push(...l.removals)}else r.push(Mg(o));const i=await ii(si(r,n));return e.push(i),n.base&&n.base.cid.toString()===i.cid.toString()?{root:i.cid,additions:[],removals:[]}:(n.base&&t.push(n.base),{root:i.cid,additions:e,removals:t})},xK=n=>n,Mg=n=>n,UO=(n,e)=>DK.create({blocks:n,link:e});class jo extends Error{constructor(e,t){super(e??"batch already committed",t),this.code=jo.code}static code="ERR_BATCH_COMMITTED"}const IK=async(n,e,t,r)=>{const i=new $o;if(n=new Ko(i,n),!e.length){const S=await Td.create();i.putSync(S.cid,S.bytes);const k=await hh(n,S.cid,t,r),M={type:"put",root:k.root,key:t,value:r},x=await Fl.create(M,e);return e=await Bh(n,e,x.cid),{root:k.root,additions:[S,...k.additions],removals:k.removals,head:e,event:x}}const o=new rc(n),l=await Xw(o,e);if(!l)throw new Error("failed to find common ancestor event");const f=await o.get(l);let{root:h}=f.value.data;const m=await zO(o,e,l),y=new Map,g=new Map;for(const{value:S}of m){let k;if(S.data.type==="put")k=await hh(n,h,S.data.key,S.data.value);else if(S.data.type==="del")k=await DO(n,h,S.data.key);else if(S.data.type==="batch"){const M=await UO(n,h);for(const x of S.data.ops){if(x.type!=="put")throw new Error(`unsupported batch operation: ${x.type}`);await M.put(x.key,x.value)}k=await M.commit()}else throw new Error(`unknown operation: ${S.data.type}`);h=k.root;for(const M of k.additions)i.putSync(M.cid,M.bytes),y.set(M.cid.toString(),M);for(const M of k.removals)g.set(M.cid.toString(),M)}const b=await hh(n,h,t,r);if(b.root.toString()===h.toString())return{root:h,additions:[],removals:[],head:e};for(const S of b.additions)i.putSync(S.cid,S.bytes),y.set(S.cid.toString(),S);for(const S of b.removals)g.set(S.cid.toString(),S);const E={type:"put",root:b.root,key:t,value:r},_=await Fl.create(E,e);i.putSync(_.cid,_.bytes),e=await Bh(n,e,_.cid);for(const S of g.keys())y.has(S)&&(y.delete(S),g.delete(S));return{root:b.root,additions:[...y.values()],removals:[...g.values()],head:e,event:_}},ou=async(n,e)=>{if(!e.length)throw new Error("cannot determine root of headless clock");const t=new $o;n=new Ko(t,n);const r=new rc(n);if(e.length===1){const y=await r.get(e[0]),{root:g}=y.value.data;return{root:g,additions:[],removals:[]}}const i=await Xw(r,e);if(!i)throw new Error("failed to find common ancestor event");const o=await r.get(i);let{root:l}=o.value.data;const f=await zO(r,e,i),h=new Map,m=new Map;for(const{value:y}of f){let g;if(y.data.type==="put")g=await hh(n,l,y.data.key,y.data.value);else if(y.data.type==="del")g=await DO(n,l,y.data.key);else if(y.data.type==="batch"){const b=await UO(n,l);for(const E of y.data.ops){if(E.type!=="put")throw new Error(`unsupported batch operation: ${E.type}`);await b.put(E.key,E.value)}g=await b.commit()}else throw new Error(`unknown operation: ${y.data.type}`);l=g.root;for(const b of g.additions)t.putSync(b.cid,b.bytes),h.set(b.cid.toString(),b);for(const b of g.removals)m.set(b.cid.toString(),b)}for(const y of m.keys())h.has(y)&&(h.delete(y),m.delete(y));return{root:l,additions:[...h.values()],removals:[...m.values()]}},UK=async(n,e,t)=>{if(!e.length)return;const r=await ou(n,e);return r.additions.length&&(n=new Ko(new $o(r.additions),n)),EK(n,r.root,t)},zK=async function*(n,e,t){if(!e.length)return;const r=await ou(n,e);r.additions.length&&(n=new Ko(new $o(r.additions),n)),yield*RK(n,r.root,t)},Xw=async(n,e)=>{if(!e.length)return;const t=e.map(r=>[r]);for(;;){let r=!1;for(const i of t){const o=await LK(n,i[i.length-1]);if(!o)continue;r=!0,i.push(o);const l=BK(t);if(l)return l}if(!r)return}},LK=async(n,e)=>{const{value:t}=await n.get(e);return t.parents.length?t.parents.length===1?t.parents[0]:Xw(n,t.parents):e},BK=n=>{n=n.map(e=>[...e]);for(const e of n)for(const t of e){let r=!0;for(const i of n)if(e!==i&&(r=i.some(o=>String(o)===String(t)),!r))break;if(r)return t}},zO=async(n,e,t)=>{if(e.length===1&&e[0].toString()===t.toString())return[];const r=new Map,i=await Promise.all(e.map(l=>LO(n,l,t)));for(const l of i)for(const{event:f,depth:h}of l){const m=r.get(f.cid.toString());m?m.weight+=h:r.set(f.cid.toString(),{event:f,weight:h})}const o=new Map;for(const{event:l,weight:f}of r.values()){const h=o.get(f);h?h.push(l):o.set(f,[l])}return Array.from(o).sort((l,f)=>f[0]-l[0]).flatMap(([,l])=>l.sort((f,h)=>String(f.cid)<String(h.cid)?-1:1))},LO=async(n,e,t,r=0)=>{const i=await n.get(e),o=[{event:i,depth:r}],{parents:l}=i.value;if(l.length===1&&String(l[0])===String(t))return o;const f=await Promise.all(l.map(h=>LO(n,h,t,r+1)));return o.concat(...f)};class Kh{#e=!1;constructor({blocks:e,head:t,entries:r,prefix:i,version:o,keyChars:l,maxKeySize:f,base:h,additions:m,removals:y}){this.blocks=e,this.head=t,this.prefix=i,this.entries=[...r],this.base=h,this.version=o,this.keyChars=l,this.maxKeySize=f,this.additions=m,this.removals=y,this.ops=[]}async put(e,t){if(this.#e)throw new jo;await IO(this.blocks,this,e,t),this.ops.push({type:"put",key:e,value:t})}async commit(){if(this.#e)throw new jo;this.#e=!0;const e=await Qw(this),t={type:"batch",ops:this.ops,root:e.root},r=await Fl.create(t,this.head),i=new $o,o=new Ko(i,this.blocks);i.putSync(r.cid,r.bytes);const l=await Bh(o,this.head,r.cid),f=new Map,h=new Map;for(const m of this.additions)f.set(m.cid.toString(),m);for(const m of this.removals)h.set(m.cid.toString(),m);for(const m of e.additions)h.has(m.cid.toString())&&h.delete(m.cid.toString()),f.set(m.cid.toString(),m);for(const m of e.removals)f.has(m.cid.toString())?f.delete(m.cid.toString()):h.set(m.cid.toString(),m);return{head:l,event:r,root:e.root,additions:[...f.values()],removals:[...h.values()]}}static async create({blocks:e,head:t}){const r=new $o;if(e=new Ko(r,e),!t.length){const m=await Td.create();return r.putSync(m.cid,m.bytes),new Kh({blocks:e,head:t,entries:[],base:m,additions:[m],removals:[],...Po(m.value)})}const{root:i,additions:o,removals:l}=await ou(e,t);for(const m of o)r.putSync(m.cid,m.bytes);const h=await new ba(e).get(i);return new Kh({blocks:e,head:t,entries:h.value.entries,base:h,additions:o,removals:l,...Po(h.value)})}}const PK=(n,e)=>Kh.create({blocks:n,head:e});function W_(n,e){switch(typeof n){case"string":case"number":return n.toString();default:throw e.Error().Msg("Invalid key type").AsError()}}function kr(n){return{get:async e=>{const t=await n.get(e);return t?{cid:t.cid,bytes:t.bytes}:void 0}}}function Ng(n){if(Array.isArray(n))return n.map(e=>typeof e=="object"&&e!==null?Ng(e):e);if(typeof n=="object"&&n!==null){if(n instanceof Date)return n.toISOString();const e=n,t={};for(const r in e)if(Object.hasOwnProperty.call(e,r)){const i=e[r];if(i===null||!Number.isNaN(i)&&i!==void 0)if(typeof i=="object"&&!r.startsWith("_"))if(i instanceof Date)t[r]=i.toISOString();else{const o=Ng(i);t[r]=o}else t[r]=i}return t}return n}async function $K(n,e,t,r,i){let o=null;if(r.length>1){const l=await PK(kr(e),t);for(const f of r){const h=await Y_(n,e,f,i);await l.put(W_(f.id,i),h)}o=await l.commit()}else if(r.length===1){const l=await Y_(n,e,r[0],i);o=await IK(kr(e),t,W_(r[0].id,i),l)}if(!o)throw i.Error().Uint64("updates.len",r.length).Msg("Missing result").AsError();if(o.event)for(const l of[...o.additions,o.event])e.putSync(await gi(l));return{head:o.head}}async function Y_(n,e,t,r){let i;if(t.del)i={del:!0};else{if(!t.value)throw r.Error().Msg("Missing value").AsError();await KK(n,e,t.value,r),i={doc:t.value}}const o=await g5(i);return e.putSync(o),o.cid}async function KK(n,e,t,r){t._files&&await Q_(r,n,e,t._files),t._publicFiles&&await Q_(r,n,e,t._publicFiles)}async function Q_(n,e,t,r){const i=t.parent;if(!i.loader)throw n.Error().Msg("Missing loader, ledger name is required").AsError();const o=new aa(i),l=[];for(const f in r)if(File===r[f].constructor){const h=r[f],{cid:m,blocks:y}=await e.encodeFile(h);l.push(f);for(const g of y)o.putSync(await y5(g));r[f]={cid:m,type:h.type,size:h.size,lastModified:h.lastModified}}else{const{cid:h,type:m,size:y,car:g,lastModified:b}=r[f];h&&m&&y&&g&&(r[f]={cid:h,type:m,size:y,car:g,lastModified:b})}if(l.length){const f=await i.loader.commitFiles(o,{files:r});if(f)for(const h of l)r[h]={car:f,...r[h]}}}async function jK(n,e,t,r){if(!e.length)throw r.Debug().Msg("Getting from an empty ledger").AsError();const i=await UK(kr(n),e,t);if(!i)throw new Kr(`Not found: ${t}`);return await eb(n,i,r)}function BO(n,{doc:e}){e&&(e._files&&X_(n,e._files),e._publicFiles&&X_(n,e._publicFiles,!0))}function X_(n,e,t=!1){for(const r in e){const i=e[r];i.cid&&(t&&(i.url=`https://${i.cid.toString()}.ipfs.w3s.link/`),i.car&&(i.file=async()=>{const o=await n.ebOpts.storeRuntime.decodeFile({get:async l=>await n.getFile(rh(i.car),l)},i.cid,i);if(o.isErr())throw n.logger.Error().Any("error",o.Err()).Any("cid",i.cid).Msg("Error decoding file").AsError();return o.unwrap()})),e[r]=i}}async function eb(n,e,t){const r=await n.get(e);if(!r)throw t.Error().Str("link",e.toString()).Msg("Missing linked block").AsError();const{value:i}=await Uw({bytes:r.bytes,hasher:Bt,codec:Hn}),o={...i,cid:e};return BO(n,o),o}class HK extends rc{logger;constructor(e,t){super(kr(t)),this.logger=e}async get(e){try{return await super.get(e)}catch(t){return this.logger.Error().Ref("link",e.toString()).Err(t).Msg("Missing event"),{value:void 0}}}}async function jh(n,e,t,r,i){const o=r.dirty?new HK(i,n):new rc(kr(n));return{result:(await PO(n,o,e,t,[],new Set,new Set,r.limit||1/0,i)).reverse(),head:e}}async function PO(n,e,t,r,i=[],o,l,f,h){if(f<=0)return i;const m=t.map(y=>y.toString());for(const y of r)if(m.includes(y.toString()))return i;for(const y of t){if(l.has(y.toString()))continue;l.add(y.toString());const{value:g}=await e.get(y);if(!g)continue;const{type:b}=g.data;let E=[];b==="batch"?E=g.data.ops:b==="put"&&(E=[g.data]);for(let _=E.length-1;_>=0;_--){const{key:S,value:k}=E[_];if(!o.has(S)){const M=await eb(n,k,h);if(S===te.GENESIS_CID)continue;i.push({id:S,value:M.doc,del:M.del,clock:y}),f--,o.add(S)}}g.parents&&(i=await PO(n,e,g.parents,r,i,o,l,f,h))}return i}async function*$O(n,e,t){for await(const[r,i]of zK(kr(n),e))if(r!==te.GENESIS_CID){const o=await eb(n,i,t);yield{id:r,value:o.doc,del:o.del}}}async function*qK(n,e){for await(const t of eO(kr(n),e))yield t}async function FK(n,e){const t=await n.get(rO(e));if(!t)throw new Error(`Missing block ${e}`);const{cid:r,value:i}=await Uw({bytes:t.bytes,codec:Hn,hasher:Bt});return new Es({cid:r,value:i,bytes:t.bytes})}function VK(n,e){const t=[];let r=!1;async function*i(){if(r||t.length===0)return;r=!0;const o=[];try{for(;t.length>0;){t.sort((f,h)=>h.updates?1:-1);const l=t.shift();if(l&&(await n(l.newHead,l.prevHead,l.updates!==void 0).catch(f=>{throw e.Error().Err(f).Msg("int_applyHead worker error").AsError()}),l.updates&&o.push(...l.updates),!t.some(f=>f.updates)||l.updates)){const f=t.every(h=>h.updates!==null);yield{updates:o,all:f},o.length=0}}}finally{r=!1;const l=i();let f=await l.next();for(;!f.done;)f=await l.next()}}return{push(o){return t.push(o),i()},size(){return t.length}}}class GK{head=[];zoomers=new Map;watchers=new Map;noPayloadWatchers=new Map;blockstore;applyHeadQueue;transaction;async ready(){}async close(){}logger;sthis;constructor(e){this.sthis=e.sthis,this.blockstore=e,this.logger=Xe(e.sthis,"CRDTClock").With().Str("dbName",e.crdtParent?.ledgerParent?.name||"unnamed").Logger(),this.applyHeadQueue=VK(this.int_applyHead.bind(this),this.logger)}setHead(e){this.head.splice(0,this.head.length,...e)}async applyHead(e,t,r){for await(const{updates:i,all:o}of this.applyHeadQueue.push({newHead:e,prevHead:t,updates:r}))return this.processUpdates(i,o,t)}async processUpdates(e,t,r){let i=e;this.watchers.size&&!t&&(i=(await jh(this.blockstore,this.head,r,{},this.logger)).result),this.zoomers.forEach(o=>o()),this.notifyWatchers(i||[])}notifyWatchers(e){e=e.filter(t=>t.id!==te.GENESIS_CID),e.length&&(this.logger.Debug().Int("updatesCount",e.length).Int("watchersCount",this.watchers.size).Int("noPayloadWatchersCount",this.noPayloadWatchers.size).Msg("NOTIFY_WATCHERS: Triggering subscriptions"),this.noPayloadWatchers.forEach(t=>t()),this.watchers.forEach(t=>t(e||[])))}onTick(e){const t=this.sthis.timeOrderedNextId().str;return this.watchers.set(t,e),()=>{this.watchers.delete(t)}}onTock(e){const t=this.sthis.timeOrderedNextId().str;return this.noPayloadWatchers.set(t,e),()=>{this.noPayloadWatchers.delete(t)}}onZoom(e){const t=this.sthis.timeOrderedNextId().str;return this.zoomers.set(t,e),()=>{this.zoomers.delete(t)}}async int_applyHead(e,t,r){const i=!r,o=!r&&(this.watchers.size>0||this.noPayloadWatchers.size>0);this.logger.Debug().Bool("localUpdates",r).Int("watchersCount",this.watchers.size).Int("noPayloadWatchersCount",this.noPayloadWatchers.size).Bool("needsManualNotification",o).Int("headLength",e.length).Int("prevHeadLength",t.length).Int("currentHeadLength",this.head.length).Msg("INT_APPLY_HEAD: Entry point");const l=xy(this.head);if(e=xy(e),e1(l,e))return;const f=xy(t);if(e1(l,f)){this.setHead(e);return}if(!this.blockstore)throw this.logger.Error().Msg("missing blockstore").AsError();await ZK(this.logger,e,this.blockstore),this.transaction||(this.transaction=this.blockstore.openTransaction({noLoader:i,add:!1}));const h=this.transaction,m=await JK(this.logger,e,h,this.head),y=await ou(kr(h),m),g=await Promise.all(y.additions.map(gi));for(const b of g)h.putSync(b);if(i||(await this.blockstore.commitTransaction(h,{head:m},{add:!1,noLoader:i}),this.transaction=void 0),this.setHead(m),o){const b=await jh(this.blockstore,m,t,{},this.logger),E=this.watchers.size>0&&this.noPayloadWatchers.size>0?"both":this.watchers.size>0?"watchers":"noPayloadWatchers";this.logger.Debug().Int("changesCount",b.result.length).Str("triggerReason",E).Int("watchersCount",this.watchers.size).Int("noPayloadWatchersCount",this.noPayloadWatchers.size).Msg("MANUAL_NOTIFICATION: Checking for changes"),b.result.length>0?(this.logger.Debug().Msg("MANUAL_NOTIFICATION: Calling notifyWatchers with changes"),this.notifyWatchers(b.result),this.noPayloadWatchers.forEach(_=>_())):(this.logger.Debug().Msg("MANUAL_NOTIFICATION: Calling noPayloadWatchers directly"),this.noPayloadWatchers.forEach(_=>_()))}}}function xy(n){return n.sort((e,t)=>e.toString().localeCompare(t.toString()))}async function ZK(n,e,t){if(!t)throw n.Error().Msg("missing blockstore");await Promise.all(e.map(async r=>{if(!await t.get(r))throw n.Error().Str("cid",r.toString()).Msg("int_applyHead missing block").AsError()}))}function e1(n,e){return n.toString()===e.toString()}async function JK(n,e,t,r){for(const i of e)try{r=await Bh(kr(t),r,i)}catch(o){n.Error().Err(o).Msg("failed to advance head")}return r}function WK(n,e){return t=>{switch(t.event){case"idleFromCommitQueue":n.tracer({event:"idleFromBlockstore",blockstore:"data",ledger:e});break;case"busyFromCommitQueue":n.tracer({event:"busyFromBlockstore",blockstore:"data",ledger:e,queueLen:t.queueLen});break;default:return n.tracer(t)}}}class YK{opts;blockstore;indexBlockstore;indexers=new Map;clock;logger;sthis;crdt;ledgerParent;constructor(e,t,r){this.sthis=e,this.ledgerParent=r,this.crdt=this,this.logger=Xe(e,"CRDTImpl"),this.opts=t;const i=dP(this.opts.compactStrategy);if(i.isErr())throw this.logger.Error().Err(i.Err()).Str("compactorName",this.opts.compactStrategy).Msg("compactor not found").AsError();const o={tracer:WK(t,r),applyMeta:async l=>{const f=l;if(!f.head)throw this.logger.Error().Msg("missing head").AsError();this.logger.Debug().Str("newHead",f.head.map(h=>h.toString()).join(",")).Int("subscribers",this.clock.watchers.size+this.clock.noPayloadWatchers.size).Int("headLength",f.head.length).Int("currentHeadLength",this.clock.head.length).Str("dbName",this.opts.name||"unnamed").Msg("APPLY_META: Calling applyHead for REMOTE sync"),await this.clock.applyHead(f.head,[])},compactStrategy:i.Ok(),gatewayInterceptor:t.gatewayInterceptor,storeRuntime:$h(this.sthis,this.opts.storeEnDe),storeUrls:this.opts.storeUrls.data,keyBag:this.opts.keyBag,meta:this.opts.meta};this.blockstore=new x_(e,o,this),this.opts.storeUrls.idx&&(this.indexBlockstore=new x_(e,{tracer:t.tracer,applyMeta:async l=>{const f=l;if(!f.indexes)throw this.logger.Error().Msg("missing indexes").AsError();for(const[h,m]of Object.entries(f.indexes))Tg(this,h,void 0,m)},gatewayInterceptor:t.gatewayInterceptor,storeRuntime:$h(this.sthis,this.opts.storeEnDe),storeUrls:this.opts.storeUrls.idx,keyBag:this.opts.keyBag},this)),this.clock=new GK(this.blockstore),this.clock.onZoom(()=>{for(const l of this.indexers.values())l._resetIndex()})}async bulk(e){if(await this.ready(),e=e.map(t=>({...t,value:Ng(t.value)})),this.clock.head.length===0){const t={id:te.GENESIS_CID,value:{_id:te.GENESIS_CID}};await this._bulk([t])}return await this._bulk(e)}async _bulk(e){const t=[...this.clock.head],r=await this.blockstore.transaction(async i=>{const{head:o}=await $K(this.blockstore.ebOpts.storeRuntime,i,this.clock.head,e,this.logger);return e=e.map(l=>(BO(this.blockstore,{doc:l.value}),l)),{head:o}});return this.logger.Debug().Str("newHead",r.meta.head.map(i=>i.toString()).join(",")).Int("subscribers",this.clock.watchers.size+this.clock.noPayloadWatchers.size).Int("headLength",r.meta.head.length).Int("prevHeadLength",t.length).Int("currentHeadLength",this.clock.head.length).Str("dbName",this.opts.name||"unnamed").Msg("BULK: Calling applyHead for LOCAL write"),await this.clock.applyHead(r.meta.head,t,e),r.meta}onceReady=new on;async ready(){return this.onceReady.once(async()=>{try{await Promise.all([this.blockstore.ready(),this.indexBlockstore?this.indexBlockstore.ready():Promise.resolve(),this.clock.ready()])}catch(e){throw this.logger.Error().Err(e).Msg("CRDT is not ready").AsError()}})}async close(){await Promise.all([this.blockstore.close(),this.indexBlockstore?this.indexBlockstore.close():Promise.resolve(),this.clock.close()])}async destroy(){await Promise.all([this.blockstore.destroy(),this.indexBlockstore?this.indexBlockstore.destroy():Promise.resolve()])}async allDocs(){await this.ready();const e=[];for await(const t of $O(this.blockstore,this.clock.head,this.logger))e.push(t);return{result:e,head:this.clock.head}}async vis(){await this.ready();const e=[];for await(const t of qK(this.blockstore,this.clock.head))e.push(t);return e.join(`
`)}async getBlock(e){return await this.ready(),await FK(this.blockstore,e)}async get(e){await this.ready();const t=await jK(this.blockstore,this.clock.head,e,this.logger);if(!t.del)return t}async changes(e=[],t={}){return await this.ready(),await jh(this.blockstore,this.clock.head,e,t,this.logger)}async compact(){return await this.blockstore.compact()}}const t1=new Mt;function KO(n,e,t){return JSON.stringify(zl({name:e,stores:zl(JSON.parse(JSON.stringify(jO(n,e,t?.storeUrls))))}))}function QK(n,e){const t=vw(e),r=KO(t,n,e),i=t1.get(r);return new XK(i.once(()=>{const o=new ej(t,{name:n,meta:e?.meta,keyBag:lO(t,e?.keyBag),storeUrls:jO(t,n,e?.storeUrls),gatewayInterceptor:e?.gatewayInterceptor,compactStrategy:e?.compactStrategy,writeQueue:ZA(e?.writeQueue),ctx:e?.ctx??new fi,storeEnDe:{encodeFile:FA,decodeFile:VA,...e?.storeEnDe},tracer:e?.tracer??(()=>{})});return o.onClosed(()=>{t1.unget(r)}),o}))}class XK{ref;writeQueue;name;constructor(e){this.ref=e,this.writeQueue=e.writeQueue,this.name=e.name,e.addShell(this)}attach(e){return this.ref.attach(e)}get opts(){return this.ref.opts}get ctx(){return this.ref.ctx}refId(){return this.ref.refId()}get logger(){return this.ref.logger}get sthis(){return this.ref.sthis}get crdt(){return this.ref.crdt}onClosed(e){return this.ref.onClosed(e)}close(){return this.ref.shellClose(this)}destroy(){return this.ref.destroy()}ready(){return this.ref.ready()}subscribe(e,t){return this.ref.subscribe(e,t)}}class ej{opts;_listening=!1;_listeners=new Set;_noupdate_listeners=new Set;crdt;writeQueue;shells=new Set;ctx;get name(){return this.opts.name}addShell(e){this.shells.add(e)}refId=Or(()=>mi(KO(this.sthis,this.name,this.opts)));_onClosedFns=new Map;onClosed(e){const t=this.sthis.nextId().str;return this._onClosedFns.set(t,e),()=>{this._onClosedFns.delete(t)}}async close(){throw this.logger.Error().Str("db",this.name).Msg("use shellClose").AsError()}async shellClose(e){if(!this.shells.has(e))throw this.logger.Error().Str("db",this.name).Msg("LedgerShell mismatch").AsError();this.shells.delete(e),this.shells.size===0&&(await this.ready(),await this.crdt.close(),await this.writeQueue.close(),this._onClosedFns.forEach(t=>t()))}async destroy(){await this.ready(),await this.crdt.destroy()}_ready=new on;async ready(){return await this._ready.once(async()=>{await this.sthis.start(),await this.crdt.ready()})}logger;sthis;constructor(e,t){this.opts={tracer:()=>{},...t},this.sthis=e,this.ctx=t.ctx,this.logger=Xe(this.sthis,"Ledger"),this.crdt=new YK(this.sthis,this.opts,this),this.writeQueue=pP(this.sthis,async r=>this.crdt.bulk(r),this.opts.writeQueue),this.crdt.clock.onTock(()=>this._no_update_notify())}async attach(e){return await this.ready(),this.crdt.blockstore.loader.attach(e)}subscribe(e,t){return this.ready(),this.logger.Debug().Bool("updates",t).Msg("subscribe"),t?(this._listening||(this._listening=!0,this.crdt.clock.onTick(r=>{this._notify(r)})),this._listeners.add(e),()=>{this._listeners.delete(e)}):(this._noupdate_listeners.add(e),()=>{this._noupdate_listeners.delete(e)})}async _notify(e){if(await this.ready(),this._listeners.size){const t=e.map(({id:r,value:i})=>({...i,_id:r}));for(const r of this._listeners)await(async()=>await r(t))().catch(i=>{this.logger.Error().Err(i).Msg("subscriber error")})}}async _no_update_notify(){if(await this.ready(),this._noupdate_listeners.size)for(const e of this._noupdate_listeners)await(async()=>await e([]))().catch(t=>{this.logger.Error().Err(t).Msg("subscriber error")})}}function jO(n,e,t){if(t=t||{},!t.base){const i=n.env.get("FP_STORAGE_URL");i?t={...t,base:an.from(i).setParam(te.URL_GEN,"fromEnv")}:t={...t,base:aK(n).build().setParam(te.URL_GEN,"default")}}const r=Fe.from(t.base);return{idx:{car:ir(n,{name:e},t.idx?.car??t.data?.car,r,"car",{idx:!0}),file:ir(n,{name:e},t.idx?.file??t.idx?.car??t.data?.file??t.data?.car,r,"file",{file:!0,idx:!0}),meta:ir(n,{name:e},t.idx?.meta??t.data?.meta,r,"meta",{idx:!0}),wal:ir(n,{name:e},t.idx?.wal??t.data?.wal,r,"wal",{idx:!0})},data:{car:ir(n,{name:e},t.data?.car,r,"car"),file:ir(n,{name:e},t.data?.file??t.data?.car,r,"file",{file:!0}),meta:ir(n,{name:e},t.data?.meta,r,"meta"),wal:ir(n,{name:e},t.data?.wal,r,"wal")}}}function tj(n,e){return new wK(QK(n,e))}Object.keys({__packageVersion__:"xxxx"})[0];Kw({name:"fireproof",compact:async n=>{const e=n.clock?.head||[];oo(n,"compact head");for(const r of e)if(!await n.get(r))throw n.logger.Error().Ref("cid",r).Msg("Missing head block").AsError();co(n,"compact head"),oo(n,"compact all entries");for await(const r of $O(n,e,n.logger));co(n,"compact all entries"),oo(n,"compact clock vis");for await(const r of eO(kr(n),e));co(n,"compact clock vis"),oo(n,"compact root");const t=await ou(kr(n),e);co(n,"compact root"),oo(n,"compact root blocks");for(const r of[...t.additions,...t.removals])n.loggedBlocks.putSync(await gi(r));return co(n,"compact root blocks"),oo(n,"compact changes"),await jh(n,e,[],{},n.logger),co(n,"compact changes"),{head:n.clock?.head}}});Kw({name:"full",compact:async n=>{if(!n.lastTxMeta)throw n.logger.Error().Msg("no lastTxMeta").AsError();for await(const e of n.loader.entries(!1))n.loggedBlocks.putSync(e);for(const e of n.transactions)for await(const t of e.entries())n.loggedBlocks.putSync(t);return n.lastTxMeta}});Kw({name:"no-op",compact:async()=>({})});const dh="webCtx";new Mt;const Iy={tokenAndClaims:{state:"initial"}},nj=new Mt;function rj(n,e){const[t,r]=ee.useState({state:"initial",ctx:Iy});return ee.useEffect(()=>{e.attach&&nj.get(n.ledger.refId()+e.attach.configHash(n.ledger)).once(()=>{if(e.attach&&t.state==="initial"){r(o=>({...o,state:"attaching"}));async function i(o){const l=o.opts.context.get(dh);if(!l)throw n.logger.Error().Msg("WebCtx not found").AsError();await l.ready(n),l.onTokenChange(h=>{if(!h){r(m=>({...m,state:"initial",ctx:Iy}));return}r(m=>({...m,ctx:{...m.ctx,tokenAndClaims:{state:"ready",tokenAndClaims:h,reset:()=>{l.resetToken().then(()=>r(y=>({...y,state:"initial",ctx:Iy})))}}}}))});const f=await Te(async()=>await n.attach(o));if(f.isErr())n.logger.Error().Err(f).Msg("attach error"),r(h=>({...h,state:"error",error:f.Err()}));else{const h=f.Ok();r(m=>({...m,state:"attached",attached:h}))}}i(e.attach)}})},[n,e.attach,t.state]),t}function sj(n){return function(t={}){const[r,i]=ee.useState(!1),[o,l]=ee.useState({docs:[]}),f=ee.useMemo(()=>JSON.stringify(t),[t]),h=ee.useRef(0);ee.useEffect(()=>{i(!1),h.current+=1},[f]);const m=ee.useCallback(async()=>{const y=++h.current,g=await n.allDocs(t);y===h.current&&(l({...g,docs:g.rows.map(b=>b.value)}),i(!0))},[n,t,f]);return ee.useEffect(()=>{m();const y=n.subscribe(m);return()=>{y()}},[n,m]),{...o,hydrated:r}}}function ij(n){return function(t=[],r={}){const[i,o]=ee.useState(!1),[l,f]=ee.useState({docs:[]}),h=ee.useMemo(()=>JSON.stringify(r),[r]),m=ee.useMemo(()=>JSON.stringify(t),[t]),y=ee.useRef(0);ee.useEffect(()=>{o(!1),y.current+=1},[m,h]);const g=ee.useCallback(async()=>{const b=++y.current,E=await n.changes(t,r);b===y.current&&(f({...E,docs:E.rows.map(_=>_.value)}),o(!0))},[n,t,r,m,h]);return ee.useEffect(()=>(g(),n.subscribe(g)),[g]),{...l,hydrated:i}}}function aj(n){return function(t){const r=ee.useRef(!1),[i,o]=ee.useState(!1);let l;typeof t=="function"?l=t():l=t??{};const f=ee.useMemo(()=>qB({...l}),[]),[h,m]=ee.useState(l),y=ee.useRef(0),g=l._id,b=ee.useMemo(()=>String(g??""),[g]),E=ee.useRef(h._id);ee.useEffect(()=>{o(!1),y.current+=1},[b]),ee.useEffect(()=>{g!==E.current&&(E.current=g,m(l))},[g]);const _=ee.useCallback(async()=>{const H=++y.current,ie=h._id;if(ie)try{const de=await n.get(ie);H===y.current&&de._id===ie&&(m(de),o(!0))}catch{H===y.current&&(m(l),o(!0))}else H===y.current&&(m(l),o(!0))},[h._id]),S=ee.useCallback(async H=>{r.current=!1;const ie=H??h,de=await n.put(ie);return!r.current&&!h._id&&!H&&m(be=>({...be,_id:de.id})),de},[h]),k=ee.useCallback(async H=>{const ie=H?._id??h._id;if(!ie)throw n.logger.Error().Msg("Document must have an _id to be removed").AsError();if(!await n.get(ie).catch(()=>{}))throw n.logger.Error().Str("id",ie).Msg("Document not found").AsError();const be=await n.del(ie);return m(l),be},[h,l]),M=ee.useCallback(H=>{r.current=!0,m(ie=>({...ie,...H}))},[]),x=ee.useCallback(H=>{r.current=!0,m(H)},[]),$=ee.useCallback(()=>{r.current=!0,m({...f})},[f]),L=ee.useCallback((H,ie={replace:!1,reset:!1})=>H?ie.replace?x(H):M(H):ie.reset?$():_(),[_,$,x,M]);ee.useEffect(()=>{if(h._id)return n.subscribe(H=>{r.current||H.find(ie=>ie._id===h._id)&&_()},!0)},[h._id,_]),ee.useEffect(()=>{_()},[_]);const j=ee.useCallback(async H=>{H?.preventDefault&&H.preventDefault(),await S(),$()},[S,$]),W={doc:{...h},hydrated:i,merge:M,replace:x,reset:$,refresh:_,save:S,remove:k,submit:j},G=[{...h},L,S,k,$,_];return Object.assign(W,G),Object.defineProperty(W,Symbol.iterator,{enumerable:!1,value:function*(){yield*G}}),W}}function oj(n){return function(t,r={},i=[]){const[o,l]=ee.useState(!1),[f,h]=ee.useState(()=>({docs:i.map(b=>b.doc).filter(b=>!!b),rows:i})),m=ee.useMemo(()=>JSON.stringify(r),[r]),y=ee.useMemo(()=>t.toString(),[t]);ee.useEffect(()=>{l(!1)},[y,m]);const g=ee.useCallback(async()=>{const b=await n.query(t,{...r,includeDocs:!0});n.logger.Debug().Str("dbname",n.name).Uint64("rows",b.rows.length).Msg("Refreshing live query"),h(b),l(!0)},[n,y,m]);return ee.useEffect(()=>{n.logger.Debug().Str("dbname",n.name).Msg("Initializing live query subscription");const b=n.subscribe(g);return()=>{b()}},[n,g]),ee.useEffect(()=>{g()},[n,m,y]),{...f,hydrated:o}}}function AH(n="useFireproof",e={}){const t=mi(e),r=ee.useMemo(()=>typeof n=="string"?tj(n,e):n,[n,t]),i=rj(r,e),o=ee.useMemo(()=>aj(r),[r.name,t]),l=ee.useMemo(()=>oj(r),[r.name,t]),f=ee.useMemo(()=>sj(r),[r.name,t]),h=ee.useMemo(()=>ij(r),[r.name,t]);return{database:r,useLiveQuery:l,useDocument:o,useAllDocs:f,useChanges:h,attach:i}}new tw({maxEntries:50});const{entries:HO,setPrototypeOf:n1,isFrozen:cj,getPrototypeOf:lj,getOwnPropertyDescriptor:uj}=Object;let{freeze:yn,seal:lr,create:Rg}=Object,{apply:Dg,construct:xg}=typeof Reflect<"u"&&Reflect;yn||(yn=function(e){return e});lr||(lr=function(e){return e});Dg||(Dg=function(e,t){for(var r=arguments.length,i=new Array(r>2?r-2:0),o=2;o<r;o++)i[o-2]=arguments[o];return e.apply(t,i)});xg||(xg=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return new e(...r)});const Gf=gn(Array.prototype.forEach),fj=gn(Array.prototype.lastIndexOf),r1=gn(Array.prototype.pop),ml=gn(Array.prototype.push),hj=gn(Array.prototype.splice),mh=gn(String.prototype.toLowerCase),Uy=gn(String.prototype.toString),zy=gn(String.prototype.match),pl=gn(String.prototype.replace),dj=gn(String.prototype.indexOf),mj=gn(String.prototype.trim),Sr=gn(Object.prototype.hasOwnProperty),hn=gn(RegExp.prototype.test),yl=pj(TypeError);function gn(n){return function(e){e instanceof RegExp&&(e.lastIndex=0);for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return Dg(n,e,r)}}function pj(n){return function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return xg(n,t)}}function Re(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:mh;n1&&n1(n,null);let r=e.length;for(;r--;){let i=e[r];if(typeof i=="string"){const o=t(i);o!==i&&(cj(e)||(e[r]=o),i=o)}n[i]=!0}return n}function yj(n){for(let e=0;e<n.length;e++)Sr(n,e)||(n[e]=null);return n}function Lr(n){const e=Rg(null);for(const[t,r]of HO(n))Sr(n,t)&&(Array.isArray(r)?e[t]=yj(r):r&&typeof r=="object"&&r.constructor===Object?e[t]=Lr(r):e[t]=r);return e}function gl(n,e){for(;n!==null;){const r=uj(n,e);if(r){if(r.get)return gn(r.get);if(typeof r.value=="function")return gn(r.value)}n=lj(n)}function t(){return null}return t}const s1=yn(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),Ly=yn(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),By=yn(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),gj=yn(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),Py=yn(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),wj=yn(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),i1=yn(["#text"]),a1=yn(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),$y=yn(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),o1=yn(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Zf=yn(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),bj=lr(/\{\{[\w\W]*|[\w\W]*\}\}/gm),vj=lr(/<%[\w\W]*|[\w\W]*%>/gm),Sj=lr(/\$\{[\w\W]*/gm),Ej=lr(/^data-[\-\w.\u00B7-\uFFFF]+$/),_j=lr(/^aria-[\-\w]+$/),qO=lr(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Aj=lr(/^(?:\w+script|data):/i),kj=lr(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),FO=lr(/^html$/i),Tj=lr(/^[a-z][.\w]*(-[.\w]+)+$/i);var c1=Object.freeze({__proto__:null,ARIA_ATTR:_j,ATTR_WHITESPACE:kj,CUSTOM_ELEMENT:Tj,DATA_ATTR:Ej,DOCTYPE_NAME:FO,ERB_EXPR:vj,IS_ALLOWED_URI:qO,IS_SCRIPT_OR_DATA:Aj,MUSTACHE_EXPR:bj,TMPLIT_EXPR:Sj});const wl={element:1,text:3,progressingInstruction:7,comment:8,document:9},Oj=function(){return typeof window>"u"?null:window},Cj=function(e,t){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let r=null;const i="data-tt-policy-suffix";t&&t.hasAttribute(i)&&(r=t.getAttribute(i));const o="dompurify"+(r?"#"+r:"");try{return e.createPolicy(o,{createHTML(l){return l},createScriptURL(l){return l}})}catch{return console.warn("TrustedTypes policy "+o+" could not be created."),null}},l1=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function VO(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Oj();const e=ue=>VO(ue);if(e.version="3.3.1",e.removed=[],!n||!n.document||n.document.nodeType!==wl.document||!n.Element)return e.isSupported=!1,e;let{document:t}=n;const r=t,i=r.currentScript,{DocumentFragment:o,HTMLTemplateElement:l,Node:f,Element:h,NodeFilter:m,NamedNodeMap:y=n.NamedNodeMap||n.MozNamedAttrMap,HTMLFormElement:g,DOMParser:b,trustedTypes:E}=n,_=h.prototype,S=gl(_,"cloneNode"),k=gl(_,"remove"),M=gl(_,"nextSibling"),x=gl(_,"childNodes"),$=gl(_,"parentNode");if(typeof l=="function"){const ue=t.createElement("template");ue.content&&ue.content.ownerDocument&&(t=ue.content.ownerDocument)}let L,j="";const{implementation:W,createNodeIterator:G,createDocumentFragment:H,getElementsByTagName:ie}=t,{importNode:de}=r;let be=l1();e.isSupported=typeof HO=="function"&&typeof $=="function"&&W&&W.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:Ee,ERB_EXPR:Pt,TMPLIT_EXPR:$t,DATA_ATTR:Ne,ARIA_ATTR:P,IS_SCRIPT_OR_DATA:ne,ATTR_WHITESPACE:me,CUSTOM_ELEMENT:Be}=c1;let{IS_ALLOWED_URI:Pe}=c1,T=null;const V=Re({},[...s1,...Ly,...By,...Py,...i1]);let Q=null;const ae=Re({},[...a1,...$y,...o1,...Zf]);let le=Object.seal(Rg(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),_e=null,Le=null;const bt=Object.seal(Rg(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}}));let ct=!0,qr=!0,Ei=!1,va=!0,Fr=!1,Fn=!0,hr=!1,_i=!1,ac=!1,Vr=!1,_s=!1,As=!1,Sa=!0,cu=!1;const Md="user-content-";let Jt=!0,Ai=!1,Gr={},Rn=null;const ks=Re({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let lu=null;const oc=Re({},["audio","video","img","source","image","track"]);let cc=null;const uu=Re({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Cr="http://www.w3.org/1998/Math/MathML",Ht="http://www.w3.org/2000/svg",qt="http://www.w3.org/1999/xhtml";let Nt=qt,lc=!1,uc=null;const Nd=Re({},[Cr,Ht,qt],Uy);let Zr=Re({},["mi","mo","mn","ms","mtext"]),Jr=Re({},["annotation-xml"]);const Ea=Re({},["title","style","font","a","script"]);let Dn=null;const _a=["application/xhtml+xml","text/html"],ki="text/html";let kt=null,Wr=null;const fc=t.createElement("form"),Ts=function(C){return C instanceof RegExp||C instanceof Function},hc=function(){let C=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(Wr&&Wr===C)){if((!C||typeof C!="object")&&(C={}),C=Lr(C),Dn=_a.indexOf(C.PARSER_MEDIA_TYPE)===-1?ki:C.PARSER_MEDIA_TYPE,kt=Dn==="application/xhtml+xml"?Uy:mh,T=Sr(C,"ALLOWED_TAGS")?Re({},C.ALLOWED_TAGS,kt):V,Q=Sr(C,"ALLOWED_ATTR")?Re({},C.ALLOWED_ATTR,kt):ae,uc=Sr(C,"ALLOWED_NAMESPACES")?Re({},C.ALLOWED_NAMESPACES,Uy):Nd,cc=Sr(C,"ADD_URI_SAFE_ATTR")?Re(Lr(uu),C.ADD_URI_SAFE_ATTR,kt):uu,lu=Sr(C,"ADD_DATA_URI_TAGS")?Re(Lr(oc),C.ADD_DATA_URI_TAGS,kt):oc,Rn=Sr(C,"FORBID_CONTENTS")?Re({},C.FORBID_CONTENTS,kt):ks,_e=Sr(C,"FORBID_TAGS")?Re({},C.FORBID_TAGS,kt):Lr({}),Le=Sr(C,"FORBID_ATTR")?Re({},C.FORBID_ATTR,kt):Lr({}),Gr=Sr(C,"USE_PROFILES")?C.USE_PROFILES:!1,ct=C.ALLOW_ARIA_ATTR!==!1,qr=C.ALLOW_DATA_ATTR!==!1,Ei=C.ALLOW_UNKNOWN_PROTOCOLS||!1,va=C.ALLOW_SELF_CLOSE_IN_ATTR!==!1,Fr=C.SAFE_FOR_TEMPLATES||!1,Fn=C.SAFE_FOR_XML!==!1,hr=C.WHOLE_DOCUMENT||!1,Vr=C.RETURN_DOM||!1,_s=C.RETURN_DOM_FRAGMENT||!1,As=C.RETURN_TRUSTED_TYPE||!1,ac=C.FORCE_BODY||!1,Sa=C.SANITIZE_DOM!==!1,cu=C.SANITIZE_NAMED_PROPS||!1,Jt=C.KEEP_CONTENT!==!1,Ai=C.IN_PLACE||!1,Pe=C.ALLOWED_URI_REGEXP||qO,Nt=C.NAMESPACE||qt,Zr=C.MATHML_TEXT_INTEGRATION_POINTS||Zr,Jr=C.HTML_INTEGRATION_POINTS||Jr,le=C.CUSTOM_ELEMENT_HANDLING||{},C.CUSTOM_ELEMENT_HANDLING&&Ts(C.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(le.tagNameCheck=C.CUSTOM_ELEMENT_HANDLING.tagNameCheck),C.CUSTOM_ELEMENT_HANDLING&&Ts(C.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(le.attributeNameCheck=C.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),C.CUSTOM_ELEMENT_HANDLING&&typeof C.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(le.allowCustomizedBuiltInElements=C.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Fr&&(qr=!1),_s&&(Vr=!0),Gr&&(T=Re({},i1),Q=[],Gr.html===!0&&(Re(T,s1),Re(Q,a1)),Gr.svg===!0&&(Re(T,Ly),Re(Q,$y),Re(Q,Zf)),Gr.svgFilters===!0&&(Re(T,By),Re(Q,$y),Re(Q,Zf)),Gr.mathMl===!0&&(Re(T,Py),Re(Q,o1),Re(Q,Zf))),C.ADD_TAGS&&(typeof C.ADD_TAGS=="function"?bt.tagCheck=C.ADD_TAGS:(T===V&&(T=Lr(T)),Re(T,C.ADD_TAGS,kt))),C.ADD_ATTR&&(typeof C.ADD_ATTR=="function"?bt.attributeCheck=C.ADD_ATTR:(Q===ae&&(Q=Lr(Q)),Re(Q,C.ADD_ATTR,kt))),C.ADD_URI_SAFE_ATTR&&Re(cc,C.ADD_URI_SAFE_ATTR,kt),C.FORBID_CONTENTS&&(Rn===ks&&(Rn=Lr(Rn)),Re(Rn,C.FORBID_CONTENTS,kt)),C.ADD_FORBID_CONTENTS&&(Rn===ks&&(Rn=Lr(Rn)),Re(Rn,C.ADD_FORBID_CONTENTS,kt)),Jt&&(T["#text"]=!0),hr&&Re(T,["html","head","body"]),T.table&&(Re(T,["tbody"]),delete _e.tbody),C.TRUSTED_TYPES_POLICY){if(typeof C.TRUSTED_TYPES_POLICY.createHTML!="function")throw yl('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof C.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw yl('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');L=C.TRUSTED_TYPES_POLICY,j=L.createHTML("")}else L===void 0&&(L=Cj(E,i)),L!==null&&typeof j=="string"&&(j=L.createHTML(""));yn&&yn(C),Wr=C}},dc=Re({},[...Ly,...By,...gj]),mc=Re({},[...Py,...wj]),fu=function(C){let Y=$(C);(!Y||!Y.tagName)&&(Y={namespaceURI:Nt,tagName:"template"});const oe=mh(C.tagName),qe=mh(Y.tagName);return uc[C.namespaceURI]?C.namespaceURI===Ht?Y.namespaceURI===qt?oe==="svg":Y.namespaceURI===Cr?oe==="svg"&&(qe==="annotation-xml"||Zr[qe]):!!dc[oe]:C.namespaceURI===Cr?Y.namespaceURI===qt?oe==="math":Y.namespaceURI===Ht?oe==="math"&&Jr[qe]:!!mc[oe]:C.namespaceURI===qt?Y.namespaceURI===Ht&&!Jr[qe]||Y.namespaceURI===Cr&&!Zr[qe]?!1:!mc[oe]&&(Ea[oe]||!dc[oe]):!!(Dn==="application/xhtml+xml"&&uc[C.namespaceURI]):!1},wn=function(C){ml(e.removed,{element:C});try{$(C).removeChild(C)}catch{k(C)}},dr=function(C,Y){try{ml(e.removed,{attribute:Y.getAttributeNode(C),from:Y})}catch{ml(e.removed,{attribute:null,from:Y})}if(Y.removeAttribute(C),C==="is")if(Vr||_s)try{wn(Y)}catch{}else try{Y.setAttribute(C,"")}catch{}},pc=function(C){let Y=null,oe=null;if(ac)C="<remove></remove>"+C;else{const Ce=zy(C,/^[\r\n\t ]+/);oe=Ce&&Ce[0]}Dn==="application/xhtml+xml"&&Nt===qt&&(C='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+C+"</body></html>");const qe=L?L.createHTML(C):C;if(Nt===qt)try{Y=new b().parseFromString(qe,Dn)}catch{}if(!Y||!Y.documentElement){Y=W.createDocument(Nt,"template",null);try{Y.documentElement.innerHTML=lc?j:qe}catch{}}const pt=Y.body||Y.documentElement;return C&&oe&&pt.insertBefore(t.createTextNode(oe),pt.childNodes[0]||null),Nt===qt?ie.call(Y,hr?"html":"body")[0]:hr?Y.documentElement:pt},yc=function(C){return G.call(C.ownerDocument||C,C,m.SHOW_ELEMENT|m.SHOW_COMMENT|m.SHOW_TEXT|m.SHOW_PROCESSING_INSTRUCTION|m.SHOW_CDATA_SECTION,null)},Vn=function(C){return C instanceof g&&(typeof C.nodeName!="string"||typeof C.textContent!="string"||typeof C.removeChild!="function"||!(C.attributes instanceof y)||typeof C.removeAttribute!="function"||typeof C.setAttribute!="function"||typeof C.namespaceURI!="string"||typeof C.insertBefore!="function"||typeof C.hasChildNodes!="function")},Rt=function(C){return typeof f=="function"&&C instanceof f};function lt(ue,C,Y){Gf(ue,oe=>{oe.call(e,C,Y,Wr)})}const Yr=function(C){let Y=null;if(lt(be.beforeSanitizeElements,C,null),Vn(C))return wn(C),!0;const oe=kt(C.nodeName);if(lt(be.uponSanitizeElement,C,{tagName:oe,allowedTags:T}),Fn&&C.hasChildNodes()&&!Rt(C.firstElementChild)&&hn(/<[/\w!]/g,C.innerHTML)&&hn(/<[/\w!]/g,C.textContent)||C.nodeType===wl.progressingInstruction||Fn&&C.nodeType===wl.comment&&hn(/<[/\w]/g,C.data))return wn(C),!0;if(!(bt.tagCheck instanceof Function&&bt.tagCheck(oe))&&(!T[oe]||_e[oe])){if(!_e[oe]&&hu(oe)&&(le.tagNameCheck instanceof RegExp&&hn(le.tagNameCheck,oe)||le.tagNameCheck instanceof Function&&le.tagNameCheck(oe)))return!1;if(Jt&&!Rn[oe]){const qe=$(C)||C.parentNode,pt=x(C)||C.childNodes;if(pt&&qe){const Ce=pt.length;for(let Wt=Ce-1;Wt>=0;--Wt){const Gn=S(pt[Wt],!0);Gn.__removalCount=(C.__removalCount||0)+1,qe.insertBefore(Gn,M(C))}}}return wn(C),!0}return C instanceof h&&!fu(C)||(oe==="noscript"||oe==="noembed"||oe==="noframes")&&hn(/<\/no(script|embed|frames)/i,C.innerHTML)?(wn(C),!0):(Fr&&C.nodeType===wl.text&&(Y=C.textContent,Gf([Ee,Pt,$t],qe=>{Y=pl(Y,qe," ")}),C.textContent!==Y&&(ml(e.removed,{element:C.cloneNode()}),C.textContent=Y)),lt(be.afterSanitizeElements,C,null),!1)},Aa=function(C,Y,oe){if(Sa&&(Y==="id"||Y==="name")&&(oe in t||oe in fc))return!1;if(!(qr&&!Le[Y]&&hn(Ne,Y))){if(!(ct&&hn(P,Y))){if(!(bt.attributeCheck instanceof Function&&bt.attributeCheck(Y,C))){if(!Q[Y]||Le[Y]){if(!(hu(C)&&(le.tagNameCheck instanceof RegExp&&hn(le.tagNameCheck,C)||le.tagNameCheck instanceof Function&&le.tagNameCheck(C))&&(le.attributeNameCheck instanceof RegExp&&hn(le.attributeNameCheck,Y)||le.attributeNameCheck instanceof Function&&le.attributeNameCheck(Y,C))||Y==="is"&&le.allowCustomizedBuiltInElements&&(le.tagNameCheck instanceof RegExp&&hn(le.tagNameCheck,oe)||le.tagNameCheck instanceof Function&&le.tagNameCheck(oe))))return!1}else if(!cc[Y]){if(!hn(Pe,pl(oe,me,""))){if(!((Y==="src"||Y==="xlink:href"||Y==="href")&&C!=="script"&&dj(oe,"data:")===0&&lu[C])){if(!(Ei&&!hn(ne,pl(oe,me,"")))){if(oe)return!1}}}}}}}return!0},hu=function(C){return C!=="annotation-xml"&&zy(C,Be)},du=function(C){lt(be.beforeSanitizeAttributes,C,null);const{attributes:Y}=C;if(!Y||Vn(C))return;const oe={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:Q,forceKeepAttr:void 0};let qe=Y.length;for(;qe--;){const pt=Y[qe],{name:Ce,namespaceURI:Wt,value:Gn}=pt,bn=kt(Ce),Mr=Gn;let Kt=Ce==="value"?Mr:mj(Mr);if(oe.attrName=bn,oe.attrValue=Kt,oe.keepAttr=!0,oe.forceKeepAttr=void 0,lt(be.uponSanitizeAttribute,C,oe),Kt=oe.attrValue,cu&&(bn==="id"||bn==="name")&&(dr(Ce,C),Kt=Md+Kt),Fn&&hn(/((--!?|])>)|<\/(style|title|textarea)/i,Kt)){dr(Ce,C);continue}if(bn==="attributename"&&zy(Kt,"href")){dr(Ce,C);continue}if(oe.forceKeepAttr)continue;if(!oe.keepAttr){dr(Ce,C);continue}if(!va&&hn(/\/>/i,Kt)){dr(Ce,C);continue}Fr&&Gf([Ee,Pt,$t],wc=>{Kt=pl(Kt,wc," ")});const gc=kt(C.nodeName);if(!Aa(gc,bn,Kt)){dr(Ce,C);continue}if(L&&typeof E=="object"&&typeof E.getAttributeType=="function"&&!Wt)switch(E.getAttributeType(gc,bn)){case"TrustedHTML":{Kt=L.createHTML(Kt);break}case"TrustedScriptURL":{Kt=L.createScriptURL(Kt);break}}if(Kt!==Mr)try{Wt?C.setAttributeNS(Wt,Ce,Kt):C.setAttribute(Ce,Kt),Vn(C)?wn(C):r1(e.removed)}catch{dr(Ce,C)}}lt(be.afterSanitizeAttributes,C,null)},mu=function ue(C){let Y=null;const oe=yc(C);for(lt(be.beforeSanitizeShadowDOM,C,null);Y=oe.nextNode();)lt(be.uponSanitizeShadowNode,Y,null),Yr(Y),du(Y),Y.content instanceof o&&ue(Y.content);lt(be.afterSanitizeShadowDOM,C,null)};return e.sanitize=function(ue){let C=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},Y=null,oe=null,qe=null,pt=null;if(lc=!ue,lc&&(ue="<!-->"),typeof ue!="string"&&!Rt(ue))if(typeof ue.toString=="function"){if(ue=ue.toString(),typeof ue!="string")throw yl("dirty is not a string, aborting")}else throw yl("toString is not a function");if(!e.isSupported)return ue;if(_i||hc(C),e.removed=[],typeof ue=="string"&&(Ai=!1),Ai){if(ue.nodeName){const Gn=kt(ue.nodeName);if(!T[Gn]||_e[Gn])throw yl("root node is forbidden and cannot be sanitized in-place")}}else if(ue instanceof f)Y=pc("<!---->"),oe=Y.ownerDocument.importNode(ue,!0),oe.nodeType===wl.element&&oe.nodeName==="BODY"||oe.nodeName==="HTML"?Y=oe:Y.appendChild(oe);else{if(!Vr&&!Fr&&!hr&&ue.indexOf("<")===-1)return L&&As?L.createHTML(ue):ue;if(Y=pc(ue),!Y)return Vr?null:As?j:""}Y&&ac&&wn(Y.firstChild);const Ce=yc(Ai?ue:Y);for(;qe=Ce.nextNode();)Yr(qe),du(qe),qe.content instanceof o&&mu(qe.content);if(Ai)return ue;if(Vr){if(_s)for(pt=H.call(Y.ownerDocument);Y.firstChild;)pt.appendChild(Y.firstChild);else pt=Y;return(Q.shadowroot||Q.shadowrootmode)&&(pt=de.call(r,pt,!0)),pt}let Wt=hr?Y.outerHTML:Y.innerHTML;return hr&&T["!doctype"]&&Y.ownerDocument&&Y.ownerDocument.doctype&&Y.ownerDocument.doctype.name&&hn(FO,Y.ownerDocument.doctype.name)&&(Wt="<!DOCTYPE "+Y.ownerDocument.doctype.name+`>
`+Wt),Fr&&Gf([Ee,Pt,$t],Gn=>{Wt=pl(Wt,Gn," ")}),L&&As?L.createHTML(Wt):Wt},e.setConfig=function(){let ue=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};hc(ue),_i=!0},e.clearConfig=function(){Wr=null,_i=!1},e.isValidAttribute=function(ue,C,Y){Wr||hc({});const oe=kt(ue),qe=kt(C);return Aa(oe,qe,Y)},e.addHook=function(ue,C){typeof C=="function"&&ml(be[ue],C)},e.removeHook=function(ue,C){if(C!==void 0){const Y=fj(be[ue],C);return Y===-1?void 0:hj(be[ue],Y,1)[0]}return r1(be[ue])},e.removeHooks=function(ue){be[ue]=[]},e.removeAllHooks=function(){be=l1()},e}var u1=VO();function Ct(n,e){return typeof n=="object"&&n!==null&&n.type===e}class Mj{isDeleteTenant(e){return Ct(e,"reqDeleteTenant")}isUpdateTenant(e){return Ct(e,"reqUpdateTenant")}isCreateTenant(e){return Ct(e,"reqCreateTenant")}isDeleteInvite(e){return Ct(e,"reqDeleteInvite")}isListInvites(e){return Ct(e,"reqListInvites")}isInviteUser(e){return Ct(e,"reqInviteUser")}isFindUser(e){return Ct(e,"reqFindUser")}isRedeemInvite(e){return Ct(e,"reqRedeemInvite")}isEnsureUser(e){return Ct(e,"reqEnsureUser")}isListTenantsByUser(e){return Ct(e,"reqListTenantsByUser")}isUpdateUserTenant(e){return Ct(e,"reqUpdateUserTenant")}isListLedgersByUser(e){return Ct(e,"reqListLedgersByUser")}isCreateLedger(e){return Ct(e,"reqCreateLedger")}isUpdateLedger(e){return Ct(e,"reqUpdateLedger")}isDeleteLedger(e){return Ct(e,"reqDeleteLedger")}isCloudSessionToken(e){return Ct(e,"reqCloudSessionToken")}isReqTokenByResultId(e){return Ct(e,"reqTokenByResultId")}isResTokenByResultId(e){return Ct(e,"resTokenByResultId")}isReqExtendToken(e){return Ct(e,"reqExtendToken")}isReqCertFromCsr(e){return Ct(e,"reqCertFromCsr")}isEnsureCloudToken(e){return Ct(e,"reqEnsureCloudToken")}}class Nj{apiUrl;isser=new Mj;constructor(e){this.apiUrl=e}async request(e){return Te(async()=>{const t=await fetch(this.apiUrl.toString(),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(e)});if(t.ok)return await t.json();throw new Error(`Request failed: ${t.status} ${t.statusText} ${this.apiUrl}`)})}async waitForToken(e,t){const r=await this.request({...e,type:"reqTokenByResultId"});if(r.isErr())return t.Error().Err(r).Msg("Error fetching token").ResultError();const i=r.unwrap();if(this.isser.isResTokenByResultId(i)){if(i.status==="found"){const o=i.token;return A.Ok({type:"resTokenByResultId",status:"found",resultId:e.resultId,token:o})}}else t.Warn().Any({returned:i}).Msg("fetching token failed");return A.Ok({type:"resTokenByResultId",status:"not-found",resultId:e.resultId})}}new Mt;const Rj=n=>async e=>new Uint8Array(await crypto.subtle.digest(n,e)),Dj=qA({name:"sha-1",code:17,encode:Rj("SHA-1")});class Vl{#e;base64;#t;#n;static fromString(e,t){const r=Ch.parse(JSON.parse(e.decode(t)));return new Vl(e,r)}static fromUnverifiedJWT(e,t){const r=wd(t),i=Ch.parse(r);return new Vl(e,i)}constructor(e,t){this.#e=Qk(Xy(t)),this.base64=e}asCert(){return this.#e}parseCertificateSubject(e){const t={};return e.split(",").forEach(r=>{const[i,o]=r.trim().split("=");i&&o&&(t[i]=o)}),t}async asSHA1(){this.#n||=this.base64.decodeUint8(this.asBase64());const e=await Dj.digest(this.#n);return st.encode(e.bytes)}async asSHA256(){this.#n||=this.base64.decodeUint8(this.asBase64());const e=await Bt.digest(this.#n);return st.encode(e.bytes)}asBase64(){return this.#t||=this.base64.encode(JSON.stringify(Xy(this.#e))),this.#t}}class Hh{#e;static async create(e={extractable:!0}){const t=await nP("ES256",e);return new Hh(t.privateKey)}static async createFromJWK(e,t={extractable:!0}){const r=jl.safeParse(e);if(!r.success)return A.Err(`Invalid JWK: ${r.error.message}`);const i=r.data,o=await ru(i,void 0,t);return o.isErr()?A.Err(o):A.Ok(new Hh(o.Ok().key))}constructor(e){this.#e=e}async fingerPrint(){return pg(await this.exportPrivateJWK(),"sha256")}async exportPrivateJWK(){const e=await Uh(this.#e),{success:t,data:r}=jl.safeParse(e);if(!t||!r)throw new Error("Invalid JWK");return r}async publicKey(){const e=await Uh(this.#e),{success:t,data:r,error:i}=ha.safeParse(e);if(!t||!r)throw new Error(`Invalid public JWK: ${i.message}`);return r}}class xj{async validateCSR(e){try{const t=CT(e);if(!t.jwk)throw new Error("No public key in CSR header");const{success:r,data:i}=ha.safeParse(t.jwk);if(!r||!i)return{valid:!1,error:"Invalid public key in CSR header"};const o=await ru(i,t.alg);if(o.isErr())return{valid:!1,error:`Failed to import public key: ${o.Err()}`};const{key:l,alg:f}=o.Ok(),{payload:h}=await nc(e,l,{typ:"CSR+JWT",algorithms:[f]}),{success:m,data:y}=wB.safeParse(h);if(!m||!y)return{valid:!1,error:"Invalid CSR payload"};const[g,b]=await Promise.all([pg(i),pg(y.csr.publicKey)]);return g!==b?{valid:!1,error:"CSR public key mismatch between header and payload"}:{valid:!0,payload:y,publicKey:i}}catch(t){return{valid:!1,error:t.message}}}}function Ij(n){return{...n,validityPeriod:n.validityPeriod||365*24*60*60,caChain:n.caChain||[]}}class tb{#e;#t;#n;constructor(e){this.#e=Ij(e),this.#t=e.caKey,this.#n=e.caSubject}static async from(e,t,r){let i;if(typeof t.privateKey=="string"){const S=await Te(async()=>{const M=st.decode(t.privateKey),x=e.txt.decode(M);return JSON.parse(x)});if(S.isErr())return A.Err(`Failed to decode privateKey: ${S.Err().message}`);const k=jl.safeParse(S.Ok());if(!k.success)return A.Err(`Invalid private key format: ${k.error.message}`);i=k.data}else i=t.privateKey;const o=await Hh.createFromJWK(i);if(o.isErr())return A.Err(`Failed to create DeviceIdKey: ${o.Err().message}`);const l=o.Ok(),f=await Te(async()=>await l.publicKey());if(f.isErr())return A.Err(`Failed to get public key: ${f.Err().message}`);const h=f.Ok(),m=await Te(async()=>await nc(t.signedCert,h,{typ:"CERT+JWT",algorithms:["ES256"]}));if(m.isErr())return A.Err(`Certificate verification failed: ${m.Err().message}`);const y=m.Ok(),g=Ch.safeParse(y.payload);if(!g.success)return A.Err(`Invalid certificate payload: ${g.error.message}: ${JSON.stringify(y.payload)}`);const E=g.data.certificate.issuer,_=new tb({base64:e.txt.base64,caKey:l,caSubject:E,actions:r});return A.Ok(_)}getCAKey(){return this.#t}async processCSR(e,t){const i=await new xj().validateCSR(e);return i.valid?this.issueCertificate({...i.payload,creatingUser:{type:"clerk",claims:t}}):A.Err(i.error)}async caCertificate(){const e=await this.issueCertificate({csr:{subject:this.#n,publicKey:await this.#t.publicKey()}});return e.isErr()?A.Err(e):A.Ok({certificate:Vl.fromUnverifiedJWT(this.#e.base64,e.Ok().certificateJWT).asCert(),jwtStr:e.Ok().certificateJWT})}async issueCertificate(e){const t=Math.floor(Date.now()/1e3),r=await this.#e.actions.generateSerialNumber(await this.#t.publicKey()),i={iss:this.#n.commonName,sub:e.csr.subject.commonName,aud:e.aud||"certificate-users",iat:t,nbf:t,exp:t+this.#e.validityPeriod,jti:r,creatingUser:e.creatingUser,certificate:{version:"3",serialNumber:r,subject:e.csr.subject,issuer:this.#n,validity:{notBefore:new Date(t*1e3).toISOString(),notAfter:new Date((t+this.#e.validityPeriod)*1e3).toISOString()},subjectPublicKeyInfo:e.csr.publicKey,signatureAlgorithm:"ES256",keyUsage:["digitalSignature","keyEncipherment"],extendedKeyUsage:["serverAuth"]}},o=await this.#t.exportPrivateJWK(),l=await this.#t.fingerPrint(),f=await new tP(i).setProtectedHeader({alg:"ES256",typ:"CERT+JWT",kid:l,x5c:this.#e.caChain}).sign(o);return A.Ok({certificateJWT:f,certificatePayload:i,format:"JWS",serialNumber:r,issuer:this.#n.commonName,subject:e.csr.subject.commonName,validityPeriod:{notBefore:new Date(t*1e3),notAfter:new Date((t+this.#e.validityPeriod)*1e3)},publicKey:e.csr.publicKey})}async buildCertificateExtensions(e,t,r){return{basicConstraints:{critical:!0,cA:!1,pathLenConstraint:null},keyUsage:{critical:!0,usage:e.keyUsage||["digitalSignature","keyEncipherment"]},extendedKeyUsage:{critical:!1,usage:e.extendedKeyUsage||["serverAuth"]},subjectAltName:{critical:!1,names:e.subjectAltName||[t.commonName]},authorityKeyIdentifier:{keyIdentifier:await this.#t.fingerPrint()},subjectKeyIdentifier:{keyIdentifier:await KB(r)}}}}class Uj{#e;#t;#n;constructor(e,t,r){this.#e=e,this.#t=t.map(i=>i.certificate),this.#n=r}createVerifyWithCertificateError(e,t={}){return{valid:!1,error:e.Err(),errorCode:this.getErrorCode(e.Err()),partialResults:{certificateExtracted:t.certificateExtracted??!1,jwtSignatureValid:t.jwtSignatureValid??!1,certificateInfo:t.certificateInfo},verificationTimestamp:new Date().toISOString()}}async verifyWithCertificate(e,t){let r,i=null,o=null;const l=this.extractCertificateFromJWT(e);if(l.isErr())return this.createVerifyWithCertificateError(l);r=l.Ok();const f=await this.validateCertificateThumbprint(r);if(f.isErr())return this.createVerifyWithCertificateError(f,{certificateExtracted:!0,certificateInfo:r});if(!f.Ok())return this.createVerifyWithCertificateError(A.Err("Certificate thumbprint validation failed"),{certificateExtracted:!0,certificateInfo:r});const h=await Te(async()=>{const g=await ru(r.certificate.asCert().certificate.subjectPublicKeyInfo,r.algorithm);if(g.isErr())throw g.Err();return nc(e,g.Ok().key,{clockTolerance:this.#n.clockTolerance,maxTokenAge:this.#n.maxAge})});if(h.isErr())return this.createVerifyWithCertificateError(h,{certificateExtracted:!0,certificateInfo:r});const m=h.Ok();if(!m)return this.createVerifyWithCertificateError(A.Err("JWT verification failed"),{certificateExtracted:!0,certificateInfo:r});i=m.payload,o=m.protectedHeader;const y=await this.validateCertificate(r.certificate);if(y.isErr())return this.createVerifyWithCertificateError(y,{certificateExtracted:!0,certificateInfo:r,jwtSignatureValid:!0});if(r.certificateChain.length>1)return this.createVerifyWithCertificateError(A.Err("Certificate chain validation not implemented"),{certificateExtracted:!0,certificateInfo:r});if(t){const g=t.safeParse(i);if(!g.success)return this.createVerifyWithCertificateError(A.Err(g.error),{certificateExtracted:!0,certificateInfo:r,jwtSignatureValid:!0});i=g.data}return{valid:!0,payload:i,header:o,certificate:{...r,validation:y.Ok(),publicKey:r.certificate.asCert().certificate.subjectPublicKeyInfo},verificationTimestamp:new Date().toISOString()}}extractCertificateFromJWT(e){return Te(()=>{const t=CT(e);if(!t.x5c||!Array.isArray(t.x5c)||t.x5c.length===0)throw new Error("No certificate chain (x5c) found in JWT header");const r=t.x5c.map(o=>Vl.fromString(this.#e,o));return{certificate:r[0],certificateChain:r,thumbprint:t.x5t,thumbprintSha256:t["x5t#S256"],keyId:t.kid,algorithm:t.alg,certificateUrl:t.x5u,rawHeader:t}})}async validateCertificateThumbprint(e){if(e.thumbprint){const t=await e.certificate.asSHA1();if(e.thumbprint!==t)return A.Err(new Error("Certificate SHA-1 thumbprint mismatch - certificate may have been tampered with"))}if(e.thumbprintSha256){const t=await e.certificate.asSHA256();if(e.thumbprintSha256!==t)return A.Err(new Error("Certificate SHA-256 thumbprint mismatch - certificate may have been tampered with"))}return A.Ok(!0)}async validateCertificate(e){const t=new Date;return Te(()=>{const r=e.asCert(),i=e.parseCertificateSubject(r.sub),o=e.parseCertificateSubject(r.iss),l=new Date(r.nbf*1e3),f=new Date(r.exp*1e3);if(l>t)throw new Error(`Certificate is not yet valid (valid from: ${l.toISOString()})`);if(f<t)throw new Error(`Certificate has expired (valid to: ${f.toISOString()})`);let h=null;if(h=this.findTrustedCA(r,this.#t),!h)throw new Error("Certificate not issued by a trusted CA");return{valid:!0,subject:i,issuer:o,serialNumber:r.certificate.serialNumber,notBefore:l,notAfter:f,publicKey:r.certificate.subjectPublicKeyInfo,trustedCA:h,validityPeriod:{days:Math.floor((f.getTime()-l.getTime())/(1e3*60*60*24))}}})}findTrustedCA(e,t){return t.find(r=>{try{return e.iss===r.sub}catch{return!1}})}getErrorCode(e){const{message:t}=e;return t.includes("thumbprint mismatch")?"CERT_THUMBPRINT_MISMATCH":t.includes("expired")?"CERT_EXPIRED":t.includes("not yet valid")?"CERT_NOT_YET_VALID":t.includes("self-signed")?"CERT_SELF_SIGNED":t.includes("not trusted")?"CERT_NOT_TRUSTED":t.includes("revoked")?"CERT_REVOKED":t.includes("signature verification failed")?"JWT_SIGNATURE_INVALID":t.includes("No certificate")?"CERT_NOT_FOUND":"VERIFICATION_FAILED"}}const zj=Or(n=>n.nextId().str);Or(n=>({id:parseInt(zj(n).replace(/[^0-9]/g,""),10)}));class Lj{sthis;constructor(e){this.sthis=e}keysAndUrls=Or(()=>{const e=[],t=[];for(let r=0;;r++){const i=r?`_${r}`:"",o=`CLERK_PUB_JWT_KEY${i}`,l=`CLERK_PUB_JWT_URL${i}`,f=this.sthis.env.gets({[o]:rn.OPTIONAL,[l]:rn.OPTIONAL});if(f.isErr())return A.Err(f.Err());const{[o]:h,[l]:m}=f.Ok();if(!h&&!m)break;h&&e.push(h),m&&t.push(...m.split(",").map(y=>y.trim()).filter(y=>y))}return A.Ok({keys:e,urls:t})});async verify(e){const t=this.keysAndUrls();if(t.isErr())return A.Err(t);const{keys:r,urls:i}=t.Ok(),o=await aP(e,r,i,{parseSchema:f=>{const h=gB.safeParse(f);return h.success?A.Ok(h.data):(console.log("FPClerkClaimSchema parse error",f,h.error),A.Err(h.error))},verifyToken:async(f,h)=>{const m=await ru(h,"RS256");if(m.isErr())return A.Err(m);const y=await Te(()=>nc(f,m.Ok().key));return y.isErr()?A.Err(y):y.Ok()?A.Ok({payload:y.Ok()}):A.Err("ClerkVerifyToken: failed")}});if(o.isErr())return A.Err(o.Err());const l=o.Ok();return A.Ok({type:"clerk",token:e,claims:l.payload})}}class Bj{sthis;opts;constructor(e,t){this.sthis=e,this.opts=t}async verify(e){const t=await this.opts.deviceIdCA.caCertificate();if(t.isErr())return A.Err(t);const i=await new Uj(this.sthis.txt.base64,[t.Ok()],{maxAge:3600,...this.opts}).verifyWithCertificate(e,bB);if(i.valid){const o=i.certificate.certificate.asCert().creatingUser;return!o||o.type!=="clerk"?A.Err(`DeviceIdApiToken-verify: unsupported creatingUser type: ${o}`):A.Ok({type:"device-id",token:e,claims:o.claims})}return A.Err(i.error)}}Or(n=>{const e=n.env.gets({DEVICE_ID_CA_PRIV_KEY:rn.REQUIRED,DEVICE_ID_CA_CERT:rn.REQUIRED});if(e.isErr())throw e.Err();const t=e.Ok();return tb.from(n,{privateKey:t.DEVICE_ID_CA_PRIV_KEY,signedCert:t.DEVICE_ID_CA_CERT},{generateSerialNumber:async()=>n.nextId(32).str})});Or(async(n,e)=>({"device-id":new Bj(n,e),clerk:new Lj(n)}));function Pj(n){return`
    <div class="fpOverlayContent">
      <div class="fpCloseButton">&times;</div>
      Fireproof Dashboard
      Sign in to Fireproof Dashboard
      <a href="${n}" target="_blank">Redirect to Fireproof</a>
    </div>
  `}const $j=`
.fpContainer {
  position: relative; /* Needed for absolute positioning of the overlay */
}

.fpOverlay {
  display: none; /* Initially hidden */
  position: fixed; /* Covers the whole viewport */
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5); /* Semi-transparent background */
  z-index: 1; /* Ensure it's on top of other content */
}

.fpOverlayContent {
  position: absolute;
  // width: calc(100vw - 50px);
  // height: calc(100vh - 50px);
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%); /* Center the content */
  // transform: translate(0%, 0%); /* Center the content */
  background-color: white;
  color: black;
  // margin: 10px;
  padding: 20px;
  border-radius: 5px;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
}

.fpCloseButton {
  position: absolute;
  top: 10px;
  right: 15px;
  font-size: 20px;
  cursor: pointer;
}
`;class Kj{resultId;overlayNode;waitState="stopped";overlayCss;overlayHtml;constructor(e={}){this.overlayCss=e.overlayCss??$j,this.overlayHtml=e.overlayHtml??Pj}hash=Or(()=>mi({overlayCss:this.overlayCss,overlayHtml:this.overlayHtml("X").toString()}));open(e,t,r,i){const o=i.context.get(dh);t.Debug().Url(o.dashboardURI).Msg("open redirect"),this.resultId=e.nextId().str;const l=an.from(o.dashboardURI).setParam("back_url",window.location.href).setParam("result_id",this.resultId).setParam("local_ledger_name",r);i.ledger&&l.setParam("ledger",i.ledger),i.tenant&&l.setParam("tenant",i.tenant);let f=document.body.querySelector("#fpOverlay");if(!f){const k=document.createElement("style");k.innerHTML=u1.sanitize(this.overlayCss),document.head.appendChild(k),f=document.createElement("div"),f.id="fpOverlay",f.className="fpOverlay",f.innerHTML=u1.sanitize(this.overlayHtml(l.toString())),document.body.appendChild(f),f.querySelector(".fpCloseButton")?.addEventListener("click",()=>{f&&(f.style.display==="block"?(f.style.display="none",this.stop()):f.style.display="block")})}f.style.display="block",this.overlayNode=f;const h=800,m=600,y=window.screenX||window.screenLeft,g=window.screenY||window.screenTop,b=window.outerWidth,E=window.outerHeight,_=y+b/2-h/2,S=g+E/2-m/2;window.open(l.asURL(),"Fireproof Login",`left=${_},top=${S},width=${h},height=${m},scrollbars=yes,resizable=yes,popup=yes`)}currentToken;waiting;stop(){this.waiting&&(clearTimeout(this.waiting),this.waiting=void 0),this.waitState="stopped"}async tryToken(e,t,r){if(!this.currentToken){const i=r.context.get(dh);this.currentToken=await i.token()}return this.currentToken}async getTokenAndClaimsByResultId(e,t,r,i,o,l=0){if(!r)return e.Error().Msg("No resultId");if(this.waitState!=="started")return;if(l*i.intervalSec>i.tokenWaitTimeSec){e.Error().Uint64("attempts",l).Msg("Token polling timed out"),this.stop();return}const f=await t.waitForToken({resultId:r},e);if(f.isErr())return e.Error().Err(f).Msg("Error fetching token").ResultError();const h=f.unwrap();if(h.status==="found"&&h.token){const m=h.token,y=wd(m);this.overlayNode?.style.setProperty("display","none"),o({token:m,claims:y});return}this.waiting=setTimeout(()=>this.getTokenAndClaimsByResultId(e,t,r,i,o),i.intervalSec)}async waitForToken(e,t,r,i){if(!this.resultId)throw new Error("waitForToken not working on redirect strategy");const o=i.context.get(dh),l=new Nj(o.tokenApiURI);return this.waitState="started",new Promise(f=>{this.getTokenAndClaimsByResultId(t,l,this.resultId,i,h=>{this.currentToken=h,f(h)})})}}new Kj;function jj(n){typeof n=="string"&&(n=Buffer.from(n));const e=new ArrayBuffer(n.length),t=new Uint8Array(e);for(let r=0;r<n.length;++r)t[r]=n[r];return t}class Hj{fs;async start(){return this.fs=await Bo(()=>Promise.resolve().then(()=>wH),void 0),this}async mkdir(e,t){return this.fs?.mkdir(e,t)}async readdir(e,t){return this.fs?.readdir(e,t)}async rm(e,t){return this.fs?.rm(e,t)}async copyFile(e,t){return this.fs?.copyFile(e,t)}async readfile(e,t){const r=await this.fs?.readFile(e,t);return jj(r)}stat(e){return this.fs?.stat(e)}async unlink(e){return this.fs?.unlink(e)}async writefile(e,t){return this.fs?.writeFile(e,t)}}const qj=new on;async function Fj(n){return qj.once(async()=>{const e=new Hj;return await e.start(),e})}const Vj=Object.freeze(Object.defineProperty({__proto__:null,getSysFileSystem:Fj},Symbol.toStringTag,{value:"Module"}));class Gj{fs;async start(){return this.fs=Deno,this}async mkdir(e,t){return this.fs?.mkdir(e,t).then(()=>e)}async readdir(e){const t=[];for await(const r of this.fs.readDir(e))t.push(r.name);return t}async rm(e,t){return this.fs?.rm(e,t)}async copyFile(e,t){return this.fs?.copyFile(e,t)}async readfile(e){return this.fs.readFile(e)}async stat(e){const t=await this.fs.stat(e);return{isFile:()=>t.isFile,isDirectory:()=>t.isDirectory,isBlockDevice:()=>!!t.isBlockDevice,isCharacterDevice:()=>!!t.isCharDevice,isSymbolicLink:()=>t.isSymlink,isFIFO:()=>!!t.isFifo,isSocket:()=>!!t.isSocket,uid:t.uid,gid:t.gid,size:t.size,atime:t.atime,mtime:t.mtime,ctime:t.birthtime,birthtime:t.birthtime}}async unlink(e){return this.fs?.remove(e)}async writefile(e,t){return this.fs?.writeFile(e,id(t))}}const Zj=new on;async function Jj(n){return Zj.once(async()=>{const e=new Gj;return await e.start(),e})}const Wj=Object.freeze(Object.defineProperty({__proto__:null,getSysFileSystem:Jj},Symbol.toStringTag,{value:"Module"})),Ig=(n,e)=>e.some(t=>n instanceof t);let f1,h1;function Yj(){return f1||(f1=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Qj(){return h1||(h1=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Ug=new WeakMap,Ky=new WeakMap,Cd=new WeakMap;function Xj(n){const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("success",o),n.removeEventListener("error",l)},o=()=>{t(na(n.result)),i()},l=()=>{r(n.error),i()};n.addEventListener("success",o),n.addEventListener("error",l)});return Cd.set(e,n),e}function eH(n){if(Ug.has(n))return;const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("complete",o),n.removeEventListener("error",l),n.removeEventListener("abort",l)},o=()=>{t(),i()},l=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",o),n.addEventListener("error",l),n.addEventListener("abort",l)});Ug.set(n,e)}let zg={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Ug.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return na(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function GO(n){zg=n(zg)}function tH(n){return Qj().includes(n)?function(...e){return n.apply(Lg(this),e),na(this.request)}:function(...e){return na(n.apply(Lg(this),e))}}function nH(n){return typeof n=="function"?tH(n):(n instanceof IDBTransaction&&eH(n),Ig(n,Yj())?new Proxy(n,zg):n)}function na(n){if(n instanceof IDBRequest)return Xj(n);if(Ky.has(n))return Ky.get(n);const e=nH(n);return e!==n&&(Ky.set(n,e),Cd.set(e,n)),e}const Lg=n=>Cd.get(n);function ZO(n,e,{blocked:t,upgrade:r,blocking:i,terminated:o}={}){const l=indexedDB.open(n,e),f=na(l);return r&&l.addEventListener("upgradeneeded",h=>{r(na(l.result),h.oldVersion,h.newVersion,na(l.transaction),h)}),t&&l.addEventListener("blocked",h=>t(h.oldVersion,h.newVersion,h)),f.then(h=>{o&&h.addEventListener("close",()=>o()),i&&h.addEventListener("versionchange",m=>i(m.oldVersion,m.newVersion,m))}).catch(()=>{}),f}const rH=["get","getKey","getAll","getAllKeys","count"],sH=["put","add","delete","clear"],jy=new Map;function d1(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(jy.get(e))return jy.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,i=sH.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(i||rH.includes(t)))return;const o=async function(l,...f){const h=this.transaction(l,i?"readwrite":"readonly");let m=h.store;return r&&(m=m.index(f.shift())),(await Promise.all([m[t](...f),i&&h.done]))[0]};return jy.set(e,o),o}GO(n=>({...n,get:(e,t,r)=>d1(e,t)||n.get(e,t,r),has:(e,t)=>!!d1(e,t)||n.has(e,t)}));const iH=["continue","continuePrimaryKey","advance"],m1={},Bg=new WeakMap,JO=new WeakMap,aH={get(n,e){if(!iH.includes(e))return n[e];let t=m1[e];return t||(t=m1[e]=function(...r){Bg.set(this,JO.get(this)[e](...r))}),t}};async function*oH(...n){let e=this;if(e instanceof IDBCursor||(e=await e.openCursor(...n)),!e)return;e=e;const t=new Proxy(e,aH);for(JO.set(t,e),Cd.set(t,Lg(e));e;)yield t,e=await(Bg.get(t)||e.continue()),Bg.delete(t)}function p1(n,e){return e===Symbol.asyncIterator&&Ig(n,[IDBIndex,IDBObjectStore,IDBCursor])||e==="iterate"&&Ig(n,[IDBIndex,IDBObjectStore])}GO(n=>({...n,get(e,t,r){return p1(e,t)?oH:n.get(e,t,r)},has(e,t){return p1(e,t)||n.has(e,t)}}));class y1{_db=new on;dbName;url;logger;sthis;constructor(e,t){this.sthis=t,this.logger=t.logger,this.url=e,this.dbName=Eg(this.url,this.sthis)}async _prepare(){return this._db.once(async()=>await ZO(this.dbName,1,{upgrade(e){["bag"].map(t=>{e.createObjectStore(t,{autoIncrement:!1})})}}))}async del(e){const r=(await this._prepare()).transaction(["bag"],"readwrite");await r.objectStore("bag").delete(e),await r.done}async get(e){const r=(await this._prepare()).transaction(["bag"],"readonly"),i=await r.objectStore("bag").get(e);if(await r.done,!!i)return i}async set(e,t){const i=(await this._prepare()).transaction(["bag"],"readwrite");await i.objectStore("bag").put(t,e),await i.done}}class cH{name;autoIncrement=!1;keyPath=[];transaction;constructor(e,t){this.transaction=t,this.name=e}indexNames=void 0;add=((e,t)=>{throw new Error("add not implemented.")});clear=void 0;createIndex=void 0;delete=(async e=>{throw new Error("delete not implemented.")});put=void 0;get(e){return Promise.resolve(void 0)}getAll(e,t){return Promise.resolve([])}getAllKeys(e,t){return Promise.resolve([])}getKey(e){return Promise.resolve(void 0)}index(e){throw new Error("Method not implemented.")}openCursor(e,t){throw new Error("Method not implemented.")}openKeyCursor(e,t){throw new Error("Method not implemented.")}iterate(e,t){throw new Error("Method not implemented.")}[Symbol.asyncIterator](){throw new Error("Method not implemented.")}deleteIndex(e){throw new Error("Method not implemented.")}count(e){throw new Error("count not implemented.")}}class lH{get objectStoreNames(){throw new Error("objectStoreNames not implemented.")}version;name;constructor(e,t=666){this.name=e,this.version=t}createObjectStore(e,t){throw new Error("createObjectStore not implemented.")}deleteObjectStore(e){throw new Error("deleteObjectStore not implemented.")}transaction(e,t,r){return{done:Promise.resolve(),objectStore:function(i){return new cH(i,this)}}}add(e,t,r){throw new Error("add not implemented.")}clear(e){throw new Error("clear not implemented.")}count(e,t){throw new Error("count not implemented.")}countFromIndex(e,t,r){throw new Error("countFromIndex not implemented.")}delete(e,t){return Promise.resolve()}get(e,t){throw new Error("get not implemented.")}getFromIndex(e,t,r){throw new Error("getFromIndex not implemented.")}getAll(e,t,r){return Promise.resolve([])}getAllFromIndex(e,t,r,i){return Promise.resolve([])}getAllKeys(e,t,r){return Promise.resolve([])}getAllKeysFromIndex(e,t,r,i){return Promise.resolve([])}getKey(e,t){return Promise.resolve(void 0)}getKeyFromIndex(e,t,r){return Promise.resolve(void 0)}put(e,t,r){throw new Error("put not implemented.")}onabort=null;onclose=null;onerror=null;onversionchange=null;close(){throw new Error("close not implemented.")}addEventListener(e,t,r){throw new Error("addEventListener not implemented.")}removeEventListener(e,t,r){throw new Error("removeEventListener not implemented.")}dispatchEvent(e){throw new Error("dispatchEvent not implemented.")}}function nb(n){return n.build().defParam(te.VERSION,Fw).URI()}const bl=new Mt;function Jf(n){return n.length===1&&(n=n[0]),n}const WO=new on;function uH(n,e,t){return async()=>{const r=await ZO(n.fullDb,1,{upgrade(l){["version","data","wal","meta","idx.data","idx.wal","idx.meta"].map(f=>{l.createObjectStore(f,{autoIncrement:!1})})}});WO.reset();const i=await r.get("version","version"),o=nb(e).getParam(te.VERSION);return i?i.version!==o&&t.logger.Warn().Url(e).Str("version",o).Str("found",i.version).Msg("version mismatch"):await r.put("version",{version:o},"version"),{db:r,dbName:n,version:o,url:e}}}async function Fi(n,e,t){const r=fH(e,t);if(n==="close"){bl.has(r.fullDb)&&((await bl.get(r.fullDb).once(()=>Promise.reject(new Error("not open")))).db.close(),bl.unget(r.fullDb));return}if((n==="read"||n==="delete")&&!bl.has(r.fullDb)&&!(await WO.once(()=>indexedDB.databases())).find(o=>o.name===r.fullDb)){const o=nb(e);return{db:new lH(r.fullDb),dbName:r,version:o.getParam(te.VERSION,Fw),url:o}}return bl.get(r.fullDb).once(uH(r,e,t))}function Ji(...n){return n.map(e=>e.replace(/^[^a-zA-Z0-9]+/g,"").replace(/[^a-zA-Z0-9-]+/g,"_")).filter(e=>e.length).join(".")}function fH(n,e){const t=nb(n),r=t.pathname.replace(/^\/+/,"").replace(/\?.*$/,""),i=t.getParam(te.NAME);if(!i)throw e.logger.Error().Str("url",t.toString()).Msg("name not found").AsError();const o=Ji(r,i),l=Gi(t,e,Ji).name,f=[o,l].join(":");return{fullDb:o,objStore:l,connectionKey:f,dbName:i}}class hH{async start(e,t){return Te(async()=>{await t.start(),t.logger.Debug().Url(e).Msg("starting");const r=await Fi("read",e,t);return t.logger.Debug().Url(r.url).Msg("started"),e.build().setParam(te.VERSION,r.version).URI()})}async close(e,t){return await Fi("close",e,t),A.Ok(void 0)}async destroy(e,t){return Te(async()=>{const r=Gi(e,t,Ji).name,o=(await Fi("write",e,t)).db.transaction(r,"readwrite"),l=o.objectStore(r),f=[];for(let h=await l.openCursor();h;h=await h.continue())f.push(h.primaryKey);for(const h of f)await o.db.delete(r,h);await o.done})}buildUrl(e,t){return Promise.resolve(A.Ok(e.build().setParam(te.KEY,t).URI()))}async get(e,t){return Gk(async()=>{const r=hy(e,t.logger),i=Gi(e,t,Ji).name;t.logger.Debug().Url(e).Str("key",r).Str("store",i).Msg("getting");const l=(await Fi("read",e,t)).db.transaction([i],"readonly"),f=await l.objectStore(i).get(Jf(r));return await l.done,f?Promise.resolve(A.Ok(f)):A.Err(new Kr(`missing ${r} ${e.toString()}`))})}async put(e,t,r){return Te(async()=>{const i=hy(e,r.logger),o=Gi(e,r,Ji).name;r.logger.Debug().Url(e).Str("key",i).Str("store",o).Msg("putting");const f=(await Fi("write",e,r)).db.transaction([o],"readwrite");await f.objectStore(o).put(t,Jf(i)),await f.done})}async delete(e,t){return Te(async()=>{const r=hy(e,t.logger),i=Gi(e,t,Ji).name;t.logger.Debug().Url(e).Str("key",r).Str("store",i).Msg("deleting");const l=(await Fi("delete",e,t)).db.transaction([i],"readwrite");return await l.objectStore(i).delete(Jf(r)),await l.done,A.Ok(void 0)})}async getPlain(e,t,r){const i=await Fi("read",e,r),o=Gi(i.url,r,Ji).name;r.logger.Debug().Str("key",t).Str("store",o).Msg("getting");let l=await i.db.get(o,Jf(t));return r.logger.Debug().Str("key",t).Str("store",o).Int("len",l.length).Msg("got"),typeof l=="string"&&(l=r.txt.encode(l)),A.Ok(l)}}const YO=Object.freeze(Object.defineProperty({__proto__:null,GatewayImpl:hH,KeyBagProviderImpl:y1,KeyBagProviderIndexedDB:y1},Symbol.toStringTag,{value:"Module"}));var Hy,g1;function dH(){return g1||(g1=1,Hy=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}),Hy}var mH=dH();const pH=b1({__proto__:null},[mH]);var qy,w1;function yH(){if(w1)return qy;w1=1;function n(i){if(typeof i!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(i))}function e(i,o){for(var l="",f=0,h=-1,m=0,y,g=0;g<=i.length;++g){if(g<i.length)y=i.charCodeAt(g);else{if(y===47)break;y=47}if(y===47){if(!(h===g-1||m===1))if(h!==g-1&&m===2){if(l.length<2||f!==2||l.charCodeAt(l.length-1)!==46||l.charCodeAt(l.length-2)!==46){if(l.length>2){var b=l.lastIndexOf("/");if(b!==l.length-1){b===-1?(l="",f=0):(l=l.slice(0,b),f=l.length-1-l.lastIndexOf("/")),h=g,m=0;continue}}else if(l.length===2||l.length===1){l="",f=0,h=g,m=0;continue}}o&&(l.length>0?l+="/..":l="..",f=2)}else l.length>0?l+="/"+i.slice(h+1,g):l=i.slice(h+1,g),f=g-h-1;h=g,m=0}else y===46&&m!==-1?++m:m=-1}return l}function t(i,o){var l=o.dir||o.root,f=o.base||(o.name||"")+(o.ext||"");return l?l===o.root?l+f:l+i+f:f}var r={resolve:function(){for(var o="",l=!1,f,h=arguments.length-1;h>=-1&&!l;h--){var m;h>=0?m=arguments[h]:(f===void 0&&(f=process.cwd()),m=f),n(m),m.length!==0&&(o=m+"/"+o,l=m.charCodeAt(0)===47)}return o=e(o,!l),l?o.length>0?"/"+o:"/":o.length>0?o:"."},normalize:function(o){if(n(o),o.length===0)return".";var l=o.charCodeAt(0)===47,f=o.charCodeAt(o.length-1)===47;return o=e(o,!l),o.length===0&&!l&&(o="."),o.length>0&&f&&(o+="/"),l?"/"+o:o},isAbsolute:function(o){return n(o),o.length>0&&o.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var o,l=0;l<arguments.length;++l){var f=arguments[l];n(f),f.length>0&&(o===void 0?o=f:o+="/"+f)}return o===void 0?".":r.normalize(o)},relative:function(o,l){if(n(o),n(l),o===l||(o=r.resolve(o),l=r.resolve(l),o===l))return"";for(var f=1;f<o.length&&o.charCodeAt(f)===47;++f);for(var h=o.length,m=h-f,y=1;y<l.length&&l.charCodeAt(y)===47;++y);for(var g=l.length,b=g-y,E=m<b?m:b,_=-1,S=0;S<=E;++S){if(S===E){if(b>E){if(l.charCodeAt(y+S)===47)return l.slice(y+S+1);if(S===0)return l.slice(y+S)}else m>E&&(o.charCodeAt(f+S)===47?_=S:S===0&&(_=0));break}var k=o.charCodeAt(f+S),M=l.charCodeAt(y+S);if(k!==M)break;k===47&&(_=S)}var x="";for(S=f+_+1;S<=h;++S)(S===h||o.charCodeAt(S)===47)&&(x.length===0?x+="..":x+="/..");return x.length>0?x+l.slice(y+_):(y+=_,l.charCodeAt(y)===47&&++y,l.slice(y))},_makeLong:function(o){return o},dirname:function(o){if(n(o),o.length===0)return".";for(var l=o.charCodeAt(0),f=l===47,h=-1,m=!0,y=o.length-1;y>=1;--y)if(l=o.charCodeAt(y),l===47){if(!m){h=y;break}}else m=!1;return h===-1?f?"/":".":f&&h===1?"//":o.slice(0,h)},basename:function(o,l){if(l!==void 0&&typeof l!="string")throw new TypeError('"ext" argument must be a string');n(o);var f=0,h=-1,m=!0,y;if(l!==void 0&&l.length>0&&l.length<=o.length){if(l.length===o.length&&l===o)return"";var g=l.length-1,b=-1;for(y=o.length-1;y>=0;--y){var E=o.charCodeAt(y);if(E===47){if(!m){f=y+1;break}}else b===-1&&(m=!1,b=y+1),g>=0&&(E===l.charCodeAt(g)?--g===-1&&(h=y):(g=-1,h=b))}return f===h?h=b:h===-1&&(h=o.length),o.slice(f,h)}else{for(y=o.length-1;y>=0;--y)if(o.charCodeAt(y)===47){if(!m){f=y+1;break}}else h===-1&&(m=!1,h=y+1);return h===-1?"":o.slice(f,h)}},extname:function(o){n(o);for(var l=-1,f=0,h=-1,m=!0,y=0,g=o.length-1;g>=0;--g){var b=o.charCodeAt(g);if(b===47){if(!m){f=g+1;break}continue}h===-1&&(m=!1,h=g+1),b===46?l===-1?l=g:y!==1&&(y=1):l!==-1&&(y=-1)}return l===-1||h===-1||y===0||y===1&&l===h-1&&l===f+1?"":o.slice(l,h)},format:function(o){if(o===null||typeof o!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof o);return t("/",o)},parse:function(o){n(o);var l={root:"",dir:"",base:"",ext:"",name:""};if(o.length===0)return l;var f=o.charCodeAt(0),h=f===47,m;h?(l.root="/",m=1):m=0;for(var y=-1,g=0,b=-1,E=!0,_=o.length-1,S=0;_>=m;--_){if(f=o.charCodeAt(_),f===47){if(!E){g=_+1;break}continue}b===-1&&(E=!1,b=_+1),f===46?y===-1?y=_:S!==1&&(S=1):y!==-1&&(S=-1)}return y===-1||b===-1||S===0||S===1&&y===b-1&&y===g+1?b!==-1&&(g===0&&h?l.base=l.name=o.slice(1,b):l.base=l.name=o.slice(g,b)):(g===0&&h?(l.name=o.slice(1,y),l.base=o.slice(1,b)):(l.name=o.slice(g,y),l.base=o.slice(g,b)),l.ext=o.slice(y,b)),g>0?l.dir=o.slice(0,g-1):h&&(l.dir="/"),l},sep:"/",delimiter:":",win32:null,posix:null};return r.posix=r,qy=r,qy}var QO=yH();const gH=Gl(QO),wH=b1({__proto__:null,default:gH},[QO]);export{SH as F,vH as R,bH as j,ee as r,AH as u};
